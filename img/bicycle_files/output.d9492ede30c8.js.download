/*
 https://fareharbor.com/about/licenses/
*/
window.FH_VERSION="0.9.0.1";
(function(){window.configure=function(m){var c=window.slipstream?window.slipstream.configuration:"unknown";m.factory("$exceptionHandler",[function(){return function(c,k){var f=_.isArray(c.stack)?c.stack.join("\n"):c.stack,l="$exceptionHandler: uncaught exception "+c.message;k&&(l+=' (caused by "'+k+'")',c.message+=' (caused by "'+k+'")');console.error(l,f||"(no stack trace)")}}]);m.config(["$animateProvider","$compileProvider","$injector","$interpolateProvider","$httpProvider","$locationProvider",
"$sceProvider","$qProvider","convertProvider",function(g,k,f,l,e,a,q,h,d){k.debugInfoEnabled("production"!==c);a.html5Mode(!0);a.hashPrefix("!");l.startSymbol("[[");l.endSymbol("]]");l.staticStartSymbol("[!");l.staticEndSymbol("!]");e.defaults.transformResponse.push(function(b){return d.serverResponse(b)});e.defaults.transformRequest.unshift(function(b){return d.clientRequest(b)});e.defaults.xsrfCookieName="csrftoken";e.defaults.xsrfHeaderName="X-CSRFToken";e.defaults.headers.common["X-Requested-With"]=
"XMLHttpRequest";e.defaults.headers.common["X-CSRFToken"]=window.slipstream.csrfToken||"";g.classNameFilter(/\banimatable\b/);h.errorOnUnhandledRejections(!1)}]);m.run(["$filter","$browser","$injector","$interpolate","$rootScope",function(c,k,f,l,e){window.$$injector=f;e.isReadonlyEnabled=window.slipstream.isReadonlyEnabled;e.max=Math.max;e.addClassIf=c("addClassIf");e.isUndefined=c("isUndefined");e.DESKTOP_MIN_WIDTH=680;e.T=window.T;e.cT=window.cT;e.nT=window.nT;e.ncT=window.ncT;e.interpolate=interpolate;
e.msie=document.documentMode;e.$bind=function(a,h){var d=this,b=function(){var b=_.get(d,h);_.set(d,a,b)};b();d.$watch(b)};e.$model=function(a){var h=_.bind(a,a,this);h.assign=_.bind(a.assign,a,this);return h};e.$once=function(a,h){var d=this.$on(a,function(){d();return h.apply(this,arguments)});return d};e.isSet=function(a){return _.isUndefined(a)?!1:""===a?!0:this.$eval(a)};var a=e.$new;e.$new=function(q,h){return q?a.call(this,!1,this.$root):a.call(this,q,h)};e.$safeApply=function(a){if(this.$root){var h=
this.$root.$$phase;return"$apply"==h||"$digest"==h?a&&a():this.$apply(a)}};e.$safeDigest=function(){if(this.$root){var a=this.$root.$$phase;"$apply"==a||"$digest"==a||this.$digest()}};e.$asyncApply=function(a){var h=k.defer(_.ignore,31536E6),d=function(){k.defer.cancel(h)};a(d);return d};e.$interpolate=function(a,h){var d=this,b=!1;h&&(d=d.$new(),_.extend(d,h),b=!0);if(_.isUndefined(a))return"";var A=l(a);if(!A)return"";A=A(d);b&&d.$destroy();return A};window.$$digest=function(a,h){var d=angular.element(document.querySelector("[ng-app]"));
h=h||d.injector().get("$rootScope");a=a||100;console.info("digest: running "+a+"...");for(var d=performance.now(),b=0;b<a;b++)h.$digest();b=performance.now();console.info("digest: average time "+(b-d)/a+"ms");var d=0,b=h,A;do if(d+=b.$$watchers?b.$$watchers.length:0,!(A=b.$$childHead||b!==h&&b.$$nextSibling))for(;b!==h&&!(A=b.$$nextSibling);)b=b.$parent;while(b=A);console.info("digest: watcher count",d)};window.$$scope=function(a){return angular.element(a).scope()}}])}})();angular.module("lib","lib.controllers lib.directives lib.filters lib.factories lib.services lib.services.interpolate".split(" "));
(function(){var m=angular.module("lib.directives",[]),c={isTouchEnabled:"ontouchstart"in window||navigator.msMaxTouchPoints,isTextInput:function(a){return a.is("input")&&_.isUndefined(a.attr("type"))||a.is('input[type="text"], input[type="password"], input[type="email"], input[type="tel"], input[type="number"], input[type="url"], input[type="search"], textarea')},bind:function(a,h,d){a.$watch(d,function(b){a[h]=b})},watcher:function(a,h,d,b,A){var s=a.$eval(h);a.$watch(h,function(d){s=d;b&&b(s)},
A);return function(){return!_.isUndefined(s)?s:d}},observer:function(a,h,d,b){var A;A=a[h];a.$observe(h,function(d){A=d;b&&b(A)});return function(){if(!_.isUndefined(A))return A;if(!_.isUndefined(d))return d;throw Error("d: undefined attribute "+h+" for observer");}},restrictKeypresses:function(a,h){a.on("keypress",function(d){if(d.which&&(!d.metaKey&&!d.controlKey&&!d.altKey)&&!(8===d.which||9===d.which||13===d.which)){var b=String.fromCharCode(d.which);h.test(b)||d.preventDefault()}})},safeInvoke:function(a,
h){return _.isArray(h)?a.invoke(h):h},conditionalDirective:function(a){a=_.extend({operator:_.constant(_.identity),link:_.constant(_.ignore),transclude:_.constant(_.ignore),once:_.never},a);return["$animate","$injector",function(h,d){return _.extend({transclude:"element",priority:800,terminal:!0,restrict:"A",compile:function(b,A,s){var r=c.safeInvoke(d,a.watch),e=c.safeInvoke(d,a.operator),G=c.safeInvoke(d,a.transclude),f=c.safeInvoke(d,_.isBoolean(a.once)?_.constant(a.once):a.once);return function(b,
d,A,c){a.link(b,d,A,c);var p,g,k=r(b,d,A,c),l=G(b,d,A,c),m=e(b,d,A,c),J=b.$watch(k,function(a){p&&(h.leave(p),p=void 0);g&&(g.$destroy(),g=void 0);m(a)&&(g=b.$new(),s(g,function(b){p=b;l(g,b);h.enter(b,d.parent(),d)}));f(b,d,A)&&J()})}}},a.directiveDescription)}]},isDropdownSupported:/iP(od|hone|ad)/i.test(window.navigator.userAgent)||/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)||/BlackBerry|Windows Phone|webOS/i.test(window.navigator.userAgent)?!1:!0,chromeVersion:function(){var a=
navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return a?_.int(a[2]):null}};m.constant("d",c);m.config(["$provide",function(a){a.decorator("ngIfDirective",["$delegate",function(a){a.shift();return a}])}]);var g=function(a){var h=a.$modelValue;_.forEach(a.$formatters,function(d){h=d(h)});a.$viewValue=h;a.$render()},k=function(a,h){m.directive(a,[function(){return{restrict:h,priority:500,require:"form",link:function(d,b,a,q){q.$errorCallbacks=[];q.$successCallbacks=[];b.attr("novalidate","novalidate")}}}])};
k("form","E");k("ngForm","A");var f=function(a,h){var d="20"+a,b=parseInt(h,10).toFixed();if(!isNaN(b))return{month:b,year:d}},l=[{device:"MSR100U",trackSeparator:"^",fullName:function(a){var h=a.split("/");a=(h[1]||"").trim();h=(h[0]||"").trim();return a?a+" "+h:h},details:function(a){var h=/;(\d+)=(\d\d)(\d\d)/.exec(a);h||(h=/%B(\d+)=(\d\d)(\d\d)/.exec(a));if(h&&(a=h[1],h=f(h[2],h[3])))return{number:a,expiryMonth:h.month,expiryYear:h.year}}},{device:"denzer-has-a-weird-one",trackSeparator:"^",fullName:_.identity,
details:function(a){var h=/;(\d+)=(\d\d)(\d\d)/.exec(a);if(h&&(a=h[1],h=f(h[2],h[3])))return{number:a,expiryMonth:h.month,expiryYear:h.year}}},{device:"knock-off-MSR100U",trackSeparator:"",details:function(a){var h=/^(\d+)=(\d\d)(\d\d)/.exec(a);if(h&&(a=h[1],h=f(h[2],h[3])))return{number:a,expiryMonth:h.month,expiryYear:h.year}}}];m.directive("ngOverthrow",[function(){return{restrict:"A",link:function(a,h,d){h.addClass("overthrow")}}}]);m.directive("ngSticky",["$parse","$window","auth","d",function(a,
h,d,b){return{restrict:"A",link:function(a,q,r){if(!a.isSet(r.ngStickyAllowTouch)&&b.isTouchEnabled)console.info("ng-sticky: touch is enabled");else{var c=a.isSet(r.ngStickyDisableMsie),e=document.documentMode;if(!c||!(e&&11>=e)){var f=a.$eval(r.ngStickyEdgeTopMargin)||0;a.$eval(r.ngStickyEdgeBottomMargin);var g=a.$eval(r.ngStickyTopMargin)||0,n=a.$eval(r.ngStickyBottomMargin)||0,k=$(h),l=function(){var b=$(r.ngStickyContent);if(b.length){var a=d.currentUser.isAuthenticated?93:0,h=k.height()-a,p=
k.scrollTop(),c=b.offset().top,b=b.outerHeight(),A=q.outerHeight();if(A>b||A>h)return q.removeClass("sticky sticky-pinned sticky-floating").css({top:"",bottom:""}),"no-sticky";h=p+(f+a);p=c+g;c=h+A>c+b-n;b=h>p&&!c;if(h<=p)return c=g,q.removeClass("sticky-floating"),q.addClass("sticky sticky-pinned").css({top:c,bottom:""}),["sticky-pinned","top",c];if(b)return c=a+f,q.removeClass("sticky-pinned"),q.addClass("sticky sticky-floating").css({top:a+f,bottom:""}),["sticky-floating","top",c];if(c)return q.removeClass("sticky-floating"),
q.addClass("sticky sticky-pinned").css({top:"",bottom:n}),["sticky-pinned","bottom",n];console.warn("ng-sticky: nothing makes sense")}},p,m=function(){var b=l();angular.equals(p,b)||(p=b,a.$apply())};k.on("scroll",m);k.on("resize",m);a.$watch(function(){setTimeout(m)})}}}}}]);m.directive("ngSwipe",[function(){return{restrict:"A",link:function(a,h,d){var b=a.$eval(d.ngSwipe),c=function(b){return _.chooseFirst(l,function(a){var d="";if(a.trackSeparator){var q=b.split(a.trackSeparator);if(3!==q.length)return;
d=a.fullName(q[1]);if(_.isUndefined(d))return}else q=["","",b];a=a.details(q[2]);if(!_.isUndefined(a))return _.extend(a,{fullName:d})})};h.on("keypress",function(d){13===d.which&&a.$apply(function(){b(c(h.val()))})});h.on("blur",function(){a.$apply(function(){b()})});h.val("");h.focus()}}}]);m.directive("ngApp",[function(){return{restrict:"A",link:function(a,h,d){$("html").removeClass("html-loading")}}}]);m.directive("ngAutoselect",["d",function(a){return{restrict:"A",link:function(h,d,b){d.attr("readonly",
"readonly");if(!a.isTouchEnabled){var c=!1;d.on("click",function(){d.focus();c||(d.select(),c=!0)});d.on("blur",function(){c=!1})}}}}]);m.directive("ngAutofocus",["$parse","$timeout","d",function(a,h,d){var b="input, textarea, select",c=function(a){if(a.is(b))return a;a=a.find(b).first();if(a.length)return a};return{restrict:"A",link:function(s,r,e){var f=s.isSet(e.ngAutofocus),g=s.isSet(e.ngAutofocusSelect),k=s.isSet(e.ngAutofocusOpen),n=e.ngAutofocusWhen?a(e.ngAutofocusWhen):_.always;b+=e.ngAutofocusElement?
", "+e.ngAutofocusElement:"";f&&(d.isTouchEnabled?g&&h(function(){var b=c(r);if(b&&!b.is("select"))b.on("focus",function(){h(function(){b[0].setSelectionRange(0,1E3)})})}):h(function(){if(n(s)){var b=c(r);b&&(b.hasClass("ng-dropdown")?(b.trigger("dropdown:focus"),k&&b.trigger("dropdown:open")):(b.focus(),g&&!b.is("select")&&b.select()))}}))}}}]);m.directive("ngAutoNavigate",["$location","$timeout","$window","navigation",function(a,h,d,b){return{restrict:"A",link:function(c,s,r){var e=!1;(e=r.ngAutoNavigate?
c.$eval(r.ngAutoNavigate):!0)&&h(function(){var h=s.prop("href");a.$$rewrite(h)?b.navigate(h):(d.parent||window).location.href=h})}}}]);m.directive("ngCurrentOption",["$parse",function(a){return{restrict:"A",scope:!0,controller:["$scope","$attrs",function(h,d){var b=this,c=a(d.ngCurrentOption),s=a(d.ngCurrentOptionTarget||"currentOption"),r=a(d.ngCurrentOptionCollection),e=a(d.ngCurrentOptionOnUpdate),f=h.$eval(d.ngCurrentOptionKey)||"pk",g=function(a,d){var q=_.find(d,function(b){return b[f]===a});
q||(q=null);s.assign(h.$parent,q);var r=b.currentOption;b.currentOption=q;e&&r!==b.currentOption&&e(h)};h.$parent.$watch(c,function(b){var a=r(h);g(b,a)});h.$parent.$watch(function(){return _.pluck(r(h),"uri")},function(){var b=r(h),a=c(h);g(a,b)},!0)}],controllerAs:"currentOptionCtrl"}}]);m.directive("ngWatchHeight",["$document","$window","db","lightframe",function(a,h,d,b){return{restrict:"A",link:function(d,h,r){var c=function(){if(a[0].body)return a[0].body.offsetHeight},e=function(a){b.updateHeight(a)};
d.$watch(c,e);setInterval(function(){e(c())},2500)}}}]);m.directive("ngDimensions",["$document","$parse","$window","$rootScope","scrollbar",function(a,h,d,b,c){var e=function(){return{width:Math.max(a[0].documentElement.clientWidth,d.innerWidth||0),height:Math.max(a[0].documentElement.clientHeight,d.innerHeight||0)}},r=function(b){return{width:b.width(),height:b.height(),outerWidth:b.outerWidth(),outerHeight:b.outerHeight()}};return{restrict:"A",link:function(b,a,q){if(!q.ngDimensionsWhen||b.$eval(q.ngDimensionsWhen)){var f=
b.isSet(q.ngDimensionsViewport)?e:_.bind(r,null,a);a=h(q.ngDimensions||"dimensions");var n=f();a.assign(b,n);var g=Math.max(c.getWidth(),15);a=function(){var a=f();if(!(a.width===n.width&&a.height===n.height)){var d=n.width-a.width;0<d&&d<=g||(_.extend(n,a),b.$digest())}};var k=_.debounce(a,0),p=_.debounce(a,250);b.$watch(k);$(d).on("resize",p);b.$on("$destroy",function(){$(d).off("resize",p);k.cancel();p.cancel()})}}}}]);m.directive("ngStyleOnce",[function(){return{restrict:"A",link:function(a,h,
d){h.css(a.$eval(d.ngStyleOnce))}}}]);k=function(a){m.directive(a.name,[function(){return{restrict:"A",link:function(h,d,b){var c=a.transform||_.identity,e=a.isNumeric&&!_.isUndefined(b[a.name+"AddToInitial"]),r=function(){var r=h.$eval(b[a.name+"Selector"]);return r?$(r):d},y=b[a.name+"ForceInitialValue"]?h.$eval(b[a.name+"ForceInitialValue"]):r().css(a.property);a.isNumeric&&(y=parseInt(y,10));if(_.isUndefined(y)||_.contains(a.emptyValues,y))y="";var f=function(b){b?(e&&y&&(b+=y),r().css(a.property,
c(b))):r().css(a.property,y)};a.interpolate?b.$observe(a.name,f):h.$watch(b[a.name],f);h.$on("$destroy",function(){f()})}}}])};k({name:"ngBackgroundImage",property:"background-image",transform:function(a){return"url("+(-1===a.indexOf("Cdn")?a.replace("Url","CdnUrl"):a)+")"},emptyValues:["none"]});k({name:"ngBackgroundColor",property:"background-color",emptyValues:["rgba(0, 0, 0, 0)","transparent"]});k({name:"ngTop",property:"top",isNumeric:!0});m.directive("ngLocation",[function(){return{restrict:"A",
link:function(a,h,d){var b=function(){var a={width:h[0].offsetWidth,height:h[0].offsetHeight},d;try{d=h.position()}catch(q){d={top:0,left:0}}a={position:d,size:a};b.position=a.position;b.size=a.size;return a};a[d.ngLocation]=b}}}]);m.directive("ngScrollStatic",["$window",function(a){return{restrict:"A",link:function(h,d,b){var c=b.ngScrollStaticContainer||"html,body",e=!b.ngScrollStaticContainer,r=h.$eval(b.ngScrollStaticPadding)||0;(function(){var d=b.ngScrollStatic,h=$(c),d=h.find(d);if(d.length&&
h.length){var d=_.min(_.map(d,function(b){return $(b).position().top||0})),f=_.chooseFirst(h,function(b){if(b.scrollHeight)return b.scrollHeight})||0,g=_.min(_.choose(h,function(b){if(b=$(b).height())return b}));e&&(g=Math.min(g,a.innerHeight));f=Math.max(0,f-g);d-=r;0>d?d=0:d>f&&(d=f);h.scrollTop(d)}})()}}}]);m.directive("ngScrollTo",["scroll",function(a){return{restrict:"A",link:function(h,d,b){var c=h.isSet(b.ngScrollOnClick),e=h.isSet(b.ngScrollSmooth),r=h.isSet(b.ngScrollForce);if(c)d.on("click",
function(d){b.ngScrollPreAction&&h.$safeApply(function(){h.$eval(b.ngScrollPreAction)});a.scrollTo(b.ngScrollTo,b.ngScrollContainer,e,r)});else a.scrollTo(b.ngScrollTo,b.ngScrollContainer,e,r)}}}]);m.directive("ngTopScrolled",["$document",function(a){return{restrict:"A",link:function(h,d,b){h=h.$eval(b.ngTopScrolled)||0;h=a.scrollTop()+h;d.css({top:h})}}}]);m.directive("ngWithLocation",[function(){return{restrict:"A",link:function(a,h,d){a.$watch(d.ngWithLocation,function(b){h.toggleClass("with-location",
!!b);if(b){var c=0,e=0;if(d.ngWithLocationOffset)var r=a.$eval(d.ngWithLocationOffset)||{},c=r.x||c,e=r.y||e;r=a.$eval(d.ngWithLocationRight)||!1;e={top:b.position.top+e};e.left=r?b.position.left+-h[0].offsetWidth+c:b.position.left+b.size.width+c;h.toggleClass("left",!r);h.toggleClass("right",r);h.css(e)}})}}}]);m.directive("ngTranslate",["$window","translate",function(a,h){return{restrict:"A",link:function(a,b){h.initialize(b)}}}]);var e=function(a){return a&&!_.isUndefined(a.x)&&!_.isUndefined(a.y)&&
a.width&&a.height};m.directive("ngImage",["$parse",function(a){var h=function(a){return _.map(a,function(b,a){return a+"="+b.toString()}).join("&")};return{restrict:"A",compile:function(d,b){var c=a(b.ngImage),s=_.isUndefined(b.ngImageOnce)?_.always:""===b.ngImageOnce?_.always:a(b.ngImageOnce);return function(b,a,d){var q=function(q){if(q){var c=b.$eval(d.ngImageCrop),s=b.$eval(d.ngImageSquare),p=b.$eval(d.ngImageMaxWidth),A=b.$eval(d.ngImageMaxHeight),f=b.$eval(d.ngImageMaxSize),g=b.$eval(d.ngImageWidth),
k=b.$eval(d.ngImageHeight),l=b.$eval(d.ngImageFilter),w=b.$eval(d.ngImageFilterAmount),B=["blur","sharpen"],m={cache:!0,compress:!0,quality:90};e(c)&&_.extend(m,{crop:c.x.toFixed(0)+","+c.y.toFixed(0)+","+c.width.toFixed(0)+","+c.height.toFixed(0)});s&&_.extend(m,{w:s,h:s,fit:"crop"});p&&_.extend(m,{w:p,fit:"max"});A&&_.extend(m,{h:A,fit:"max"});f&&_.extend(m,{w:f,h:f,fit:"max"});g&&_.extend(m,{w:g});k&&_.extend(m,{h:k});l&&(-1!==_.indexOf(B,l)&&w)&&(m.filter=l,m[l+"Amount"]=w);_.startsWith(q,"https://fh-sites.imgix.net")||
(q=q+"/convert?"+h(m));a.is("img")?a.attr("src",q):a.css("background-image","url("+q+")");return q}console.info("ng-image: no url supplied")};if(s()){var f=q(c(b));console.info("ng-image: once",f)}else b.$watch(c,function(b){b=q(b);console.info("ng-image: watch",b)})}}}}]);m.directive("ngCrop",["$parse","$timeout",function(a,h){return{restrict:"A",require:"^form",link:function(d,b,c,s){b.attr("src",d.$eval(c.ngCrop));var r=d.$eval(c.ngCropAspectRatio),r=!1===r?0:r||1.9,y=a(c.ngCropModel),f=function(a){d.$safeApply(function(){var q=
y(d),h=b[0].naturalWidth/b.width();q.x=Math.floor(a.x*h);q.y=Math.floor(a.y*h);q.width=Math.floor(a.w*h);q.height=Math.floor(a.h*h);s.$setDirty()})},g,k=function(){b.Jcrop({onSelect:f,keySupport:!1,aspectRatio:r},function(){g=this;var a=y(d),q=b[0].naturalWidth/b.width();if(e(a)){var h=Math.floor(a.x/q),c=Math.floor(a.y/q),s=h+Math.floor(a.width/q),a=c+Math.floor(a.height/q);g.setSelect([h,c,s,a])}else c=g.getWidgetSize(),h=c[0],c=c[1],r?(h/r<c?(s=h,a=h/r,h=0,c=(c-a)/2):(s=c*r,a=c,h=(h-s)/2,c=0),
h=Math.floor(h),c=Math.floor(c),s=h+Math.floor(s),a=c+Math.floor(a),g.setSelect([h,c,s,a])):g.setSelect([0,0,h,c])})};h(function(){k();d.$on("$destroy",function(){g&&g.destroy()})})}}}]);m.directive("ngAudio",[function(){return{restrict:"A",link:function(a,h,d){var b=d.ngAudioSrc,c;a[d.ngAudio]=function(){c||(c=$('<audio><source src="'+b+'"></audio>'),h.append(c));c[0].load();c[0].play()};a.$on("$destroy",function(){c&&c.remove()})}}}]);m.directive("ngTip",["$compile","$parse","$sanitize","$templateCache",
"d",function(a,h,d,b,c){var e;return{restrict:"A",link:function(r,y,f){var g=f.ngTipLocation,k=f.ngTipWhen?h(f.ngTipWhen):_.always,n=$("body"),l=f.ngTipPosition;if(!c.isTouchEnabled||r.$eval(f.ngTipTouch)){e||(e=$('<span class="tip" aria-live="polite"></span>'),n.append(e));var m=function(){var b=y.attr("class")||"",b=b.split(" "),b=_.choose(b,function(b){if(b=b.trim())return"tip-ele--"+b});return b=b.join(" ")},p,t,K,x=!1,E=function(h){var c=y;if(g&&(c=y.find(g),!c.length))return;if(k(r)){var A=
l?"tip-"+l:"";e.attr("class","tip").addClass(R()+" "+m()+" "+A);var S;if(f.ngTipTemplate){var A=f.ngTipTemplate,V=b.get(A);if(!V){console.warn("ng-tip: invalid template",A);return}var U=a(V);r.$safeApply(function(){S=U(r)})}else S=d(M());e.html(S);e.css({width:"auto"});A=c.offset();V=c.outerWidth();0===V&&c[0]instanceof SVGElement&&(V=c[0].getBoundingClientRect().width);K=e.outerWidth();t=e.outerHeight();var fa=parseInt(n.css("top"),10)||0;p={};c=c.outerHeight();if("right"===l||"left"===l)p.top=Math.floor(A.top+
c/2-t/2)-fa;"right"===l?p.left=A.left+V+8:"left"===l?p.left=A.left-K-8:"cursor"===l&&(50<=V||50<=c)?(x=!0,v(h)):(p.top=Math.floor(A.top-t-8-fa),p.left=Math.floor(Math.max(A.left+(V-K)/2,0)));e.css(p);e.addClass("showing")}},J=function(){e.attr("class","tip");e.css({top:-100,left:-100})},v=function(b){p.top=Math.max(b.pageY-t-8,0);p.left=Math.max(b.pageX-Math.floor(K/2),0)},M=c.observer(f,"ngTip",""),R=c.observer(f,"ngTipClasses","");y.on("mouseenter",E);y.on("mouseleave",J);if("cursor"===l)y.on("mousemove",
function(b){x&&(v(b),e.css(p))});y.on("retip",function(b){window.setTimeout(function(){if(r.$root){var a=e.hasClass("showing");J();a&&E(b)}})});f.ngDisabled&&y.is("button, input, select, textarea")&&f.$observe("disabled",function(b){b&&e.hasClass("showing")&&J()});r.$on("$destroy",J)}}}}]);m.directive("ngRadioFlyer",[function(){return{link:function(a,h,d){var b=function(b){h.find('input[type="radio"]').each(function(){var a=$(this),d=_.isUndefined(b)?a.is(":checked"):a.val()===b;a.closest("label").toggleClass("radio-selected",
d)})};d.ngRadioFlyer?a.$watch(d.ngRadioFlyer,function(a){b(a)}):a.$watch(function(){b()});a.$evalAsync(function(){b()})}}}]);m.directive("ngCheckboxMadness",[function(){return{require:"ngModel",link:function(a,h,d){a.$watch(d.ngModel,function(b){h.closest(".field").toggleClass("checkbox-selected",!!b)})}}}]);m.directive("ngSupportHacks",_.optional(["d","events","?native",function(a,h,d){return{restrict:"A",link:function(b){var c=$("html");c.addClass(a.isTouchEnabled?"touch":"not-touch");c.addClass(d&&
d.isNative?"native":"not-native");h.on(b,"fareharbor.native.inApp",function(b,a){c.addClass("native").removeClass("not-native")})}}}]));m.directive("ngBlurEscape",["$document","d",function(a,h){return{restrict:"A",link:function(d,b,c){a.on("keydown",function(b){if(27===b.which){var a=$(b.target);h.isTextInput(a)&&(b.preventDefault(),b.stopPropagation(),a.trigger("blur"))}})}}}]);m.directive("ngShortcut",["$parse","navigation","shortcuts",function(a,h,d){return{restrict:"A",compile:function(b,h){var c=
a(h.ngShortcut),r=h.ngShortcutAction?a(h.ngShortcutAction):_.ignore;return function(b,a,q){var h=c(b);if(!_.isUndefined(h)){var h=h.split("|"),e=_.ignore;b.isSet(q.ngShortcutClick)&&(e=_.then(e,function(){q.disabled||a.trigger("click")}));b.isSet(q.ngShortcutFocus)&&(e=_.then(e,function(){a.is("input, textarea, select")?setTimeout(function(){a.trigger("focus")}):a.find("input, textarea").first().trigger("focus")}));q.ngShortcutAction&&(e=_.then(e,function(){b.$apply(function(){q.disabled||r(b)})}));
b.isSet(q.ngShortcutOnly)&&a.addClass("ng-hide");_.forEach(h,function(a){var h=d.register({keySet:a,action:e,description:q.ngShortcutDescription||""});b.$on("$destroy",function(){d.unregister(h)})})}}}}}]);m.directive("ngGenericForm",[function(){return{link:function(a,h,d){a[d.ngGenericForm]={}}}}]);m.directive("ngSortable",[function(){return{restrict:"A",require:"^?form",link:function(a,h,d,b){var c=a.$eval(d.ngSortable);if(c){var e=d.ngSortableHandle||".sortable-handle",r=d.ngSortableSelector||
"li.sortable",f='<li class="sortable sortable-placeholder"></li>';a.$eval(d.ngSortableTable)&&(f='<tbody class="sortable"><tr><td style="height: 50px"></td></tr></tbody>');d={itemSelector:r,placeHolderTemplate:f,dragEnd:function(d,h){var r=$(this),e=$(d),s=$(h),f=r.data("ng-sortable-item"),p=e.data("ng-sortable-item"),y=s.data("ng-sortable-item");f===y&&(y=null);f===p&&(p=null);return a.$apply(function(){b&&b.$setDirty();return c(f,p,y)})}};e&&(d.dragSelector=e,d.dragSelectorExclude="input, textarea");
h.dragsort(d);a.$on("$destroy",function(){h.dragsort("destroy")})}}}}]);m.directive("ngSortableItem",[function(){return{restrict:"A",link:function(a,h,d){if(a=a.$eval(d.ngSortableItem))h.data("ng-sortable-item",a),h.addClass("sortable")}}}]);m.directive("ngDropdown",["$interpolate","$parse","$sanitize","d",function(a,h,d,b){var c=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,
e=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+hide\s+when\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)?$/,r=T("Choose an option"),f={errorLoading:_.constant(T("The results could not be loaded")),inputTooLong:function(b){b=b.input.length-b.maximum;return interpolate(nT("Please delete %(count)s character","Please delete %(count)s characters",b),{count:b})},inputTooShort:function(b){b=b.minimum-b.input.length;
return interpolate(nT("Please enter %(count)s or more character","Please enter %(count)s or more characters",b),{count:b})},loadingMore:_.constant(T("Loading more results...")),maximumSelected:function(b){return interpolate(nT("You can only select %(count)s item","You can only select %(count)s items",b.maximum),{count:b.maximum})},noResults:_.constant(T("No results found")),searching:_.constant(T("Searching..."))};return{restrict:"A",require:["ngModel","select"],compile:function(g,k){var l,n,m,I,
p,t,K,x,E,J,v;if(k.ngDropdownRemoteOptions){J="remote-options-mode";l=k.ngDropdownRemoteOptions.match(e);if(!l){console.error("ngDropdown: malformed ngDropdownRemoteOptions expression.");return}p=h(l[2]||l[1]);K=l[3]?h(l[3]):null;x=l[4]?h(l[4]):null;n=l[6];m=l[5]||l[7];I=h(l[2]?l[1]:m);t=h(l[8]);v=k.ngDropdownMinimum?h(k.ngDropdownMinimum):_.constant(2)}else if(k.ngOptions){J="ng-options-mode";l=k.ngOptions.match(c);if(!l){console.error("ngDropdown: ng-options regex must match angular.");return}n=
l[5];m=l[4]||l[6];E=h(l[7])}else{console.error("ngDropdown: ngDropdownRemoteOptions or ngOptions required.");return}var M="ng-options-mode"===J&&!b.isDropdownSupported,R=a(k.ngPlaceholder||r),u=k.ngPlaceholderValue?h(k.ngPlaceholderValue):_.constant(null),X=k.ngDropdownCurrentOption&&h(k.ngDropdownCurrentOption),F=k.ngDropdownAllowClear&&h(k.ngDropdownAllowClear),S=h(k.ngModel);l=$("<option class='empty-option' value='' label=''></option>");g.prepend(l);M?g.closest(".the-field").addClass("ng-dropdown-disabled"):
(g.css("width","100%"),g.addClass("ng-dropdown"));return function(b,a,h,q){var r=q[0],c=q[1];q=!F||F(b);if(M&&!q)var e=b.$watch(h.ngModel,function(b){""!==a.val()&&(a.find(".empty-option").remove(),e())});var s=u(b);r.$parsers.push(function(b){return null===b?s:b});r.$formatters.push(function(b){return b===s?null:b});if(!M){var A;q={language:f,minimumResultsForSearch:8,allowClear:q,placeholder:R(b)};var g={};q.templateResult=function(b){var a=$("<span>"+d(b.text)+"</span>");b=g[b.id];_.isObject(b)&&
b.classes&&a.addClass(b.classes);return a};var l={},k=function(a,d,h){if(!a)return null;n&&(l[n]=h);l[m]=d;return a(b,l)};if("remote-options-mode"===J){var G=t(b),w=function(b,a){return{id:b.uri||b.pk.toString(),text:k(p,b,a),disabled:k(x,b,a),ngModelValue:k(I,b,a),originalValue:b}};q.minimumInputLength=v(b);q.ajax={delay:250,transport:function(b,a,d){var h=G(b.data.term);h.$promise.then(function(){a(h)},function(){d(h)});return{abort:h.$promise.cancel}},processResults:function(b){g={};var a=[];_.forEach(b,
function(b,d){if(!k(K,b,d)){var h=w(b,d);a.push(h);g[h.id]=h.ngModelValue}});return{results:a}}};r.$parsers.unshift(function(b){return g[b]||null});c.readValue=function(){var b=a.val();return b in c.selectValueMap?c.selectValueMap[b]:b}}else if("ng-options-mode"===J){var r={"default":function(){var a=E(b);if(_.isArray(a))if(a.length)if(_.isUndefined(a[0].label))if(_.isUndefined(a[0].uri))if(_.isUndefined(a[0].pk)){if(_.isString(a[0]))return a}else return _.pluck(a,"pk");else return _.pluck(a,"uri");
else return _.pluck(a,"label");else return a;else if(_.isObject(a))return _.keys(a)},uri:function(){var a=E(b);return _.pluck(a,"uri")},pk:function(){var a=E(b);return _.pluck(a,"pk")}}[b.$eval(h.ngDropdownWatchType)||"default"],B=function(){window.setTimeout(function(){a.trigger("change.select2")})};b.$watch(r,function(){g=_.indexBy(E(b),function(b,a){return a.toString()});A.dataAdapter.destroy();B()},!0);b.$watch(h.ngModel,B)}r=a.closest(".ng-dropdown-context");r.length&&(q.dropdownParent=r);_.forEach(["open",
"focus"],function(b){a.bind("dropdown:"+b,function(){a.select2(b)})});b.$watch(h.ngDisabled,function(b){a.attr("disabled",!!b)});b.$watch(function(){return!!a.parents("fieldset[disabled]").length},function(b){a.attr("disabled",b)});b.$on("$destroy",function(){A.destroy()});a.select2(q);A=a.data("select2");"remote-options-mode"===J&&X&&(b.$watch(X,function(b){if(!_.isUndefined(b)){var a=[];b&&a.push(w(b));A.trigger("selection:update",{data:a})}}),b.$watch(S,function(a){a||X.assign(b,null)}),A.on("select",
function(a){b.$apply(function(){X.assign(b,a.data.originalValue)})}))}}}}}]);m.directive("ngIf",c.conditionalDirective({watch:["$parse",function(a){return function(h,d,b){var c=a(b.ngIf);return function(){return!!c(h)}}}],operator:function(a,h,d){return function(b){d.ngThen&&(a[d.ngThen]=b);return b}}}));m.directive("ngIfOnce",c.conditionalDirective({watch:["$parse",function(a){return function(h,d,b){var c=a(b.ngIfOnce);return function(){return!!c(h)}}}],operator:function(a,h,d){return function(b){d.ngThen&&
(a[d.ngThen]=b);return b}},once:!0}));m.directive("ngIfInLabs",c.conditionalDirective({watch:["labs",function(a){return function(h,d,b){return function(){var d=b.ngIfInLabs.replace("!",""),c=b.ngIfInLabsVariation,r=0===b.ngIfInLabs.indexOf("!"),d=a.isInVariation(d,c);b.ngThen&&(h[b.ngThen]=d);return r?!d:d}}}]}));m.directive("ngElse",c.conditionalDirective({watch:["$parse",function(a){return function(h,d,b){var c=a(b.ngElse);return function(){return!c(h)}}}]}));m.directive("ngElseOnce",c.conditionalDirective({watch:["$parse",
function(a){return function(h,d,b){var c=a(b.ngElseOnce);return function(){return!c(h)}}}],once:!0}));m.directive("ngWatch",c.conditionalDirective({watch:["$parse",function(a){return function(h,d,b){return a(b.ngWatch)}}],operator:_.constant(_.always),transclude:["$parse",function(a){return function(h,d,b){var c=a(b.ngWatchAction)||_.ignore;return function(){c(h)}}}]}));m.directive("ngInterval",[function(){return{link:function(a,h,d){h=a.$eval(d.ngInterval)||1;var b=setInterval(function(){a.$digest()},
1E3*h);a.$on("$destroy",function(){clearInterval(b)})}}}]);m.directive("ngData",["$q",function(a){return{scope:!0,transclude:!0,templateUrl:"ng-data",controllerAs:"dataCtrl",controller:["$scope","$attrs",function(h,d){var b=this;b.status="loading";h.isSet(d.ngDataSmall)?b.type="small":h.isSet(d.ngDataManual)?b.type="manual":b.type="large";b.transcludeOnError="transclude"===(d.ngDataOnError||"");var c=d.ngDataOnSuccess||"",e=function(){b.status="success";c&&h.$eval(c)},r=h.$eval(d.ngData);if(_.isUndefined(r))e();
else{var f=_.isArray(r);if(!f&&!_.isPromise(r))e();else{f&&(r=a.all(r));var g=h.$eval(d.ngDataStale);if(!_.isUndefined(g)&&(g=f?g:[g],!_.any(g,"$fresh"))){e();return}r.then(function(){e()},function(){b.status="error"})}}}]}}]);m.config(["$provide",function(a){a.decorator("ngShowDirective",["$delegate",function(a){a.shift();return a}])}]);m.directive("ngShow",["$parse",function(a){return{restrict:"A",compile:function(h,d){var b=a(d.ngShow);return function(a,d,h){a.$watch(b,function(b){d.toggleClass("ng-hide",
!b);h.ngThen&&(a[h.ngThen]=b)})}}}}]);m.directive("ngShowOnce",["$parse",function(a){return{restrict:"A",compile:function(h,d){var b=a(d.ngShowOnce);return function(a,d,h){var q=b(a);d.toggleClass("ng-hide",!q);h.ngThen&&(a[h.ngThen]=q)}}}}]);m.config(["$provide",function(a){a.decorator("ngHideDirective",["$delegate",function(a){a.shift();return a}])}]);m.directive("ngHideOnce",["$parse",function(a){return{restrict:"A",compile:function(h,d){var b=a(d.ngHideOnce);return function(a,d,h){var q=!!b(a);
d.toggleClass("ng-hide",q);h.ngThen&&(a[h.ngThen]=q)}}}}]);m.directive("ngHide",["$parse",function(a){return{restrict:"A",compile:function(h,d){var b=a(d.ngHide);return function(a,d,h){a.$watch(b,function(b){b=!!b;d.toggleClass("ng-hide",b);h.ngThen&&(a[h.ngThen]=b)})}}}}]);m.directive("ngAutoExporter",["$interpolate","autoExport",function(a,h){return{scope:!0,templateUrl:"auto-exporter",compile:function(d,b){var c=a(b.ngAutoExporter),e=a(b.ngAutoExporterFilename);return function(b,a,d){b.autoExport=
h;b.isLeft=b.isSet(d.ngAutoExporterLeft);b.$watch(c,function(a){b.namespace=a});b.$watch(e,function(a){b.filename=a})}}}}]);m.directive("ngAutoExportValue",[function(){return{restrict:"A",compile:function(a,h){var d=h.ngAutoExportValue||"";h.$set("ngAutoExportValue","");return function(b,a,h){a.data("ngAutoExportValue",function(){return b.$interpolate(d)})}}}}]);m.directive("ngAutoExportSkip",["$parse",function(a){return{restrict:"A",compile:function(h,d){var b=a(d.ngAutoExportSkip||"true");return function(a,
d,h){d.data("ngAutoExportSkip",_.bind(b,null,a))}}}}]);m.directive("ngAutoExportOnly",["$parse",function(a){return{restrict:"A",compile:function(h,d){if(d.ngAutoExportOnly){var b=a(d.ngAutoExportOnly);return function(a,d,h){a.$watch(b,function(b){d.toggleClass("ng-hide",b)})}}h.addClass("ng-hide")}}}]);m.directive("ngAutoExport",["$interpolate","$parse","autoExport",function(a,h,d){return{restrict:"A",scope:!0,compile:function(b,c){var e=a(c.ngAutoExport),r=c.ngAutoExportProcess?h(c.ngAutoExportProcess):
null;return function(b,a){var h=e(b),q={isCSS:b.isSet(c.ngAutoExportCss),tableSelector:c.ngAutoExportTable,rowSelector:c.ngAutoExportRow,cellSelector:c.ngAutoExportCell};r&&(q.process=_.bind(r,null,b));var n=d.addExport(h,a,q);b.$on("$destroy",function(){d.removeExport(n)})}}}}]);m.directive("ngTableFilters",["$parse","$rootScope","require",function(a,h,d){return{restrict:"A",scope:!0,controller:function(){var b=this;b.ignore=null;b.filters=[];b.addFilter=function(a){d.assert(a.type,"ng-table-filter: expected filter description to include type");
d.assert(a.filter,"ng-table-filter: expected filter description to include filter");b.filters.push(a);g(a)};b.removeFilter=function(a){f(a);_.overwriteWithout(b.filters,a)};b.reset=function(){_.forEach(b.filters,function(b){b.resetValue()});b.update()};b.isFiltering=function(a){return _.any(_.map(b.filters,function(b){return b.isFiltering()}))};var a=function(a,d){for(var h=[],q=b.filters.length,c,r,e,f=0,s=d.length;f<s;f++){r=d[f];c=!0;if(r&&r!==b.ignore)for(var g=0;g<q;g++)if(e=b.filters[g],e.isFiltering()&&
!e.filter(r)){c=!1;break}c&&h.push(r)}_.overwrite(a,h);a.filtered=d.length-h.length},q={},c={};b.update=function(){console.info("ng-table-filters: filtering collections");_.forEach(q,function(b,d){a(c[d],b)});f()};b.debouncedUpdate=_.debounce(function(){h.$apply(function(){b.update()})},500);b.addCollection=function(b,d){q[b.$id]=d||[];var h=c[b.$id];_.isUndefined(h)&&(h=c[b.$id]=[]);a(h,q[b.$id]);return h};b.removeCollection=function(b){delete q[b.$id];delete c[b.$id]};var e={},f=function(a){e&&
(_.isUndefined(a)?_.forEach(b.filters,function(b){f(b)}):!_.isUndefined(a.identifier)&&!_.isUndefined(a.value)&&(e[a.identifier]=a.value))},g=function(a){if(e)if(_.isUndefined(a))_.forEach(b.filters,g);else if(!_.isUndefined(a.identifier)){var d=e[a.identifier];_.isUndefined(d)?a.resetValue():a.value=d}};b.updateModel=function(a){f();e=a||{};g();b.update();return e};b.storeModel=function(){f();return e}},compile:function(b,d){var h=d.ngTableFilters?a(d.ngTableFilters):null,c=d.ngTableFiltersModel?
a(d.ngTableFiltersModel):null,e=d.ngTableFiltersIgnore?a(d.ngTableFiltersIgnore):null;return{pre:function(b,a,d,q){b.$tableFilters=q;c&&b.$watch(c,function(a){c.assign(b,q.updateModel(a))});h&&b.$watchCollection(h,function(a){b.$collection=q.addCollection(b,a)});e&&b.$watch(e,function(b){q.ignore=b;q.update()})}}}}}]);m.directive("ngTableFilter",["$compile","$parse","$templateCache",function(a,h,d){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],scope:!0,controller:function(){this.name=
"";this.isFiltering=_.never;this.filter=_.always},compile:function(b,c){var e=d.get(c.ngTableFilterTemplate||"tableFilter.filter");if(e){var r=a(e),f=c.ngTableFilterIdentifier?h(c.ngTableFilterIdentifier):null;return{pre:function(b,a,d,h){var q=h[0],c=h[1];b.$tableFilter=c;c.reset=function(){c.resetValue();q.update()};c.name=c.identifier=d.ngTableFilter;f&&(c.identifier=f(b));d.$observe("ngTableFilter",function(b){c.name=b});a.addClass("ng-table-filter");b.$watch(function(){return c.isFiltering()},
function(b){a.toggleClass("filtering",b)});r(b,function(b){a.append(b)})},post:function(b,a,d,h){var q=h[0],c=h[1];q.addFilter(c);b.$on("$destroy",function(){q.removeFilter(c)})}}}console.error("ng-table-filter-filter: template not found")}}}]);m.directive("ngTableFilterString",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(h,d){var b=a(d.ngTableFilterString);return{post:function(a,d,h,c){var q=c[0],e=c[1];e.type="string";e.value="";e.resetValue=
function(){e.value=""};var f="";e.isFiltering=function(){f=e.value.toLowerCase();return!!f};e.filter=function(d){return 0<=(b(a,{$row:d})||"").toLowerCase().indexOf(f)};a.$watch(function(){return e.value},function(){q.debouncedUpdate()})}}}}}]);m.directive("ngTableFilterDate",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(h,d){var b=a(d.ngTableFilterDate);return{pre:function(a,d,h,c){var q=c[0],e=c[1];e.operations=[{name:T("Before"),value:"before"},
{name:T("On"),value:"on"},{name:T("After"),value:"after"}];var f={},n;f.on=function(d){return(d=b(a,{$row:d})||0)?0===d.diff(n,"days"):!1};f.before=function(d){return(d=b(a,{$row:d})||0)?0>d.diff(n,"days"):!1};f.after=function(d){return(d=b(a,{$row:d})||0)?0<d.diff(n,"days"):!1};e.type="date";e.value={operation:"on",date:""};e.resetValue=function(){e.value.date=""};e.isFiltering=function(){n=e.value.date?moment(e.value.date,"YYYY-MM-DD"):null;return!!n};e.filter=f[e.value.operation];a.$watch(function(){return e.value.operation},
function(b){e.filter=f[b];q.debouncedUpdate()});a.$watch(function(){return e.value.date},function(){q.debouncedUpdate()})}}}}}]);m.directive("ngTableFilterAmount",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(h,d){var b=a(d.ngTableFilterAmount);return{pre:function(a,d,h,c){var q=c[0],e=c[1];e.operations=[{name:T("is"),value:"equal"},{name:T("less than"),value:"less-than"},{name:T("greater than"),value:"greater-than"}];var f={equal:function(d){return(b(a,
{$row:d})||0)===e.value.amount},"less-than":function(d){return(b(a,{$row:d})||0)<e.value.amount},"greater-than":function(d){return(b(a,{$row:d})||0)>e.value.amount}};e.type="amount";e.value={operation:"greater-than",amount:""};e.resetValue=function(){e.value.amount=""};e.isFiltering=function(){return""!==e.value.amount};e.filter=f[e.value.operation];a.$watch(function(){return e.value.operation},function(b){e.filter=f[b];q.debouncedUpdate()});a.$watch(function(){return e.value.amount},function(){q.debouncedUpdate()})}}}}}]);
m.directive("ngTableFilterNumber",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(h,d){var b=a(d.ngTableFilterNumber);return{pre:function(a,d,h,c){var q=c[0],e=c[1];e.operations=[{name:T("is"),value:"equal"},{name:T("less than"),value:"less-than"},{name:T("greater than"),value:"greater-than"}];var f={equal:function(d){return(b(a,{$row:d})||0)===e.value.number},"less-than":function(d){return(b(a,{$row:d})||0)<e.value.number},"greater-than":function(d){return(b(a,
{$row:d})||0)>e.value.number}};e.type="number";e.value={operation:"greater-than",number:""};e.resetValue=function(){e.value.number=""};e.isFiltering=function(){return""!==e.value.number};e.filter=f[e.value.operation];a.$watch(function(){return e.value.operation},function(b){e.filter=f[b];q.debouncedUpdate()});a.$watch(function(){return e.value.number},function(){q.debouncedUpdate()})}}}}}]);m.directive("ngTableFilterChoice",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],
compile:function(h,d){var b=a(d.ngTableFilterChoice),c=a(d.ngTableFilterChoices),e=a(d.ngTableFilterChoiceName||"$choice.name"),r=a(d.ngTableFilterChoiceValue||"$choice.pk");return{pre:function(a,d,h,q){var n=q[0],f=q[1];f.choiceValue=function(b){return r(a,{$choice:b})};f.choiceName=function(b){return e(a,{$choice:b})};d=c(a);var g=_.map(d,function(b){return f.choiceValue(b)});f.type="choices";f.choices=d;f.value={};f.resetValue=function(){_.forEach(g,function(b){f.value[b]=!1})};f.resetValue();
f.isFiltering=function(){return _.any(_.values(f.value))};f.filter=function(d){var h=b(a,{$row:d})||!1;if(_.isArray(h)){for(var c=0,q=h.length;c<q;c++)if(d=f.choiceValue(h[c]),0<=g.indexOf(d)&&f.value[d])return!0;return!1}d=f.choiceValue(h);return 0<=g.indexOf(d)?f.value[d]:!1};a.$watch(function(){return f.value},function(){n.debouncedUpdate()},!0)}}}}}]);m.directive("ngTableFilterYesno",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(h,d){var b=
a(d.ngTableFilterYesno);return{pre:function(a,d,h,c){var q=c[0],e=c[1],f=e.ANY="any";e.type="yesno";e.value=f;e.resetValue=function(){e.value=f};e.isFiltering=function(){return e.value!==f};e.filter=function(d){return(b(a,{$row:d})||!1)===e.value};a.$watch(function(){return e.value},function(){q.debouncedUpdate()})}}}}}]);m.directive("ngTableFilterView",["$compile","$templateCache",function(a,h){var d={};return{require:"^ngTableFilter",link:{pre:function(b,c,e,r){e="tableFilter.filters."+r.type;var f=
d[e];if(!f){f=h.get(e);if(!f){console.warn("ng-table-filter-view: invalid or custom type",r.type);c.remove();return}f=d[e]=a(f)}f(b,function(b){c.append(b)})}}}}]);m.directive("ngTables",[function(){return{restrict:"A",scope:!0,controllerAs:"tablesCtrl",controller:function(){var a=this;a.tables=[];a.predicate=null;a.addTable=function(h){_.contains(a.tables,h)||a.tables.push(h)};a.removeTable=function(h){_.overwriteWithout(a.tables,h)};a.toggle=function(h){a.predicate=h;_.forEach(a.tables,function(a){a.toggle(h)})}}}}]);
m.directive("ngTable",["$filter",function(a){var h=a("orderBy");return{restrict:"A",scope:!0,controller:["$scope","$attrs","$parse","$element",function(a,b,c,q){var e=this,f,g=b.ngTableName||"$table",l=a.isSet(b.ngTableFiltered)?q.controller("ngTableFilters"):null;e.collection=[];e.predicate=null;e.isReversed=!1;e.isHeadersIgnored=a.isSet(b.ngTableIgnoreHeaders);e.toggle=function(b){b&&e.predicate===b?e.isReversed=!e.isReversed:(e.predicate=b,e.isReversed=!1);e.update()};e.update=function(b){_.isUndefined(b)||
(f=b);b=f;e.predicate&&(b=h(f,e.predicate,e.isReversed));_.overwrite(e.collection,b);_.forEach(k,function(b){b()})};var k=[];e.watch=function(b,a){k.push(a);b.$on("$destroy",function(){_.overwriteWithout(k,a)})};a.tablesCtrl&&a.isSet(b.ngTableTables)&&(a.tablesCtrl.addTable(e),e.predicate=a.tablesCtrl.predicate,a.$on("$destroy",function(){a.tablesCtrl.removeTable(e)}));b=c(b.ngTable);e.update(b(a));var n;a.$watchCollection(b,function(b){l?n=l.addCollection(a,b):e.update(b)});l&&(a.$watchCollection(function(){return n},
function(b){e.update(b);e.filtered=b.filtered}),a.$on("$destroy",function(){l.removeCollection(a)}));_.set(a,g,e)}]}}]);m.directive("ngTableHeader",["tableHeaders","require",function(a,h){return{restrict:"A",require:["^?ngTable","^?ngTables"],link:function(d,b,c,e){var r=e[0]||e[1];r&&(r===e[0]&&r.isHeadersIgnored)&&(r=e[1],h.assert(r,"If ngTable is only for summaries, ngTables is required for headers!"));h.assert(r,"ngTable or ngTables required");if(!c.ngTableHeaderWhen||d.$eval(c.ngTableHeaderWhen)){var f=
a.parsePredicate(d,c.ngTableHeader,d.isSet(c.ngTableHeaderDefault),c.ngTableHeaderKey);d.isSet(c.ngTableHeaderDisabled)||(b.on("click",function(){d.$apply(function(){r.toggle(f)})}),b.addClass("ng-table-header"),d.$watch(function(){return r.predicate===f},function(a){b.toggleClass("active",a)}));f.isDefault&&r.toggle(f)}}}}]);m.directive("ngTableSummary",["$parse","require",function(a,h){return{scope:!0,restrict:"A",compile:function(d,b){var c=b.ngTableSummary?a(b.ngTableSummary):null,e=b.ngTableSummaryOperator?
a(b.ngTableSummaryOperator):function(b,a){return(a.$acc||0)+(a.$row||0)},r=b.ngTableSummaryInitial?a(b.ngTableSummaryInitial):b.ngTableSummaryOperator?null:_.constant(0);b.ngTableSummaries&&(c=a(b.ngTableSummaries),r=function(){return[]},e=function(b,a){_.forEach(a.$row,function(b,d){a.$acc[d]=(a.$acc[d]||0)+(b||0)});return a.$acc});return{pre:function(b,d,f){d=f.ngTableSummaryTableName||"$table";h.inScope(b,d,"ngTable controller must be in scope");var g=b[d],n=f.ngTableSummaryWhen?a(f.ngTableSummaryWhen):
_.always,l=function(){if(!n(b))return"";var a=r?r(b):null;return _.reduce(g.collection,function(a,d){return e(b,{$acc:a,$row:c?c(b,{$row:d}):d})},a)};d=function(){b.$summary=l()};d();b.isSet(f.ngTableSummaryOnce)||(b.isSet(f.ngTableSummaryTableOnly)?g.watch(b,d):b.$watch(d))}}}}}]);m.directive("ngGroup",[function(){return{scope:!0,restrict:"A",require:["ngGroup","^?ngGroups"],controller:function(){var a=this;a.collection=[];a.groups=[];a.byFn=a.asFn=a.name=null;a.group=function(){var h=!0,d=a.byFn;
d||(d=_.constant(""),h=!1);var b=a.asFn?a.asFn:d,c={},e={};if(a.collection.length){var r={};_.forEach(a.collection,function(h){var f={$row:h},n=d(f)||"",n=_.isArray(n)?n:[n];n.length||(n=[null]);_.forEach(n,function(n){f.$by=n;n=_.isModelObject(n)?n.uri:n;if(_.isUndefined(c[n])){var g=b===d?n:b(f);c[n]=g||null}_.isUndefined(e[n])&&(e[n]=a.sortByFn?a.sortByFn(f):c[n]);delete f.$by;g=r[n]||[];g.push(h);r[n]=g})});var f={};_.forEach(a.groups,function(a){f[a.by]=a});var g=_.map(r,function(b,d){var r=
f[d]||{};_.extend(r,{isGrouped:h,by:d,as:c[d],name:a.name,rows:b,sortBy:e[d]});return r});_.overwrite(a.groups,_.sortBy(g,"sortBy"))}else _.overwrite(a.groups,[{isGrouped:h,name:a.name,rows:[]}])};a.groupBy=function(h,d,b,c){a.byFn=h;a.asFn=d;a.sortByFn=b;a.name=c;a.group()};a.update=function(h){a.collection=h;a.group()}},link:function(a,h,d,b){var c=b[0],e=b[1];e&&(e.addNgGroupCtrl(c),a.$on("$destroy",function(){e.removeNgGroupCtrl(c)}));a.$groups=c.groups;a.$watchCollection(d.ngGroup,function(a){c.update(a)})}}}]);
m.directive("ngGroupBy",["$parse","require",function(a,h){return{require:["^?ngGroup","^?ngGroups"],compile:function(d,b){var c=b.ngGroupBy?a(b.ngGroupBy):null,e=b.ngGroupAs?a(b.ngGroupAs):null,r=b.ngGroupSortBy?a(b.ngGroupSortBy):null,f=b.ngGroupByModel?a(b.ngGroupByModel):null;return function(a,d,q,n){var g=n[0]||n[1];h.assert(g,"Either ngGroup or ngGroups required on ancestor");var l,p,k;c&&(l=_.bind(c,null,a),p=_.bind(e,null,a));r&&(k=_.bind(r,null,a));var m=function(){g.groupBy(l,p,k,q.ngGroupName)};
a.isSet(q.ngGroupDefault)&&m();d.on("click",function(){f?f.assign(a,b.ngGroupBy):m()});a.$watch(function(){return g.byFn===l},function(a){d.toggleClass("toggled",a)});f&&a.$watch(f,function(a,d){a===b.ngGroupBy&&m()})}}}}]);m.directive("ngGroups",["$parse","events",function(a,h){return{scope:!0,restrict:"A",controller:["$scope","$attrs",function(a,b){var c=this;c.ngGroupCtrls=[];var e=function(a){a.groupBy(c.byFn,c.asFn,c.sortByFn,c.name)};c.groupBy=function(a,b,d,h){c.byFn=a;c.asFn=b;c.sortByFn=
d;c.name=h;_.forEach(c.ngGroupCtrls,e)};c.addNgGroupCtrl=function(a){c.ngGroupCtrls.push(a);c.byFn&&e(a)};c.removeNgGroupCtrl=function(a){_.ref.remove(c.ngGroupCtrls,a)};if(b.ngGroupsRegroupEvent)h.on(a,b.ngGroupsRegroupEvent,function(){_.forEach(c.ngGroupCtrls,e)})}]}}]);m.directive("ngToggle",["$parse","$rootScope","toggles",function(a,h,d){return{restrict:"A",compile:function(b,h){var c=a(h.ngToggleValue),e=a(h.ngToggleDefault),f=a(h.ngToggleGroupValue),g=h.ngToggleWhen?a(h.ngToggleWhen):null;
return function(a,b,h){var q=c(a)||h.ngToggle,l=e(a)||!1,p=f(a)||h.ngToggleGroup,k=a.isSet(h.ngToggleAutoClose),A=a.isSet(h.ngToggleGroupCloseable),m=_.isUndefined(h.ngToggleInteractive)||a.isSet(h.ngToggleInteractive),E=_.isUndefined(h.ngToggleAriaExpanded)||a.isSet(h.ngToggleAriaExpanded),J=g?_.bind(g,null,a):null;d.create(q,{autoClose:k,defaultState:l,group:p,isCloseableGroup:A,when:J});m&&(l="click",a.isSet(h.ngToggleMousedown)&&(l="mousedown"),b.on(l,function(b){a.$apply(function(){d.toggle(q)})}));
a.$watch(function(){return d.state(q)},function(a){b.toggleClass("toggled",a);E&&b.attr("aria-expanded",(!!a).toString())});a.$on("$destroy",function(){d.destroy(q)})}}}}]);m.directive("ngToggled",c.conditionalDirective({watch:["$parse","toggles",function(a,h){return function(d,b,c){var e=d.$eval(c.ngToggledValue)||c.ngToggled,r=c.ngToggledAlwaysWhen?a(c.ngToggledAlwaysWhen):_.never;return function(){return h.state(e)||r(d)}}}],operator:["$parse",function(a){return function(h,d,b){var c=b.ngToggledAction?
a(b.ngToggledAction):_.ignore;return function(a){c(h,{$value:a});return a}}}]}));m.directive("ngToggledShow",["$parse","toggles",function(a,h){return{link:function(d,b,c){var e=c.ngToggledAction?a(c.ngToggledAction):_.ignore,r=c.ngToggledAlwaysWhen?a(c.ngToggledAlwaysWhen):_.never,f=d.$eval(c.ngToggledShowValue)||c.ngToggledShow;d.$watch(function(){return h.state(f)||r(d)},function(a){e(d,{$value:a});b.css("display",a?"":"none")})}}}]);m.directive("ngWith",["$parse",function(a){return{restrict:"A",
scope:!0,priority:900,compile:function(h,d){var b=a(d.ngWith);return{pre:function(a,d,h){b(a);a.$watch(b)}}}}}]);m.directive("ngDestroy",[function(){return function(a,h,d){a.$on("$destroy",function(){a.$eval(d.ngDestroy)})}}]);m.directive("ngFadeIn",[function(){return{restrict:"A",link:function(a,h,d){a=parseInt(d.ngFadeIn);h.hide();h.fadeIn(a)}}}]).directive("ngFadeOut",[function(){return{restrict:"A",link:function(a,h,d){var b=parseInt(d.ngFadeOut);d=d.ngFadeTarget;var c=$(h);h=a;d&&(h=a.$eval(d));
h.fadeOut=function(d){c.fadeOut(b,function(){d&&d(a)})}}}}]);m.directive("ngNullForm",[function(){return{name:"form",controller:function(){this.$setPristine=this.$setDirty=this.$removeControl=this.$setValidity=this.$addControl=_.ignore;this.$$renameControl=function(a,h){a.$name=h}},link:{pre:function(a){a.nullForm={$dirty:!1,$pristine:!0,$valid:!0,$invalid:!1}}}}}]);m.directive("ngName",[function(){return{restrict:"A",require:["ngModel","^?form"],link:function(a,h,d,b){a.$watch(d.ngName,function(a){h.attr("name",
a);var d=b[0],c=b[1];c.$removeControl(d);d.$name=a;c.$addControl(d)})}}}]).directive("ngPrefix",[function(){return{restrict:"A",priority:100,controller:["$scope","$element","$attrs",function(a,h,d){var b=h.attr("name");a.$watch(d.ngPrefix,function(a){var h=b;a&&(h=a+"-"+h);d.$set("name",h)})}]}}]);m.directive("ngOutboundLink",[function(){return{restrict:"A",priority:-1,link:function(a,h,d){var b=a.$interpolate(d.ngOutboundLink)||"_self";(!d.ngOutboundLinkWhen||a.$eval(d.ngOutboundLinkWhen))&&h.attr("target",
b)}}}]);m.directive("ngBackButton",["$window",function(a){return{restrict:"A",link:function(h,d,b){d.on("click",function(b){setTimeout(function(){a.history.back()},50)})}}}]);m.directive("ngSearchLink",["navigation",function(a){return{restrict:"A",link:function(h,d,b){b.$observe("ngSearchLink",function(c){var e=h.$eval(b.ngSearchLinkCompany)||a.currentCompany;e&&(c=e.$url(urls.dashboard.bookings.index)+"?q="+c,d.attr("href",c))})}}}]);m.directive("ngPrint",_.optional(["$timeout","$window","?native",
function(a,h,d){var b=d&&d.isNative;return{restrict:"A",link:function(c,e,r){var f=function(){var a;if(b){if(r.ngPrintNative){a=$(c.$interpolate(r.ngPrintNative));if(!a.length)return;a=a[0]}d.print(a)}else h.print()};e.on("click",function(a){a.preventDefault();a.stopPropagation();f()});c.isSet(r.ngPrintAuto)&&a(function(){f()},b?0:400)}}}]));m.directive("ngOpenWindow",["$window","d",function(a,h){return{restrict:"A",link:function(d,b,c){var e=h.observer(c,"ngOpenWindow"),r=h.observer(c,"ngOpenWindowArguments",
"toolbar=0,status=0,scrollbars=1");b.on("click",function(b){if(e()){var h=d.$eval(c.ngOpenWindowWidth);b=d.$eval(c.ngOpenWindowHeight);var f=r();if(h)var g=Math.max(0,(a.screen.width-h)/2),f=f+(",width="+h)+(",left="+g);b&&(h=Math.max(0,(a.screen.height-b)/2),f+=",height="+b,f+=",top="+h);a.open(e(),"angular-open-winow",f)}})}}}]);m.directive("ngCloseWindow",["$window","d",function(a,h){return{restrict:"A",link:function(d,b,h){b.on("click",function(b){a.close()})}}}]);m.directive("ngTouch",["$parse",
"d",function(a,h){return{restrict:"A",compile:function(d,b){var c=a(b.ngTouch);return function(a,b){b.on(h.isTouchEnabled?"touchstart":"click",function(){a.$apply(function(){c(a)})})}}}}]);m.directive("ngConfirmClick",["d","xmessage",function(a,h){return{priority:-1,restrict:"A",link:function(d,b,c){var e=d.isSet(c.ngConfirmClickStrict),r=function(a,c){var e=d.isConfirmedWithOuterFrame;d.isConfirmedWithOuterFrame=!1;e||(a.stopImmediatePropagation(),a.preventDefault(),h.broadcast("fareharbor.confirm",
{message:c}),h.on(d,"fareharbor.confirmed",function(){d.isConfirmedWithOuterFrame=!0;b.click()}))};b.on("click",function(b){if(!(e&&this!==b.target)){var h=c.ngConfirmClick,f;if(!(f=!h))f=_.isUndefined(c.ngConfirmClickWhen)?!0:d.$eval(c.ngConfirmClickWhen,{$event:b}),f=!f;f||(window.top!==window.self&&92===a.chromeVersion()?r(b,h):confirm(h)||(b.stopImmediatePropagation(),b.preventDefault()))}})}}}]);m.directive("ngCancelClick",[function(){return{priority:-1,restrict:"A",link:function(a,h,d){h.on("click",
function(b){a.$eval(d.ngCancelClick)&&(b.stopImmediatePropagation(),b.preventDefault())})}}}]);k=function(a,h){m.directive(a,[function(){return{restrict:"A",link:function(d,b,c){var e=d.isSet(c[a+"Strict"]),r=c[a+"On"]||"";b.on("click",function(b){e&&this!==b.target||(!r||$(b.target).is(r))&&h.test(b)&&d.$apply(function(){!1===d.$eval(c[a])&&(b.stopPropagation(),b.preventDefault())})})}}}])};m.config(["$provide",function(a){a.decorator("ngClickDirective",["$delegate",function(a){a.shift();return a}])}]);
m.directive("ngKeyboardAccessibleClick",[function(){var a=[13,32];return{restrict:"A",link:function(c,d,b){var e=!1,f=function(a){(e=a)?(d.attr("role","button"),d.attr("tabindex","0")):(d.removeAttr("role"),d.removeAttr("tabindex"))};b.ngKeyboardAccessibleClick?c.$watch(b.ngKeyboardAccessibleClick,f):f(!0);d.on("keydown",function(b){_.contains(a,b.keyCode)&&e&&(b.preventDefault(),b.stopPropagation(),$(b.target).click())})}}}]);k("ngClick",{test:function(a){return!a.shiftKey&&!a.ctrlKey&&!a.metaKey&&
!a.altKey}});k("ngShiftClick",{test:function(a){return a.shiftKey&&!a.ctrlKey&&!a.metaKey&&!a.altKey}});k("ngControlClick",{test:function(a){return!a.shiftKey&&a.ctrlKey&&!a.metaKey&&!a.altKey}});k("ngMetaClick",{test:function(a){return!a.shiftKey&&!a.ctrlKey&&a.metaKey&&!a.altKey}});k("ngAltClick",{test:function(a){return!a.shiftKey&&!a.ctrlKey&&!a.metaKey&&a.altKey}});k("ngShiftOrAltClick",{test:function(a){return(a.shiftKey||a.altKey)&&!a.ctrlKey&&!a.metaKey}});m.directive("ngPhoneNumberInput",
["d",function(a){return{priority:1,restrict:"A",link:function(c,d){a.restrictKeypresses(d,/\+|\d/)}}}]);m.directive("ngAmountInput",["$parse","d",function(a,c){return{priority:1,require:"ngModel",restrict:"A",link:function(d,b,e,f){var r=a(e.ngModel),l=parseFloat(e.max)||99999999,k=parseFloat(e.min)||-99999999,w=e.ngAmountInputMax&&a(e.ngAmountInputMax),B=e.ngAmountInputMin&&a(e.ngAmountInputMin),n=e.ngAmountInputDefault&&a(e.ngAmountInputDefault),m=d.isSet(e.ngAmountInputAllowEmpty),m=!e.required||
m,I=d.isSet(e.ngAmountInputAllowZero)&&!!e.ngAmountInputAllowZero,p=function(){return n?n(d)/100:0},t=/[0-9]|\./;if(e.ngAmountInputPositive?!d.$eval(e.ngAmountInputPositive):1)t=/[0-9]|\.|\-/;c.restrictKeypresses(b,t);f.$parsers.push(function(a){if(_.isUndefined(a)||""===a||null===a){if(m)return"";f.$$lastCommittedViewValue=p().toString();return _.roundHalfToEven(100*p())}if(I&&0===a)return 0;f.$setValidity("required",!0);var b=B?Math.max(B(d)/100,k):k,c=w?Math.min(w(d)/100,l):l;!_.isNaN(b)&&a<b&&
(a=b,f.$setValidity("min_value",!0));!_.isNaN(c)&&a>c&&(a=c,f.$setValidity("max_value",!0));return _.roundHalfToEven(100*a)});f.$formatters.unshift(function(a){return _.isUndefined(a)||""===a||null===a?m?"":p():_.roundHalfToEven(a/100,2).toFixed(2)});d.$watch(r,function(a,b){!m&&(_.isUndefined(a)&&_.isUndefined(b))&&r.assign(d,p())});b.on("blur",function(){g(f)})}}}]);m.directive("ngJsonInput",["$parse",function(a){var c=/^(?!^[_\-])(?!.*[_\-]$)[a-zA-Z0-9_\-]+$/,d=function(a){try{_.parseJSON(a)}catch(d){return!1}return!0};
return{require:"ngModel",restrict:"A",link:function(b,e,f,r){var g=a(f.ngModel);r.$parsers.push(function(a){a=$.trim(a);if(_.isUndefined(a)||""===a||null===a)return r.$setValidity("valid_json",!0),"";var b=a;c.test(b)&&(b='"'+b+'"');r.$setValidity("valid_json",d(b));return a});b.$watch(g,function(a){a&&('"'===a.charAt(0)&&'"'===a.slice(-1))&&(a=a.slice(1,a.length-1),(!a||c.test(a))&&g.assign(b,a))})}}}]);m.directive("ngBindOnce",[function(){return{link:function(a,c,d){c.addClass("ng-binding").data("$binding",
d.ngBindOnce);a=a.$eval(d.ngBindOnce)||"";c[0].textContent=a.toString()}}}]);m.directive("ngBindHtmlOnce",["$sce","clientOptions",function(a,c){return{link:function(d,b,e){b.addClass("ng-binding").data("$binding",e.ngBindHtmlOnce);c.reflectUrlsInHrefs(b);b.html(a.getTrustedHtml(d.$eval(e.ngBindHtmlOnce))||"")}}}]);var k=function(a,c,d){m.directive(a,["$compile","$filter","$injector","auth","navigation",function(b,e,f,r,g){var l=T("You don't have permission to see this amount"),k=f.invoke(c.render),
m=e("currencySymbol");return{restrict:"A",compile:function(c,h){c.addClass("notranslate amount");var e={};e.showNullAsZero="ngAmountShowNullAsZero"in h;return function(c,h,f){var n,g;e.hideDecimalWhenInteger=c.isSet(f.ngAmountHideCents);var s=function(a,q){if(!(a===g&&q===n)){g=a;n=q;var s=c.$eval(f.ngAmountCurrency)||c.processorCurrency||q;d=d||"viewAmounts";q&&!r.permissions.can(d,q)?(s=m(s,"short"),b('<span ng-tip="'+l+'">'+s+"?</span>")(c,function(a){h.empty().append(a)}),h.addClass("amount-hidden")):
(s=k(c,f,g,q,s,e),h.text(s),h.addClass("amount-visible"),h.toggleClass("negative",0>g))}};c.$watch(f[a],function(b){s(b,c.$eval(f[a+"Company"])||c.company||null)});_.isUndefined(f[a+"Company"])||c.$watch(f[a+"Company"],function(b){s(c.$eval(f[a]),b||null)})}}}}])},a={render:["$filter",function(a){var c=a("amount");return function(a,b,e,f,r,q){return c(e,r,q.hideDecimalWhenInteger,!0,q.showNullAsZero)}}]};k("ngAmount",a);k("ngInvoiceAmount",a,"viewInvoiceAmounts");k("ngAmountRate",{render:["$filter",
function(a){var c=a("percentage");return function(a,b,e){return c(e)}}]});m.directive("ngFloatInput",function(){return{priority:1,require:"ngModel",link:function(a,c,d,b){a.$eval(d.ngFloatInput);var e=d.ngFloatInputMaxDigits?a.$eval(d.ngFloatInputMaxDigits):null,f=d.ngFloatInputDecimalPlaces?a.$eval(d.ngFloatInputDecimalPlaces):null,r;if(c=d.ngFloatInputMin||d.min){var g=a.$eval(c);r=function(a){b.$setValidity("min_value",a>=g)}}var l;if(d=d.ngFloatInputMax||d.max){var k=a.$eval(d);l=function(a){b.$setValidity("max_value",
a<=k)}}b.$parsers.push(function(a){"."===a&&(a="");"-"===a&&(a="");if(null!==f){var b=a.indexOf(".");-1!==b&&a.length-(b+1)>f&&(a=a.slice(0,b+1)+a.slice(b+1,b+1+f))}null!==e&&(b=e,_.startsWith(a,"-")&&(b+=1),_.contains(a,".")&&(b+=1),a.length>b&&(a=a.substring(0,b)));b=parseFloat(a);if(isNaN(b))return a;r&&r(b);l&&l(b);return b})}}});m.directive("ngBooleanSelect",function(){return{priority:1,require:"ngModel",link:function(a,c,d,b){b.$parsers.push(function(a){return _.contains([!0,"True","true","1"],
a)?!0:_.contains([!1,"False","false","0"],a)?!1:a});b.$formatters.push(function(a){return!0===a?"True":!1===a?"False":a})}}});m.directive("ngIntInput",["$parse","d",function(a,c){return{require:"ngModel",priority:1,compile:function(d,b){var e=a(b.ngIntInputMin),f=a(b.ngIntInputMax);return function(a,b,d,q){if(a.isSet(d.ngIntInput)){var l=_.isUndefined(d.ngIntInputAllowEmpty)||a.isSet(d.ngIntInputAllowEmpty);c.restrictKeypresses(b,/[-0-9]/);q.$parsers.push(function(b){var d=e(a),c=f(a);if(""===b)return l?
b:0;var h=parseInt(b,10);if(isNaN(h))return b;_.isUndefined(d)||(h<d&&(h=d),q.$setValidity("min",!0));_.isUndefined(c)||(h>c&&(h=c),q.$setValidity("max",!0));return h});b.on("blur",function(){g(q)})}}}}}]);m.directive("ngLoadTime",["$window",function(a){return{restrict:"A",link:function(){console.info("ng-load-time",(new Date-a.$$loadTime)/1E3)}}}]);m.directive("ngPlaceholder",[function(){return function(a,c,d){d.$observe("ngPlaceholder",function(a){c.attr("placeholder",a);if("SELECT"===c[0].nodeName){var d=
c.children("option").first();d.text()||(d.attr("label",a),d.text(a))}})}}]);m.directive("ngDatepicker",["$parse","d","localization","moment","Pikaday",function(a,c,d,b,e){return{require:"ngModel",priority:1,restrict:"A",compile:function(d,f){var l=a(f.ngDatepickerYearRange),k=a(f.ngDatepickerMinDate);return function(a,d,q,s){var m=a.isSet(q.ngDatepickerAllowEmpty),p=b.localeData().longDateFormat("L"),t=a.company&&a.company.features?a.company.features.isSundayBased:!0;_.isUndefined(f.ngDatepickerSundayBased)||
(t=a.isSet(f.ngDatepickerSundayBased));var K=$(d),x=_.replaceAll(p,/[a-zA-Z]/,"");c.restrictKeypresses(d,RegExp("[0-9]|/|["+x+"]"));var E=function(a,d){var c=b(a,d);return!c||!c.isValid()?m?"":b():c},t={field:K[0],format:p,onSelect:function(){a.$apply(function(){s.$setViewValue(J.toString())})},minDate:k,yearRange:l,onOpen:function(){var a=E(s.$modelValue,"YYYY-MM-DD");a&&J.setMoment(a)},firstDay:t?0:1,i18n:{previousMonth:T("Previous Month"),nextMonth:T("Next Month"),months:[T("January"),T("February"),
cT("the month of March","March"),T("April"),cT("the month of May","May"),T("June"),T("July"),T("August"),T("September"),T("October"),T("November"),T("December")],weekdays:[T("Sunday"),T("Monday"),T("Tuesday"),T("Wednesday"),T("Thursday"),T("Friday"),T("Saturday")],weekdaysShort:[cT("Abbreviation of Sunday","Sun"),cT("Abbreviation of Monday","Mon"),cT("Abbreviation of Tuesday","Tue"),cT("Abbreviation of Wednesday","Wed"),cT("Abbreviation of Thursday","Thu"),cT("Abbreviation of Friday","Fri"),cT("Abbreviation of Saturday",
"Sat")]}},J=new e(t),v=function(a,b,d){return(a=E(a,b))?a.format(d):""};s.$parsers.push(function(a){return v(a,p,"YYYY-MM-DD")});s.$formatters.unshift(function(a){return v(a,"YYYY-MM-DD",p)});!a.$eval(q.ngModel)&&!m&&(q=s.$pristine,s.$pristine=!1,s.$setViewValue(b().format(p)),s.$render(),s.$pristine=q);d.on("blur",function(){g(s)});a.$on("$destroy",function(){J.destroy()});k&&a.$watch(k,function(a){J.config({minDate:a?a.toDate():void 0});a&&0>b(s.$modelValue,"YYYY-MM-DD").diff(a)&&(s.$modelValue=
a.format("YYYY-MM-DD"),s.$$writeModelToScope(),g(s))})}}}}]);m.directive("ngTimepicker",["$parse","$timeout","d","localization","moment",function(a,c,d,b,e){return{require:"ngModel",restrict:"A",link:function(a,f,q,l){var k=b.current().TIME_FORMATS.default;q=b.current().SERVER_TIME_FORMAT;var m=$(f);d.restrictKeypresses(f,/[0-9]|[:amp]/);var n=m.timepicker({timeFormat:q});f.on("selectTime",function(){a.$safeApply(function(){var a=n.val();a!==l.$viewValue&&l.$setViewValue(a)})});var P=function(a,b,
d){b=e(a,b);return!a||!b||!b.isValid()?"":b.format(d)};l.$parsers.push(function(a){return P(a,k,"HH:mm")});l.$formatters.unshift(function(a){var b=P(a,"HH:mm",k);c(function(){n.timepicker("setTime",b)});return b});f.on("blur",function(){g(l)});a.$on("$destroy",function(){n.timepicker("remove")})}}}]);m.directive("ngInternationalPhoneField",["$compile","$parse","$timeout","auth","localization","models","navigation",function(a,c,d,b,e,f,r){return{require:"ngModel",restrict:"A",link:function(f,g,l,k){var n=
c(l.ngModel),s=c(l.ngInternationalPhoneFieldPhoneCountryModel),n=n(f),m=s(f),p=$(g);g=f.$eval(l.ngInternationalPhoneFieldCountries)||[];var t=function(){return p.intlTelInput("getSelectedCountryData")},K=function(){var b=t(),d=p.siblings(".flag-container").find(".selected-flag");d.attr("ng-tip",function(){return T("Country Code")+(_.isEmpty(b)?"":": +"+b.dialCode+" "+b.name)}).attr("ng-tip-classes","tip-indent").attr("title",null);a(d)(f)},x=_.map(g,function(a){return a[0].toLowerCase()}),E=function(a){a=
a?a.toLowerCase():"";return _.contains(x,a)},J=function(a){d(function(){s.assign(f,a.toUpperCase())},0)};g=[];if(1<x.length){b.currentUser.isAuthenticated||g.push(e.browser.ACCEPT_LANGUAGE_COUNTRY_CODE.toLowerCase());l=r.currentCompany;var v=l.country;if("US"===l.processorCountry||!l.country)v=l.processorCountry;g.push(v.toLowerCase());g=_.uniq(g);g=_.filter(g,function(a){return E(a)})}var M="";m&&E(m)?M=m.toLowerCase():n||(g.length?M=g[0]:x.length&&(M=x[0]));p.intlTelInput({autoPlaceholder:"off",
formatOnDisplay:!1,onlyCountries:x,preferredCountries:g,initialCountry:M});J(M);K();n&&p.intlTelInput("setNumber",n);f.$watch(s,function(a,b){p.parents(".international-phone-field").toggleClass("no-country",!a);if(a!==b)if(!a||E(a)){var d=a,d=d?d.toLowerCase():"";p.intlTelInput("setCountry",d)}else J(M)});p.on("countrychange",function(){f.$safeApply(function(){var a;a=t();a=!a||!a.iso2?"":a.iso2.toUpperCase();J(a);k.$setDirty();k.$setViewValue(p.val());K()})});p.on("open:countrydropdown",function(){f.$safeApply(function(){var a=
p.siblings(".flag-container").find(".country-list");a.length&&!a.hasClass("tb-flyout")&&a.addClass("tb-flyout")})});f.$on("$destroy",function(){p.intlTelInput("destroy")})}}}]);m.directive("ngSlideshow",["$animate","$compile","$templateCache","$timeout",function(a,c,d,b){return{restrict:"A",controller:["$scope","$element","$attrs",function(b,d,c){var e=b.$eval(c.ngSlideshowDelay)||4500,h,f,g=this;g.isPlaying=!1;g.slides=[];g.currentSlide=null;g.addSlide=function(a){a={element:a};g.slides.push(a);
return a};g.removeSlide=function(a){g.slides[f]===a&&(f+=1,f>=g.slides.length&&(f=0));_.overwriteWithout(g.slides,a);g.slides[f]||(f=void 0)};g.showSlide=function(b){if(g.slides.length){var d=_.indexOf(g.slides,b);0>d||(!_.isUndefined(f)&&g.slides[f]!==b&&(b=g.slides[f],g.currentSlide=null,a.removeClass(b.element,"slideshow-showing")),f=d,d=g.slides[f],g.currentSlide=d,a.addClass(d.element,"slideshow-showing"),g.isPlaying&&g.play())}};g.next=function(){var a;_.isUndefined(f)?a=0:(a=f+1,a>=g.slides.length&&
(a=0));g.showSlide(g.slides[a])};g.previous=function(){var a;_.isUndefined(f)?a=0:(a=f-1,0>a&&(a=g.slides.length-1));g.showSlide(g.slides[a])};g.pause=function(){a.removeClass("slideshow-playing");a.addClass("slideshow-paused");clearTimeout(h);g.isPlaying=!1};var n=function(){b.$safeApply(function(){h=null;g.slides.length&&g.next()})};g.play=function(a){g.isPlaying=!0;h&&clearTimeout(h);h=setTimeout(n,a?0:e)}}],link:function(a,b,e,f){e=d.get("slideshow-dots");var g=d.get("slideshow-arrows");a=a.$new();
a.slideshow=f;b.append(c(e)(a));b.append(c(g)(a));f.play(!0)}}}]);m.directive("ngSlideshowSlide",[function(){return{restrict:"A",require:"^ngSlideshow",link:function(a,c,d,b){c.addClass("slideshow-slide");b.slides.length||c.addClass("slideshow-showing");var e=b.addSlide(c);a.$on("$destroy",function(){b.removeSlide(e)})}}}]);m.directive("ngDiff",["diff",function(a){return{restrict:"A",link:function(c,d,b){var e=c.$eval(b.ngDiff);c=c.$eval(b.ngDiffWith);if(_.isUndefined(e)||null===e)e="";if(_.isUndefined(c)||
null===c)c="";d.addClass("diff");_.forEach(a.diffWords(c,e),function(a){var b=$("<span />");a.added?b.addClass("diff-added"):a.removed?b.addClass("diff-removed"):b.addClass("diff-unchanged");b.text(a.value);d.append(b)})}}}]);m.directive("ngMarkdownFileUpload",["$timeout","fileuploader","flash",function(a,c,d){return{require:"ngModel",restrict:"A",link:function(b,e,f,r){var g,l=_.first(e);e.bind("keyup click",function(){_.isUndefined(l.selectionStart)||(g=l.selectionStart)});var k=e.parents(f.ngMarkdownParent).first(),
m=f.ngMarkdownFileUpload;a(function(){k.find(m).on("click",function(){c.uploadAsMarkdown().then(function(a){if(a){var b=r.$viewValue||"",c=_.isUndefined(g)?b.length:g,e=b.substr(0,c);e&&!e.match(/\s$/)&&(e+="\n");(b=b.substr(c))&&!b.match(/^\s/)&&(b="\n"+b);r.$setViewValue(e+a+b);r.$render();d.success(T("Uploaded file"))}},function(){d.error(T("File was not uploaded, please try again"))})})})}}}]);m.directive("ngMarkdownBulkFileUpload",["events","fileuploader","flash",function(a,c,d){return{restrict:"A",
link:function(b,e,f){var r=f.ngMarkdownBulkFileUpload?"ngMarkdownBulkFileUpload."+f.ngMarkdownBulkFileUpload:null;e.on("click",function(){c.uploadAsMarkdown().then(function(b){b&&(a.broadcast(r,b),d.success(T("Uploaded file")))})})}}}]);m.directive("ngMarkdownBulkFileUploadChild",["events",function(a){return{restrict:"A",require:"ngModel",link:function(c,d,b,e){a.on(c,b.ngMarkdownBulkFileUploadChild?"ngMarkdownBulkFileUpload."+b.ngMarkdownBulkFileUploadChild:null,function(a,b){if(b){var d=e.$viewValue||
"",c=b;d&&(c=d+"\n"+b);e.$setViewValue(c);e.$render()}})}}}]);m.directive("ngMarkdownPreview",["markdownConverter",function(a){return{require:"ngModel",restrict:"A",link:function(c,d,b,e){c=d.parents(b.ngMarkdownParent).first();d=c.find(b.ngMarkdownPreview);var f=c.find(b.ngMarkdownPreviewResult);d.on("click",function(){var b=a.makeHtml(e.$viewValue);f.html(b)})}}}]);m.directive("ngMarkdown",["markdownConverter",function(a){return{restrict:"A",link:function(c,d,b,e){e=function(b){b=a.makeHtml(b);
d.html(b)};if(c.isSet(b.ngMarkdownOnce))c.isSet(b.ngMarkdownDebounce)&&console.warn("ngMarkdown: ng-markdown-debounce is ignored when ng-markdown-once is set"),e(c.$eval(b.ngMarkdown));else{var f=e;c.isSet(b.ngMarkdownDebounce)&&(f=_.debounce(e,250,{maxWait:1250}));c.$watch(b.ngMarkdown,f)}}}}]);m.directive("ngMailcheck",["Mailcheck",function(a){return{restrict:"A",scope:{email:"=ngMailcheck"},template:'<a ng-show="suggestedEmail">'+T("Did you mean")+" <b>[[ suggestedEmail ]]</b>?</a>",link:function(c,
d,b,e){c.suggestedEmail="";c.$watch("email",function(b){b?a.run({email:b,suggested:function(a){c.suggestedEmail=a.full},empty:function(){c.suggestedEmail=""}}):c.suggestedEmail=""});d.on("click",function(){c.email=c.suggestedEmail})}}}]);k=function(a){return m.directive(a.name,[function(){return{restrict:"A",link:function(c,d,b){d="$"+a.name;var e=c[d],f;e&&(f=e.isEnabled,e.isEnabled=!1);if(c.hasOwnProperty(d))throw Error("lib.directives: multiple copies of "+a.name+" modifier in same scope");var r=
{isEnabled:!0};c[d]=r;var g=$(a.selector),l=a.get(g),k=l;b.$observe(a.name,function(b,d){r.isEnabled&&(k=b,a.set(g,b,d))});c.$on("$destroy",function(){a.set(g,l,k);e&&(e.isEnabled=f)})}}}])};k({name:"ngTitle",selector:"title",get:function(a){return document.title},set:function(a,c){return document.title=c}});k({name:"ngMetaViewport",selector:'meta[name="viewport"]',get:function(a){return a.attr("content")},set:function(a,c){return a.attr("content",c)}});m.directive("ngBodyClass",[function(){return{restrict:"A",
link:function(a,c,d){var b=$("body"),e="";a.$watch(function(){var b=a.$eval(d.ngBodyClass);return _.isObject(b)?_.mapObject(b,function(a){return!!a}):b},function(a){b.removeClass(e);var d="";_.isObject(a)?_.forEach(a,function(a,b){a&&(d+=b+" ")}):d=a;b.addClass(d);e=d},!0);a.$on("$destroy",function(){b.removeClass(e)})}}}]);m.directive("ngBodyClassOnce",[function(){return{restrict:"A",link:function(a,c,d){c=$("body");a=a.$eval(d.ngBodyClassOnce);var b="";_.isObject(a)?_.forEach(a,function(a,d){a&&
(b+=d+" ")}):b=a;c.addClass(b)}}}]);m.directive("ngInline",["$templateCache",function(a){return{restrict:"A",priority:400,compile:function(c,d){var b=d.ngInline,e=a.get(b);e?c.html(e):console.warn("ng-inline: invalid template",b)}}}]);m.directive("ngLink",["$compile","$templateCache",function(a,c){var d={};return{restrict:"A",priority:400,link:function(b,e,f){if(f=b.$interpolate(f.ngLink)){var g=d[f];if(!g){g=c.get(f);if(!g){console.warn("ng-link: invalid template",f);return}g=a(g);d[f]=g}g(b,function(a){e.empty().append(a)})}else console.warn("ng-link: invalid template name",
f)}}}]);m.directive("ngLoad",["$compile","$http","$templateCache",function(a,c,d){return{restrict:"A",priority:400,compile:function(b,e){var f="/"+e.ngLoad,g=d.get(f);if(g)console.info("ng-load: compiled load",f),b.html(g);else{(g=d.get("ng-load-spinner"))&&b.html(g);var l;return function(b,e,g){var r=function(){l(b,function(a){e.empty().append(a)})};g=function(b){b=b.data;d.put(f,b);console.info("ng-load: downloaded load",f);l=a(b);r()};l?(console.info("ng-load: linked load",f),r(b,e)):c.get(f).then(null,
function(){console.error("ng-load: unable failed to load, retrying...",f);return c.get(f)}).then(g,function(){console.error("ng-load: unable to load",f);var c=d.get("ng-load-error");e.empty().append(a(c)(b))})}}}}}]);m.directive("ngNewTransportation",["$parse",function(a){return{restrict:"A",require:"^?form",controller:"lib.shared.NewTransportationCtrl",link:{pre:function(a,d,b,c){if(c){c.$setValidity("loading-transportation",!1);var e=a.$watch("newTransportationCtrl.status",function(a){if("success"===
a||"error"===a)c.$setValidity("loading-transportation",!0),e()});a.$on("$destroy",function(){c.$setValidity("loading-transportation",!0)})}}}}}]);m.directive("ngDebug",[function(){return{restrict:"A",link:function(a,c,d){debugger}}}]);m.directive("ngLog",[function(){return{restrict:"A",link:function(a,c,d){console.log("ng-log: link",a.$eval(d.ngLog));a.$on("$destroy",function(){console.log("ng-log: $destroy",a.$eval(d.ngLog))})}}}]);m.directive("ngCurrentBlock",["$parse",function(a){return{restrict:"A",
link:function(c,d,b){var e=a(b.ngCurrentBlockBlocks);c.$watch(b.ngCurrentBlockAffiliation,function(a){var b;a&&(b=e(c),b=_.find(b,function(b){return b.affiliation===a}));c.currentBlock=b})}}}]);m.directive("ngStartBooking",["navigation","postBook",function(a,c){return{priority:-1,restrict:"A",link:function(d,b,e){b.on("click",function(){d.$apply(function(){var b;b=e.ngStartBooking?d.$interpolate(e.ngStartBooking):a.url;c.startBooking(b)})})}}}]);m.directive("ngDump",["$parse",function(a){return{restrict:"A",
link:function(c,d,b){var e=a(b.ngDump);console.log("ng-dump: link",e(c));c.isSet(b.ngDumpWatch)&&c.$watch(function(){console.log("ng-dump: $watch",e(c))})}}}]);m.directive("ngQrCode",["$interpolate","QRCode",function(a,c){return{restrict:"A",compile:function(d,b){var e=a(b.ngQrCode);return function(a,b){var d=e(a);new c(b[0],{text:d,width:256,height:256,colorDark:"#000000"})}}}}]);m.directive("ngModelDependencies",["$parse",function(a){return{restrict:"A",controller:function(){var a=this;a.dependents=
[];a.addDependent=function(d){a.dependents.push(d)}},compile:function(c,d){var b=a(d.ngModelDependencies);return function(a,d,c,e){a.$watch(b,function(a){a?d.prop("disabled",!1):(d.prop("disabled",!0),_.forEach(e.dependents,function(a){a(!1)}))})}}}}]);m.directive("ngModel",["$parse",function(a){return{require:"^?ngModelDependencies",link:function(c,d,b,e){if(e){console.info("adding dependent",b.ngModel);var f=a(b.ngModel);e.addDependent(function(a){return f.assign(c,a)})}}}}]);m.directive("ngModelFormatters",
[function(){return{require:"ngModel",link:function(a,c,d,b){_.forEach(a.$eval(d.ngModelFormatters),function(a){b.$formatters.push(a)})}}}]);m.directive("ngModelParsers",[function(){return{require:"ngModel",link:function(a,c,d,b){_.forEach(a.$eval(d.ngModelParsers),function(a){b.$parsers.push(a)})}}}]);m.directive("ngModelIgnore",[function(){return{restrict:"A",require:"ngModel",link:function(a,c,d,b){b.$setPristine=_.ignore;b.$pristine=!1}}}]);m.directive("ngSelectAll",["$parse",function(a){return{restrict:"A",
templateUrl:"ng-select-all",scope:!0,compile:function(c,d){var b=a(d.ngSelectAll),e=a(d.ngSelectAllModel),f=d.ngSelectAllWhen?a(d.ngSelectAllWhen):_.always,g=a(d.ngSelectAllDefaults),l=a(d.ngSelectAllDefaultField);return function(a,c,h){var n=function(h){if(!c.parents("fieldset[disabled]").length){var g=b(a);_.forEach(g,function(b,d){var c={$element:b,$index:d};f(a,c)&&e.assign(a,h(b),c)});(g=a.$eval(d.ngSelectAllCallback))&&g()}};a.selectText=a.$interpolate(h.ngSelectAllText);a.selectAll=_.bind(n,
null,_.constant(!0));a.selectNone=_.bind(n,null,_.constant(!1));a.allowDefaults=!!g(a);if(a.allowDefaults){var q=_.makeIteratee(l(a));a.selectDefaults=function(){var b=g(a);n(function(a){return!!b[q(a)]})}}}}}}]);m.directive("ngSelectAllFromObject",["$parse",function(a){return{restrict:"A",templateUrl:"ng-select-all",scope:!0,compile:function(c,d){var b=a(d.ngSelectAllFromObject);return function(a,d,c){var e=function(c){if(!d.parents("fieldset[disabled]").length){var e=b(a);_.forOwn(e,function(a,
b){e[b]=c})}};a.selectText=a.$interpolate(c.ngSelectAllText);a.selectAll=_.bind(e,null,!0);a.selectNone=_.bind(e,null,!1)}}}}]);m.directive("ngClearInput",["$parse",function(a){return{restrict:"A",compile:function(c,d){c.addClass("ng-clear-input");var b=a(d.ngClearInput);return function(a,d,c){var e=_.isUndefined(c.ngClearInputRefocus)||a.isSet(c.ngClearInputRefocus);a.$watch(b,function(a){d.toggleClass("ng-hide",!a)});d.on("click",function(c){c.preventDefault();c.stopPropagation();e&&d.prev().focus();
a.$apply(function(){b.assign(a,"")})})}}}}]);m.directive("ngDjangoField",["$parse",function(a){return{restrict:"A",compile:function(c,d){var b=a(d.ngDjangoField),e=a(d.ngDjangoFieldModel),f=_.isUndefined(d.ngDjangoFieldRequired)?_.constant(!1):""===d.ngDjangoFieldRequired?_.constant(!0):a(d.ngDjangoFieldRequired),g=_.isUndefined(d.ngDjangoFieldDisabled)?_.constant(!1):a(d.ngDjangoFieldDisabled);return{pre:function(a,b){b.addClass("field")},post:function(a,d){a.$watch(function(){var d=b(a)||{},c=e(a),
h=f(a),l=g(a),c=""===c||_.isUndefined(c);return{"ng-pristine":d.$pristine,"ng-dirty":d.$dirty,"ng-invalid":d.$invalid||c&&h,"ng-disabled":l,"ng-required":h}},function(a){var b=_.map(a,function(a,b){if(a)return b});a=_.map(a,function(a,b){if(!a)return b});d.addClass(b.join(" ")).removeClass(a.join(" "))},!0)}}}}}]);m.directive("ngNoisyInvalidFields",[function(){return{restrict:"A",require:"ngNoisyInvalidFields",controller:["$scope",function(a){var c=this;c.isShowing=!1;var d=function(){$("body").toggleClass("noisy-invalid-fields",
c.isShowing)};c.show=function(a){c.isShowing=_.isUndefined(a)?!0:a;d()};c.hide=function(){c.isShowing=!1;d()};a.$on("$destroy",function(){c.hide()})}],controllerAs:"noisyInvalidFieldsCtrl"}}]);m.directive("ngFiltered",["$parse","$timeout",function(a,c){return{restrict:"A",scope:!0,controller:["$scope","$attrs","$element",function(d,b,e){var f=this;f.searchTerm="";f.isFiltering=!1;f.objects=[];f.reset=function(){g.assign(d,"");P("")};var g=a(b.ngFiltered),l=a(b.ngFilteredObjects),k;b.ngFilteredSearchDocument&&
(k=a(b.ngFilteredSearchDocument));var m=!1;d.isSet(b.ngFilteredElements)&&(m=!0,l=function(){return e.find("[ng-filtered-element]")},k=function(a,b){var d=b.$obj.getAttribute("ng-filtered-element")||"";return b.$obj.innerText+" "+d});var B=function(){_.forEach(e.find("[ng-filtered-element-group]"),function(a){a=$(a);var b=0<a.find("[ng-filtered-element]:not(.ng-hide)").length;a.toggleClass("ng-hide",!b)})},n=function(){var a=l(d);if(!f.searchTerm)return m&&(_.forEach(a,function(a){$(a).removeClass("ng-hide")}),
_.forEach(e.find("[ng-filtered-element-group]"),function(a){$(a).removeClass("ng-hide")})),a;a=_.filter(a,function(a){var b;b=k?k(d,{$obj:a}):a;b=_.contains(b.toLowerCase(),f.searchTerm.toLowerCase());m&&$(a).toggleClass("ng-hide",!b);return b});m&&B();return a},P=function(a){d.$safeApply(function(){f.searchTerm=a;f.isFiltering=!!f.searchTerm;c(function(){f.objects=n()})})},I=_.debounce(P,100);d.$watch(g,function(a){I(a)})}],controllerAs:"filteredCtrl"}}]);m.directive("ngNegateCheckbox",[function(){return{require:"ngModel",
link:function(a,c,d,b){b.$parsers.push(function(a){return!a});b.$formatters.push(function(a){return!a})}}}]);m.directive("ngShortcutsOverlay",[function(){return{templateUrl:"lib.shortcutsOverlay"}}]);m.directive("ngSvg",["$document",function(a){return{replace:!0,template:function(c,d){var b=a[0].getElementById(d.ngSvg);return!b?(console.warn("ng-svg: unable to find svg:",d.ngSvg),"<span></span>"):(new XMLSerializer).serializeToString(b)}}}]);m.directive("ngHoursBeforeMidnight",["$parse",function(a){return{restrict:"A",
templateUrl:"ng-hours-before-midnight",controllerAs:"hoursBeforeMidnightCtrl",controller:["$scope","$attrs",function(c,d){var b=this,e=a(d.ngHoursBeforeMidnight);c.$watch(e,function(a){if(!(_.isUndefined(a)||""===a)){var d=moment().startOf("day").subtract(a,"hours");a=Math.ceil(a/24);b.time=d;b.days=a}})}]}}]);m.directive("ngHoursToDays",["$parse",function(a){return{restrict:"A",templateUrl:"ng-hours-to-days",controllerAs:"hoursToDaysCtrl",controller:["$scope","$attrs",function(c,d){var b=this,e=
a(d.ngHoursToDays);c.$watch(e,function(a){if(!(_.isUndefined(a)||""===a)){var d=a%24;a/=24;var c=0>a;a=Math.floor(Math.abs(a));c&&(a*=-1);b.days=a;b.hours=d}})}]}}]);k=function(a,c){m.directive(a,["cache","clientOptions","db",function(d,b,e){return{restrict:"A",templateUrl:c,controllerAs:"itemPricingCtrl",controller:["$scope","$attrs",function(c,h){var f=this;f.status="loading";f.item=c.$eval(h[a]);if(f.item.isRetail||!f.item.company.features.isPriceEstimateEnabled||f.item.settings.isPriceEstimateHidden)f.status=
"hidden";else{var g=function(a){var c={};b.defaultTotalSheetPk?c.totalSheetPk=b.defaultTotalSheetPk:b.defaultTotalSheetUuid?c.totalSheetUuid=b.defaultTotalSheetUuid:b.defaultTotalScheduleUuid&&(c.totalScheduleUuid=b.defaultTotalScheduleUuid);a&&(c.date=a.format("YYYY-MM-DD"));var h=e.item.pricingOverview({shortname:f.item.company.shortname,itemPk:f.item.pk},null,null,c,{flashError:!1,isRatelimited:!0});d.fresh(h)?(f.status=f.pricingOverview?"success":"loading",h.$promise.then(function(){f.pricingOverview=
h;f.status="success"},function(a){f.pricingOverview=null;f.status=a&&404===a.status?"success":"error"})):(f.status="success",f.pricingOverview=h)},l=h[a+"Date"];l?c.$watch(l,function(a){g(a)}):g()}}]}}])};k("ngItemPricingEstimate","ng-item-pricing-estimate");k("ngItemPricingSummary","ng-item-pricing-summary");m.directive("ngGallery",[function(){return{require:"A",controllerAs:"galleryCtrl",controller:["$scope","$element","$attrs",function(a,c,d){var b=this,e,f,g=function(){var a=b.objects.indexOf(e),
d=c.find("[ng-gallery-selects]"),a=c.find("[ng-gallery-select]")[a];d.length&&a&&d.stop().animate({scrollLeft:a.offsetLeft-a.clientWidth/2})},l=function(d){if(b.isAutoAdvance||d)d=b.objects.indexOf(e),d=(d+1)%b.objects.length,e=b.objects[d],a.$safeApply(),g()},k=function(a){clearInterval(f);a&&l();f=setInterval(function(){l()},4E3)};b.isAutoAdvance=a.isSet(d.ngGalleryAutoAdvance);b.objects=a.$eval(d.ngGallery)||[];d=a.$eval(d.ngGalleryPreselect)||0;e=b.objects[d];b.isSelected=function(a){return e===
a};b.select=function(a){e=a;g()};b.isPaused=!1;b.pause=function(a){a||(b.isPaused=!0);clearInterval(f)};b.unpause=function(a){if(!b.isPaused||!a)b.isPaused=!1,k(!a)};b.next=function(){l(!0)};c.on("mouseenter",function(){b.pause(!0)});c.on("mouseleave",function(){b.unpause(!0)});k()}]}}]);m.directive("ngGalleryOverlay",[function(){return{require:"A",controllerAs:"galleryOverlayCtrl",controller:["$scope","$attrs",function(a,c){var d=this;d.isShowing=!1;d.show=function(a){d.isShowing=!0;d.preselectIndex=
0;a&&(d.preselectIndex=d.objects.indexOf(a),d.preselectIndex=-1===d.preselectIndex?0:d.preselectIndex)};d.hide=function(){d.isShowing=!1};d.objects=a.$eval(c.ngGalleryOverlay)}]}}]);m.directive("ngGalleryOverlayContent",[function(){return{restrict:"A",require:"ngGalleryOverlay",templateUrl:"ng-gallery-overlay-content"}}]);m.directive("ngPasswordGenerator",["$parse","events",function(a,c){var d=/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/;return{restrict:"A",templateUrl:"ng-password-generator",require:["^form",
"ngPasswordGenerator"],controller:function(){var a=this;a.model={};a.update=function(d,c){a.model=d;a.field=c};a.password="";a.generate=function(){for(var c="";!c;){for(var e=0;12>e;e++)c+="abcdefghijknpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ23456789$#*!@?".charAt(Math.floor(61*Math.random()));d.test(c)||(c="")}a.password=a.model.password=c;a.field&&a.field.$setDirty();return c}},compile:function(b,d){var c=a(d.ngPasswordGenerator),e=a(d.ngPasswordGeneratorField);return function(a,b,d,f){var h=f[0];a.generatorCtrl=
f[1];a.generatorCtrl.update(c(a),h[e(a)]);a.$watch(_.bind(c,null,a),function(){a.generatorCtrl.update(c(a),h[e(a)])})}}}}])})();
(function(){var m=angular.module("lib.filters",["lib.services"]);m.factory("filterFields",[function(){var c=[void 0,"",null,[],{}],g=function(g){return _.any(c,function(c){return _.isEqual(c,g)})};return{EMPTY_VALUES:c,isEmpty:g,isSet:function(c,f){return g(f)?!g(c):_.isArray(c)&&_.isArray(f)?!_.isEqual(c.sort(),f.sort()):!_.isEqual(c,f)}}}]);m.filter("isNumber",[function(){return _.isNumber}]);m.filter("isBoolean",[function(){return _.isBoolean}]);m.filter("humanize",["convert",function(c){return c.humanize}]);
m.filter("indexOf",[function(){return _.indexOf}]);m.filter("percentage",["localization",function(c){return function(g,k,f,l){_.isUndefined(f)&&(f=1);var e=c.current();if(f)g=g?g/f:0;else return e.formatPercentage(1,0,!k);l?_.isNumber(l)||(l=0):l=5;return e.formatPercentage(g,l,!k)}}]);m.filter("percentageFromPercentage",["$filter",function(c){return function(g,k,f,l){return c("percentage")(g/100,k,f,l)}}]);m.filter("cssPercentage",[function(){return function(c){if(_.isUndefined(c))return"";c=Math.floor(1E4*
c)/100;return c+"%"}}]);m.filter("pluralize",[function(){return function(c,g,k){k=k||"s";g=g||"";c=parseInt(c||"0",10);c=isNaN(c)?0:c;return 1===c?g:k}}]).filter("capitalize",[function(){return function(c){return _.capitalize(c)}}]).filter("lowercase",[function(){return function(c){return c.toLowerCase()}}]).filter("uppercase",[function(){return function(c){return c.toUpperCase()}}]).filter("bracketWrap",[function(){return function(c){return"["+c+"]"}}]).filter("aOrAnBefore",[function(){var c=/[aeiouAEIOU]/;
return function(g,k){return(g&&c.test(g.charAt(0))?k?"An":"an":k?"A":"a")+" "+g}}]).filter("css",[function(){return function(c){c=(c||"").replace(/\s+/g,"-");c=c.replace(/-+/g,"-");c=c.replace(/[^-\w]/g,"");return c.toLowerCase()}}]).filter("addClassIf",[function(){return function(c,g,k){return c?g||"":k||""}}]).filter("addClasses",[function(){return function(c){var g=[];_.forEach(c,function(c,f){c&&g.push(f)});return g.join(" ")}}]).filter("isDefined",[function(){return function(c){return!_.isUndefined(c)}}]).filter("isUndefined",
[function(){return function(c){return _.isUndefined(c)}}]).filter("map",[function(){return function(c,g){return _.map(c,g)}}]).filter("any",[function(){return _.any}]).filter("anyNumbers",[function(){return function(c){return _.any(c,_.isNumber)}}]).filter("keys",[function(){return _.keys}]).filter("exclude",[function(){return function(c,g){return _.filter(c,function(c){return!g(c)})}}]).filter("colonless",[function(){var c=/:+\s*$/;return function(g){return(g||"").replace(c,"")}}]).filter("commaSeparated",
[function(){return function(c){return!c?"":_.filter(c).join(", ")}}]).filter("replaceAll",[function(){return _.replaceAll}]).filter("ageInYears",[function(){return function(c){return moment().diff(c,"years")}}]).filter("get",[function(){return _.get}]).filter("pluck",[function(){return _.pluck}]).filter("compactObject",[function(){return _.ref.compactObject}]);m.factory("localization",["$browser","$window","auth","convert","db","models","moment","navigation",function(c,g,k,f,l,e,a,q){a.locale("en-us");
var h=l.slipstream("unitsLanguageFormats"),d=l.slipstream("unitsLanguageCodes"),b=function(a){if(!a)return"";a=a.toLowerCase().match(/^([a-z]{2}-)?([a-z]{2})$/);if(!a||3!==a.length)return"";a=a[2];if(!a)return"";a=a.toUpperCase();return _.contains(e.Company.COUNTRY_CODES,a)?a:""};g.ldmlnum.round=_.roundHalfToEven;var m=function(a){h[a]||(console.warn("localization: unsupported language",a),a="en-us");var b=h[a],d=T("Today"),c=_.extend({"export":"MM/YYYY"},b.client.month),e=_.extend({"default":b.client.date.short,
"export":"YYYY-MM-DD"},b.client.date);g.ldmlnum.locale.xx=g.ldmlnum.locale(b.groupSymbol,b.decimalSymbol,b.plusSignSymbol,b.minusSignSymbol);var f=g.ldmlnum(b.decimalPattern,"xx"),r=g.ldmlnum(b.currencyPattern,"xx"),l=g.ldmlnum(b.percentPattern,"xx"),n=RegExp("\\"+b.decimalSymbol+"0+");return{language:a,formatNumber:f,formatCurrency:function(a,b,d){b=b||"";b=r(a).replace("\u00a4\u00a4\u00a4",b).replace("\u00a4\u00a4",b).replace("\u00a4",b);_.isInteger(a)&&d&&(b=b.replace(n,""));return b},formatPercentage:function(a,
d,c){d=l(a,d);c&&(0<a&&-1===d.indexOf(b.plusSignSymbol))&&(d=b.plusSignSymbol+d);return d},PERCENT_SYMBOL:b.percentSymbol,VALID_DATETIME_FORMATS:"default short shortNoYear shortFullYear dayWithMonthAbbr long longNoYear export input".split(" "),TIME_SEPARATOR:b.timeSeparator,HTML_TIME_SEPARATOR:b.htmlTimeSeparator,RANGE_SEPARATOR:" - ",HTML_RANGE_SEPARATOR:"<br/>- ",TODAY:d,DAY_FORMAT:"dddd",DAYS_FORMATS:{"default":"[[ days ]] [days]"},ALL_DAY_FORMATS:{"default":"[All day]"},MONTH_FORMATS:c,DATE_FORMATS:e}};
c=(l.slipstream("acceptLanguage")||"").split(",");c=c.length?_.find(c,function(a){return!!b(a)}):"";var s=b(c),r="",y={},G=function(a,b,d){d=d||{};d.server&&d.topOfHour&&console.error("localization: unsupported use of `server` and `topOfHour` options in `__getTimeFormat()");var c;d.server?(c="server",d="exact"):(c="client",d=d.topOfHour?"topOfHour":"exact");var e=h[a];if(e){var g=e[c];if(g)if(g=g.time)if(g=g[d]){b=b||e[c].time[d].default;if(e=g.values)return(e=e[f.camelKey(b)])||console.warn("localization: failed to identify time format for:",
a,c,"time",d,"values",b),e;console.warn("localization: failed to identify time format for:",a,c,"time",d,"values")}else console.warn("localization: failed to identify time format for:",a,c,"time",d);else console.warn("localization: failed to identify time format for:",a,c,"time");else console.warn("localization: failed to identify time format for:",a,c)}else console.warn("localization: failed to identify time format for:",a)},w=e.Company,B=function(a,b){b=b||{};b.server&&b.topOfHour&&console.error("localization: unsupported use of `server` and `topOfHour` options in `__fallbackTimeFormat()");
return a===w.TWENTY_FOUR_HOUR_TIME_FORMAT_TYPE?b.server?w.FALLBACK_SERVER_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:b.topOfHour?w.FALLBACK_CLIENT_TOP_OF_HOUR_TWENTY_FOUR_HOUR_TIME_FORMAT:w.FALLBACK_CLIENT_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:b.server?w.FALLBACK_SERVER_EXACT_TWELVE_HOUR_TIME_FORMAT:b.topOfHour?w.FALLBACK_CLIENT_TOP_OF_HOUR_TWELVE_HOUR_TIME_FORMAT:w.FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT},n=function(a,b){var d;if(k.currentUser.isAuthenticated){d=k.currentUser.company.isAdmin&&q.currentCompany?
q.currentCompany:k.currentUser.company;var c;c=d.timeFormatType===w.COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE?G(d.language,void 0,b):G(d.language,d.timeFormatType,b);c||(console.warn("localization: falling back for time format type:",d.timeFormatType,b),c=B(d.timeFormatType,b));return c}if(q.currentCompany)return d=q.currentCompany,c=d.anonymousTimeFormatType===w.ANONYMOUS_USER_LOCALE_DEFAULT_TIME_FORMAT_TYPE?G(a,void 0,b):d.anonymousTimeFormatType===w.COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE?G(d.language,
void 0,b):G(d.language,d.anonymousTimeFormatType,b),c||(console.warn("localization: falling back for anonymous time format type:",d.anonymousTimeFormatType,b),c=B(d.anonymousTimeFormatType,b)),c;console.warn("localization: falling back to 12-hour time for an anonymous user with no current company");return w.FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT},P=function(a,b){if(_.contains(b,a))return a;var d=a.split("-")[0];if(_.contains(b,d))return d;for(var c=0,e=b.length;c<e;c++){var f=b[c],h=f.split("-")[0];
if(d===h)return f}};c={browser:{ACCEPT_LANGUAGE:c,ACCEPT_LANGUAGE_COUNTRY_CODE:s},setLanguageManuallyForAnonymousUser:function(a,b){var c;a:if(c=P(a,d),!c){if(b&&(c=P(b.language,d)))break a;c="en-us"}h[c]?(console.log("localization: manually setting units language for anonymous user",c,"based on target language",a),r=c):console.warn("localization: unsupported language",c)},current:function(){var b;b=!k.currentUser.isAuthenticated&&r?r:l.slipstream("unitsLanguage")||"en-us";y[b]=y[b]||m(b);var d=y[b];
a.locale(b);b={TIME_FORMATS:_.extend({"default":"h:mma","export":"hh:mma"},n(b)),TOP_OF_HOUR_TIME_FORMATS:_.extend({"default":"ha","export":"hh:mma"},n(b,{topOfHour:!0})),SERVER_TIME_FORMAT:n(b,{server:!0})};return _.extend({},d,b)}};c.current();return c}]);m.factory("dates",["$interpolate","localization",function(c,g){var k=g.current,f=function(a,b,d,e){var f=b[d.format]||b["default"];if(!f)return console.warn("dates: invalid date format",d.format,"valid formats",b),"";_.isUndefined(e)||(f=c(f)(e));
return!f?"":a.format(f)},l={format:"short",isRelative:!1,isRelativeTime:!1,isHtml:!1,endAt:null,hideDate:null},e=function(a,b,d,c){return c?b||"":b&&d?b+a+d:b||d},a=function(a,b){if(!moment.isMoment(a)||!moment.isMoment(b))return!1;var d=a.clone().startOf("day"),c=b.clone().startOf("day");return!d.diff(c)},q=function(a){var b=a.clone().startOf("day");return!a.diff(b)},h=function(a){var b=a.clone().startOf("hour");return!a.diff(b)},d=function(a,b){if(b.isRelative&&b.isRelativeTime){var d=moment(),
d=a.diff(d,"hours");if(b.isRelative&&0<=d&&6>d)return a.fromNow()}},b=function(a,b){b=b||l;var c=d(a,b);if(c)return c;if(b.endAt&&q(a)&&q(b.endAt)){c=Math.abs(b.endAt.diff(a,"days"));if(1<c)return f(a,k().DAYS_FORMATS,b,{days:c});if(1===c)return f(a,k().ALL_DAY_FORMATS,b)}return h(a)?f(a,k().TOP_OF_HOUR_TIME_FORMATS,b):f(a,k().TIME_FORMATS,b)},m=function(b,d){d=d||l;return d.isRelative&&a(b,moment())?k().TODAY:f(b,k().DATE_FORMATS,d)},s=function(c,f){f=f||l;if(f.endAt&&q(c)&&q(f.endAt))return m(c,
f);var h=m(c,f),g=d(c,f);if(g)return g;g=_.extend({},f);delete g.endAt;return(g=b(c,g))&&f.isHideDate&&a(c,f.hideDate)?g:e(k().TIME_SEPARATOR,h,g)};return{options:function(a){var b=_.extend({},l);_.contains(a,"short")?console.warn("date: unnecessary short format specifier"):_.find(k().VALID_DATETIME_FORMATS,function(d){if(_.contains(a,d))return b.format=d,!0});b.isRelative=_.contains(a,"relative");b.isRelativeTime=_.contains(a,"relative-time");b.isAlwaysHideDate=_.contains(a,"always-hide-date");b.isHideDate=
b.isAlwaysHideDate||_.contains(a,"hide-date");b.isHtml=_.contains(a,"html");b.is12amPlus1=_.contains(a,"12am+1");_.forEach(a,function(d){moment.isMoment(d)&&(b.endAt?b.isHideDate?b.hideDate=d:console.warn("date: extra moments",a,skipEndAt):b.endAt=d)});return b},isSameDay:a,isMidnight:q,isTopOfHour:h,getMonth:function(a,b){b=b||l;return f(a,k().MONTH_FORMATS,b)},getDay:function(b,d){d=d||l;return d.isRelative&&a(b,moment())?k().TODAY:f(b,k().DAY_FORMAT,d)},getDate:m,getDateRange:function(b,d,c){c=
c||l;if(a(b,d))return m(b,c);var f=c.isHtml?k().HTML_RANGE_SEPARATOR:k().RANGE_SEPARATOR;return e(f,m(b,c),m(d,c))},getTime:b,getRelativeTime:d,getTimeRange:function(a,d,c){c=c||l;var h=c.isHtml?k().HTML_RANGE_SEPARATOR:k().RANGE_SEPARATOR,g=Math.abs(a.diff(d,"days"));if(0===a.diff(d))return b(a,c);if(q(a)&&q(d))return 1<g?f(a,k().DAYS_FORMATS,c,{days:g}):f(a,k().ALL_DAY_FORMATS,c);c=null;return 0===g?e(h,b(a,c),b(d,c)):1===g?e(h,b(a,c),b(d,c)+" "+T("(next day)")):e(h,b(a,c),b(d,c)+" "+interpolate(T("(%(count)s days later)"),
{count:g.toString()}))},getDatetime:s,getDatetimeRange:function(d,c,f){f=f||l;if(0===d.diff(c))return s(d,f);var h=f.isHtml?k().HTML_RANGE_SEPARATOR:k().RANGE_SEPARATOR;if(q(d)&&q(c))return 1<Math.abs(d.diff(c,"days"))?(c=c.clone(),c.subtract(1,"days"),e(h,m(d,f),m(c,f))):f.isAlwaysHideDate&&a(d,f.hideDate)?b(d,f):m(d,f);var g;if(g=f.is12amPlus1)if(g=q(c)){g=d;var n=c;!moment.isMoment(g)||!moment.isMoment(n)?g=!1:(g=g.clone().startOf("day"),n=n.clone().startOf("day"),g=1===n.diff(g,"days"))}if(a(d,
c)||g){c=e(k().RANGE_SEPARATOR,b(d,f),b(c,f));g&&(c+="+1");if(f.isHideDate&&a(d,f.hideDate))return c;d=m(d,f);f=f.isHtml?k().HTML_TIME_SEPARATOR:k().TIME_SEPARATOR;return e(f,d,c)}f.isHideDate?(g=_.defaults({isHideDate:!1,hideDate:null},f),f=f.isAlwaysHideDate?f:g):f=g=f;return e(h,s(d,f),s(c,g))}}}]);m.filter("dateOffset",["moment",function(c){return function(g,k,f,l){if(!c.isMoment(g))return"";k=k||0;f=f||"minutes";g=g.clone();return l?g.add(k,f):g.subtract(k,f)}}]).filter("dateSubtract",["$filter",
function(c){return function(g,k,f){return c("dateOffset")(g,k,f,!1)}}]).filter("dateAdd",["$filter",function(c){return function(g,k,f){return c("dateOffset")(g,k,f,!0)}}]);m.filter("dateRange",["dates","moment",function(c,g){return function(k){var f=c.options(_.rest(arguments)),l=f.endAt;return!g.isMoment(k)||!g.isMoment(l)?(console.log("dateRange: invalid moments",k,l,f),""):c.getDateRange(k,l,f)}}]).filter("datetimeRange",["dates","moment",function(c,g){return function(k){var f=c.options(_.rest(arguments)),
l=f.endAt;return!g.isMoment(k)||!g.isMoment(l)?(console.log("datetimeRange: invalid moments",k,l,f),""):c.getDatetimeRange(k,l,f)}}]).filter("timeRange",["dates","moment",function(c,g){return function(k){var f=c.options(_.rest(arguments)),l=f.endAt;return!g.isMoment(k)||!g.isMoment(l)?(console.log("timeRange: invalid moments",k,l,f),""):c.getTimeRange(k,l,f)}}]).filter("date",["dates","moment",function(c,g){return function(k){_.isString(k)&&(k=g(k));var f=c.options(_.rest(arguments));return!g.isMoment(k)?
(console.log("date: invalid moment",k,f),""):c.getDate(k,f)}}]).filter("day",["dates","moment",function(c,g){return function(k){var f=c.options(_.rest(arguments));return!g.isMoment(k)?(console.log("day: invalid moment",k,f),""):c.getDay(k,f)}}]).filter("month",["dates","moment",function(c,g){return function(k){var f=c.options(_.rest(arguments));return!g.isMoment(k)?(console.log("day: invalid moment",k,f),""):c.getMonth(k,f)}}]).filter("datetime",["dates","moment",function(c,g){return function(k){var f=
c.options(_.rest(arguments));return!g.isMoment(k)?(console.log("datetime: invalid moment",k,f),""):c.getDatetime(k,f)}}]).filter("datetimeWithTimezone",["dates","moment",function(c,g){return function(k,f){var l=c.options(_.slice(arguments,2));if(!g.isMoment(k))return console.log("datetimeWithTimezone: invalid moment",k,f,l),"";if(!_.isString(f))return console.log("datetimeWithTimezone: invalid timezone",k,f,l),"";var e=g.tz(k.valueOf(),f);return c.getDatetime(e,l)}}]).filter("timeWithTimezone",["dates",
"moment",function(c,g){return function(k,f){var l=c.options(_.slice(arguments,2));if(!g.isMoment(k))return console.log("timeWithTimezone: invalid moment",k,f,l),"";if(!_.isString(f))return console.log("timeWithTimezone: invalid timezone",k,f,l),"";var e=g.tz(k.valueOf(),f);return c.getTime(e,l)}}]).filter("dateWithTimezone",["dates","moment",function(c,g){return function(k,f){var l=c.options(_.slice(arguments,2));if(!g.isMoment(k))return console.log("dateWithTimezone: invalid moment",k,f,l),"";var e=
g.tz(k.valueOf(),f);return c.getDate(e,l)}}]).filter("time",["dates","moment",function(c,g){return function(k){var f=c.options(_.rest(arguments));return!k||_.isString(k)&&(k=g(k,"HH:mm"),!g.isMoment(k))?"":c.getTime(k,f)}}]);m.filter("range",[function(){return function(c,g){return _.range(c,g)}}]);m.filter("firstLineOfMarkdown",[function(){var c=/^\s*$/,g=/^#+/,k=/([*_]{1,3})(\S.*?\S?)\1/;return function(f){if(!f)return"";f=_.find(f.split("\n"),function(f){return!c.test(f)})||"";return _.trim(f.replace(g,
"").replace(k,"$2").replace(k,"$2"))}}]);m.filter("encodeURIComponent",[function(){return function(c){return encodeURIComponent(c)}}]);m.filter("hostname",[function(){return function(c){if(!c)return"";var g=c.toLowerCase(),k=document.createElement("a");k.setAttribute("href",g);k=k.hostname;return!k||-1===g.indexOf(k)?c:k=k.replace(/^www./,"")}}]);m.filter("withLineBreaks",[function(){return function(c){return c.replace(/\n+/g,"\n<br />\n")}}]);m.factory("phoneNumbers",[function(){var c=_.toTrueKeys([201,
202,203,205,206,207,208,209,210,212,213,214,215,216,217,218,219,220,224,225,227,228,229,231,234,239,240,248,251,252,253,254,256,260,262,267,269,270,272,274,276,278,281,283,301,302,303,304,305,307,308,309,310,312,313,314,315,316,317,318,319,320,321,323,325,327,330,331,334,336,337,339,341,346,347,351,352,360,361,364,369,380,385,386,401,402,404,405,406,407,408,409,410,412,413,414,415,417,419,423,424,425,430,432,434,435,440,442,443,447,458,464,469,470,475,478,479,480,484,501,502,503,504,505,507,508,509,
510,512,513,515,516,517,518,520,530,531,534,539,540,541,551,557,559,561,562,563,564,567,570,571,573,574,575,580,582,585,586,601,602,603,605,606,607,608,609,610,612,614,615,616,617,618,619,620,623,626,627,628,629,630,631,636,641,646,650,651,657,659,660,661,662,667,669,678,679,681,682,689,701,702,703,704,706,707,708,712,713,714,715,716,717,718,719,720,724,725,727,730,731,732,734,737,740,743,747,754,757,760,762,763,764,765,769,770,772,773,774,775,779,781,785,786,801,802,803,804,805,806,808,810,812,813,
814,815,816,817,818,828,830,831,832,843,845,847,848,850,854,856,857,858,859,860,862,863,864,865,870,872,878,901,903,904,906,907,908,909,910,912,913,914,915,916,917,918,919,920,925,927,928,929,930,931,934,935,936,937,938,940,941,947,949,951,952,954,956,959,970,971,972,973,975,978,979,980,984,985,989]),g=function(c){return c?c.replace(/\D/g,""):""},k=function(c){return!c?"":("+"===c[0]?"+":"")+g(c)},f=/^\+?\d{5,15}$/,l=function(e){e=g(e);11===e.length&&"1"===e[0]&&(e=e.slice(1));if(10===e.length){var a=
e.slice(0,3);if(c[a])return{isUsPhoneNumber:!0,areaCode:a,exchange:e.slice(3,6),suffix:e.slice(6,10)}}return{isUsPhoneNumber:!1}};return{cleanPhoneNumber:k,digits:g,isPossiblyValid:function(c){return f.test(k(c))},parseUsPhoneNumber:l,formatUsPhoneNumber:function(c){c=c||"";if("+"===c[0])return c;var a=l(c);return!a.isUsPhoneNumber?c:"("+a.areaCode+") "+a.exchange+"-"+a.suffix}}}]);m.filter("phone",["navigation","phoneNumbers",function(c,g){return function(c){return g.formatUsPhoneNumber(c)}}]);m.filter("contactPhone",
["navigation",function(c){return function(g){if(g){var k=c.currentCompany,k=k.country||k.processorCountry;return!g.phoneCountry||g.phoneCountry===k?g.displayPhoneNational:g.displayPhoneInternational}}}]);m.filter("currencyClass",[function(){return function(c){return(c=_.resolveCurrency(c))?"currency--"+c:""}}]);m.filter("currencySymbol",["auth","db","localization",function(c,g,k){var f=g.slipstream("currencies");return function(g,e){g=_.resolveCurrency(g);var a=f[g];if(!a)return console.warn("currencySymbol filter: unsupported currency",
g),"";c.currentUser.isAuthenticated&&(e=c.currentUser.company.isAdmin?"long":"short");if("short"===e)return a.symbol;if("long"===e)return a.symbolLong;var q=a.symbolLongByLanguage;return(q?q[k.current().language]:"")||a.symbolLong}}]);m.filter("currencyDisplayName",["db","localization",function(c,g){var k=c.slipstream("currencies");return function(c,g){c=_.resolveCurrency(c);var e=k[c];return!e?(console.warn("currencyDisplayName filter: unsupported currency",c),""):"short"==g?e.displayName:e.displayNameLong}}]);
m.filter("amount",["$filter","db","localization","navigation",function(c,g,k,f){var l=g.slipstream("currencies"),e=c("currencySymbol");return function(a,c,h,d,b){b&&null===a&&(a=0);if(!_.isNumber(a))return"";_.isBoolean(c)&&_.isUndefined(d)&&(d=!h,h=c,c=null);c=_.resolveCurrency(c);c||(f.currentCompany?(console.warn("amount filter: not passed currency, falling back to currentCompany"),c=f.currentCompany.processorCurrency):(console.warn("amount filter: not passed currency, no currentCompany to fall back to"),
c="",d=!1));_.isUndefined(d)&&(d=!0);b=k.current();var g=l[c];g?g=g.decimalPlaces:(console.warn("amount filter: passed unsupported currency:",c),d=!1,g=2);a/=Math.pow(10,g);c=d?e(c,d):"";return b.formatCurrency(a,c,h)}}]);m.filter("count",["localization",function(c){return function(g,k){return null===g||void 0===g?"":c.current().formatNumber(g,k||4)}}]);m.filter("stripNewlines",[function(){return function(c){return c.replace(/\r|\n/g,"").replace(/\s+/g," ")}}]);m.filter("yesno",[function(){return function(c,
g,k){g=_.isUndefined(g)?"Yes":g;k=_.isUndefined(k)?"No":k;return c?g:k}}]);m.filter("name",[function(){return function(c,g,k,f){g=g||"";_.isUndefined(f)&&(f=g);return _.isUndefined(c)?f:_.isString(c)?c||g:_.isObject(c)?(c.shortName||c.name||c.unicode||g)+(c.isArchived&&!k?" ("+T("archived")+")":""):g}}]);m.filter("primaryImageUrl",[function(){return function(c){return c.imageCdnUrl||(c.images&&c.images.length?c.images[0].croppedCdnUrl:"")}}]);m.filter("availabilityOrItemImageUrl",[function(){return function(c){return c.availabilityHeadline&&
c.availabilityHeadline.imageCdnUrl?c.availabilityHeadline.imageCdnUrl:c.item.images&&c.item.images.length?c.item.images[0].croppedCdnUrl:c.item.imageCdnUrl||""}}]);m.filter("value",[function(){return function(c){return _.isString(c)?c:c.value}}]);m.filter("personalizeCollectedByText",["$filter","auth",function(c,g){var k=c("name");return function(c){return g.isCompanyUser(c)?T("Collected by you"):interpolate(T("Collected by %(companyName)s"),{companyName:k(c)})}}]);m.filter("lastNameFirst",[function(){return function(c){c=
c.split(/\s+/);var g=c.pop();c.length&&(g+=",");c.unshift(g);return c.join(" ")}}]);m.filter("isOnlineStatusFlag",["models",function(c){return function(g,k){var f="";if(!g)return!1;c.Availability.isCancelled(g)?f="cancelled":g.isBookableOnlyByPhone?f="phone":g.isBookable&&g.isUnlisted?f="unlisted":!g.isBookable&&(g.isResourcesAvailable||g.item.company.companyFeatures.isResourceBookableCapacityEnabled)?f="lock":!g.item.company.companyFeatures.isResourceBookableCapacityEnabled&&!g.isResourcesAvailable&&
(f="noResources");return f===k}}]);m.filter("capacityIndicatorClass",[function(){return function(c){var g=_.contains(arguments,"filled"),k=_.contains(arguments,"large")?"icon-user":"icon-user-small";return c.companyFeatures.isResourceBookableCapacityEnabled?g?"cb-square filled":"cb-square":g?k+" full":k+" empty"}}]);m.filter("blockedCapacityClass",[function(){return function(c,g){return 0===c?"ava-is-empty":c===g?"ava-is-full":c>g?"ava-is-overbooked":"ava-is-booked"}}]);m.filter("capacityClass",["models",
function(c){return function(g,k,f){var l=g.customerCount,e=g.capacity;_.isUndefined(k)||(l=k);var a;_.isUndefined(f)&&(f=!0);if(g.cls===c.ItemGroup.cls)return 0<(g.bookingCount||0)?"ava-is-booked":"ava-is-empty";g.cls===c.Block.cls&&(a=g.reservedCapacity-l);g.cls===c.CustomerTypeRate.cls&&(a=e-l);if(g.cls===c.Availability.cls){a=f?"bookableCapacity":"blocksIncludedBookableCapacity";f=f?"nonResourceBookableCapacity":"blocksIncludedNonResourceBookableCapacity";if(!l)return"ava-is-empty";if(g.company.companyFeatures.isResourceBookableCapacityEnabled){a=
g[a];if(_.isUndefined(a))return console.log("capacityClass: no capacity information for object",g.uri),"ava-is-empty";if(g.isOverusingResources||0>g[f])return"ava-is-overbooked"}else{a=g[f];if(_.isUndefined(a))return console.log("capacityClass: no capacity information for object",g.uri),"ava-is-empty";null!==a&&(a+=g.customerCount-l)}}return 0>=l?"ava-is-empty":0>a?"ava-is-overbooked":0===a?"ava-is-full":null===a||0<a?"ava-is-booked":"ava-is-empty"}}]);m.filter("liveCapacityClass",["models",function(c){return function(c,
k){if(!c||c.$fresh)return"ava-is-empty";var f=k.bookCountsCtrl.availabilityCustomerCount;if(!f)return"ava-is-empty";if(0===k.bookCountsCtrl.customerCount&&(k.availability.isOverbooked||k.availability.isOverusingResources)||c.isOverbookingAvailability||c.isOverusingResources)return"ava-is-overbooked";if(0===c.availabilityLiveBookableCapacity)return"ava-is-full";if(0<f&&(null===c.availabilityLiveBookableCapacity||0<c.availabilityLiveBookableCapacity))return"ava-is-booked";console.log("liveCapacityClass: no capacity information.",
c,f);return"ava-is-empty"}}]);m.filter("availableClass",[function(){return function(c,g){var k=c.capacity-c.customerCount;_.isUndefined(g)||(k=g);return 0>=k?"ava-is-unbookable":"ava-is-bookable"}}]);m.filter("paymentAmountClass",["models",function(c){return function(g){return g.disputeStatus===c.Payment.LOST_DISPUTE_STATUS?"strike":c.Payment.isPaymentFailed(g)?"negative":g.expiresAt?"fh-grey":"positive"}}]);m.filter("hasCustomersClass",[function(){return function(c){return 0<c.customerCount?"ava-is-booked":
"ava-is-empty"}}]);m.filter("abs",[function(){return function(c){return Math.abs(c||0)}}]);m.filter("isAllDay",["dates",function(c){return function(g){return!g?(console.warn("isAllDay: invalid range"),!1):!g.startAt||!g.endAt||+g.startAt===+g.endAt?!1:c.isMidnight(g.startAt)&&c.isMidnight(g.endAt)}}]);m.filter("isMidnight",["dates","moment",function(c,g){return function(k){return!g.isMoment(k)?(console.warn("isMidnight: invalid date",k),!1):c.isMidnight(k)}}]);m.filter("contains",[function(){return function(c,
g){return _.contains(c,g)}}]);m.filter("bookingUrl",["auth","navigation","urls",function(c,g,k){return function(f,l){var e=f.company;return f.isPending&&!c.currentUser.isAuthenticated&&!f.rebookedFrom?(e=f.$url(k.embeds.book.wait.booking),g.extendQuery(e,{status:"initial"})):c.permissions.can("viewDashboardSection",e)?(e=f.$url(k.dashboard.overlay.contact.booking),l&&(e=g.extendQuery(e,{action:l})),e):f.affiliation&&c.permissions.can("viewDashboardSection",f.affiliation.affiliateCompany)?(e=f.$url(k.dashboard.bookings.contact.affiliateBookingPermalink),
l&&(e=g.extendQuery(e,{action:l})),e):f.$url(k.company.item.booking)}}]);m.filter("orderUrl",["auth","navigation","urls",function(c,g,k){return function(f){if(c.permissions.can("viewDashboardSection",f.company))return f.$url(k.dashboard.overlay.contact.order);var g=_.filter(f.allBookings,function(e){return e.affiliation&&c.permissions.can("viewDashboardSection",e.affiliation.affiliateCompany)});return 0<g.length?k.populate(k.dashboard.bookings.contact.affiliateOrderPermalink,{affiliateShortname:g[0].affiliation.affiliateCompany.shortname,
shortname:f.company.shortname,contactPk:f.contact.pk,orderUuid:f.uuid}):f.$url(k.company.order.index)}}]);m.filter("contactUrl",["auth","navigation","urls","require",function(c,g,k,f){return function(f){if(c.permissions.can("viewDashboardSection",f.company))return f.$url(k.dashboard.overlay.contact.index);var e=_.findWhere(c.currentUser.company.partners,{company:f.company});return e&&e.affiliateGroup&&c.permissions.can("viewDashboardSection",c.currentUser.company)?k.populate(k.dashboard.bookings.contact.affiliateContactPermalink,
{affiliateShortname:c.currentUser.company.shortname,shortname:f.company.shortname,contactPk:f.pk}):f.$url(k.company.index)}}]);m.filter("availabilityUrl",["auth","models","urls",function(c,g,k){return function(f){return c.permissions.can("viewDashboardSection",f.item.company)?f.$url(k.dashboard.overlay.availability.index):f.$url(k.company.item.book)}}]);m.filter("itemGroupUrl",["auth","flows","models","urls",function(c,g,k,f){return function(l,e){var a=c.permissions.can("viewDashboardSection",l.item.company)?
f.dashboard.overlay.item.date:f.company.item.date,a=f.populate(a,{shortname:l.item.company.shortname,itemPk:l.item.pk,date:e.format("YYYY-MM-DD")});return a=g.extendWithFlow(a)}}]);m.filter("itemUrl",["auth","urls",function(c,g){return function(k){return c.permissions.can("viewItemsSection",k.company)?k.$url(g.dashboard.items.item.index):k.$url(g.company.item.index)}}]);m.filter("checkinUrl",["db","urls",function(c,g){return function(k){return!k?"":c.slipstream("checkinDomain")+g.populate(g.embeds.checkin.qr,
{encodedCustomerPk:k.encodedPk})}}]);m.filter("waiverUrl",[function(){return function(c,g){return g.company.smartwaiverUrl+c.waiverUuid+"/web/?auto_tag=fh_id_"+g.pk.toString()}}]);m.filter("invoiceUrl",["auth","navigation","urls",function(c,g,k){return function(f,l){l=l||"index";var e;e=g.currentCompany===f.company&&c.permissions.can("viewDashboardSection",f.company)?k.dashboard.reports.invoices.invoice[l]:f.affiliation&&c.permissions.can("viewDashboardSection",f.affiliation.affiliateCompany)?k.dashboard.reports.invoices.partnerInvoice[l]:
k.company.invoice.index;if(!e)throw Error("invoiceUrl: invalid view "+l);return f.$url(e)}}]);m.filter("uploadUrl",["navigation","urls",function(c,g){return function(k){return g.populate(g.dashboard.reports.accounts.upload,{shortname:c.currentCompany.shortname,uploadPk:k.pk})}}]);m.filter("companyDefaultIntegrationsUrl",["navigation","urls","auth","models",function(c,g,k,f){return function(c){var e={shortname:c.shortname};return k.permissions.canList(f.ResellerCompany,c)?c.isAdmin?g.populate(g.dashboard.settings.reseller.apps.index,
e):g.populate(g.dashboard.settings.reseller.index,e):g.populate(g.dashboard.settings.integrations.subscribe,e)}}]);m.filter("key",[function(){return function(c){return c.cls+"."+c.pk}}]);m.filter("summary",[function(){return function(c,g,k){return _.reduce(c,function(c,l){return c+(_.getDotted(l,g)||0)},k||0)}}]);m.filter("uniqueCount",["$filter",function(c){var g=c("pluralize");return function(c,f,l,e){var a={};_.forEach(c,function(c){c=_.get(c,f);_.isObject(c)&&c.uri&&(c=c.uri);a[c]=1});c=_.sum(a);
return l||e?c.toString()+" "+g(c,l,e):c}}]);m.filter("uncamel",[function(){var c=/([a-z])([A-Z])/g,g=function(c,f,g){return f+" "+g};return function(k){return k.replace(c,g)}}]);m.filter("activityChange",["$filter","models",function(c,g){var k=c("amount"),f=c("percentage"),l=function(a){moment.isMoment(a)||(a=moment.parseZone(a));return a},e={AmountField:k,BooleanField:function(a){return a?T("true"):T("false")},PositiveAmountField:k,PercentField:f,PositivePercentField:f,DateTimeField:function(a){return c("datetime")(l(a))},
DateField:function(a){return c("date")(l(a))},ColumnWidthField:function(a){return g.FlowNode.WIDTH_LABELS[a]||a},PKListField:function(a){return a||T("all")},ArrayField:function(a){return _.isArray(a)?a.join(", "):""}};return function(a,f){var h=e[f];return h?h(a):_.isObject(a)?c("name")(a):a}}]);m.filter("defaultIfUndefined",[function(){return function(c,g){return _.isUndefined(c)?g:c}}]);m.filter("displayFilterValue",["$filter",function(c){return function(g){if(!0===g)return T("is set");if(!1===
g)return T("is empty");var k="";_.isString(g)&&"{"===g[0]&&(g=_.parseJSON(g),"contains"===g.type&&(k=T("contains")+" "),g=g.value);return k+c("name")(g)}}]);m.filter("fieldOrBoolean",["$filter",function(c){return function(g){return!0===g?"is set":!1===g?"is empty":_.isObject(g)?c("name")(g):g}}]);m.filter("names",["$filter",function(c){return function(g){return _.map(g,c("name")).join(", ")}}]);m.filter("isEmptyFilter",["filterFields",function(c){return function(g){return _.any(c.EMPTY_VALUES,function(c){return _.isEqual(c,
g)})}}]);m.filter("defaults",[function(){return _.defaults}]);m.filter("parsePresetDateRange",["dateUtils",function(c){return function(g,k){return c.dateRange(g,k)}}]);m.filter("colorClass",["models",function(c){return function(g,k,f){k=k||"";f=f||"";if(!g)return f;g.cls===c.Booking.cls?g=g.availability.item:g.item&&(g=g.item);g.color&&(g=g.color);if(!g||!_.isNumber(g))return f;k&&"-"!==k.charAt(0)&&(k=" "+k);return"color-"+g+k}}]);m.filter("approximate",["$filter",function(c){return function(g,k){var f,
l=1,e=k?"+":"";if(1E3<=g)f=100,l=1E3,e="k"+e;else if(100<=g)f=100;else if(10<=g)f=10;else return g;return c("count")((g-g%f)/l,1)+e}}]);m.filter("displayLanguage",["models",function(c){return function(g){return c.SupportedLanguage.display(g)}}]);m.filter("bankAccountDescription",[function(){return function(c){return c?c.bankName+" "+c.accountLast4:""}}])})();
(function(){var m=angular.module("lib.services","flash.services lib.factories lib.filters lib.models lib.processors ngSanitize ngCookies".split(" "));m.factory("sessionStorage",[function(){var c=function(){var c={};return{get:function(f){f=c[f];if(!_.isUndefined(f))return _.parseJSON(f)},set:function(f,g){c[f]=_.stringifyJSON(g)},del:function(f){delete c[f]},clear:function(){c={}}}},g=c();g.create=c;return g}]);m.factory("storage",["$window","sessionStorage",function(c,g){var k;try{window.localStorage.setItem("$test",
"$test"),window.localStorage.removeItem("$test"),k=!0}catch(f){k=!1}var l;k?(l={key:function(e){try{return c.localStorage.key(e)}catch(a){}},get:function(e){try{var a=c.localStorage.getItem(e);if(_.isString(a))return _.parseJSON(a)}catch(f){}},set:function(e,a){try{c.localStorage.setItem(e,_.stringifyJSON(a))}catch(f){}},del:function(e){try{c.localStorage.removeItem(e)}catch(a){}},clear:function(){try{c.localStorage.clear()}catch(e){}}},Object.defineProperty(l,"length",{get:function(){try{return c.localStorage.length}catch(e){return 0}},
configurable:!1,enumerable:!1})):l=g.create();l.isPersistent=function(){return k};return l}]);m.factory("persistentStorage",["$q","$rootScope","clientOptions","db","events","navigation","require","storage",function(c,g,k,f,l,e,a,q){_.isValidUuid(k.userIdentifier)||(c=q.get("persistentStorageIdentifier"),k.userIdentifier=_.isValidUuid(c)?c:_.uuid());q.set("persistentStorageIdentifier",k.userIdentifier);console.log("persistentStorage: identified user:",k.userIdentifier);var h=function(b){a.notNull(e.currentCompany,
"shortname","persistentStorage needs currentCompany");var d={identifier:k.userIdentifier,shortname:e.currentCompany.shortname};b&&(d.key=b);return d},d={getIdentifier:function(){return k.userIdentifier},setIdentifier:function(a){q.set("persistentStorageIdentifier",a);k.userIdentifier=a;console.log("persistentStorage: re-identified user:",a);l.broadcast("persistentStorage.reIdentifiedUser")},regenerateIdentifier:function(){d.setIdentifier(_.uuid())},get:function(a){a=h(a);var d=f.persistentStoreItem(a);
return d.$promise.then(function(a){return d})},set:function(a,d){var c=h(a),e=f.persistentStoreItem.update(c,d);return e.$promise.then(function(){return e})},del:function(a){a=h(a);return f.persistentStoreItem.remove(a).$promise},clear:function(){var a=h();return f.persistentStoreForCompany.remove(a).$promise},getForAllCompanies:function(a){var d=f.persistentStore({identifier:k.userIdentifier});return d.$promise.then(function(){var c={};_.forEach(d,function(d){c[d.company.shortname]={company:d.company};
c[d.company.shortname][a]=d[a]});return c})}};l.on(g,"auth.logout",d.regenerateIdentifier);l.on(g,"auth.login",d.regenerateIdentifier);return d}]);m.factory("translate",["$rootScope","$window","db",function(c,g,k){var f,l=function(a){0>=a?console.warn("translate: failed to load Google Translate"):!g.google||!g.google.translate||!g.google.translate.TranslateElement?(console.info("translate: not yet loaded, retrying..."),setTimeout(_.bind(l,_,a-1),1E3)):(console.info("translate: loaded"),c.$apply(function(){e.isReady=
!0}))},e={isReady:!1,initialize:function(a){e.isReady?f?a.append(f):(f=$('<div id="google-translate"></div>'),a.append(f),new g.google.translate.TranslateElement({pageLanguage:"en"},f[0])):console.warn("translate: attempting to initialize before load")}};k.slipstream("isAnonymous")&&l(3);return e}]);m.factory("postBook",["$filter","auth","navigation","require",function(c,g,k,f){return{startBooking:function(c){console.log("postBook: start booking",c);g.sessionStorage.set("postBook.path",c)},stopBooking:function(l){f.assert(l,
"postBook: expected booking");var e=c("bookingUrl")(l),a=g.sessionStorage.get("postBook.path");g.sessionStorage.del("postBook.path");console.log("postBook: stop booking",l,e,a);if(!a)return e;l=k.parseMultiUrl(e);if(!l||0!==a.indexOf(l.path))return e;e={};e[l.key]=l.multiPath;_.extend(e,l.search);return k.extendQuery(a,e)}}}]);m.constant("showdown",window.showdown);m.factory("markdownConverter",["$sanitize","showdown",function(c,g){var k=new g.Converter({simpleLineBreaks:!0,noHeaderId:!0});return{makeHtml:function(f){if(!f)return"";
try{var g=_.escape(f),g=_.replaceAll(g,"&gt;",">"),g=_.replaceAll(g,"&#96;","`"),e=k.makeHtml(g);return c(e)}catch(a){return console.error("markdownConverter.makeHtml:",a),""}}}}]);m.constant("Mailcheck",window.Mailcheck);m.constant("moment",window.moment);m.constant("Pikaday",window.Pikaday);m.constant("QRCode",window.QRCode);m.constant("Sentry",window.Sentry);m.factory("filepicker",function(){return window.filepicker||null});m.factory("fileuploader",["$q","$window",function(c,g){var k={},f=window.filepicker;
k.upload=function(){var l=c.defer();f.pickAndStore({mimetypes:["image/*","application/*","text/*"],services:["COMPUTER","WEBCAM","FACEBOOK","INSTAGRAM","URL"]},{location:"S3"},function(c){var a=c?_.first(c):"";if(a.url){c=a.url.replace(g.slipstream.remoteFileDomain,g.slipstream.remoteFileCdnDomain);var f=a.filename||"attachment",a=(a.mimetype||"").match(/^image\/\S+$/);l.resolve({url:c,fileName:f,isImage:a})}else l.reject()},function(c){c&&101===c.code?l.resolve():l.reject()});return l.promise};k.uploadAsMarkdown=
function(){return k.upload().then(function(c){if(c){var e=c.url,a=c.fileName;c=c.isImage?"!["+T("Description of image")+"]("+e+")":"["+T("View")+" "+a+"]("+e+")";return c}return""})};return k}]);m.factory("d3",function(){return window.d3});m.factory("diff",function(){return window.JsDiff});m.factory("exporter",["$q","$rootScope","$timeout","$window","filepicker",function(c,g,k,f,l){var e=document.createElement("a"),a="download"in e&&"Blob"in window,q=function(a,d,e){var f=c.defer();l.store(a,{filename:d,
mimetype:e},function(a){g.$safeApply(function(){f.resolve(a.url)})},function(){g.$safeApply(function(){f.reject()})});return f.promise},h=function(b,d,h){h=h||{};var g=c.defer();if(a)k(function(){var a=new Blob([b],{type:h.mediaType}),a=URL.createObjectURL(a);e.setAttribute("href",a);e.setAttribute("download",d);document.body.appendChild(e);e.click();document.body.removeChild(e);g.resolve()},0,!1);else if(h.openWindow){var m=encodeURIComponent(b);window.open("data:"+h.mediaType+";charset=utf-8,"+
m);g.resolve()}else{if(!l||l._queue)return g.reject(),g.promise;q(b,d,"application/octet-stream").then(function(a){f.location.href=a;g.resolve()},function(){g.reject()})}return g.promise},d=function(a){var d="\ufeff";_.forEach(a,function(a){a=_.map(a,function(a){_.isUndefined(a)?a="":_.isString(a)&&(a=a.replace(/^\s+|\s+$/g,""),a=a.replace(/\s+/g," "),a=a.replace(/,$/,""),a=a.replace(/"/g,'""'),a='"'+a+'"');return a});d+=a.join(",")+"\n"});return d};return{exportToCsvFile:function(a,c,e){e=e||{};
e.mediaType="text/csv";a=d(a);return h(a,c,e)},isDownloadSupported:a}}]);m.factory("xmessage",["$window","db",function(c,g){return{broadcast:function(k,f,l){k={type:k};_.extend(k,f);l=l||"*";f="";try{f=_.stringifyJSON(k),g.slipstream("isDebug")&&console.info("xmessage: broadcast",f),c.parent.postMessage(f,l)}catch(e){console.error("xmessage: unable to broadcast",f)}},on:function(k,f,l,e){e=e||"*";var a=function(a){try{var d=_.parseJSON(a.data);_.isObject(d)&&(g.slipstream("isDebug")&&console.info("xmessage: on",
d),f&&d.type===f&&("*"!==e&&(!e||e!==d.origin)||l(d.data)))}catch(b){}};c.addEventListener("message",a);var q=function(){c.removeEventListener("message",a)};k.$on("$destroy",function(){q()});return q}}}]);m.factory("events",["$rootScope",function(c){return{on:function(c,k,f){return c.$on(k,f)},broadcast:function(){c.$broadcast.apply(c,arguments)}}}]);m.factory("require",function(){var c=function(c,k){c="require: "+c;return k?c+" ("+k+")":c};return{assert:function(g,k){if(!g)throw Error(c("expected '"+
g+"' to be true",k));},assertDefined:function(g,k){if(_.isUndefined(g))throw Error(c("expected '"+g+"' to be defined",k));},notNull:function(g,k,f){if(null===g[k])throw Error(c("expected '"+k+"' not to be null",f));},defined:function(g,k,f){if(_.isUndefined(g[k]))throw Error(c("expected '"+k+"' to be defined",f));},unDefined:function(g,k,f){if(!_.isUndefined(g[k]))throw Error(c("expected '"+k+"' to be undefined",f));},inScope:function(g,k,f){if(_.isUndefined(_.getDotted(g,k)))throw Error(c("expected '"+
k+"' to be in scope",f));},notInScope:function(g,k,f){if(!_.isUndefined(g[k]))throw Error(c("expected '"+k+"' not to be in scope",f));}}});m.provider("convert",["moment",function(c){var g=/_([a-z0-9])/g,k=function(a){a=a||"";return"/"===a[0]?a:a.replace(g,function(a,b){return b.toUpperCase()})},f=function(a,b){if(!a)return null;var d=c(a,"YYYY-MM-DDTHH:mm:ssZZ",!0);if(d.isValid())return d;d=c(a,"YYYY-MM-DDTHH:mm:ss",!0);if(d.isValid())return d;d=c(a,"YYYY-MM-DD",!0);if(d.isValid())return d;if(3===
a.split("-")[0].length)return console.warn("convert: date has a 3-digit year; please fix.",b,a),a="0".concat(a),f(a,b);throw Error("convert: invalid date "+b+": "+a);},l=/_at$/,e=function(a){if(_.isArray(a))for(var b=0,d=a.length;b<d;b++)e(a[b]);else if(_.isObject(a))for(b in a)if(a.hasOwnProperty(b)){d=a[b];delete a[b];var c=k(b);l.test(b)||"at"===b?a[c]=f(d,c):a[c]=e(d)}return a},a=function(a,b,d){return b+"_"+d.toLowerCase()},q=/([a-z])([A-Z0-9])/g,h=/([0-9])([a-zA-Z])/g,d=function(b){b=b.replace(q,
a);return b.replace(h,a)},b=function(a){var e,f;if(c.isMoment(a))e=a.format();else{if(_.isDate(a))throw Error("convert: expected moment, not date "+a);if(_.isArray(a)){e=[];f=0;for(var h=a.length;f<h;f++)e.push(b(a[f]))}else if(_.isObject(a))for(h in e={},a)h&&(a.hasOwnProperty(h)&&"$"!==h[0])&&(f=d(h),e[f]=b(a[h]));else e=a}return e},m=function(a,b,d){return b+" "+d},s=function(a,b){a=a.toString();a=a.replace(q,m);a=a.replace(h,m);a=a.replace(/-/g," ");return _[b?"titleize":"capitalize"](a.toLowerCase())};
this.serverResponse=e;this.clientRequest=b;this.$get=function(){return{serverResponse:e,clientRequest:b,camelKey:k,unCamelKey:d,humanize:s}}}]);m.factory("shortcutsOverlay",["$rootScope","auth","db","events",function(c,g,k,f){var l={isShowing:!1,shouldConfirmClose:!1,show:function(){l.isShowing=!0},hide:function(){l.isShowing=!1},confirmClose:function(a){l.shouldConfirmClose=a}},e;f.on(c,"navigation.company.updated",function(a,c){if(!k.slipstream("isDebug")){var f=c.company;f&&e!==f&&(e=f,f.adminNotes&&
g.permissions.canAdminUpdate(f)&&l.show())}});return l}]);m.factory("shortcuts",["$document","auth","d",function(c,g,k){var f=[],l={"delete":8,tab:9,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},e=function(a,b){for(var c=a.length,e=0;e<c;e++)l[a[e]]=b+e};e("1234567890",49);e("abcdefghijklmnopqrstuvwxyz",65);var a={};_.forEach(l,function(d,b){a[d]=b});var q={shift:"shift",ctrl:"ctrl",
meta:"meta",alt:"alt"},h=function(a){a=a.split("+");var b={};_.forEach(q,function(a){b[a]=!1});_.forEach(a,function(a){var d=q[a];d?b[d]=!0:b.keyCode=l[a]});return b};c.on("keydown",function(d){if(g.currentUser.isAuthenticated){var b=$(d.target);if(!k.isTextInput(b)&&!b.is(".js-disable-shortcuts, select")){b={};b.keyCode=l[a[d.which]];b.meta=d.metaKey||!1;b.alt=d.altKey||!1;b.ctrl=d.ctrlKey||!1;b.shift=d.shiftKey||!1;for(var c,e=f.length-1;0<=e;e--)if(c=f[e],b&&c.keys&&b.keyCode===c.keys.keyCode&&
b.ctrl===c.keys.ctrl&&b.alt===c.keys.alt&&b.meta===c.keys.meta&&b.shift===c.keys.shift){d.preventDefault();c.action();break}}}});return{shortcuts:f,register:function(a){a.keys=h(a.keySet);if(a.keys)return f.push(a),a},unregister:function(a){_.overwriteWithout(f,a)}}}]);m.factory("toggles",["$document","$rootScope",function(c,g){$("html").on("click",function(f){var l=$(f.target);l.closest("[ng-toggle], [ng-toggled], [ng-toggled-show]").length||$.contains(c[0].documentElement,f.target)&&(l.closest(".select2-container, .pika-select").length||
g.$apply(function(){_.forEach(k.toggles,function(c,a){if(c.autoClose&&(!c.group||c.isCloseableGroup))c.state=!1})}))});var k={toggles:{},create:function(c,l){var e=k.toggles[c];e?(e.state=l.defaultState||e.state||!1,e.count+=1):(e={autoClose:l.autoClose||!1,state:l.defaultState||!1,group:l.group||null,isCloseableGroup:l.isCloseableGroup||!1,when:l.when||_.always,count:1},k.toggles[c]=e,e.group&&(e.deregisterGroupWatch=g.$watch(function(){return e.state},function(a){a&&_.forEach(k.toggles,function(a,
c){e!==a&&e.group===a.group&&(a.state=!1)})})))},destroy:function(c){var g=k.toggles[c];g?(g.count-=1,g.count||(g.deregisterGroupWatch&&g.deregisterGroupWatch(),delete k.toggles[c])):console.warn("invalid toggle",c)},toggle:function(c,g){var e=k.toggles[c];e?e.when()?(g=_.isUndefined(g)?!e.state:!!g,e.state=e.group?e.isCloseableGroup?g:!0:g):console.info("toggles: disabled toggle",c):console.warn("toggles: invalid toggle",c)},state:function(c){c=k.toggles[c];return!c?!1:c.state},closeAll:function(){_.forEach(k.toggles,
function(c){c.state=!1})}};return k}]);angular.module("lib.services.interpolate",[]).provider("$interpolate",[function(){var c="{{",g="}}",k="{!",f="!}";this.startSymbol=function(f){return f?(c=f,this):c};this.endSymbol=function(c){return c?(g=c,this):g};this.staticStartSymbol=function(c){return c?(k=c,this):k};this.staticEndSymbol=function(c){return c?(f=c,this):f};this.$get=["$parse","$exceptionHandler","$sce",function(l,e,a){var q=c.length,h=g.length,d=k.length,b=f.length;e=function(e,s,r){for(var m,
G,w=0,B=[],n=e.length,P=!1,I,p,t,K,x=[];w<n;)-1!=(m=e.indexOf(c,w))&&-1!=(G=e.indexOf(g,m+q))?(w!=m&&B.push(e.substring(w,m)),B.push({fn:l(I=e.substring(m+q,G)),exp:I,"static":!1}),w=G+h,P=!0):-1!=(m=e.indexOf(k,w))&&-1!=(G=e.indexOf(f,m+d))?(w!=m&&B.push(e.substring(w,m)),B.push({fn:l(I=e.substring(m+d,G)),exp:I,"static":!0}),w=G+b,P=!0):(w!=n&&B.push(e.substring(w)),w=n);if(!(n=B.length))B.push(""),n=1;m=r===a.URL||r===a.MEDIA_URL;if(r&&!m&&1<B.length)throw console.error("$interpolate: error while interpolating SCE violation",
B),Error("$interpolate: error while interpolating: SCE violation");if(!s||P)return x.length=n,K=function(b){if("undefined"!==typeof K.values[b.$id])return K.values[b.$id];try{for(var d=0,c=0,f=n,h;c<f;c++)h=B[c],"object"===typeof h?(p=h.fn(b),p=r?a.getTrusted(r,p):a.valueOf(p),t=typeof p,null===p||"undefined"===t?p="":"number"===t?p=""+p:"string"!==t&&(p=angular.toJson(p)),h.static||d++):p=h,x[c]=p;var g=x.join("");d||(K.values[b.$id]=g);return g}catch(k){console.error("unable to interpolate",e,"error",
k)}},K.exp=e,K.parts=B,K.values={},K};e.startSymbol=function(){return c};e.endSymbol=function(){return g};e.staticStartSymbol=function(){return k};e.staticEndSymbol=function(){return f};return e}]}]);m.factory("selectedItems",["navigation",function(c){return{extendUrl:function(g,k){if(k.length){var f={"selected-items":_.pluck(k,"pk").join(",")};return c.compose(g,f)}return g}}}]);m.factory("parseAttrsForScope",["$parse",function(c){return function(g,k,f,l){var e={},a=_.isString(l)?function(a){return l+
_.capitalize(a.slice(0,1))+a.slice(1)}:function(a){return a};_.forEach(f,function(f,h){var d=a(h);"@"===f?e[h]=g[d]:"="===f?e[h]=k.$eval(g[d]):"&"===f&&(e[h]=c(g[d]).bind(null,k))});return e}}]);m.factory("tableHeaders",["$parse",function(c){return{parsePredicate:function(g,k,f,l){l=l||"$row";var e=_.choose(k.split(";"),function(a){if(a)return c(a)}),e=_.map(e,function(a,c){return function(c){var d={};d[l]=c;d=a(g,d);moment.isMoment(d)&&(d=d.unix());return _.isUndefined(d)?(console.warn("ng-table-header: predicate returned undefined",
k,c),0):d}});1===e.length&&(e=e[0]);e.source=k;e.isDefault=f||!1;return e}}}]);m.factory("autoExport",["$filter","$q","$timeout","exporter","flash",function(c,g,k,f,l){var e=c("stripNewlines"),a=function(a){return a.replace(/\u2011/g,"-")},q=function(a){return _.map(a.contents(),function(a){var b=$(a);if(3===a.nodeType)return b.text();if(b.is(":visible")&&!b.is("[ng-auto-export-skip]"))return q(b)}).join(" ")},h=function(a){a=!_.isUndefined(a)?a:1;return _.map(_.range(a),_.constant(""))},d=function(a){if(!a||
!a.length)console.warn("autoExport: no exports found");else{if(1===a.length)return a[0];var b={rows:a[0].rows,filename:a[0].filename};_.forEach(_.rest(a),function(a){b.rows.push(h());_.ref.append(b.rows,a.rows)});return b}},b=function(b,d){var c=d.rowSelector?d.rowSelector:d.isCSS?"> .thead > .tr, > .tbody > .tr, > .tfoot > .tr":"> thead > tr, > tbody > tr, > tfoot > tr",f=d.cellSelector?d.cellSelector:d.isCSS?"> .td, > .th":"> td, > th",g=b.data().ngAutoExportSkip;if(!g||!g()){var n=[];_.forEach(b.find(c),
function(b){b=$(b);var d;if(!(d=b.data().ngAutoExportSkip)||!d()){var c=[];_.forEach(b.find(f),function(b){b=$(b);var d=b.data(),f;if(!(f=d.ngAutoExportSkip)||!f()){var g;f=(g=d.ngAutoExportValue)?g():q(b);c.push(a(e(f).trim()));g=(g=b.prop("colspan"))?parseInt(g,10):1;_.ref.append(c,h(g-1))}});n.push(c)}});return{rows:n}}},m={},s={status:"ready",ready:function(){return"ready"===s.status||"error"===s.status},autoExport:function(a,c,e){a=a||"default";c=c||a;if(s.ready()){var h=m[a]||[];if(h.length){var q=
function(){s.status="error";l.error("Error exporting "+c)};s.status="processing";k(function(){var a=[];try{var k=[];_.forEach(h,function(d){if(d.process){var c=d.process(),c=g.when(c);k.push(c);c.then(function(b){b&&a.push({rows:b})})}else{var c=d.tableSelector?d.tableSelector:d.isCSS?".table":"table",e=d.element;e.is(c)||(e=e.find(c));_.forEach(e,function(c){(c=b($(c),d))&&a.push(c)})}});g.all(k).then(function(){var b=d(a);b?(s.status="exporting",f.exportToCsvFile(b.rows,c,e).then(function(){s.status=
"ready"},q)):s.status="ready"})}catch(l){q(),console.error("Error exporting",l)}},0,!1)}else console.warn("autoExport: no exports")}else console.warn("autoExport: not ready")},addExport:function(a,b,d){a=a||"default";var c=m[a]=m[a]||[];a={element:b,namespace:a};_.extend(a,d||{});c.push(a);return a},removeExport:function(a){var b=m[a.namespace]=m[a.namespace]||[];_.ref.remove(b,a)},isDownloadSupported:f.isDownloadSupported,canExport:function(a){return m[a]?0<m[a].length:!1}};return s}]);m.factory("scrollbar",
[function(){var c={width:null,getWidth:function(){if(null!==c.width)return c.width;var g=document.createElement("p");g.style.width="100%";g.style.height="200px";var k=document.createElement("div");k.style.position="absolute";k.style.top="0px";k.style.left="0px";k.style.visibility="hidden";k.style.width="200px";k.style.height="150px";k.style.overflow="hidden";k.appendChild(g);document.body.appendChild(k);var f=g.offsetWidth;k.style.overflow="scroll";g=g.offsetWidth;f==g&&(g=k.clientWidth);document.body.removeChild(k);
c.width=Math.max(f-g,0);return c.width}};return c}]);m.factory("scroll",["$window",function(c){return{scrollTo:function(g,k,f,l){if(g){"top"===g&&(g="body");var e=!k;k=k||"html,body";g=$(g);k=$(k);if(g.length&&k.length){g=Math.min.apply(Math,_.map(g,function(a){return $(a).offset().top||0}));var a=_.chooseFirst(k,function(a){if(a=$(a).scrollTop())return a})||0,q=_.chooseFirst(k,function(a){if(a.scrollHeight)return a.scrollHeight})||0,h=Math.min.apply(Math,_.choose(k,function(a){if(a=$(a).height())return a}));
e&&(h=Math.min(h,c.innerHeight));var e=Math.max(0,q-h),a=1>Math.abs(g-a),d;0>g?(d=15,g=0):a?d=g-15:g>e&&(d=e-15,g=e);e&&(l&&!_.isUndefined(d)?k.stop().animate({scrollTop:d},250,"swing").animate({scrollTop:g},250,"swing"):f?k.stop().animate({scrollTop:g},500,"swing"):k.scrollTop(g))}}}}}]);m.factory("dateUtils",["moment","models",function(c,g){var k=/^\d\d:\d\d$/,f=c("1900-01-01","YYYY-MM-DD"),l=function(a){return _.isUndefined(a)?c():c().tz(a)},e=function(a,b){return function(d){return[l(d).subtract(1,
a+"s").startOf(a),b?l(d).subtract(1,a+"s"):l(d).subtract(1,a+"s").endOf(a)]}},a=function(a,b){return function(d){return[l(d).startOf(a),b?l(d):l(d).endOf(a)]}},q=function(a){return function(b){return[l(b).add(1,a+"s").startOf(a),l(b).add(1,a+"s").endOf(a)]}},h=function(a){return function(b){return[l(b).startOf("day"),l(b).add(a-1,"days").endOf("day")]}},d=function(a){return function(b){return[l(b).subtract(a-1,"days").startOf("day"),l(b).endOf("day")]}},b=g.Report,m={};m[b.TODAY_DATE_RANGE]=a("day");
m[b.THIS_WEEK_DATE_RANGE]=a("week");m[b.THIS_WEEK_TO_DATE_DATE_RANGE]=a("week",!0);m[b.THIS_MONTH_DATE_RANGE]=a("month");m[b.THIS_MONTH_TO_DATE_DATE_RANGE]=a("month",!0);m[b.THIS_QUARTER_DATE_RANGE]=a("quarter");m[b.THIS_QUARTER_TO_DATE_DATE_RANGE]=a("quarter",!0);m[b.THIS_YEAR_DATE_RANGE]=a("year");m[b.THIS_YEAR_TO_DATE_DATE_RANGE]=a("year",!0);m[b.REMAINING_THIS_YEAR_DATE_RANGE]=function(a){return function(b){return[l(b).startOf("day"),l(b).endOf(a)]}}("year");m[b.YESTERDAY_DATE_RANGE]=e("day");
m[b.LAST_WEEK_DATE_RANGE]=e("week");m[b.LAST_WEEK_TO_DATE_DATE_RANGE]=e("week",!0);m[b.LAST_MONTH_DATE_RANGE]=e("month");m[b.LAST_MONTH_TO_DATE_DATE_RANGE]=e("month",!0);m[b.LAST_QUARTER_DATE_RANGE]=e("quarter");m[b.LAST_QUARTER_TO_DATE_DATE_RANGE]=e("quarter",!0);m[b.LAST_YEAR_DATE_RANGE]=e("year");m[b.LAST_YEAR_TO_DATE_DATE_RANGE]=e("year",!0);m[b.TOMORROW_DATE_RANGE]=q("day");m[b.NEXT_WEEK_DATE_RANGE]=q("week");m[b.NEXT_MONTH_DATE_RANGE]=q("month");m[b.NEXT_YEAR_DATE_RANGE]=q("year");m[b.LAST_SEVEN_DAYS_DATE_RANGE]=
d(7);m[b.LAST_THIRTY_DAYS_DATE_RANGE]=d(30);m[b.NEXT_SEVEN_DAYS_DATE_RANGE]=h(7);m[b.NEXT_THIRTY_DAYS_DATE_RANGE]=h(30);m[b.ALL_TIME_DATE_RANGE]=function(){return function(a){return[l(a).startOf("year").year(1),l(a).endOf("year").year(9990)]}}();var s={};s[b.THIS_WEEK_DATE_RANGE]=[!0,!0];s[b.THIS_WEEK_TO_DATE_DATE_RANGE]=[!0,!1];s[b.LAST_WEEK_DATE_RANGE]=[!0,!0];s[b.LAST_WEEK_TO_DATE_DATE_RANGE]=[!0,!1];s[b.NEXT_WEEK_DATE_RANGE]=[!0,!0];var r={DATE_RANGES:m,dateRange:function(a,d){var c=m[a];c||(c=
m[b.TODAY_DATE_RANGE]);var e=c(d.timezone);d.features.isSundayBased||(c=s[a])&&_.forEach(c,function(a,b){a&&e[b].add(1,"days")});return e},isInvertedRange:function(a){if(!a[0]||!a[1])return!1;var b=k.test(a[0]),d=b?"HH:mm":null;if(b&&"00:00"===a[1])return!1;b=c(a[0],d);a=c(a[1],d);return b.isValid()&&a.isValid()&&b>a},isValidDates:function(a){return c(a[0],"YYYY-MM-DD")<f||c(a[1],"YYYY-MM-DD")<f?!1:!0},formatMoment:function(a){return a.format("YYYY-MM-DD-HH-mm-ss")},formatTimeRange:function(a){return r.formatMoment(a.startAt)+
"/"+r.formatMoment(a.endAt)},parseTimeRange:function(a){var b=_.split(a,"/");return{startAt:c(b[0],"YYYY-MM-DD-HH-mm-ss"),endAt:c(b[1],"YYYY-MM-DD-HH-mm-ss"),formatted:a}},overlapsWith:function(a,b){return function(d){return a.startAt<d.endAt&&d.startAt<a.endAt?!0:b?d.startAt.isSame(d.endAt)&&d.startAt.isSame(a.startAt):!1}}};return r}]);m.factory("searchTerms",[function(){return{}}]);m.factory("flows",["$q","availabilityCalendarController","cache","clientOptions","db","models","navigation","require",
"urls",function(c,g,k,f,l,e,a,q,h){var d=e.FlowNode,b=a.getPks("selected-items"),m=function(a,b){!a.children.length&&b&&(a.emptyPageChildren=_.map(b,function(b){return{cls:d.cls,uri:"",pk:null,company:a.company,type:d.ITEM_TYPE,parent:a,item:b,properties:{},unicode:b.unicode}}))},s,r=function(a,b){var d=l.defaultFlowPage({shortname:a});d.$promise.then(function(){b.resolve();y.initialFlowNode=d.flowNode},b.reject)},y={wrapEndpoint:function(a,d){return function(c,e,f,h,g){h=h||{};b.length&&(h.selectedItems=
b.join(","));d||(h.isPage=!0);g=g||{};g.ignoreQueryParamsInCacheUri=!0;g.sideKeys=["emptyPageItems"];c=a(c,e,f,h,g);c.$promise.then(function(a){a!==l.CANCELLED&&m(d?a.primaryData.flowNode:a.primaryData,a.emptyPageItems)});return c}},isNoFlow:function(){return y.initialFlowNode===d.NO_FLOW},currentFlowNodePk:function(){var b=a.get(d.FLOW_QUERY);return"no"===b?!1:b?_.int(b):null},currentFlowNodeUrl:function(a,b){var d=y.currentFlowNodePk();if(!1===d)return null;var c;if(d)return c=a.features.isFlowDateViewEnabled?
h.company.flowNode.date.index:h.company.flowNode.calendar,c=b?c:h.company.flowNode.index,h.populate(c,{flowNodePk:d,shortname:a.shortname});d=a.features.isFlowDateViewEnabled?h.company.items.date.index:h.company.items.calendar;c=b?d:h.company.items.index;return a.$url(c)},currentFlowNodeFromCache:function(a){q.assert(y.initialFlowNode,"flows must be initialized");var b=y.currentFlowNodePk();if(b){a={shortname:a,flowNodePk:b};b=h.populate(h.api.flowNode,a);b=k.cache[b];if(!b||!b.breadcrumbs)b=l.flowNode(a);
return b}return y.initialFlowNode},initialFlowNode:void 0,initialItemBindings:void 0,initialize:function(b){if(s)return console.log("flows: already initialized"),s;var e=c.defer();s=e.promise;var f=y.currentFlowNodePk();if(!1===f){var g=a.pathStartsWith(h.company.item.index);if(g)return y.initialItemBindings=g,y.initialFlowNode=d.NO_FLOW,e.resolve(),s;a.clear(d.FLOW_QUERY,!0)}if(a.get(d.IS_FROM_CART_QUERY))g=[],g.push(l.defaultFlowPage({shortname:b}).$promise),f&&!y.isOnFlowNodePage()&&g.push(l.flowNode({shortname:b,
flowNodePk:f}).$promise),c.all(g).then(function(a){y.initialFlowNode=a[0].primaryData.flowNode;e.resolve()},e.reject);else if(f){var k=l.flowNode({shortname:b,flowNodePk:f});k.$promise.then(function(){y.initialFlowNode=k;e.resolve()},function(c){a.clear(d.FLOW_QUERY,!0);r(b,e)})}else r(b,e);return s},initialUrl:function(){q.assert(y.initialFlowNode,"flows must be initialized");return y.initialFlowNode===d.NO_FLOW?h.populate(h.company.item.index,y.initialItemBindings):y.initialFlowNode.$url(h.company.flowNode.index)},
extendWithFlow:function(b){var c=d.FLOW_QUERY,e=a.get(c);if(_.isUndefined(e))return b;var f={};f[c]=e;return a.compose(b,f,!0)},endpointParams:function(a){var d={shortname:a.company.shortname},c={allowGrouped:"yes",bookableOnly:f.isBookableOnly?"yes":"no"};0<a.childrenCount?c.flow=a.pk:b.length&&(d.itemPks=b.join(","));return{params:d,queryParams:c}},calendarController:function(a,b,d){var c=l.company.calendar,e=y.endpointParams(b);e.itemPks&&(c=l.items.calendar);d.params=_.extend({},d.params,e.params);
d.queryParams=_.extend({},d.queryParams,e.queryParams);return g(a,_.extend({url:d.url,company:b.company,endpoint:c},d))},isOnInitialFlowNode:function(){q.assert(y.initialFlowNode,"flows must be initialized");var a=y.currentFlowNodePk();return null===a||a===y.initialFlowNode.pk},isOnFlowNodePage:function(){return!(!a.pathEquals(h.company.items.index)&&!a.pathStartsWith(h.company.items.calendar)&&!a.pathStartsWith(h.company.items.date.index))},backToCartUrl:function(){var b={};b[d.IS_FROM_CART_QUERY]=
"";var c;c=y.isNoFlow()?a.currentCompany.$url(h.embeds.book.cart.index):y.initialFlowNode.$url(h.embeds.book.cart.flowNode);return a.compose(c,b)}};return y}]);m.factory("poller",["$timeout","$q","db","flash",function(c,g,k,f){var l=[1,1,1,1,1,2,2,3,3,4,4,5,5,10],e=function(a){var g=this;if(!g.isCancelled)if(g.result&&!g.result.isInProgress)g.deferred.resolve(g.result);else{a=a||0;var h=g.pollIntervals[Math.min(a,g.pollIntervals.length-1)],h=1E3*h;g.result=g.endpoint(g.params,g.payload);g.request=
g.result.$promise;g.request.then(function(d){g.status="success";g.isCancelled||(g.result.isInProgress?(g.request=c(_.bind(e,g,a+1),h,g.request),g.request.cancel=function(){c.cancel(g.request)}):g.deferred.resolve(g.result))},function(a){g.status="success";g.cancel();var b=a.data.errorMessage;f.error(g.errorMessage+(b?"("+b+")":""));g.deferred.reject(a)})}};return function(a){var c=g.defer();return{endpoint:a.endpoint,params:a.params||{},payload:a.payload||{},errorMessage:a.errorMessage||"",isComplete:a.isComplete||
_.constant(!0),status:"initial",isCancelled:!1,request:null,result:null,deferred:c,pollIntervals:a.pollIntervals||l,poll:function(){this.isCancelled=!1;e.apply(this);return this},cancel:function(){this.isCancelled=!0;this.request&&this.request.cancel();this.request=null;return this},$promise:c.promise}}}]);m.factory("ratelimit",["$q","require",function(c,g){var k=0,f=[],l=0,e=!1,a=function(){e=!1;var c=_.slice(f,0,20);_.forEach(c,function(a){a()});f=_.rest(f,20);0<f.length&&(e=!0,_.delay(a,1E3));
l=Date.now()};return function(q){return function(){var h=_.toArray(arguments);1E3<Date.now()-l&&(k=0);k++;if(20>=k){l=Date.now();var d=q.apply(null,h);g.assert(_.isPromise(d),"expected promise");return d}console.log("ratelimit: queuing fn:",q);var b=c.defer();f.push(function(){var a=q.apply(null,h);g.assert(_.isPromise(a),"expected promise");a.then(b.resolve,b.reject);return a});e||(e=!0,_.delay(a,1E3));return b.promise}}}]);m.run(["$rootScope","flows","searchTerms","shortcutsOverlay","toggles","translate",
function(c,g,k,f,l,e){c.toggles=l;c.translate=e;c.searchTerms=k;c.shortcutsOverlay=f;c.flows=g}])})();
(function(){var m=angular.module("lib.controllers",["auth.services","db.services","lib.services"]);m.controller("lib.shared.CompanyAdminNotesEditableCtrl",["$scope","controllers","db","require","shortcutsOverlay",function(c,g,k,f,l){f.inScope(c,"company","lib.shared.CompanyAdminNotesEditableCtrl");g.editController(c,{collectionKey:"companies",elementKey:"company",modelKey:"editableCompany",update:k.company.adminNotes.update,editCallback:function(){c.editableCompany.adminNotes||(c.editableCompany.adminNotes=
"# Dashboard Flag Explanation\n\nIf there is anything critical FH Admins should know before working with this Dashboard or this client please:\n\n1. Add all critical information here, be as specific as possible\n2. Check the **Flag this company** box below\n\nOR - Erase this section if it is not applicable to this Dashboard or client\n\n-----\n# Dashboard Notes\n\nBasic overview of company, what they do/sell\n\n-----\n# Additional Feature Notes\n\nIf anything enabled in **Advanced settings** needs further explanation please include that information here, be as specific as possible.\n\nIf usage is straightforward please do not retype enabled features here.\n\n-----\n# Items\n\n\u2022 Settings that must be active on all new items\n\u2022 Information and item numbers for any items that vary in setup from the majority of the Dashboard\n\n-----\n# Resources\n\nBasic overview of company resource layout, other useful information.\n\n-----\n# Affiliates\n\nIf OTAs such as Viator, Expedia, GYG, or Google are in use please explain usage.\n\n-----\n# Related Dashboards\n\nInclude links\n\n-----\n# Major Dashboard Updates Log\n\nYour name:\nWhat you updated:\nWhen you updated it:");
l.confirmClose(!0)},cancelCallback:_.partial(l.confirmClose,!1),successCallback:function(){c.editCtrl.editing=!1;l.confirmClose(!1)},params:function(){return{shortname:c.company.shortname}}})}]);m.controller("lib.shared.NewTransportationCtrl",["$scope","$attrs","$injector","$interpolate","$parse","auth","controllers","convert","db","require","models",function(c,g,k,f,l,e,a,q,h,d,b){d.inScope(c,"customField","lib.shared.NewTransportationCtrl");var m=k.get("plusbook"),s=k.get("rebook"),r=l(g.ngNewTransportation),
y=r(c);y&&_.isString(y)&&(y=q.serverResponse(_.parseJSON(y)));var G=function(a){c.newTransportationCtrl.data=a;a.lodging?(c.newTransportationCtrl.currentLodging=_.find(c.newTransportationCtrl.lodgings,function(b){return b.pk===a.lodging}),c.newTransportationCtrl.currentLodging||(a.lodging=null)):c.newTransportationCtrl.currentLodging=null;a.route&&!m.currentSourceBooking&&!B()?(c.newTransportationCtrl.currentRoute=_.find(c.newTransportationCtrl.routes,function(b){return b.pk===a.route}),c.newTransportationCtrl.currentRoute||
(a.route=null)):c.newTransportationCtrl.currentRoute=null;a.stop&&c.newTransportationCtrl.currentRoute?(c.newTransportationCtrl.currentStop=_.find(c.newTransportationCtrl.currentRoute.stops,function(b){return b.pk===a.stop}),c.newTransportationCtrl.currentStop||(a.stop=null)):(a.route=null,c.newTransportationCtrl.currentRoute=null,a.stop=null,c.newTransportationCtrl.currentStop=null);c.newTransportationCtrl.needsTransportation=!!c.newTransportationCtrl.currentStop||c.customFieldPricing.visibility.isRequired;
c.newTransportationCtrl.needsTransportation&&s.currentBooking&&w()},w=function(){c.newTransportationCtrl.rebookingTransportation=!0;c.newTransportationCtrl.rebookTransportationOptions=[];c.newTransportationCtrl.rebookTransportationOption=null;var a=function(a){_.find(c.newTransportationCtrl.rebookTransportationOptions,function(b){return b.route===a.route&&b.stop===a.stop})||(c.newTransportationCtrl.rebookTransportationOptions.push(a),c.newTransportationCtrl.rebookTransportationOption||(c.newTransportationCtrl.rebookTransportationOption=
a))};if(c.availability.defaultRoute){if(s.currentBooking.stop){var b=_.find(c.availability.defaultRoute.stops,function(a){return a.pickup===s.currentBooking.stop.pickup});b&&a({text:T("Match pickup location"),tip:T("Move to route of new availability but keep same pickup location"),route:c.availability.defaultRoute,stop:b})}(b=_.chooseFirst(c.newTransportationCtrl.currentLodging.preferredPickups,function(a){return _.find(c.availability.defaultRoute.stops,function(b){if(b.pickup===a.pickup)return b})}))&&
a({text:T("Use new availability's default"),tip:T("Use the lodging's preferred stop on the default route"),route:c.availability.defaultRoute,stop:b})}c.newTransportationCtrl.currentRoute&&c.newTransportationCtrl.currentStop&&a({text:T("Keep old booking's options"),route:c.newTransportationCtrl.currentRoute,stop:c.newTransportationCtrl.currentStop});if(c.newTransportationCtrl.canOverrideTransportation){var d={text:T("Pick new options"),route:c.availability.defaultRoute||"",stop:""};a(d)}c.newTransportationCtrl.rebookTransportationOption&&
(c.newTransportationCtrl.data.route=c.newTransportationCtrl.rebookTransportationOption.route.pk,c.newTransportationCtrl.currentRoute=c.newTransportationCtrl.rebookTransportationOption.route,c.newTransportationCtrl.data.stop=c.newTransportationCtrl.rebookTransportationOption.stop.pk,c.newTransportationCtrl.currentStop=c.newTransportationCtrl.rebookTransportationOption.stop);var e=!1;c.$watch("newTransportationCtrl.data",function(a,b){var f=_.find(c.newTransportationCtrl.rebookTransportationOptions,
function(b,d){return b.route.pk===a.route&&b.stop.pk===a.stop}),f=f||d;f!==c.newTransportationCtrl.rebookTransportationOption&&(c.newTransportationCtrl.rebookTransportationOption=f,e=!0,c.$evalAsync(function(){e=!1}))},!0);c.$watch("newTransportationCtrl.rebookTransportationOption",function(a,b){a&&a!==b&&!e&&(a.route&&(c.newTransportationCtrl.data.route=a.route.pk,c.newTransportationCtrl.currentRoute=a.route),c.$evalAsync(function(){c.newTransportationCtrl.data.stop=a.stop?a.stop.pk:null;c.newTransportationCtrl.currentStop=
a.stop||null}))})};c.availability||(c.availability={company:c.company,startAt:moment()});c.newTransportationCtrl={canOverrideTransportation:e.permissions.can("overrideTransportation",b.Booking,c.availability.company),needsTransportation:void 0,rebookingTransportation:!1,rebookingTransportationOptions:[],rebookingTransportationOption:null,data:{lodging:null,lodgingRoomNumber:"",selfLodgingAddress:"",route:null,stop:null},status:"loading"};c.newTransportationCtrl.needsTransportation=c.customFieldPricing.visibility.isRequired?
!0:c.newTransportationCtrl.canOverrideTransportation?!1:void 0;var B=function(){return c.newTransportationCtrl.canOverrideTransportation&&!c.booking&&!c.availability.defaultRoute};c.newTransportationCtrl.showSelfTransportation=function(){return B()||!c.newTransportationCtrl.currentLodging?!1:!c.newTransportationCtrl.isTransportationAvailable()||!1===c.newTransportationCtrl.needsTransportation};c.newTransportationCtrl.isTransportationAvailable=function(){if(B()||!c.newTransportationCtrl.routes.length||
!c.newTransportationCtrl.currentLodging)return!1;var a;if(a=!c.newTransportationCtrl.canOverrideTransportation)if(a=!c.customFieldPricing.visibility.isRequired)a=P(),a=!p(a);return a?!1:!0};c.newTransportationCtrl.showRoutes=function(){return 1>=c.newTransportationCtrl.routes.length?!1:c.newTransportationCtrl.canOverrideTransportation};c.newTransportationCtrl.showStops=function(){return 0>=c.newTransportationCtrl.stops.length?!1:c.newTransportationCtrl.canOverrideTransportation?!0:!p(c.newTransportationCtrl.currentRoute)};
c.newTransportationCtrl.showNeedsTransportation=function(){return c.customFieldPricing.visibility.isRequired?!1:c.newTransportationCtrl.isTransportationAvailable()};c.newTransportationCtrl.showTransportationPrice=function(){return!c.customField.isPricingHidden&&(b.PriceLine.showOffset(c.customFieldPricing)||b.PriceLine.showRate(c.customFieldPricing))};var n=function(){c.newTransportationCtrl.stops=c.newTransportationCtrl.currentRoute?c.newTransportationCtrl.currentRoute.stops:[]},P=function(){return 1===
c.newTransportationCtrl.routes.length?c.newTransportationCtrl.routes[0]:c.availability.defaultRoute?c.availability.defaultRoute:null},I=function(){var a=P();a?(c.newTransportationCtrl.data.route=a.pk,c.newTransportationCtrl.currentRoute=a):(c.newTransportationCtrl.data.route=null,c.newTransportationCtrl.currentRoute=null)},p=function(a){if(c.newTransportationCtrl.currentLodging&&a)return 1===c.newTransportationCtrl.stops.length&&(c.newTransportationCtrl.canOverrideTransportation||c.customFieldPricing.visibility.isRequired)?
c.newTransportationCtrl.stops[0]:_.chooseFirst(c.newTransportationCtrl.currentLodging.preferredPickups,function(b){return _.chooseFirst(a.stops,function(a){if(a.pickup===b.pickup)return a})})},t=function(){var a=p(c.newTransportationCtrl.currentRoute);if(a)return c.newTransportationCtrl.data.stop=a.pk,c.newTransportationCtrl.currentStop=a,!0;c.newTransportationCtrl.data.stop=null;c.newTransportationCtrl.currentStop=null;!c.newTransportationCtrl.canOverrideTransportation&&!c.customFieldPricing.visibility.isRequired&&
(c.newTransportationCtrl.data.route=null,c.newTransportationCtrl.currentRoute=null);return!1},K=function(a){return{route:a,run:{capacity:a.capacity,customerCount:0,bookingCount:0},pk:a.pk}};c.newTransportationCtrl.routeSelectionText=function(a){var b=a.route;a=a.run;if(!c.newTransportationCtrl.canOverrideTransportation||!a.customerCount)return b.name;var d=a.customerCount.toString();null!==a.capacity&&(d+=" "+T("of")+" "+a.capacity.toString());d=interpolate(nT("(%(count)s person booked so far)","(%(count)s people booked so far)",
d),{count:d});return b.name+" "+d};var x,E,J,v=function(){x=h.lodgings({shortname:c.availability.company.shortname},null,null,null,{tagAlong:!0});E=c.newTransportationCtrl.canOverrideTransportation?h.routes({shortname:c.availability.company.shortname},null,null,null,{tagAlong:!0}):c.availability.defaultRoute?h.route({shortname:c.availability.company.shortname,routePk:c.availability.defaultRoute.pk},null,null,null,{tagAlong:!0}):[];J=c.newTransportationCtrl.canOverrideTransportation?h.runs.searchByDate({shortname:c.availability.company.shortname,
date:c.availability.startAt.format("YYYY-MM-DD")},null,null,null,{tagAlong:!0}):[];a.dataController(c,{promises:[x.$promise,E.$promise,J.$promises],successCallback:M,errorCallback:function(){c.newTransportationCtrl.status="error"}})},M=function(){c.newTransportationCtrl.status="success";c.newTransportationCtrl.lodgings=x;c.newTransportationCtrl.routes=_.isArray(E)?E:[E];c.newTransportationCtrl.routeSelections=_.map(c.newTransportationCtrl.routes,K);_.forEach(J,function(a){var b=_.find(c.newTransportationCtrl.routeSelections,
function(b){return b.route===a.route});b&&(b.run=a)});y&&G(y);c.$watch("customFieldPricing.visibility.isRequired",function(a){a&&(c.newTransportationCtrl.needsTransportation=!0)});c.$watch("newTransportationCtrl.currentLodging",function(a,b){a&&c.newTransportationCtrl.needsTransportation&&(c.newTransportationCtrl.currentRoute||I(),a!==b&&t(),a===b&&(!c.newTransportationCtrl.canOverrideTransportation&&!c.newTransportationCtrl.currentStop)&&(n(),t()))});c.$watch("newTransportationCtrl.currentRoute",
function(a,b){n();a!==b&&a&&t()});c.$watch("newTransportationCtrl.needsTransportation",function(a,b){a!==b&&(a?(c.newTransportationCtrl.currentRoute||I(),t()):(c.newTransportationCtrl.data.route=null,c.newTransportationCtrl.currentRoute=null,c.newTransportationCtrl.data.stop=null,c.newTransportationCtrl.currentStop=null))});c.$watch("newTransportationCtrl.data",function(){c.newTransportationCtrl.data.lodging?r.assign(c,_.stringifyJSON(q.clientRequest(c.newTransportationCtrl.data))):r.assign(c,null)},
!0)};c.availability.pk&&_.isUndefined(c.availability.defaultRoute)?h.availability({shortname:c.availability.company.shortname,itemPk:c.availability.item.pk,availabilityPk:c.availability.pk}).$promise.then(function(){v()}):v()}])})();
(function(){var m=angular.module("lib.factories",[]);m.factory("dataController",["$q","cache","db",function(c,g,k){var f={};return function(l,e){e=e||{};var a=e.successCallback||_.ignore,q=e.errorCallback||_.ignore;l.dataCtrl={STALE:f,status:e.isManual?"manual":"loading",isStale:!1};var h=!1;l.$on("$destroy",function(){_.forEach(e.promises,function(a){a&&a.cancel&&a.cancel()});h=!0});var d=function(a){l.dataCtrl.status=a;l.dataCtrl.isStale=!1},b=function(a){if(a){var b=k.errorStatus(a.status);b&&
(q(a),d(b))}},m=function(c){if(!h){var e=a(c);e&&_.isFunction(e.then)?e.then(function(){d("success")},b):d("success");return c}},s=function(){if(_.isFunction(e.loadCallback)){var d=e.loadCallback();_.isObject(d)&&(_.extend(e,d),a=e.successCallback||_.ignore,q=e.errorCallback||_.ignore)}l.dataCtrl.status="loading";d=_.choose(e.promises||[]);if(!d.length)return m();e.stale&&_.every(e.stale,function(a){return!_.isUndefined(a)&&!g.fresh(a)})&&(a(l.dataCtrl.STALE),l.dataCtrl.isStale=!0,l.dataCtrl.status=
"success");return c.all(d).then(m,b)};l.dataCtrl.showLoading=function(){l.dataCtrl.status="loading"};l.dataCtrl.showComplete=function(){l.dataCtrl.status="success"};e.retry&&(l.dataCtrl.retry=function(){s()});e.isManual?l.dataCtrl.load=function(){return s()}:s();return l}}]);m.factory("navigationController",["navigation",function(c){return function(g,k){g.navigationCtrl={entries:k.entries||[]};_.forEach(g.navigationCtrl.entries,function(f){_.isUndefined(f.isCurrent)&&(f.isCurrent=function(){var g=
f.navigationUrl||f.url;return!g?!1:(f.equals?c.pathEquals:c.pathStartsWith)(g)})});g.navigationCtrl.isVisible=function(c){return _.isUndefined(c.isVisible)?!0:_.isFunction(c.isVisible)?c.isVisible():c.isVisible};return g}}]);m.factory("nagsController",["auth","db","models",function(c,g,k){return function(f,l){f.nagsCtrl={company:l.company};f.nagsCtrl.isNagSaving=!1;f.nagsCtrl.dismissCompanyNag=function(c){if(!f.nagsCtrl.isNagSaving){f.nagsCtrl.isNagSaving=!0;var a={};a[c]=!0;g.company.nags.update({shortname:f.nagsCtrl.company.shortname},
a).$promise.then(function(){f.nagsCtrl.isNagSaving=!1},function(){f.nagsCtrl.isNagSaving=!1})}};f.nagsCtrl.dismissUserNag=function(e){if(c.currentUser.nags[e]){f.nagsCtrl.isNagSaving=!0;var a={};a[e]=!0;g.user.nags.update({shortname:c.currentUser.company.shortname,username:c.currentUser.username},a).$promise.then(function(){f.nagsCtrl.isNagSaving=!1},function(){f.nagsCtrl.isNagSaving=!1})}else console.error("Invalid dismissal for user nag: ",e)};f.nagsCtrl.dismissUserNags=function(){k.User.hasAnyNags(c.currentUser)&&
g.user.nags.update({shortname:c.currentUser.company.shortname,username:c.currentUser.username})};f.nagsCtrl.undismissCompanyNags=function(){f.nagsCtrl.isNagSaving=!0;g.company.nags.update({shortname:f.nagsCtrl.company.shortname},{undismiss:!0}).$promise.then(function(){f.nagsCtrl.isNagSaving=!1},function(){f.nagsCtrl.isNagSaving=!1})};f.nagsCtrl.undismissUserNags=function(){f.nagsCtrl.isNagSaving=!0;g.user.nags.update({shortname:c.currentUser.company.shortname,username:c.currentUser.username},{undismiss:!0}).$promise.then(function(){f.nagsCtrl.isNagSaving=
!1},function(){f.nagsCtrl.isNagSaving=!1})};return f}}]);m.factory("headerController",["$timeout","auth","db","models","nagsController","navigation","navigationController","urls",function(c,g,k,f,l,e,a,q){return function(h,d){h.headerCtrl={};h.headerCtrl.logout=function(){g.isLogoutInProgress=!0;var a=g.currentUser.company;a?e.navigate(a.$url(q.company.login)):e.navigate(q.index);c(function(){g.isLogoutInProgress&&g.logout();g.isLogoutInProgress=!1})};g.currentUser.isAuthenticated&&(h.headerCtrl.relatedCompanies=
g.relatedCompanies());h.$watch(d.companyFn,function(b){h.headerCtrl.company=b;l(h,{company:h.headerCtrl.company});a(h,{entries:[{text:"Admin",url:b.$url(q.dashboard.admin.index),isVisible:function(){return b.isAdmin&&g.permissions.can("viewAdminSection",b)},shortcut:"shift+a",shortcutDescription:"Show Admin."},{text:"Bookings",url:b.$url(q.dashboard.bookings.index),isVisible:function(){return(b.isCharter||b.isAffiliate)&&g.permissions.can("viewBookingsSection",b)},shortcut:"shift+b",shortcutDescription:"Show Bookings calendar."},
{text:"Manifest",url:b.$url(q.dashboard.manifest.index),isVisible:function(){return b.isCharter&&g.permissions.can("viewManifestSection",b)},shortcut:"shift+m",shortcutDescription:"Show Manifest."},{text:"Reports",url:b.$url(q.dashboard.reports.index),isVisible:function(){return g.permissions.canList(f.Report,b)},shortcut:"shift+r",shortcutDescription:"Show Reports."},{text:"Items",url:b.$url(q.dashboard.items.index),isVisible:function(){return b.isCharter&&g.permissions.can("viewItemsSection",b)},
shortcut:"shift+i",shortcutDescription:"Show Items.",isCurrent:function(){return e.pathStartsWith(q.dashboard.items.index)||e.pathStartsWith(q.dashboard.resources.index)}},{text:"Settings",url:b.$url(q.dashboard.settings.index),shortcut:"shift+s|shift+e",shortcutDescription:"Show Settings."},{text:"Website Admin",url:"https://content.fareharbor.me/wp-admin/",isVisible:_.getter(b,"isAdmin"),isOutbound:!0},{text:"Help",url:"https://fareharbor.com/help/",isOutbound:!0}]})});h.headerCtrl.turnOffSnowstorm=
g.storage.get("turnOffSnowstorm");h.$watch("headerCtrl.turnOffSnowstorm",function(a){a?g.storage.set("turnOffSnowstorm",!0):g.storage.del("turnOffSnowstorm")});return h}}]);m.factory("emailSubjectsController",["$q","db","models","require",function(c,g,k,f){var l=[k.Booking.cls,k.Order.cls,k.Availability.cls];return function(e,a){f.defined(a,"modelKey");f.defined(a,"target","emailSubjectsCtrl: target must be provided");f.assert(_.contains(l,a.target.cls),"emailSubjectsCtrl: target must be an availability, booking, or an order");
var q={};e[a.controllerAs||"emailSubjectsCtrl"]=q;var h=a.target.company,d=a.prefix||"",b=d+"type",m=d+"subject",s=d+"language",r=function(b,d){d||(d=_.getDotted(e,a.modelKey));return _.isObject(d)?_.getDotted(d,b):void 0},y=function(b,d){_.getDotted(e,a.modelKey)[b]=d};q.resetToDefault=function(){var d=r(b),c="";e.isSubjectEditable=k.Notification.isSubjectEditable(d);d===k.Notification.DISPUTE_TYPE&&(c=k.Notification.subjectForDisputeType(a.target));a.subjectKeys?_.forEach(a.subjectKeys,function(a,
b){y(b,c||e.subjects[a]||e.subjects[h.language])}):(d=r(s),y(m,c||e.subjects[d]))};var G=!1,w=c.defer();q.promises=[w.promise];e.$watchCollection(function(){return _.getDotted(e,a.modelKey)},function(d,c){var f=r(b,d),l=r(b,c),p=r(s,d),m=r(s,c);if(!G&&f)if(f===k.Notification.DISPUTE_TYPE)q.resetToDefault();else{if(a.target.cls===k.Availability.cls){if(e.subjects&&f===l)return;l=_.values(a.subjectKeys).join(",");e.subjects=g.subjects.availability({shortname:h.shortname,type:f,availabilityPk:a.target.pk,
languages:l})}else{if(!p||e.subjects&&f===l&&p===m)return;e.subjects=a.target.cls===k.Order.cls?g.subjects.order({shortname:h.shortname,type:f,orderUuid:a.target.uuid,language:p}):g.subjects.booking({shortname:h.shortname,type:f,bookingUuid:a.target.uuid,language:p})}G=!0;e.subjects.$promise.then(function(){q.resetToDefault();G=!1;w.resolve()}).catch(function(){w.reject()})}});return q}}]);m.factory("cannedMessagesController",["$q","auth","db","flash","models","navigation","require","toggles",function(c,
g,k,f,l,e,a,q){return function(h,d){a.defined(d,"modelKey");a.defined(d,"noteField");d.cannedField=d.cannedField||"message";var b={};h.cannedMessagesCtrl=b;b.toggleKey="canned-message-"+h.$id;b.useDefaultMessage=!d.languageKey&&!d.onTranslationsLoad&&!d.languageOverride;var m=function(a,b){var d=l.SupportedLanguage.rootLanguage(b),c=_.find(a,{language:b});return(c=(c=c||_.find(a,{language:d}))||_.find(a,function(a){return l.SupportedLanguage.shareRootLanguage(a.language,b)}))?c.fieldValue:null};b.onTranslationsLoad=
d.onTranslationsLoad||function(a,c){var e=c[d.cannedField],g=d.languageOverride||h[d.modelKey][d.languageKey],k=a(g);k?e=k:l.SupportedLanguage.shareRootLanguage(c.company.language,g)||f.warn(interpolate(T("Selected canned message is missing translation for %(language)s, using original message instead."),{language:l.SupportedLanguage.display(g)}));b.addMessageToNote(e)};b.select=function(a){var c=g.permissions.canView(l.SupportedLanguage,a.company),e=a.company.companyFeatures.isContentTranslationEnabled;
if(b.useDefaultMessage||!e||!c){b.addMessageToNote(a[d.cannedField]);var G=l.SupportedLanguage.shareRootLanguage(d.languageOverride||h[d.modelKey][d.languageKey],a.company.language);e&&(!c&&!G)&&f.warn(interpolate(T("You do not have permission to view translated content for %(companyName)s. Please contact your administrator."),{companyName:a.company.name}));q.toggle(b.toggleKey,!1)}else{b.loadingCannedMessagePk=a.pk;var w=k.translationsForField({shortname:a.company.shortname,objectType:a.cls,objectId:a.pk,
objectField:d.cannedField});return w.$promise.then(function(){var d=_.filter(w.translationsForField,function(a){return a.supportedLanguage.isLive}),d=_.bind(m,null,d);b.onTranslationsLoad(d,a)}).finally(function(){b.loadingCannedMessagePk=!1;q.toggle(b.toggleKey,!1)})}};b.addMessageToNote=d.addMessageToNote||function(a){var b=h[d.modelKey][d.noteField]||"",b=b.replace(/\s+$/g,"");""!==b&&(b=b.concat("\n\n"));a=b.concat(a);h[d.modelKey][d.noteField]=d.formattingFn?d.formattingFn(a):a};b.TYPES=d.types||
l.CannedMessage.TYPES;b.displayType=l.CannedMessage.displayType;b.promises=[];d.cannedMessagesByType||(d.cannedMessagesByType={},_.forEach(b.TYPES,function(a){d.cannedMessagesByType[a]=[]}),_.forEach(_.unique([e.currentCompany,g.currentUser.company,d.company]),function(a){a&&g.permissions.canList(l.CannedMessage,a)&&(a=k.cannedMessages({shortname:a.shortname}),b.promises.push(a.$promise.catch(_.ignore)))}),c.all(b.promises).then(function(a){a=_.flatten(_.pluck(a,"primaryData"));_.forEach(a,function(a){_.contains(b.TYPES,
a.type)&&d.cannedMessagesByType[a.type].push(a)})}));b.cannedMessagesByType=d.cannedMessagesByType;b.isEmptyMessage=function(a){a=a[d.cannedField];return _.isString(a)?_.isEmpty(a):_.isNull(a)};b.hasEmptyMessages=function(a){return _.all(b.cannedMessagesByType[a],b.isEmptyMessage)};return h}}]);m.factory("imageUploadController",["$q","filepicker","require",function(c,g,k){return function(f,l){k.defined(l,"modelKey");var e=l.id||"image",a=l.field||"imageUrl",q=l.width||2560,h=l.height||2560,d=_.isUndefined(l.resetAfterSubmit)?
!0:l.resetAfterSubmit,b=function(){_.extend(f.imageUploadCtrl[e],{url:"",urls:{},initialUrls:{},isSelected:!1,isPristine:!0,isUploading:!1,isCropping:!1,isSavingCrop:!1,crop:{},unCroppedUrl:null})},m=function(a){var b=c.defer();g.store({url:a},{location:"S3"},function(a){console.log("imageUploadCtrl: stored image ",a.url);b.resolve(a)},function(a){console.error("imageUploadCtrl: unable to store image",a);b.reject(a)});return b.promise},s=function(a){var b=c.defer(),d={height:h,width:q,fit:"max"};
g.convert(a,d,function(a){f.$safeApply(function(){console.log("imageUploadCtrl: converted image",a.url,d);b.resolve(a)})},function(a){f.$safeApply(function(){console.error("imageUploadCtrl: unable to convert image",a);b.reject(a)})});return b.promise};if(!f.imageUploadCtrl||f.imageUploadCtrl.scope!==f)f.imageUploadCtrl={scope:f,ids:[]},f.imageUploadCtrl.isPristine=function(){return _.every(f.imageUploadCtrl.ids,function(a){return f.imageUploadCtrl[a].isPristine})},f.imageUploadCtrl.isUploading=function(){return _.some(f.imageUploadCtrl.ids,
function(a){return f.imageUploadCtrl[a].isUploading})};f.imageUploadCtrl.ids.push(e);f.imageUploadCtrl[e]={};f.imageUploadCtrl[e].clear=function(){f.imageUploadCtrl[e].urls[a]="";f[l.modelKey][a]="";_.extend(f.imageUploadCtrl[e],{url:"",isSelected:!1,isPristine:!1,crop:{},unCroppedUrl:null})};f.imageUploadCtrl[e].select=function(){f.imageUploadCtrl[e].isUploading=!0;g.pick({mimetypes:["image/*"],services:["COMPUTER","WEBCAM","FACEBOOK","INSTAGRAM","URL"]},function(b){f.$apply(function(){s(b).then(function(b){f.imageUploadCtrl[e].urls[a]=
b.url;f[l.modelKey][a]=b.url;_.extend(f.imageUploadCtrl[e],{url:b.url,isSelected:!0,isPristine:!1,isUploading:!1,crop:{},unCroppedUrl:null})},function(a){console.error("imageUploadCtrl.select: unable to convert image",a);f.imageUploadCtrl[e].isUploading=!1})})},function(a){f.$apply(function(){101!==a.code&&console.error("imageUploadCtrl.select: unable to pick image",a);f.imageUploadCtrl[e].isUploading=!1})})};f.imageUploadCtrl[e].edit=function(){k.defined(l,"elementKey");var b=f[l.elementKey][a];
f.imageUploadCtrl[e].urls[a]=b;f.imageUploadCtrl[e].initialUrls[a]=b;f[l.modelKey][a]=b;_.extend(f.imageUploadCtrl[e],{url:b,isSelected:!!b,crop:{},unCroppedUrl:null})};f.imageUploadCtrl[e].submit=function(){var h=f.imageUploadCtrl[e].urls[a],h=f.imageUploadCtrl[e].initialUrls[a]!==h&&h?m(h):c.resolve();f.imageUploadCtrl[e].isPristine=!0;d&&b();return h};f.imageUploadCtrl[e].cancel=function(){b()};f.imageUploadCtrl[e].saveCrop=function(){f.imageUploadCtrl[e].isSavingCrop=!0;var b={fit:"crop",crop:[f.imageUploadCtrl[e].crop.x,
f.imageUploadCtrl[e].crop.y,f.imageUploadCtrl[e].crop.width,f.imageUploadCtrl[e].crop.height],format:"jpg",quality:90},d=f.imageUploadCtrl[e].url;g.stat({url:d},function(c){c.url=d;g.convert(c,b,function(b){f.$safeApply(function(){f[l.modelKey][a]=b.url;f.imageUploadCtrl[e].urls[a]=b.url;_.extend(f.imageUploadCtrl[e],{url:b.url,isPristine:!1,isCropping:!1,isSavingCrop:!1,unCroppedUrl:d})})},function(a){console.error("imageUploadCtrl.saveCrop: unable to crop image",a)})})};f.imageUploadCtrl[e].startCropping=
function(){f.imageUploadCtrl[e].unCroppedUrl&&(f.imageUploadCtrl[e].url=f.imageUploadCtrl[e].unCroppedUrl);f.imageUploadCtrl[e].isCropping=!0};f.imageUploadCtrl[e].cancelCrop=function(){f.imageUploadCtrl[e].isCropping=!1;f.imageUploadCtrl[e].url=f[l.modelKey][a]};b();return f}}]);m.factory("splitPaymentController",["require","toggles",function(c,g){return function(c,f){c.splitPaymentCtrl={customerCount:f.customerCount(),amount:f.amount(),divideByPeople:1,payForPeople:1,splitAmount:0};c.$watch(function(){return f.amount()},
function(f){c.splitPaymentCtrl.amount=f});c.$watch(f.customerCount,function(f){f=Math.max(1,f);c.splitPaymentCtrl.customerCount=f;c.splitPaymentCtrl.divideByPeople=f;c.splitPaymentCtrl.payForPeople=Math.min(c.splitPaymentCtrl.divideByPeople,c.splitPaymentCtrl.payForPeople)});c.$watch(function(){var f=_.roundHalfToEven(c.splitPaymentCtrl.amount*c.splitPaymentCtrl.payForPeople/c.splitPaymentCtrl.divideByPeople);isFinite(f)||(f=0);return f},function(f){c.splitPaymentCtrl.splitAmount=f});c.splitPaymentCtrl.useSplitAmount=
function(){var l=Math.min(c.splitPaymentCtrl.splitAmount,f.max());0>=l||(f.amount(l),g.toggle("splitPaymentCalc",!1))}}}]);m.factory("reorderController",["$window","db","events","flash",function(c,g,k,f){return function(l,e){var a=e.reorderCallback||_.ignore,q=e.reorderConfirm,h=e.reorderConfirmWhen||(q?_.always:_.never);l=l||{};l.reorderCtrl={};l.reorderCtrl.reorder=function(d,b,m){var s={},r=0;b&&(s.previousPk=b.pk,r=(b.sortableIndex||0)+0.1);!m&&e.alwaysLast&&(m=e.alwaysLast);m&&(s.nextPk=m.pk,
r=(m.sortableIndex||0)-0.1);var y;e.collectionKey?y=_.get(l,e.collectionKey):e.collectionFn&&(y=e.collectionFn(d));if(y){if(h(d,b,m)&&!c.confirm(q||T("Are you sure you want to reorder this list?")))return!1;d.sortableIndex=r;_.ref.reorder(y,d,b,m);d=g.reorder({shortname:(d.company?d.company:e.company).shortname,objectCls:d.cls?d.cls:e.cls,objectPk:d.pk},{},null,s);a(d);d.$promise.then(function(){f.success(T("Saved sort order"));e.refreshActivities&&k.broadcast("dashboard.shared.ActivitiesCtrl.refresh")},
function(){f.error(T("Sort order not saved, please try again."))})}};return l}}]);m.factory("listController",["reorderController","imageUploadController","urls","events",function(c,g,k,f){return function(l,e){var a=e.get,q=e.create||a&&a.create,h=e.remove,d=e.successCallback||_.ignore,b=e.errorCallback||_.ignore,m=e.submitCallback||_.ignore,s=e.removeCallback||_.ignore,r=_.isFunction(e.params)?e.params:_.constant(e.params||{}),y=k.extract,G=_.isUndefined(e.reset)?!0:e.reset,w=_.isUndefined(e.closeAfterSubmit)?
!0:e.closeAfterSubmit,B=!!e.imageUpload,n=e.defaultModel||{};_.isFunction(n)||(n=_.constant(n));l[e.modelKey]=_.extend({},n());B&&g(l,{modelKey:e.modelKey});a&&(e.collectionKey&&!_.isArray(_.get(l,e.collectionKey)))&&_.set(l,e.collectionKey,a(r()));l.listCtrl={};l.listCtrl.submit=function(a){var c=l[e.modelKey],h=m(a);h&&(c=_.extend({},c,h));var g=(e.createFn?e.createFn():q)(r(),c,a);g.$promise.then(function(b){if(e.collectionKey){var c=_.get(l,e.collectionKey);c&&(_.isArray(g)?e.overwrite?_.overwrite(c,
g):_.ref.append(c,g):c.push(g))}l.listCtrl.cancel(a);e.refreshActivities&&f.broadcast("dashboard.shared.ActivitiesCtrl.refresh");B&&l.imageUploadCtrl.image.submit();d(g,a,b)},function(d){b(d,a)})};l.listCtrl.adding=e.adding||!1;l.listCtrl.cancel=function(a){w&&(l.listCtrl.adding=!1);G&&(l[e.modelKey]=_.extend({},n()));a.$setPristine()};l.listCtrl.add=function(){l.listCtrl.adding=!0};l.listCtrl.toggle=function(){l.listCtrl.adding=!l.listCtrl.adding};l.listCtrl.close=function(a){l.listCtrl.adding=!1;
a&&G&&(l[e.modelKey]=_.extend({},n()),a.$setPristine())};e.sortable&&e.collectionKey&&(l.listCtrl.reorder=c(l,{collectionKey:e.collectionKey,reorderCallback:e.reorderCallback,reorderConfirm:e.reorderConfirm,reorderConfirmWhen:e.reorderConfirmWhen,alwaysLast:e.alwaysLast,company:e.company,refreshActivities:e.refreshActivities}).reorderCtrl.reorder);e.remove&&(l.listCtrl.remove=function(a,b){l.listCtrl.status="removing";h(y(a),{},b).$promise.then(function(){l.listCtrl.status="success";b&&_.overwrite(b,
{});e.collectionKey&&_.overwriteWithout(_.get(l,e.collectionKey),_.isReferenceEqualTo(a));e.refreshActivities&&f.broadcast("dashboard.shared.ActivitiesCtrl.refresh");s(a)})});return l}}]);m.factory("createController",["events",function(c){return function(g,k){var f=k.get||{},l=k.create||f.create,e=k.successCallback||_.ignore,a=k.errorCallback||_.ignore,q=k.submitCallback||_.ignore,h=_.isFunction(k.params)?k.params:_.constant(k.params||{}),d=_.isUndefined(k.reset)?!0:k.reset,b=k.defaultModel||{},m=
function(a){return _.set(g,k.modelKey,a)};m(_.extend({},b));g.createCtrl={};g.createCtrl.creating=!1;g.createCtrl.submit=function(b){q(b);var d=l(h(),_.get(g,k.modelKey),b);d.$promise.then(function(){g.createCtrl.cancel(b);k.refreshActivities&&c.broadcast("dashboard.shared.ActivitiesCtrl.refresh");e(d,b)},function(d){a(d,b)})};g.createCtrl.cancel=function(a){d&&m(_.extend({},b));a.$setPristine();g.createCtrl.creating=!1};return g}}]);m.factory("removeController",[function(){return function(c,g){var k=
g.remove||g.get.remove,f=g.removeCallback||_.ignore,l=_.isFunction(g.params)?g.params:_.constant(g.params||{});c.removeCtrl={status:"success"};c.removeCtrl.remove=function(e){c.removeCtrl.status="removing";k(l(),{},e).$promise.then(function(){c.removeCtrl.status="success";e&&_.overwrite(e,{});g.collectionKey&&_.overwriteWithout(c[g.collectionKey],_.isReferenceEqualTo(c[g.elementKey]));f(c[g.elementKey],e)},function(){c.removeCtrl.status="error"})};return c}}]);m.factory("editController",["$injector",
"events","flash","imageUploadController","navigation",function(c,g,k,f,l){return function(c,a){var q=a.get||_.ignore,h=a.update||q.update,d=a.remove||q.remove,b=a.successCallback||_.ignore,m=a.errorCallback||_.ignore,s=a.editCallback||_.ignore,r=a.removeCallback||_.ignore,y=a.cancelCallback||_.ignore,G=a.submitCallback||_.ignore,w=_.isFunction(a.params)?a.params:_.constant(a.params||{}),B=a.jsonFieldKeys||[],n=!!a.imageUpload;c.editCtrl={};c.editCtrl.editing=!1;c.editCtrl.status="success";n&&f(c,
{modelKey:a.modelKey,elementKey:a.elementKey});if(!_.isUndefined(_.get(c,a.collectionKey))||a.remove)c.editCtrl.remove=function(b){c.editCtrl.status="removing";d(w(),{},b).$promise.then(function(){c.editCtrl.status="success";b&&_.overwrite(b,{});var d=_.get(c,a.collectionKey);d&&_.overwriteWithout(d,_.isReferenceEqualTo(c[a.elementKey]));a.refreshActivities&&g.broadcast("dashboard.shared.ActivitiesCtrl.refresh");a.flashAfterRemove&&(d=_.isString(a.flashAfterRemove)?a.flashAfterRemove:interpolate(T("Removed %(name)s"),
{name:c[a.elementKey].unicode}),k.success(d));a.navigateAfterRemove&&l.navigate(a.navigateAfterRemove);r(c[a.elementKey],b)},function(){c.editCtrl.status="error"})};var P=function(){var b={};_.forEach(c[a.elementKey],function(a,d){if(!_.isObject(a)||_.includes(B,d))b[d]=a});a.modelFields&&(b=_.pick(b,a.modelFields));c[a.modelKey]=b};c.editCtrl.edit=function(a,b){b||P();c.editCtrl.editing=!0;n&&c.imageUploadCtrl.image.edit();s(a,b)};c.editCtrl.cancel=function(b){c.editCtrl.editing=!1;P();y(b);b&&b.$setPristine();
a.editing&&c.editCtrl.edit(b)};c.editCtrl.submit=function(d){var f=c[a.modelKey],k=G(d);k&&(f=_.extend({},f,k));c.editCtrl.status="submitting";var l=h(w(),f,d);l.$promise.then(function(f){c.editCtrl.status="success";d.$setPristine();c.editCtrl.editing=!1;a.refreshActivities&&g.broadcast("dashboard.shared.ActivitiesCtrl.refresh");n&&c.imageUploadCtrl.image.submit();b(l,d,f);a.editing&&c.editCtrl.edit(d)},function(b){c.editCtrl.status="error";m(b,d);a.editing&&c.editCtrl.edit(d,a.skipResetAfterError)})};
a.editing&&c.editCtrl.edit();return c}}]);m.factory("calendarController",["$filter","$injector","auth","cache","db","events","localization","navigation","require","urls",function(c,g,k,f,l,e,a,q,h,d){return function(b,c){var h=g.get("flows"),m=d.calendarUrls(c.url),y=_.isFunction(c.params)?c.params:_.constant(c.params||{}),G=_.isFunction(c.queryParams)?c.queryParams:_.constant(c.queryParams||{}),w=c.endpoint,B=c.beforeRequest||_.ignore,n=c.onSuccess||_.ignore,P=c.largeDaySelected||_.ignore,I=c.smallDaySelected||
_.ignore,p=c.urlParams||_.ignore,t=c.preselectDate||null,K=_.isFunction(c.isSundayBased)?c.isSundayBased:_.isBoolean(c.isSundayBased)?_.constant(c.isSundayBased):_.constant(c.company?c.company.features.isSundayBased:!0);b.calendarCtrl={status:"uninitialized",company:c.company||null,isSundayBased:K,calendar:{},isRetrieving:!1,isEmptyAllowed:c.isEmptyAllowed||!1,date:moment().startOf("day"),isCalendarEmpty:c.isCalendarEmpty||_.ignore,isWeekEmpty:c.isWeekEmpty||_.ignore,isDayEmpty:c.isDayEmpty||_.ignore,
isDayUsed:c.isDayUsed||_.ignore,isEditable:c.isEditable||!1,editDay:c.editDay||_.ignore,showSelectedDay:_.isUndefined(c.showSelectedDay)?!0:c.showSelectedDay};var x=moment().startOf("day");b.calendarCtrl.dropdownMonths=_.map([T("January"),T("February"),cT("the month of March","March"),T("April"),cT("the month of May","May"),T("June"),T("July"),T("August"),T("September"),T("October"),T("November"),T("December")],function(a,b){return{value:b,text:a}});b.calendarCtrl.dropdownYears=_.map(_.range(x.year()-
2,x.year()+5),function(a){return{value:a,text:a}});var E=!1,J,v,M=b.calendarCtrl.refresh=function(a){E=!1;if(!1!==B()){var c=_.extend({year:b.calendarCtrl.date.format("YYYY"),month:b.calendarCtrl.date.format("MM")},y()),d=G();if(a||!angular.equals([c,d],[J,v]))J=c,v=d,b.calendarCtrl.status="loading",u={},b.calendarCtrl.calendar.$promise&&b.calendarCtrl.calendar.$promise.cancel(),b.calendarCtrl.calendar=w(_.extend({},c),{},null,d),f.fresh(b.calendarCtrl.calendar)?b.calendarCtrl.isRetrieving=!0:V(),
b.calendarCtrl.calendar.$promise.then(function(a){a!==l.CANCELLED&&(V(),b.calendarCtrl.status="success",b.calendarCtrl.isRetrieving=!1,n(a))},function(){b.calendarCtrl.status="error";b.calendarCtrl.isRetrieving=!1})}},R=function(a,b){var c=x-a.at;return 0===c?b.current||"":0<c?b.past||"":b.future||""};b.calendarCtrl.dayPastPresentFutureClass=function(a){return R(a,{past:"past-day",current:"current-day"})};b.calendarCtrl.anonymousDayClass=function(a){return 0===a.count?"empty":a.isBookable?"":"no-bookable"};
b.calendarCtrl.isPastWeek=function(a){return R(_.last(a.days),{past:!0})};var u={},X=x.clone().startOf("month");b.calendarCtrl.showingPastWeek=function(a){return 0!==b.calendarCtrl.date.clone().startOf("month").diff(X)||u[a.number]};b.calendarCtrl.showPastWeek=function(a){u[a.number]=!0};q.watch(b,function(a){if(q.pathEquals(m.index))q.redirect(d.populate(m.month,_.extend({year:b.calendarCtrl.date.format("YYYY"),month:b.calendarCtrl.date.format("MM")},p())));else{var c;(c=q.pathEquals(m.month))?(a=
c.year,c=c.month-1,a=moment({year:a,month:c,day:1}),b.calendarCtrl.style="month",b.calendarCtrl.date=a,b.calendarCtrl.monthDropdown=a.month(),b.calendarCtrl.yearDropdown=a.year(),e.broadcast("lib.shared.CalendarCtrl.month",{date:b.calendarCtrl.date}),M()):console.warn("calendarController: invalid calendar url",a)}});var F=b.calendarCtrl.monthUrl=function(a,b){return d.populate(m.month,_.extend({year:a.format("YYYY"),month:a.format("MM")},p(),b))};b.calendarCtrl.nextMonthUrl=function(){var a=b.calendarCtrl.date.clone();
a.add(1,"months");return F(a)};b.calendarCtrl.currentMonthUrl=function(){return F(x)};b.calendarCtrl.previousMonthUrl=function(){var a=b.calendarCtrl.date.clone();a.add(-1,"months");return F(a)};b.$watch("calendarCtrl.yearDropdown",function(a,c){if(!_.isUndefined(c)&&a!==c){var d=b.calendarCtrl.date.clone();d.year(a);d=F(d);q.pathEquals(d)||q.navigate(h.extendWithFlow(d))}});b.$watch("calendarCtrl.monthDropdown",function(a,c){if(!_.isUndefined(c)&&a!==c){var d=b.calendarCtrl.date.clone();d.month(a);
d=F(d);q.pathEquals(d)||q.navigate(h.extendWithFlow(d))}});b.calendarCtrl.isCurrentMonth=function(){return b.calendarCtrl.date.year()===x.year()&&b.calendarCtrl.date.month()===x.month()};e.on(b,"lib.shared.CalendarCtrl.refresh",function(){M(!0)});var S=b.calendarCtrl.dayForDate=function(a){if(a){var c=b.calendarCtrl.calendar.weeks;if(!c)return null;var d=null;_.some(c,function(b){return _.some(b.days,function(b){return b.at.isSame(a,"day")?(d=b,!0):!1})});return d}};b.calendarCtrl.goToToday=function(){q.navigate(b.calendarCtrl.currentMonthUrl());
b.calendarCtrl.selectedDay=S(moment());u={}};b.calendarCtrl.selectLargeDay=function(a){b.calendarCtrl.selectedDay=a;P(a)};b.calendarCtrl.dayLabel=function(c,d){return d===b.calendarCtrl.calendar.weeks[0]&&c===d.days[0]?c.at.format(a.current().DATE_FORMATS.dayWithMonthAbbr):1===c.number?c.at.format(a.current().DATE_FORMATS.dayWithMonthAbbr):c.number};b.calendarCtrl.selectSmallDay=function(a){a&&(b.calendarCtrl.selectedDay=a,I(a),E=!0)};var V=function(){if(t){var a=S(t())||S(b.calendarCtrl.date);b.calendarCtrl.selectedDay=
a;I(a)}else a=E?b.calendarCtrl.selectedDay.at:k.currentUser.isAuthenticated?b.calendarCtrl.date.year()===x.year()&&b.calendarCtrl.date.month()===x.month()?x:b.calendarCtrl.date.clone().startOf("month"):null,b.calendarCtrl.selectedDay=S(a)};b.calendarCtrl.debouncedRefresh=_.debounce(function(a){b.$safeApply(function(){b.calendarCtrl.refresh(a)})},1E3,{leading:!0});b.calendarCtrl.effectiveRange=function(a,b){var c=a.startAt,d=a.endAt;c<b.at&&(c=b.at);d>b.at+864E5&&(d=b.at.clone().add(1,"day").startOf("day"));
return{startAt:c,endAt:d}};return b}}]);m.factory("availabilityCalendarController",["$filter","calendarController","events","navigation",function(c,g,k,f){return function(l,e){var a=_.isFunction(e.params)?e.params:_.constant(e.params||{}),q=e.beforeRequest||_.ignore,h=_.isUndefined(e.autoOpenItemGroups)?!0:e.autoOpenItemGroups,d=e.openLightframe?e.openLightframe:f.navigate,b=e.items||null,m=function(a){var b=a.availabilities,e=a.itemGroups||[];h&&(!b.length&&1===e.length)&&(a=c("itemGroupUrl")(e[0],
a.at),d(a))};k.on(l,"dashboard.bookings.NavigationCtrl.calendarFilter.items",function(a,b){var c=b.items||[],d=_.difference(c,l.calendarCtrl.items).length;l.calendarCtrl.items=c;d&&l.calendarCtrl.debouncedRefresh(!0)});k.on(l,"dashboard.bookings.NavigationCtrl.filterChoicesUpdated",function(a,b){b&&(l.calendarCtrl.items=b.filteredItems||[]);l.calendarCtrl.refresh()});_.extend(e,{isCalendarEmpty:function(){return!l.calendarCtrl.calendar.availabilityCount},isWeekEmpty:function(a){return!a.availabilityCount},
isDayEmpty:function(a){var b=a.availabilities;a=a.itemGroups||[];return!b.length&&!a.length?!0:l.isCalendarFiltered?_.all(b,l.isCalendarFiltered)&&_.all(a,l.isCalendarFiltered):!1},isDayUsed:function(a){var b=a.availabilities;a=a.itemGroups||[];l.isCalendarFiltered&&(b=_.reject(b,l.isCalendarFiltered),a=_.reject(a,l.isCalendarFiltered));b=_.sum(_.pluck(b,"customerCount"));a=_.sum(_.pluck(a,"customerCount"));return 0<b+a},smallDaySelected:e.smallDaySelected||m,beforeRequest:function(){return l.calendarCtrl.items&&
!l.calendarCtrl.items.length?!1:q()},params:function(){var b=_.extend({},a());if(l.calendarCtrl.items){var c=_.pluck(l.calendarCtrl.items,"pk").join(",");b.itemPks=c}return b}});g(l,e);_.extend(l.calendarCtrl,{items:b,nextBookableMonthUrl:function(){var a=l.calendarCtrl.calendar.nextBookableStartAt;if(a)return l.calendarCtrl.monthUrl(a)},alreadyRedirectedToNextBookableMonth:!1,redirectToNextBookableMonth:function(){l.calendarCtrl.alreadyRedirectedToNextBookableMonth||(l.calendarCtrl.alreadyRedirectedToNextBookableMonth=
!0,f.redirect(l.calendarCtrl.nextBookableMonthUrl()))}});return l}}]);m.factory("emailPreviewController",["convert","models","navigation","urls",function(c,g,k,f){var l={type:"type",emails:"emails",subject:"subject",note:"note",language:"language"};return function(e,a){var q=_.extend({},l,a.fields),h=_.isFunction(a.params)?a.params:_.constant(a.params||{}),d;a.data&&(d=_.isFunction(a.data)?a.data:function(){return a.data});e.emailPreviewCtrl={};e.emailPreviewCtrl.previewUrl=function(){var b={};_.forEach(q,
function(c,d){c&&(b[d]=e[a.modelKey][c]||"")});a.languageOverride&&(b.language=a.languageOverride);d&&_.extend(b,c.clientRequest(d()));var g=f.populate(a.url,h(b.type));return k.compose(g,b)};var b=_.isFunction(a.isPreviewable)?a.isPreviewable:_.constant(a.isPreviewable);e.emailPreviewCtrl.isPreviewable=function(){var c=e[a.modelKey][q.type],d=e[a.modelKey][q.emails],f=e[a.modelKey][q.subject];if(!c||!d||!f)return!1;d=b(c);return!_.isUndefined(d)?d:g.Notification.isPreviewable(c)};return e}}]);m.factory("affiliationController",
["$q","auth","cache","db","editController","events","models",function(c,g,k,f,l,e,a){return function(q,h){var d=function(a){return(h.prefix?h.prefix+"-":"")+"voucher-"+a};q.affiliationCtrl={status:"success",substatus:"success",showDesks:!1};q.affiliationCtrl.agentName=function(b){return b===a.Agent.OTHER_AGENT?b.name:b.name+" (#"+b.pk+")"};q[h.modelKey][d("agent")]=null;q[h.modelKey][d("agentName")]="";q[h.modelKey][d("desk")]=null;q[h.modelKey][d("deskName")]="";var b=function(b){q.affiliationCtrl.agents=
[];q.affiliationCtrl.desks=[];q.affiliationCtrl.showDesks=!1;if(b){var d={agents:g.permissions.canCreate(a.Agent,b),desks:g.permissions.canCreate(a.Desk,b)},e={agents:a.Agent.OTHER_AGENT,desks:a.Desk.OTHER_DESK},h=function(a,b){_.overwrite(q.affiliationCtrl[a],b);d[a]&&q.affiliationCtrl[a].push(e[a])},l=[];if(g.permissions.canList(a.Agent,b.affiliateCompany)){var m=f.agents({shortname:b.affiliateCompany.shortname}),n=m.$promise.then(function(){h("agents",m)});k.fresh(m)?l.push(n):h("agents",m)}if(g.permissions.canList(a.Desk,
b.affiliateCompany)){var A=f.desks({shortname:b.affiliateCompany.shortname});b=A.$promise.then(function(){q.affiliationCtrl.showDesks=0<A.length;h("desks",A)});k.fresh(A)?l.push(b):(q.affiliationCtrl.showDesks=0<A.length,h("desks",A))}l.length&&(q.affiliationCtrl.substatus="loading",c.all(l).then(function(){q.affiliationCtrl.substatus="success"}))}};q.$watch(h.affiliateModelKey+".currentAffiliation",function(a,c){b(a);if(a&&c&&a!==c||!a)q[h.modelKey][d("agent")]=null,q[h.modelKey][d("agentName")]=
"",q[h.modelKey][d("desk")]=null,q[h.modelKey][d("deskName")]=""});var m=function(b){var c=h.booking?h.booking.company:h.company;g.permissions.canList(a.Affiliation,c)?c.affiliatesCount>a.Affiliation.MAX_SELECTABLE_AFFILIATES?(q.affiliationCtrl.affiliatesNgDropdownEndpoint=f.searchEndpoint(f.affiliates.pickable,{shortname:c.shortname}),q.affiliationCtrl.status="success"):(q.affiliationCtrl.affiliations=f.affiliates.pickable({shortname:c.shortname},null,null,null,{flashError:!!h.isEditingAffiliationOnBooking}),
q.affiliationCtrl.status=k.fresh(q.affiliationCtrl.affiliations)?"loading":"stale",q.affiliationCtrl.affiliations.$promise.then(function(){q.affiliationCtrl.status="success";h.booking&&h.booking.affiliation&&!_.contains(q.affiliationCtrl.affiliations,h.booking.affiliation)&&q.affiliationCtrl.affiliations.unshift(h.booking.affiliation)},function(){h.isEditingAffiliationOnBooking&&q.editCtrl.cancel(b)})):q.affiliationCtrl.status="success"};h.isEditingAffiliationOnBooking?l(q,{elementKey:"affiliation",
modelKey:h.modelKey,update:f.booking.affiliation.update,editCallback:function(a){m(a);q[h.modelKey].isBlockable=h.booking.isBlockable;q[h.modelKey].affiliation=h.booking.affiliation?h.booking.affiliation.pk:null;q[h.modelKey][d("agent")]=h.booking.agent?h.booking.agent.pk:null;q[h.modelKey][d("desk")]=h.booking.desk?h.booking.desk.pk:null;q[h.modelKey][d("voucherNumber")]=h.booking.voucherNumber;q[h.affiliateModelKey].currentAffiliation=h.booking.affiliation||null},successCallback:function(a){var c=
-1==q[h.modelKey][d("agent")],f=-1==q[h.modelKey][d("desk")];(c||f)&&b(a.booking.affiliation);e.broadcast("dashboard.shared.ActivitiesCtrl.refresh")},params:function(){return{shortname:h.booking.company.shortname,bookingUuid:h.booking.uuid}}}):m()}}]);m.factory("controllers",["affiliationController","calendarController","cannedMessagesController","createController","dataController","editController","emailPreviewController","emailSubjectsController","headerController","imageUploadController","listController",
"nagsController","navigationController","removeController","reorderController","splitPaymentController",function(c,g,k,f,l,e,a,q,h,d,b,m,s,r,y,G){return{affiliationController:c,calendarController:g,cannedMessagesController:k,createController:f,dataController:l,editController:e,emailPreviewController:a,emailSubjectsController:q,headerController:h,imageUploadController:d,listController:b,nagsController:m,navigationController:s,removeController:r,reorderController:y,splitPaymentController:G}}])})();
(function(){var m=angular.module("lib.models",[]);m.factory("models",["$filter","$injector","convert","require",function(c,g,k,f){var l=c("orderBy"),e=c("pluralize"),a=c("name"),q=[["US",cT('"USA" acronym for United States of America',"USA")],["AF",T("Afghanistan")],["AL",T("Albania")],["DZ",T("Algeria")],["AS",T("American Samoa")],["AD",T("Andorra")],["AO",T("Angola")],["AI",T("Anguilla")],["AQ",T("Antarctica")],["AG",T("Antigua & Barbuda")],["AR",T("Argentina")],["AM",T("Armenia")],["AW",T("Aruba")],
["AU",T("Australia")],["AT",T("Austria")],["AZ",T("Azerbaijan")],["BS",T("Bahamas")],["BH",T("Bahrain")],["BD",T("Bangladesh")],["BB",T("Barbados")],["BY",T("Belarus")],["BE",T("Belgium")],["BZ",T("Belize")],["BJ",T("Benin")],["BM",T("Bermuda")],["BT",T("Bhutan")],["BO",T("Bolivia")],["BA",T("Bosnia and Herzegovina")],["BW",T("Botswana")],["BV",T("Bouvet Island")],["BR",T("Brazil")],["IO",T("British Indian Ocean Territory")],["VG",T("British Virgin Islands")],["BN",T("Brunei Darussalam")],["BG",T("Bulgaria")],
["BF",T("Burkina Faso")],["BI",T("Burundi")],["KH",T("Cambodia")],["CM",T("Cameroon")],["CA",T("Canada")],["CV",T("Cape Verde")],["KY",T("Cayman Islands")],["CF",T("Central African Republic")],["TD",T("Chad")],["CL",T("Chile")],["CN",T("China")],["CX",T("Christmas Island")],["CC",T("Cocos (Keeling) Islands")],["CO",T("Colombia")],["KM",T("Comoros")],["CG",T("Congo")],["CK",T("Cook Iislands")],["CR",T("Costa Rica")],["HR",T("Croatia")],["CU",T("Cuba")],["CY",T("Cyprus")],["CZ",T("Czech Republic")],
["DK",T("Denmark")],["DJ",T("Djibouti")],["DM",T("Dominica")],["DO",T("Dominican Republic")],["TP",T("East Timor")],["EC",T("Ecuador")],["EG",T("Egypt")],["SV",T("El Salvador")],["GQ",T("Equatorial Guinea")],["ER",T("Eritrea")],["EE",T("Estonia")],["ET",T("Ethiopia")],["FK",T("Falkland Islands (Malvinas)")],["FO",T("Faroe Islands")],["FJ",T("Fiji")],["FI",T("Finland")],["FR",T("France")],["FX",T("France, Metropolitan")],["GF",T("French Guiana")],["PF",T("French Polynesia")],["TF",T("French Southern Territories")],
["GA",T("Gabon")],["GM",T("Gambia")],["GE",T("Georgia")],["DE",T("Germany")],["GH",T("Ghana")],["GI",T("Gibraltar")],["GR",T("Greece")],["GL",T("Greenland")],["GD",T("Grenada")],["GP",T("Guadeloupe")],["GU",T("Guam")],["GT",T("Guatemala")],["GN",T("Guinea")],["GW",T("Guinea-Bissau")],["GY",T("Guyana")],["HT",T("Haiti")],["HM",T("Heard & McDonald Islands")],["HN",T("Honduras")],["HK",T("Hong Kong")],["HU",T("Hungary")],["IS",T("Iceland")],["IN",T("India")],["ID",T("Indonesia")],["IQ",T("Iraq")],["IE",
T("Ireland")],["IR",T("Islamic Republic of Iran")],["IL",T("Israel")],["IT",T("Italy")],["CI",T("Ivory Coast")],["JM",T("Jamaica")],["JP",T("Japan")],["JO",T("Jordan")],["KZ",T("Kazakhstan")],["KE",T("Kenya")],["KI",T("Kiribati")],["KP",T("Korea, Democratic People's Republic of")],["KR",T("Korea, Republic of")],["KW",T("Kuwait")],["KG",T("Kyrgyzstan")],["LA",T("Lao People's Democratic Republic")],["LV",T("Latvia")],["LB",T("Lebanon")],["LS",T("Lesotho")],["LR",T("Liberia")],["LY",T("Libyan Arab Jamahiriya")],
["LI",T("Liechtenstein")],["LT",T("Lithuania")],["LU",T("Luxembourg")],["MO",T("Macau")],["MG",T("Madagascar")],["MW",T("Malawi")],["MY",T("Malaysia")],["MV",T("Maldives")],["ML",T("Mali")],["MT",T("Malta")],["MH",T("Marshall Islands")],["MQ",T("Martinique")],["MR",T("Mauritania")],["MU",T("Mauritius")],["YT",T("Mayotte")],["MX",T("Mexico")],["FM",T("Micronesia")],["MD",T("Moldova, Republic of")],["MC",T("Monaco")],["MN",T("Mongolia")],["MS",T("Monserrat")],["MA",T("Morocco")],["MZ",T("Mozambique")],
["MM",T("Myanmar")],["NA",T("Namibia")],["NR",T("Nauru")],["NP",T("Nepal")],["NL",T("Netherlands")],["AN",T("Netherlands Antilles")],["NC",T("New Caledonia")],["NZ",T("New Zealand")],["NI",T("Nicaragua")],["NE",T("Niger")],["NG",T("Nigeria")],["NU",T("Niue")],["NF",T("Norfolk Island")],["MP",T("Northern Mariana Islands")],["NO",T("Norway")],["OM",T("Oman")],["PK",T("Pakistan")],["PW",T("Palau")],["PA",T("Panama")],["PG",T("Papua New Guinea")],["PY",T("Paraguay")],["PE",T("Peru")],["PH",T("Philippines")],
["PN",T("Pitcairn")],["PL",T("Poland")],["PT",T("Portugal")],["PR",T("Puerto Rico")],["QA",T("Qatar")],["RE",T("Reunion")],["RO",T("Romania")],["RU",T("Russian Federation")],["RW",T("Rwanda")],["LC",T("Saint Lucia")],["WS",T("Samoa")],["SM",T("San Marino")],["ST",T("Sao Tome & Principe")],["SA",T("Saudi Arabia")],["SN",T("Senegal")],["RS",T("Serbia")],["SC",T("Seychelles")],["SL",T("Sierra Leone")],["SG",T("Singapore")],["SK",T("Slovakia")],["SI",T("Slovenia")],["SB",T("Solomon Islands")],["SO",T("Somalia")],
["ZA",T("South Africa")],["GS",T("South Georgia and the South Sandwich Islands")],["ES",T("Spain")],["LK",T("Sri Lanka")],["SH",T("St. Helena")],["KN",T("St. Kitts and Nevis")],["PM",T("St. Pierre & Miquelon")],["VC",T("St. Vincent & the Grenadines")],["SD",T("Sudan")],["SR",T("Suriname")],["SJ",T("Svalbard & Jan Mayen Islands")],["SZ",T("Swaziland")],["SE",T("Sweden")],["CH",T("Switzerland")],["SY",T("Syrian Arab Republic")],["TW",T("Taiwan")],["TJ",T("Tajikistan")],["TZ",T("Tanzania, United Republic of")],
["TH",T("Thailand")],["TG",T("Togo")],["TK",T("Tokelau")],["TO",T("Tonga")],["TT",T("Trinidad & Tobago")],["TN",T("Tunisia")],["TR",T("Turkey")],["TM",T("Turkmenistan")],["TC",T("Turks & Caicos Islands")],["TV",T("Tuvalu")],["UG",T("Uganda")],["UA",T("Ukraine")],["AE",T("United Arab Emirates")],["GB",T("United Kingdom (Great Britain)")],["UM",T("United States Minor Outlying Islands")],["VI",T("United States Virgin Islands")],["US",cT('"USA" acronym for United States of America',"USA")],["ZZ",T("Unknown or unspecified country")],
["UY",T("Uruguay")],["UZ",T("Uzbekistan")],["VU",T("Vanuatu")],["VA",T("Vatican City State (Holy See)")],["VE",T("Venezuela")],["VN",T("Viet Nam")],["WF",T("Wallis & Futuna Islands")],["EH",T("Western Sahara")],["YE",T("Yemen")],["YU",T("Yugoslavia")],["ZR",T("Zaire")],["ZM",T("Zambia")],["ZW",T("Zimbabwe")]],h=_.map(q,function(a){return a[0]}),d=function(a){var b=g.get("db").slipstream("currencyChoices");return _.isUndefined(b)?(console.warn("getCurrencyChoices: currency choices undefined"),[]):
!a?b:_.filter(b,function(b){return _.contains(a,b[0])})},b={NETWORK_FILTER:"#network",COMPANY_FILTER:"#company",ADMIN_FILTER:{},filterUrl:function(a){return a===b.COMPANY_FILTER?"":a===b.ADMIN_FILTER?"admin/":a===b.NETWORK_FILTER?"network/":"network/"+a.shortname+"/"}},m=function(a,b,c,d){return function(e){return e[a]===b?e[c]:d}},s={US_COUNTRY_CODE:"US",ADMIN_TYPE:"admin",CHARTER_TYPE:"charter",AFFILIATE_TYPE:"affiliate",CALL_CENTER_SHORTNAME:"fhcallcenter",NO_FEE_TYPE:"no-fee",PERCENTAGE_FEE_TYPE:"percentage-fee",
FLAT_FEE_TYPE:"flat-fee",TIERED_FEE_TYPE:"tiered-fee",WATERFALL_FEE_TYPE:"waterfall-fee",ROLLING_WINDOW_PERIOD_TYPE:"rolling-window-period",IMMEDIATE_PERIOD_TYPE:"immediate-period",REFUND_RESERVE_AMOUNT_FORMAT:"fixed",REFUND_RESERVE_PERCENT_FORMAT:"percent",US_PROCESSOR_COUNTRY:"US",ADMIN_SHORTNAME:"admin",isAdmin:function(a){return a&&a.shortname===s.ADMIN_SHORTNAME},MONTH_VIEW:"month",DAY_VIEW:"day",AGENDA_VIEW:"agenda",GRID_VIEW:"grid",TIMELINE_VIEW:"timeline",AVAILABILITY_TIMELINE:"availability",
RESOURCE_TIMELINE:"resource",MANIFEST_AVAILABILITIES_VIEW:"availabilities",MANIFEST_ITEMS_VIEW:"items",MANIFEST_BOOKINGS_VIEW:"bookings",MANIFEST_RUNS_VIEW:"runs",MANIFEST_RESOURCES_VIEW:"resources",TAKE_PAYMENT_PREFERENCE:"take",INFO_PAYMENT_PREFERENCE:"info",SKIP_PAYMENT_PREFERENCE:"skip",DEPOSIT_PAYMENT_PREFERENCE:"deposit",FH_BLUE:"#0a6ece",DEFAULT_TIERED_FEE_SCHEDULE:[{cutoff:0,rate:"0.06"}],DEFAULT_PRE_LOCATION_HEADING:T("Before we begin:"),DEFAULT_START_LOCATION_HEADING:T("Please meet us at:"),
DEFAULT_PRIMARY_LOCATION_HEADING:T("We're headed to:"),DEFAULT_END_LOCATION_HEADING:T("We will end at:"),forObject:function(a){if(a)return a.cls===s.cls?a:a.cls===ha.cls?a.payment.company:a.company},INVOICE_FEE_RATE:1.9,INVOICE_FLAT_FEE:30,ONLINE_INSTALLMENTS_FEE_RATE:3,ONLINE_INSTALLMENTS_MINIMUM_FEE:100,COUNTRIES:q,COUNTRY_CODES:h,getCountryDefaults:function(a){var b=g.get("db").slipstream("countryDefaults");return _.isUndefined(b)?(console.warn("getCountryDefaults: country defaults data undefined"),
[]):b[a]},getCurrencyChoices:d,getCurrencyCodes:function(){var a=g.get("db").slipstream("currencies");return _.isUndefined(a)?(console.warn("getCurrencyCodes: currency data undefined"),[]):_.keys(a)},DEFAULT_LANGUAGE:"en-us",DEFAULT_INCLUDED_TAX_PERCENTAGE_BY_COUNTRY:{AU:10},DEFAULT_TAX_DISPLAY_NAME:T("Taxes"),DEFAULT_TAX_DISPLAY_NAMES:{AU:"GST"},IDEAL_COUNTRY_CODES:["NL"],IDEAL_CURRENCIES:["eur"],SOFORT_COUNTRY_CODES:"AT BE DE IT NL ES".split(" "),SOFORT_CURRENCIES:["eur"],BANCONTACT_CURRENCIES:["eur"],
taxDisplayName:function(a){return a.features.taxDisplayName?a.features.taxDisplayName:s.DEFAULT_TAX_DISPLAY_NAMES[a.processorCountry]||s.DEFAULT_TAX_DISPLAY_NAME},COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE:"company_locale_default",ANONYMOUS_USER_LOCALE_DEFAULT_TIME_FORMAT_TYPE:"user_locale_default",TWELVE_HOUR_TIME_FORMAT_TYPE:"12_hour",TWENTY_FOUR_HOUR_TIME_FORMAT_TYPE:"24_hour",FALLBACK_SERVER_EXACT_TWELVE_HOUR_TIME_FORMAT:"g:iA",FALLBACK_SERVER_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:"H:i",FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT:"h:mma",
FALLBACK_CLIENT_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:"HH:mm",FALLBACK_CLIENT_TOP_OF_HOUR_TWELVE_HOUR_TIME_FORMAT:"ha",FALLBACK_CLIENT_TOP_OF_HOUR_TWENTY_FOUR_HOUR_TIME_FORMAT:"HH:mm",FAST_PAYOUT_TIMEZONES:["US/Eastern","US/Central","US/Mountain","US/Arizona","US/Pacific"],isFastPayoutsAvailable:function(a){return!1},isSofortPaymentSupported:function(a){return _.contains(s.SOFORT_CURRENCIES,a.processorCurrency)},isBancontactPaymentSupported:function(a){return _.contains(s.BANCONTACT_CURRENCIES,a.processorCurrency)},
hasMultipleProcessorsEnabled:function(a){return 1<a.enabledProcessorTypes.length},isAnyWaiverEnabled:function(a){return a.isSmartwaiverEnabled||a.features.isWherewolfEnabled}},r=_.map([s.MONTH_VIEW,s.DAY_VIEW,s.AGENDA_VIEW,s.GRID_VIEW,s.TIMELINE_VIEW],function(a){return[a,_.capitalize(a)]}),y=_.filter(r,function(a){return a[0]!==s.DAY_VIEW});s.dashboardBookingsViewChoices=function(a){return a?r:y};s.rollingWindowDays=m("payoutPeriodType",s.ROLLING_WINDOW_PERIOD_TYPE,"rollingWindowDays",0);s.flatFee=
m("feeType",s.FLAT_FEE_TYPE,"flatFee",0);s.percentageFeeRate=m("feeType",s.PERCENTAGE_FEE_TYPE,"percentageFeeRate",0);var h={verboseName:T("resource"),verboseNamePlural:T("resources"),NONE_GRANULARITY:"none",bookingResources:function(a){return _.sortBy(_.unique(_.flatten(_.map(a.customers,function(a){return _.pluck(a.resourceUses,"resourceRequirement.resource")}))),"name")},displayName:function(a){return a.name+(a.isArchived?" "+T("(archived)"):"")}},m={verboseName:T("resource requirement"),verboseNamePlural:T("resource requirements"),
name:function(a){return a.isItemLevel?a.shortName+" ("+a.item.name+")":a.shortName}},G={BOOKING_TYPE:"booking",CUSTOMERS_TYPE:"customers",FOR_ALL_CUSTOMER_PROTOTYPES:T("Every customer"),isApplicable:function(a,b){b=!_.isArray(b)?[b]:b;if(a.type!==G.CUSTOMERS_TYPE)return!1;if(a.requirementGroup.isItemLevel){var c=_.pluck(a.customerPrototypeRequirements,"customerPrototype");return!c.length?!0:0<_.intersection(c,_.pluck(b,"customerPrototype")).length}c=_.pluck(a.customerTypeRequirements,"customerType");
return!c.length?!0:0<_.intersection(c,_.pluck(b,"customerPrototype.customerType")).length},forCustomerPrototypes:function(a){return a.type===G.BOOKING_TYPE?T("Whole booking"):!a.customerPrototypeRequirements.length&&!a.customerTypeRequirements.length?G.FOR_ALL_CUSTOMER_PROTOTYPES:a.requirementGroup.isItemLevel?_.map(a.customerPrototypeRequirements,function(a){a=a.customerPrototype;return a.customerType.isHidden?a.customerType.name+" "+T("(deleted)"):a.name||c("name")(a.customerType)}).join(", "):
_.map(a.customerTypeRequirements,function(a){a=a.customerType;return a.isHidden?a.name+" "+T("(deleted)"):c("name")(a)}).join(", ")}},w={START_TIMING:"start-timing",END_TIMING:"end-timing",DATE_TIMING:"date-timing",PADDING_END_AT_KIND:"padding-kind",LENGTH_END_AT_KIND:"length-kind",SEATING_LABELS:{isSingleSeatGroupRequired:cT("party refers to people on a booking, groups refers to groups of seats in a venue","don't allow split parties across groups"),isEmptySeatGroupRequired:T("make groups exclusive"),
isEntireSeatMapRequired:T("fill all seats once booked")},times:function(a,b){var c,d,e=a.timing;e===w.START_TIMING?c=b.startAt.clone():e===w.END_TIMING?c=b.endAt.clone():e===w.DATE_TIMING?c=b.startAt.clone().startOf("day"):console.error("ResourceRequirement.times: invalid timing "+e);c.subtract(a.startAtHours,"hours");var e=a.endAtKind,f=a.endAtHours;e===w.PADDING_END_AT_KIND?d=b.endAt.clone().add(f,"hours"):e===w.LENGTH_END_AT_KIND?d=c.clone().add(a.hours,"hours"):console.error("ResourceRequirement.times: invalid endAtKind "+
e);return{startAt:c,endAt:d}},allowedZones:function(a){var b=a.resource.settings.seatZones;a=a.settings.seatZones;a.length&&(b=_.intersection(b,a));return _.toTrueKeys(b)},displayableSeatingSettings:function(a){return _.reduce(a.settings,function(a,b,c){(c=w.SEATING_LABELS[c])&&b&&a.push(_.capitalize(c));return a},[])}},B={displayOption:function(a){return a?a.isIgnoreOveruse?T("Create uses, don't check overuse"):a.isSkipResourceUseCreation?T("Don't create uses, check overuse"):T("Create uses, check overuse"):
""},equals:function(a,b){return _.isUndefined(a.customerTypeRate)||_.isUndefined(b.customerTypeRate)?a.booking.pk===b.booking.pk&&a.resourceRequirement.pk===b.resourceRequirement.pk&&a.useCount===b.useCount:a.customerTypeRate.pk===b.customerTypeRate.pk&&a.resourceRequirement.pk===b.resourceRequirement.pk&&a.useCount===b.useCount},resourceUseSummaryKey:function(a,b){return a+"-"+b},isSeatResource:function(a){return!a.company.features.isSeatingEnabled?!1:a.seat?!0:!!a.resourceRequirement.resource.seatMapPk},
isAnySeatableResourceUses:function(a){return!a.company.features.isSeatingEnabled?!1:_.any(a.customers,function(a){return _.any(a.resourceUses,B.isSeatResource)})},seatableResourceUses:function(a){return _.filter(_.flatten(_.pluck(a.customers,"resourceUses")),B.isSeatResource)},seatedResourceUses:function(a){return _.filter(_.flatten(_.pluck(a.customers,"resourceUses")),"seat")},newResourceUseKey:function(a){return["seat",a.requirementPk,a.customerTypeRatePk,a.customerIndex,a.seatIndex].join(":")},
isNewResourceUseKey:function(a){return _.isString(a)&&_.startsWith(a,"seat")},isNewResourceUseKeyForCustomerTypeRate:function(a,b){return B.isNewResourceUseKey(a)&&_.int(_.split(a,":")[2])===b.pk},setNewResourceUseKeySeatIndexToZero:function(a){a=_.split(a,":");return B.newResourceUseKey({requirementPk:a[1],customerTypeRatePk:a[2],customerIndex:a[3],seatIndex:0})},useCountsTotal:function(a){return _.sum(a,"useCount")},displayArchivedResource:function(a){return a.resourceRequirement.resource.isArchived?
T("(archived)"):""}},n={RELATED_FEATURE_FLAG:"isSeatingEnabled",DEFAULT_SEAT_SIZE:28,MAX_SEAT_SIZE:40,MIN_SEAT_SIZE:20,style:function(a,b){b?(delete b.$center,delete b.$index):_.forEach(a.seats,function(a){a.seatGroup&&(delete a.seatGroup.$center,delete a.seatGroup.$index)});_.forEach(a.seats,function(a){b&&a.seatGroupPk!==b.pk||a.$style&&a.$style()})},maxZoom:function(a){return n.MAX_SEAT_SIZE-a.settings.seatSize},minZoom:function(a){return n.MIN_SEAT_SIZE-a.settings.seatSize}},P={verboseName:T("group"),
FORM_FIELDS:["rotation","xNudge","yNudge"],RELATED_FEATURE_FLAG:"isSeatingEnabled"},I={forBooking:function(a){return _.flatten(_.pluck(a.customers,"seatAssignments"))},isAnyForBooking:function(a){return _.any(I.forBooking(a))},sortBySeatMap:function(a){return _.sortBy(_.compact(I.forBooking(a)),"seat.seatMap.settings.displayName")},displayableSeatAssignment:function(a){var b=a.seatMap.settings,c=[];b.isSeatZoneVisible&&c.push(a.seatZone.name);b.isSeatGroupVisible&&c.push(a.seatGroup.name);b.isSeatNameVisible&&
c.push(a.name);return c.join(", ")},fromResourceUse:function(a){return{seat:a.seat}}},p={UNLIMITED:"unlimited",CAPACITY_CHOICES:[[0,0],[1,1],["unlimited",T("Unlimited")]],FORM_FIELDS:"name isNameVisible width height rotation xNudge yNudge capacity seatZonePk seatGroupPk".split(" "),RELATED_FEATURE_FLAG:"isSeatingEnabled",verboseName:T("seat"),getOverlappingSeat:function(a,b){return _.find(b,function(b){return p.isOverlappingOtherSeat(a,b)?b:null})},isOverlappingOtherSeat:function(a,b){if(a===b)return!1;
var c=a.yCoord+a.height-1;if(a.xCoord+a.width-1<b.xCoord||c<b.yCoord)return!1;c=b.yCoord+b.height-1;return b.xCoord+b.width-1<a.xCoord||c<a.yCoord?!1:!0},newPositions:function(a,b,c){var d=0,e=0,f=_.min(a,function(a){return a.xCoord+a.yCoord});a=_.map(a,function(a){var Ea=b+(a.xCoord-f.xCoord);a=c+(a.yCoord-f.yCoord);d=Ea<d?Ea:d;e=a<e?a:e;return{xCoord:Ea,yCoord:a}});(0>d||0>e)&&_.forEach(a,function(a){a.xCoord-=d;a.yCoord-=e});return a},defaultSeat:function(a,b,c,d){return{name:"",isNameVisible:!1,
width:1,height:1,capacity:1,rotation:0,xNudge:0,yNudge:0,seatZonePk:c,seatGroupPk:d,xCoord:a,yCoord:b}},commonSeatGroup:function(a,b){var c=_.unique(_.pluck(a,"seatGroupPk"));return 1!==c.length?null:_.findWhere(b,{pk:c[0]})},isBookable:function(a){return _.filter(a,function(a){return 0!==a.capacity})}},t={verboseName:T("zone"),RELATED_FEATURE_FLAG:"isSeatingEnabled"},K={MAX_COLOR:12,DEFAULT_RECEIPT_FOOTER:cT('"order" as in sales order',"Thanks for your order!"),FOLLOW_UP_AFTER_END_TYPE:"availability-end",
FOLLOW_UP_AFTER_START_TYPE:"availability-start",isValidColor:function(a){return _.isNumber(a)&&0<=a&&a<=K.MAX_COLOR},images:function(a,b){var c=[];a.images.length?c=[].concat(a.images):a.imageCdnUrl&&(c=[{croppedUrl:a.imageCdnUrl,imageCdnUrl:a.imageCdnUrl}]);b&&(b.availabilityHeadline&&b.availabilityHeadline.imageCdnUrl)&&c.unshift({croppedUrl:b.availabilityHeadline.imageCdnUrl,imageCdnUrl:b.availabilityHeadline.imageCdnUrl});return c},checklistName:function(a){var b=a.name;a.isPrivate?b="<span class='badge badge-lock ghost'>"+
T("Private")+"</span> "+b:a.isUnlisted&&(b="<span class='badge'>"+T("Unlisted")+"</span> "+b);a.shortName&&(b=b+" <span class='fh-grey'>("+a.shortName+")</span>");return b},isSeatingConfirmationsEnabled:function(a){return a.company.features.isSeatingEnabled&&a.settings.isSeatingConfirmationsEnabled},isDepositRequired:function(a){return a.effectiveIsDepositEnabled&&a.settings.isDepositRequired&&!a.settings.isBookingFeeOnly},verboseName:T("item"),verboseNamePlural:T("items")},x={NO_FLOW:{pk:!1,name:T("None")},
PAGE_TYPE:"page",LINK_TYPE:"link",ITEM_TYPE:"item",FLOW_QUERY:"flow",IS_FROM_CART_QUERY:"from-cart",WIDTH_ONE_THIRD:"1-3",WIDTH_HALF:"1-2",WIDTH_TWO_THIRDS:"2-3",WIDTH_FULL:"1-1",HEIGHT_1:1,HEIGHT_2:2,HEIGHT_3:3,singleItemRedirect:function(a){return a&&a!==x.NO_FLOW&&x.isAllItems(a)&&a.emptyPageChildren&&1===a.emptyPageChildren.length?a.emptyPageChildren[0].item:null},effectiveChildren:function(a){var b=a.children;x.isAllItems(a)&&(b=a.emptyPageChildren);return b||[]},childItems:function(a){return _.compact(_.pluck(x.effectiveChildren(a),
"item"))},childPages:function(a){return _.filter(a.children,{type:x.PAGE_TYPE})},isCalendarIncluded:function(a){if(!a.isCalendarIncluded)return!1;a=x.effectiveChildren(a);return _.any(a,function(a){return a.type===x.PAGE_TYPE||a.type===x.ITEM_TYPE&&!a.item.isRetail})},breadcrumbName:function(a){return a.shortName||a.name},isAllItems:function(a){return 0===a.childrenCount},isSingleLevelFlow:function(a){f.assert(a.children&&a.breadcrumbs,"Flow node must be fully loaded");return 0<a.breadcrumbs.length||
0<x.childPages(a).length?!1:!0},gridColumnCount:function(a){a=x.effectiveChildren(a).length;return 6<=a||3===a?3:4<=a||2===a?2:1},defaultBlockWidth:function(a){if(!x.isAllItems(a))return x.WIDTH_ONE_THIRD;a=x.gridColumnCount(a);return 3===a?x.WIDTH_ONE_THIRD:2===a?x.WIDTH_HALF:x.WIDTH_FULL},emptyGridBlockCount:function(a){if(!x.isAllItems(a))return 0;var b=x.gridColumnCount(a);return(a=x.effectiveChildren(a).length%b)?b-a:0},heading:function(a){return a.properties.heading||(a.item?a.item.name:a.name)},
subheading:function(a){return a.properties.subheading?a.properties.subheading:a.item?a.item.headline:""},imageUrl:function(a){return a.imageCdnUrl?a.imageCdnUrl:a.item?a.item.imageCdnUrl||(a.item.images.length?a.item.images[0].croppedCdnUrl:null):null},imageMaxWidth:function(a){return!a.properties.width?550:x.isTallBlock(a)?null:x.imageMinWidth(a)},imageMaxHeight:function(a){return!a.properties.width?null:x.isTallBlock(a)?x.imageMinHeight(a):null},imageMinWidth:function(a){switch(a.properties.width){case x.WIDTH_ONE_THIRD:return 604;
case x.WIDTH_HALF:return 920;case x.WIDTH_TWO_THIRDS:return 1236;case x.WIDTH_FULL:return 1868;default:return 0}},imageMinHeight:function(a){switch(a.properties.height){case x.HEIGHT_1:return 332;case x.HEIGHT_2:return 692;case x.HEIGHT_3:return 1052;default:return 0}},isTallBlock:function(a){return a.properties.height>x.HEIGHT_1&&(a.properties.width===x.WIDTH_ONE_THIRD||a.properties.width===x.WIDTH_HALF)||a.properties.width===x.WIDTH_TWO_THIRDS&&a.properties.height===x.HEIGHT_3},WIDTH_LABELS:{}};
x.WIDTH_LABELS[x.WIDTH_ONE_THIRD]="one-third";x.WIDTH_LABELS[x.WIDTH_HALF]="half";x.WIDTH_LABELS[x.WIDTH_TWO_THIRDS]="two-thirds";x.WIDTH_LABELS[x.WIDTH_FULL]="full";var E={effectiveMinimumPartySize:function(a){return null!==a.minimumPartySize?a.minimumPartySize:a.customerPrototype.minimumPartySize},effectiveMaximumPartySize:function(a){return null!=a.maximumPartySize?a.maximumPartySize:a.customerPrototype.maximumPartySize},find:function(a,b,c){var d;c||(d=_.find(a,function(a){return a.customerPrototype===
b.customerPrototype}));d||(d=_.find(a,function(a){return a.customerPrototype.customerType===b.customerPrototype.customerType}));return d}},J={ANY_CONDITIONS_TYPE:"any",ALL_CONDITIONS_TYPE:"all",isVisibleDueToConditions:function(a,b,c){return a.isHidden?!1:!a.customFieldInstanceConditions.length?!0:(a.conditionsType===J.ANY_CONDITIONS_TYPE?_.any:_.all)(a.customFieldInstanceConditions,function(a){return v.isMatch(a,b,c)})},find:function(a,b){return _.contains(a,b)?b:_.find(a,{customField:b.customField})}},
v={SELECTED_TYPE:"selected",NOT_SELECTED_TYPE:"not-selected",EXACT_TYPE:"exact",NOT_EXACT_TYPE:"not-exact",SELECTED_NOT_EXACT_TYPE:"selected-ne",RANGE_TYPE:"range",SELECTED_OPTIONS:[{name:T("is not empty"),value:"selected"},{name:T("is empty"),value:"not-selected"}],EXACT_OPTIONS:[{name:T("is not empty"),value:"selected"},{name:T("is empty"),value:"not-selected"},{name:T("is:"),value:"exact"},{name:T("is not:"),value:"selected-ne"},{name:T("is empty or not:"),value:"not-exact"}],RANGE_OPTIONS:[{name:T("is in range:"),
value:"range"}],isValidParent:function(a){return _.contains([C.SHORT_TYPE,C.YES_NO_TYPE,C.CODE_GENERATOR_TYPE,C.EXTENDED_OPTION_TYPE,C.MULTI_CAMPAIGN_TYPE,C.COUNT_TYPE],a.customField.type)},types:function(a){if(v.needsExactValue(a)){var b=v.EXACT_OPTIONS;a.customField.type===C.COUNT_TYPE&&(b=b.concat(v.RANGE_OPTIONS));return b}return v.SELECTED_OPTIONS},needsExactValue:function(a){return _.contains([C.SHORT_TYPE,C.EXTENDED_OPTION_TYPE,C.COUNT_TYPE],a.customField.type)},needsCustomField:function(a){return _.contains([v.EXACT_TYPE,
v.NOT_EXACT_TYPE,v.SELECTED_NOT_EXACT_TYPE,v.RANGE_TYPE],a.type)},isMatch:function(a,b,c){c=c||{};var d=c[a.uri];if(!_.isUndefined(d))return d;c[a.uri]=!1;var e=a.parentCustomFieldInstance;if(!e||e.isHidden||!J.isVisibleDueToConditions(e,b,c))return!1;d=a.type;b=b(e);d===v.SELECTED_TYPE?d=!!b:d===v.NOT_SELECTED_TYPE?d=!b:d===v.EXACT_TYPE?d=a.exactValue===b:d===v.NOT_EXACT_TYPE?d=!b||a.exactValue!==b:d===v.SELECTED_NOT_EXACT_TYPE?d=!!b&&a.exactValue!==b:d===v.RANGE_TYPE?(d=a.properties,d=d.rangeStart<=
b&&b<=d.rangeEnd):d=!1;return c[a.uri]=d},rawValue:function(a){return a.type===v.RANGE_TYPE?a.properties:a.exactValue}},M={CHECKED_IN_TYPE:"checked-in",NO_SHOW_TYPE:"no-show",MIXED_CHECKIN_STATUS:{pk:"mixed",name:T("Set check-in per customer..."),type:"mixed"},EMPTY_CHECKIN_STATUS:{pk:"",name:T("Not yet checked in")},RELATED_FEATURE_FLAG:"isCheckinEnabled",isCheckedIn:function(a){return a&&a.type===M.CHECKED_IN_TYPE},isNoShow:function(a){return a&&a.type===M.NO_SHOW_TYPE},isMixed:function(a){return a===
M.MIXED_CHECKIN_STATUS},bookingCheckinStatus:function(a){if(a&&a.customers&&a.customers.length){var b=a.customers[0]?a.customers[0].checkinStatus:null;return _.every(a.customers,{checkinStatus:b})?b:M.MIXED_CHECKIN_STATUS}},bookingCheckinStatusObject:function(a){return M.bookingCheckinStatus(a)||M.EMPTY_CHECKIN_STATUS},bookingCheckinBreakdown:function(a){var b={};_.forEach(a.customers,function(a){var c=a.customerTypeRate.customerPrototype.customerType,d=a.checkinStatus||null;a=c.uri+":"+(d?d.uri:
"");c=b[a]||{count:0,customerType:c,checkinStatus:d};c.count+=1;b[a]=c});a=l(_.values(b),function(a){return!a.checkinStatus?[1,2,0,a.customerType.sortableIndex]:[0,a.checkinStatus.type===N.CheckinStatus.NOT_CHECKED_IN_TYPE?1:0,a.checkinStatus.sortableIndex,a.customerType.sortableIndex]});return _.map(a,function(a){var b=a.customerType.shortName||e(a.count,a.customerType.singular,a.customerType.plural),c=a.checkinStatus?a.checkinStatus.name:T("not checked in");return a.count.toString()+"\u00a0"+b+
"\u00a0"+c}).join(", ")},checkinStatusClass:function(a){return a?a.type:"not-checked-in"},checkinStatusSort:function(a){return[!!a,M.isCheckedIn(a),M.isMixed(a),M.isNoShow(a),a?a.sortableIndex:0]}},R=function(a){return function(b){return u.effectiveBookingRestriction(b,a)}},u={AUTO_STATUS:"auto",OPEN_STATUS:"open",CALL_STATUS:"call",CLOSED_STATUS:"closed",CANCELLED_STATUS:"cancelled",DISPLAY_STATUS_BY_STATUS:{auto:T("Auto close"),open:T("Open"),call:T("Closed & Call to book"),closed:T("Closed & hidden"),
cancelled:T("Cancelled")},displayStatus:function(a){return u.DISPLAY_STATUS_BY_STATUS[a]},cutoffReachedStart:function(a){var b=u.cutoffReachedKind(a),c=u.cutoffReachedHours(a);return qa.cutoffStart(b,c,a.utcStartAt)},cutoffUnreachedStart:function(a){var b=u.cutoffUnreachedKind(a),c=u.cutoffUnreachedHours(a);return qa.cutoffStart(b,c,a.utcStartAt)},effectiveBookingRestriction:function(a,b){return a.bookingRestriction?a.bookingRestriction[b]:a.item.bookingRestriction?a.item.bookingRestriction[b]:a.item[b]},
soldOutText:R("soldOutText"),isBookableEverByPhone:R("isBookableEverByPhone"),cutoffReachedKind:R("cutoffReachedKind"),cutoffReachedHours:R("cutoffReachedHours"),cutoffUnreachedKind:R("cutoffUnreachedKind"),cutoffUnreachedHours:R("cutoffUnreachedHours"),isInPast:function(a){var b=a.utcEndAt;a=a.customerCount?u.cutoffReachedStart(a):u.cutoffUnreachedStart(a);b=Math.max(b.unix(),a.unix());a=moment().unix();return b<a},isCancelled:function(a){return a.status===u.CANCELLED_STATUS},isBookableByDashboardUser:function(a){var b=
g.get("auth");return!u.isCancelled(a)||b.permissions.can("bookCancelled",u,a.company)},minimumPartySize:function(a){return a.customerCount?u.effectiveBookingRestriction(a,"minimumSubsequentPartySize"):u.effectiveBookingRestriction(a,"minimumInitialPartySize")},maximumPartySize:function(a){return a.customerCount?u.effectiveBookingRestriction(a,"maximumSubsequentPartySize"):u.effectiveBookingRestriction(a,"maximumInitialPartySize")},blockedCustomerCount:function(a){return _.sum(a.blocks,"customerCount")},
reservedCapacity:function(a){return _.sum(a.blocks,"reservedCapacity")},customFieldInstances:function(a){var b=[];_.forEach(a.customerTypeRates,function(a){_.ref.append(b,a.customerPrototype.customFieldInstances)});_.ref.append(b,_.get(a.customFieldInstanceGroup,"customFieldInstances"));return b},isEligibleForAutoFollowUpEmail:function(a){return a.item.isFollowUpEnabled},isEligibleForAutoReminderEmail:function(a){return a.item.isReminderEnabled},isEligibleForAutoReminderSms:function(a){return a.company.isSmsEnabled&&
a.item.isSmsReminderEnabled},hasBookingWaiver:function(a){return _.any(a.bookings,function(a){return F.hasBookingLevelWaiver(a)||S.hasCustomerLevelWaiver(a.customers)})},AFFILIATE_SORT_ORDER:"affiliate",LAST_BOOKED_AT_SORT_ORDER:"lastBookedAt",LAST_BOOKED_BY_SORT_ORDER:"lastBookedBy",CONTACT_NAME_SORT_ORDER:"name",PAID_STATUS_SORT_ORDER:"status",PAX_COUNT_SORT_ORDER:"paxCount"},X={COMPLETED_TYPE:"completed",PENDING_TYPE:"pending",items:function(a){return F.uniqueItems(a.allBookings)},isNoTax:function(a){return _.all(a.contributingBookings,
"availability.item.isNoTax")},receiptFooter:function(a){a=_.uniq(_.map(X.items(a),"receiptFooter"));return 1===a.length&&a[0]?a[0]:K.DEFAULT_RECEIPT_FOOTER},showTaxByType:function(a){return a.company.features.isTaxTypeBreakdownEnabled&&!(ia.LEGACY_TAX_TYPE_PK in a.contributingBookingCosts.totalCost.taxByType)}},R={COUNTRIES:q},F={CANCELLED_STATUS:"cancelled",UNCANCELLED_STATUS:"uncancelled",PAID_PAID_STATUS:"paid",UNPAID_PAID_STATUS:"unpaid",OVERPAID_PAID_STATUS:"overpaid",UNDERPAID_PAID_STATUS:"underpaid",
COMPLETED_TYPE:"completed",PENDING_TYPE:"pending",nonZeroGeneratedStoredValueCards:function(a){return _.filter(a.generatedStoredValueCards,function(a){return 0<a.balance})},isEligibleForDeposit:function(a,b,c){return a.effectiveIsDepositEnabled&&0<b&&b<c&&(a.settings.depositModifierKind===L.PERCENTAGE_MODIFIER_KIND||a.settings.depositOffset<c)&&(a.settings.isMinimumBookingAmountForDepositOptionRequired?a.settings.minimumBookingAmountForDepositOption<=c:!0)},effectiveDeposit:function(a,b){if(0>=b)return 0;
var c=0;a.settings.depositModifierKind===N.PriceLine.OFFSET_MODIFIER_KIND?c=a.settings.depositOffset:a.settings.depositModifierKind===N.PriceLine.PERCENTAGE_MODIFIER_KIND&&(c=_.roundHalfToEven(a.settings.depositRate*b));return c},paymentsAndRefunds:function(a){var b=_.append.apply(null,_.map(_.reject(a.payments,"isHold"),"refunds"));_.ref.append(b,a.payments);return _.sortBy(b,"createdAt")},adjustBookingFee:function(a,b,c,d){b+=c;return!b||!d?a:d<b?_.roundHalfToEven(a*((b-d)/b)):0},affiliateCompany:function(a){return a.affiliation?
a.affiliation.affiliateCompany:void 0},newTransportation:function(a){if(a.customFieldValues)return _.find(a.customFieldValues,function(a){return a.customFieldInstance.customField.type===C.NEW_TRANSPORTATION_TYPE});console.warn("models.Booking.newTransportation: booking has no custom field values")},waiverCustomFields:function(a){var b=[],c=function(a){return C.isWaiverType(a.customFieldInstance.customField)},d=function(a){return a.customFieldInstance.customField},e=_.map(_.filter(a.customFieldValues,
c),d),f=[];_.forEach(a.customers,function(a){f.push(_.map(_.filter(a.customFieldValues,c),d))});f=_.flatten(f);b=b.concat(f,e);if(b.length)return _.uniq(b,"pk");console.warn("models.Booking.waivers: booking has no waiver custom fields")},hasBookingLevelWaiver:function(a){return _.any(a.customFieldValues,function(a){return N.CustomField.isWaiverType(a.customFieldInstance.customField)})},hasWaiverType:function(a){return this.hasBookingLevelWaiver(a)||N.Customer.hasCustomerLevelWaiver(a.customers)},
generatedCustomFields:function(a){var b={};_.forEach(a.generatedCodes,function(a){var c=a.generatingCampaign,d=c.customField,e=b[d.uri]||{customField:d,generatedCampaigns:{}};b[d.uri]=e;d=e.generatedCampaigns[c.uri]||{generatingCampaign:c,generatedCodes:[]};e.generatedCampaigns[c.uri]=d;d.generatedCodes.push(a)});a=_.sortBy(_.values(b,function(a){return a.customField.name}));_.forEach(a,function(a){a.generatedCampaigns=_.sortBy(_.values(a.generatedCampaigns,function(a){return a.generatingCampaign.campaign.name}))});
return a},isEligibleForAutoFollowUpEmail:function(a){return a.item.isFollowUpEnabled&&!a.availability.isFollowUpDisabled&&a.contact.email},isEligibleForAutoReminderEmail:function(a){return a.item.isReminderEnabled&&!a.availability.isReminderDisabled&&a.contact.email},isEligibleForAutoReminderSms:function(a){return a.company.isSmsEnabled&&a.item.isSmsReminderEnabled&&!a.availability.isSmsReminderDisabled&&a.isSmsEnabled&&ua.isEligiblePhoneNumber(a.contact.phone,a.contact.phoneCountry,a.contact.company)},
isEligibleForReviewExpress:function(a){return a.item.isReviewExpressEnabled&&a.contact.email},isEligibleForOnlineCancellation:function(a){var b=a.paidStatus===F.PAID_PAID_STATUS,c=_.filter(a.payments,function(a){return!a.isRefunded&&!a.isProcessorBasedType});return(!u.isInPast(a.availability)||u.isCancelled(a.availability))&&!a.isCancelled&&a.company.features.isCancellationPoliciesEnabled&&a.company.features.isOnlineCancellationEnabled&&!!a.effectiveCancellationRule&&a.effectiveCancellationRule.isCancellationAllowed&&
b&&!c.length},charterInvoiceRevenue:function(a){return!a.affiliation?null:a.invoicedToCharter+a.invoiceableToCharter},charterInvoiceOwed:function(a){return!a.affiliation?null:a.invoicedToAffiliate+a.invoiceableToAffiliate},isEligibleForCancellation:function(a,b){if(!a.company.features.isCancellationPoliciesEnabled||!a.effectiveCancellationRule||!a.effectiveCancellationRule.isCancellationAllowed)return!1;var c=b?b.company:null;return a.affiliation&&a.affiliation.affiliateCompany===c&&_.any(a.payments,
function(a){return!a.isDeferred&&!a.isCollectedByAffiliate})?!1:!0},isEligibleForRebook:function(a,b){return F.isEligibleForCancellation(a,b)},itemsInOrder:function(a){return a.isOrder?_.uniq(_.pluck(a.order.allBookings,"item")):[a.item]},hasEmailableDisputes:function(a){return _.some(a.payments,function(a){return O.isOpenDisputeStatus(a)})},customerTypeRateCountKey:function(a){return"customerTypeRate:"+a.pk+"-count"},customerCardKey:function(a,b){return a.pk.toString()+"-"+b.toString()},customFieldInstanceKeyPrefix:function(a,
b,c,d){b=_.isObject(b)?b.cls===E.cls?F.customerCardKey(b,c):b.key:_.isString(b)?b:"booking";_.isNumber(d)&&(b+="-pushed-"+d);return"customFieldInstance"+a.pk+"For:"+b},customFieldInstanceKey:function(a,b,c,d){return F.customFieldInstanceKeyPrefix(a,b,c,d)+"-value"},adjustedPriceKeyPrefix:function(a,b,c){return(a=_.isModelObject(a)?F.customFieldInstanceKeyPrefix(a,b,null,c):a)?a+"-"+ea.ADJUSTED_PRICE_KEY_PREFIX:ea.ADJUSTED_PRICE_KEY_PREFIX},clearCustomFieldValuesFromModel:function(a,b,c,d){var e=N.Booking.customFieldInstanceKey(b,
c,null,d);delete a[e];var f=F.adjustedPriceKeyPrefix(b,c,d);_.forEach(["offset","rate","invoiceOffset","invoiceRate"],function(b){delete a[f+b]})},uniqueItems:function(a){return _.uniq(_.map(a,"item"))},effectivePrimaryLocation:function(a){var b=a.availability.item,c=b.startLocation,d=b.primaryLocation;!d&&!b.isCustomPrimaryLocation&&(d=a.company.defaultItemPrimaryLocation);d&&(c&&d.pk===c.pk)&&(d=null);return d},showTaxByType:function(a){return a.company.features.isTaxTypeBreakdownEnabled&&null===
a.explicitGross&&!(ia.LEGACY_TAX_TYPE_PK in a.costs.totalCost.taxByType)},hasPushedCustomFieldInstancesNotOnAvailability:function(a,b){var c=[];_.forEach(a.customers,function(a){_.ref.append(c,_.filter(a.customFieldValues,"isPushed"))});_.ref.append(c,_.filter(a.customFieldValues,"isPushed"));return!c.length?!1:0<_.difference(_.pluck(c,"customFieldInstance"),u.customFieldInstances(b)).length},calculateOnlineInstallmentAmounts:function(a,b,c,d,e,h){if(!d||0===c)return{gross:0,fee:0,tax:0};var g=a.features.onlineInstallmentsMinimumFee,
k=b.tax/b.price,l=b.tax/b.total,n=d*l,p=d*(b.feeable/b.total),q=a.features.onlineInstallmentsFeeRate;a=q*(b.feeable/b.price);q=e||0==p?0:Math.max(p*q,g);p=_.roundHalfToEven(d+q);p=c===p;if(!c)return console.log("Preview installment amounts"),console.log("Calculated gross:",d),console.log("Calculated fee:",q),{gross:d,fee:_.roundHalfToEven(q),tax:_.roundHalfToEven(n)};if(e)return n=_.roundHalfToEven(c*l),console.log("Online deposits installment amounts"),console.log("Calculated gross:",c),console.log("Calculated fee:",
0),{gross:c,fee:0,tax:n};l=0;e=c;p?(console.log("Pay in full installment amounts"),l=d/(k+1),e=l*(a+k+1),l*a<g&&0<b.feeable&&(e=l+l*k+g)):(console.log("Partial payment installment amounts"),l=c/(a+k+1),l*a<g&&0<b.feeable&&(l=(c-g)/(k+1)));d=_.roundHalfToEven(l*k);k=_.roundHalfToEven(l+d);a=_.roundHalfToEven(e-k);a=N.Company._minimumFee(a,b.price,h,g);p||(b=c-(k+a),0<b?k+=b:0>b&&(a+=b));console.log("Calculated gross:",k);console.log("Calculated fee:",a);console.log("Calculated tax:",d);console.log("Calculated rounded total:",
_.roundHalfToEven(e));f.assert(a+k===c,"Online installment:"+c+" must equal gross ("+k+") + booking fee ("+a+")");return{gross:k,fee:0<k?a:0,tax:d}},onlineInstallmentAmountsPreview:function(a,b,c,d,e){return F.calculateOnlineInstallmentAmounts(a,b,null,c,d,e)},onlineInstallmentMinimumAmount:function(a,b){var c=b.isDeposit,d=b.isOnline;return!b.costs.totalCost.feeable||c&&d?a:b.company.features.onlineInstallmentsMinimumFee+a},onlineInstallmentMaximumAmount:function(a){a=F.onlineInstallmentAmountsPreview(a.company,
a.costs.totalCost,a.amountDue,N.Booking.isOnlineDeposit(a),a.item.isFreeAllowed);return a.gross+a.fee},isOnlineDeposit:function(a){return a.isDeposit&&a.originalUserType===N.User.ONLINE_TYPE}},S={hasCustomerLevelWaiver:function(a){return _.any(a,function(a){return N.CustomerCustomFieldValue.hasWaiverType(a.customFieldValues)})}},V={OTHER_AGENT:{name:T("Add new agent"),pk:-1}},U={OTHER_DESK:{name:T("Add new desk"),pk:-1}},fa={PERCENTAGE_COMMISSION_TYPE:"percentage",FLAT_COMMISSION_TYPE:"flat",AFFILIATE_TAKE_PAYMENT_PREFERENCE:"affiliate-take",
CARD_ON_FILE_PAYMENT_PREFERENCE:"card-on-file",TAKE_PAYMENT_PREFERENCE:s.TAKE_PAYMENT_PREFERENCE,INFO_PAYMENT_PREFERENCE:s.INFO_PAYMENT_PREFERENCE,SKIP_PAYMENT_PREFERENCE:s.SKIP_PAYMENT_PREFERENCE,MAX_SELECTABLE_AFFILIATES:400,isOnlineBookingEnabled:function(a){return(a=a.affiliateGroup&&a.affiliateGroup.groupPermissions)&&a.canCreateBookings},verboseName:T("affiliate"),verboseNamePlural:T("affiliates"),name:function(a){return!a?"":!a.affiliateCompany?a.unicode:a.affiliateCompany.name}},D={NEW_STATUS:"new",
PENDING_STATUS:"pending",RUNNING_STATUS:"running",FAILED_STATUS:"failed",SUCCEEDED_STATUS:"succeeded",CANCELLED_STATUS:"cancelled",ALL_PARTNER_FILTER_OPTION:"all",DIRECT_PARTNER_FILTER_OPTION:"direct",ALL_AFFILIATE_FILTER_OPTION:"all",DIRECT_AFFILIATE_FILTER_OPTION:"direct",ALL_ITEM_FILTER_OPTION:"all",ALL_USER_FILTER_OPTION:"all",ONLINE_USER_FILTER_OPTION:"online",ORIGINAL_USER_TYPE_FILTER_OPTION:"original",CURRENT_USER_TYPE_FILTER_OPTION:"current",ALL_CANCELLED_BOOKINGS_FILTER_OPTION:"all",NO_CANCELLED_BOOKINGS_FILTER_OPTION:"none",
NON_REFUNDED_CANCELLED_BOOKINGS_FILTER_OPTION:"non-refunded",ONLY_CANCELLED_BOOKINGS_FILTER_OPTION:"only",ALL_TRANSACTION_TAG_FILTER_OPTION:"all",ALL_SALESPERSON_FILTER_OPTION:"all",ALL_DISPUTE_STATUS_FILTER_OPTION:"all",ALL_CLOSED_DISPUTE_STATUS_FILTER_OPTION:"all-closed",ALL_OPEN_DISPUTE_STATUS_FILTER_OPTION:"all-open",ALL_CURRENCY_FILTER_OPTION:"all",UNCANCELLED_FILTER_OPTION:"uncancelled",REFUNDED_CANCELLED_FILTER_OPTION:"refunded",UNREFUNDED_CANCELLED_FILTER_OPTION:"unrefunded",ADVANCED_TYPE:"advanced",
emptyFilters:function(){return _.mapValues(N.Report.MODELS,function(){return[]})},emptyColumns:function(){return _.mapValues(N.Report.MODELS,function(){return{}})},emptyCompanyOptions:function(a){return _.keyBy(a,"pk",function(a){var b={};a.isCharter&&(b.filters=D.emptyFilters());a.isAffiliate&&(b.selectedAllPartners=void 0,b.allPartnerFilters=D.emptyFilters(),b.partners={},b.selectedPartners={});return b})},emptyReportOptions:function(a){return{modelName:"",presetDateRange:"",startDate:"",endDate:"",
dateType:"",filters:D.emptyFilters(),companies:D.emptyCompanyOptions(a),selectedCharters:{},selectedAffiliates:{},groups:[],isDetailed:"",columns:D.emptyColumns(),isOpened:!1,customFieldValueModel:""}},defaultGroups:function(){return[D.ITEM_GROUP]},datetimeGroups:function(){return[D.BOOKING_CREATED_AT_HOUR_GROUP,D.BOOKING_CANCELLED_AT_HOUR_GROUP,D.CUSTOMER_CHECKIN_STATUS_LAST_MODIFIED_AT_HOUR_GROUP,D.LINE_ITEM_CREATED_AT_HOUR_GROUP,D.AVAILABILITY_START_AT_HOUR_GROUP,D.PAYMENT_OR_REFUND_CREATED_AT_HOUR_GROUP,
D.STORED_VALUE_CARD_CREATED_AT_HOUR_GROUP]},defaultBookingCancelledStatusFilter:function(){return{type:D.CANCELLED_STATUS_FILTER_TYPE,data:{value:[D.UNCANCELLED_FILTER_OPTION,D.UNREFUNDED_CANCELLED_FILTER_OPTION]}}},defaultFilters:function(){return _.extend(D.emptyFilters(),{Booking:[D.defaultBookingCancelledStatusFilter()]})},defaultBookingColumns:function(){return _.toTrueKeys([D.BOOKING_COUNT_COLUMN,D.BOOKING_ID_COLUMN,D.BOOKING_BOOKED_BY_COLUMN,D.CREATED_AT_COLUMN,D.AVAILABILITY_DATETIME_COLUMN,
D.TOTAL_COST_PRICE_COLUMN,D.TOTAL_COST_TAX_COLUMN,D.TOTAL_COST_TOTAL_COLUMN,D.CONTACT_NAME_COLUMN,D.CUSTOMER_COUNT_COLUMN,D.AFFILIATE_COLUMN,D.VOUCHER_NUMBER_COLUMN,D.INVOICEABLE_TO_CHARTER_COLUMN,D.INVOICEABLE_TO_AFFILIATE_COLUMN,D.RECEIPT_PROCESSING_FEE_COLUMN,D.COLLECTED_TOTAL_COST_TOTAL_COLUMN,D.RECEIPT_NET_COLUMN])},defaultCustomerColumns:function(){return _.toTrueKeys([D.CUSTOMER_COUNT_COLUMN,D.TOTAL_COST_PRICE_COLUMN,D.TOTAL_COST_TAX_COLUMN,D.TOTAL_COST_TOTAL_COLUMN,D.COLLECTED_TOTAL_COST_PRICE_COLOUMN,
D.COLLECTED_TOTAL_COST_TAX_COLOUMN,D.COLLECTED_TOTAL_COST_TOTAL_COLUMN])},defaultCustomFieldValueColumns:function(){return _.toTrueKeys([D.USE_COUNT_COLUMN,D.TOTAL_COST_PRICE_COLUMN,D.TOTAL_COST_TAX_COLUMN,D.TOTAL_COST_TOTAL_COLUMN,D.COLLECTED_TOTAL_COST_PRICE_COLOUMN,D.COLLECTED_TOTAL_COST_TAX_COLOUMN,D.COLLECTED_TOTAL_COST_TOTAL_COLUMN])},defaultResourceUseColumns:function(){return _.toTrueKeys([D.USE_COUNT_COLUMN])},defaultLineItemColumns:function(){return _.toTrueKeys([D.CREATED_AT_COLUMN,D.TOTAL_COST_PRICE_COLUMN,
D.TOTAL_COST_TAX_COLUMN,D.TOTAL_COST_TOTAL_COLUMN,D.LINE_ITEM_DESCRIPTION_COLUMN])},defaultStoredValueCardColumns:function(){return _.toTrueKeys([D.CREATED_AT_COLUMN,D.STORED_VALUE_CARD_TYPE_COLUMN,D.STORED_VALUE_CARD_NUMBER_COLUMN])},defaultPaymentProcessingDocumentColumns:function(){return _.toTrueKeys([D.PAYMENT_PROCESSING_DOCUMENT_NUMBER_COLUMN,D.PAYMENT_PROCESSING_DOCUMENT_TOTAL_COLUMN,D.PAYMENT_PROCESSING_DOCUMENT_PERIOD_COLUMN])},defaultPaymentColumns:function(){return _.toTrueKeys([D.CREATED_AT_COLUMN,
D.PAYMENT_OR_REFUND_COLUMN,D.PAYMENT_OR_REFUND_ID_COLUMN,D.PAYMENT_TYPE_COLUMN,D.PAYMENT_AND_REFUND_GROSS_COLUMN,D.PAYMENT_AND_REFUND_PROCESSING_FEE_COLUMN,D.PAYMENT_AND_REFUND_NET_COLUMN,D.PAYMENT_COUNT_COLUMN,D.REFUND_COUNT_COLUMN,D.PAYMENT_TOTAL_TAX_COLUMN,D.REFUND_TOTAL_PRICE_COLUMN])},defaultPaymentColumnsWithTax:function(){return _.extend(D.defaultPaymentColumns(),_.toTrueKeys([D.PAYMENT_AND_REFUND_TOTAL_TAX_COLUMN]))},defaultCustomerReportColumns:function(){return _.extend(D.emptyColumns(),
{Customer:D.defaultCustomerColumns(),Booking:_.toTrueKeys([D.BOOKING_ID_COLUMN,D.BOOKING_COUNT_COLUMN,D.CUSTOMER_COUNT_COLUMN,D.TOTAL_COST_TOTAL_COLUMN])})},defaultColumns:function(){return _.extend(D.emptyColumns(),{Booking:D.defaultBookingColumns(),Customer:D.defaultCustomerColumns(),CustomFieldValue:D.defaultCustomFieldValueColumns(),ResourceUse:D.defaultResourceUseColumns(),LineItem:D.defaultLineItemColumns(),StoredValueCard:D.defaultStoredValueCardColumns(),PaymentProcessingDocument:D.defaultPaymentProcessingDocumentColumns()})},
paymentTypeChoicesForCompany:function(a,b){var c={};c[O.IDEAL_PROCESSOR_BASED_TYPE]="isIdealPaymentsEnabled";c[O.SOFORT_PROCESSOR_BASED_TYPE]="isSofortPaymentsEnabled";c[O.BANCONTACT_PROCESSOR_BASED_TYPE]="isBancontactPaymentsEnabled";return _.filter(a,function(a){return _.has(c,a.value)?b.features[c[a.value]]:!0})},defaultReportOptions:function(a){var b=_.defaults({dateType:D.AVAILABILITY_DATE_TYPE,presetDateRange:D.YESTERDAY_DATE_RANGE,isDetailed:!1,groups:D.defaultGroups(),columns:D.defaultColumns(),
filters:D.defaultFilters(),customFieldValueModel:va.cls},D.emptyReportOptions(a));a=a[0];b.selectedCharters[a.pk]=a.isCharter;b.selectedAffiliates[a.pk]=!a.isCharter&&a.isAffiliate;return b}},C={STACK_PRICING_TYPE:"stack",CURRENT_PRICING_TYPE:"current",INITIAL_PRICING_TYPE:"initial",ZERO_PRICING_TYPE:"zero",SHORT_TYPE:"short",LONG_TYPE:"long",YES_NO_TYPE:"yes-no",EXTENDED_OPTION_TYPE:"extended-option",HEADER_TYPE:"header",NOTE_TYPE:"note",TRANSPORTATION_TYPE:"transportation",NEW_TRANSPORTATION_TYPE:"new-transportation",
CODE_TYPE:"code",MULTI_CAMPAIGN_TYPE:"multi-campaign",CODE_GENERATOR_TYPE:"code-generator",CARD_GENERATOR_TYPE:"card-generator",COUNT_TYPE:"count",SMARTWAIVER_TYPE:"waiver",WHEREWOLF_TYPE:"wherewolf-waiver",WAIVER_TYPES:["waiver","wherewolf-waiver"],DISPLAY_ONLY_TYPES:["note","header"],isWaiverType:function(a){return _.contains(C.WAIVER_TYPES,a.type)},defaultCount:function(a){return a.type!==C.COUNT_TYPE?"":0>=a.countMin&&0<=a.countMax?0:a.countMin},suggestedAmounts:function(a){if(a.type!==C.CARD_GENERATOR_TYPE)return[];
a=a.cardSuggestedAmount||2500;return[a,2*a,4*a]},isDisplayOnly:function(a){return _.contains(C.DISPLAY_ONLY_TYPES,a.type)},isManifestField:function(a){return C.isDisplayOnly(a)?!1:!_.contains([C.NEW_TRANSPORTATION_TYPE,C.CODE_GENERATOR_TYPE,C.SMARTWAIVER_TYPE,C.WHEREWOLF_TYPE],a.type)},isAggregatable:function(a){return _.contains([N.CustomField.EXTENDED_OPTION_TYPE,N.CustomField.CODE_TYPE,N.CustomField.MULTI_CAMPAIGN_TYPE,N.CustomField.YES_NO_TYPE,N.CustomField.TRANSPORTATION_TYPE,N.CustomField.COUNT_TYPE],
a.type)},usesCheckbox:function(a){return _.contains([C.YES_NO_TYPE,C.CODE_GENERATOR_TYPE],a.type)},needsRequired:function(a){return C.isDisplayOnly(a)?!1:!_.contains([C.TRANSPORTATION_TYPE,C.COUNT_TYPE],a.type)},needsPricing:function(a){return _.contains([C.YES_NO_TYPE,C.CODE_TYPE,C.CODE_GENERATOR_TYPE,C.CARD_GENERATOR_TYPE,C.NEW_TRANSPORTATION_TYPE,C.COUNT_TYPE],a.type)},needsAlwaysPerCustomer:function(a){return C.needsPricing(a)||_.contains([C.EXTENDED_OPTION_TYPE],a.type)},pricedByValue:function(a){return a.type===
C.CARD_GENERATOR_TYPE},pricedByOptions:function(a){return _.contains([C.EXTENDED_OPTION_TYPE,C.MULTI_CAMPAIGN_TYPE],a.type)},isAdjustableType:function(a){return _.contains([C.YES_NO_TYPE,C.EXTENDED_OPTION_TYPE,C.COUNT_TYPE],a.type)},needsBookingNotes:function(a){return _.contains([C.CODE_TYPE,C.CODE_GENERATOR_TYPE,C.CARD_GENERATOR_TYPE,C.MULTI_CAMPAIGN_TYPE,C.YES_NO_TYPE,C.TRANSPORTATION_TYPE,C.NEW_TRANSPORTATION_TYPE,C.EXTENDED_OPTION_TYPE,C.COUNT_TYPE],a.type)},needsHint:function(a){return _.contains([C.SHORT_TYPE,
C.LONG_TYPE,C.CODE_TYPE,C.NEW_TRANSPORTATION_TYPE,C.MULTI_CAMPAIGN_TYPE],a.type)},hasExtraOptions:function(a){return _.contains([C.EXTENDED_OPTION_TYPE,C.TRANSPORTATION_TYPE,C.MULTI_CAMPAIGN_TYPE],a.type)},isDefaultValueAllowed:function(a){return _.contains(C.DEFAULT_VALUE_TYPES,a.type)},isValidRawValue:function(a,b,c){return a.type===C.EXTENDED_OPTION_TYPE?""===b?!0:_.isNumber(b)&&_.find(a.extendedOptions,{pk:b}):a.type===C.COUNT_TYPE?c===v.RANGE_TYPE?!(b.rangeStart>a.countMax||b.rangeEnd<a.countMin):
_.isNumber(b)&&b>=a.countMin&&b<=a.countMax:!0},displayForRawValue:function(b,c,d){return b.type===C.EXTENDED_OPTION_TYPE?""===c?"":(b=_.find(b.extendedOptions,{pk:c}))?a(b):"Deleted option":b.type===C.YES_NO_TYPE?c?"Yes":"No":d===v.RANGE_TYPE?c.rangeStart+" \u2014 "+c.rangeEnd:_.isUndefined(c)||null===c?"":c.toString()},isOptionAvailable:function(a,b){if(""===b)return!0;var c=a.type;return c===C.EXTENDED_OPTION_TYPE?_.some(a.extendedOptions,function(a){return a.pk===b}):c===C.TRANSPORTATION_TYPE?
_.some(a.transportationOptions,function(a){return a.pk===b}):c===C.COUNT_TYPE?b>=a.countMin&&b<=a.countMax:!0},autofillValue:function(a,b,c){if(!_.isUndefined(b)&&(a=a.customField,C.isOptionAvailable(a,b)))return c&&a.type===C.NEW_TRANSPORTATION_TYPE&&(b=void 0),_.clone(b)},verboseName:T("custom field"),verboseNamePlural:T("custom fields"),dropdownName:function(a){return"["+a.shortDisplayType+"] "+a.name}};_.extend(C,{GROUPED_TYPES:{text:[C.SHORT_TYPE,C.LONG_TYPE],checkbox:[C.YES_NO_TYPE,C.CODE_GENERATOR_TYPE],
dropdown:[C.EXTENDED_OPTION_TYPE],quantity:[C.COUNT_TYPE],transportation:[C.NEW_TRANSPORTATION_TYPE,C.TRANSPORTATION_TYPE],code:[C.MULTI_CAMPAIGN_TYPE,C.CODE_TYPE],label:[C.HEADER_TYPE],waiver:[C.SMARTWAIVER_TYPE,C.WHEREWOLF_TYPE],"gift-card":[C.CARD_GENERATOR_TYPE]},groupedType:function(a){return _.findKey(C.GROUPED_TYPES,function(b){return _.contains(b,a)})},DEFAULT_VALUE_TYPES:[C.SHORT_TYPE,C.YES_NO_TYPE,C.CODE_GENERATOR_TYPE,C.EXTENDED_OPTION_TYPE,C.COUNT_TYPE],DEPRECATED_TYPES:[C.NOTE_TYPE,C.CODE_TYPE,
C.TRANSPORTATION_TYPE],disabledTypes:function(a){var b=[].concat(C.DEPRECATED_TYPES);a.features.isTransportationEnabled||b.push(N.CustomField.NEW_TRANSPORTATION_TYPE);return b},enabledTypesForCompany:function(a){var b=g.get("db").slipstream("customFieldChoices");return b=_.filter(b,function(b){return!_.includes(C.disabledTypes(a),b[0])})},group:function(a){return a.isArchived?T("Archived"):a.isHidden?T("Deleted"):T("Active")}});var Ka=function(a){return _.some(a.payments,function(a){return a.type===
O.AFFILIATE_TYPE?!1:!a.isDeferred&&!a.isRefunded})},Sa=function(a){return _.some(a.payments,function(a){return a.type===O.AFFILIATE_TYPE?!1:!a.isDeferred&&!!a.refundCount})},z={AVAILABILITY_MANIFEST_TYPE:"availability-manifest",ORDER_CONFIRMATION_TYPE:"order-confirmation",ORDER_CANCELLATION_TYPE:"order-cancellation",ORDER_RECEIPT_TYPE:"order-receipt",ORDER_REFUNDED_TYPE:"order-refunded",ORDER_SHARE_TYPE:"order-share",BANK_ACCOUNT_CHANGE_TYPE:"bank-account-change",BOOKING_CANCELLATION_TYPE:"booking-cancellation",
BOOKING_CONFIRMATION_TYPE:"booking-confirmation",BOOKING_FOLLOW_UP_TYPE:"booking-follow-up",BOOKING_MESSAGE_TYPE:"booking-message",BOOKING_RECEIPT_TYPE:"booking-receipt",BOOKING_REBOOKED_TYPE:"booking-rebooked",BOOKING_REFUNDED_TYPE:"booking-refunded",BOOKING_REMINDER_TYPE:"booking-reminder",BOOKING_SHARE_TYPE:"booking-share",NOTIFICATION_FAILURE_TYPE:"notification-failure",CREW_CHANGE_TYPE:"crew-change",CREW_REMINDER_TYPE:"crew-reminder",DAILY_MANIFEST_TYPE:"daily-manifest",DISPUTE_TYPE:"dispute",
INVOICE_PAYMENT_REQUEST_TYPE:"invoice-payment-request",INVOICE_UPLOAD_STATUS_UPDATE_TYPE:"invoice-upload-status-update",STORED_VALUE_CARD_TYPE:"stored-value-card",FAILED_ONLINE_PAYMENTS_TYPE:"failed-online-payments",PROCESSOR_VERIFICATION_REQUIRED_TYPE:"processor-verification-required",displayType:function(a){a=a.replace("booking-","").replace("order-","");return _.capitalize(a)},notificationTypesForOrder:function(a){var b=[];a.contributingBookingCount&&b.push(z.ORDER_CONFIRMATION_TYPE);_.any(a.allBookings,
Ka)&&b.push(z.ORDER_RECEIPT_TYPE);_.any(a.allBookings,Sa)&&b.push(z.ORDER_REFUNDED_TYPE);_.any(a.allBookings,"isCancelled")&&b.push(z.ORDER_CANCELLATION_TYPE);return b},notificationTypesForBooking:function(a){if(a.rebookedTo)return[];var b=[];a.isCancelled?b.push(z.BOOKING_CANCELLATION_TYPE):a.rebookedFrom?(b.push(z.BOOKING_REBOOKED_TYPE),b.push(z.BOOKING_REMINDER_TYPE),b.push(z.BOOKING_CONFIRMATION_TYPE)):(b.push(z.BOOKING_CONFIRMATION_TYPE),b.push(z.BOOKING_REMINDER_TYPE));Ka(a)&&b.push(z.BOOKING_RECEIPT_TYPE);
Sa(a)&&b.push(z.BOOKING_REFUNDED_TYPE);b.push(z.BOOKING_MESSAGE_TYPE);b.push(z.BOOKING_FOLLOW_UP_TYPE);return b},isPreviewable:function(a){return _.contains([z.ORDER_CANCELLATION_TYPE,z.ORDER_CONFIRMATION_TYPE,z.BOOKING_CANCELLATION_TYPE,z.BOOKING_CONFIRMATION_TYPE,z.BOOKING_FOLLOW_UP_TYPE,z.BOOKING_MESSAGE_TYPE,z.BOOKING_REMINDER_TYPE,z.INVOICE_PAYMENT_REQUEST_TYPE,z.BOOKING_RECEIPT_TYPE],a)},isSubjectEditable:function(a){return _.contains([z.BOOKING_CANCELLATION_TYPE,z.BOOKING_FOLLOW_UP_TYPE,z.BOOKING_MESSAGE_TYPE,
z.BOOKING_REBOOKED_TYPE,z.BOOKING_RECEIPT_TYPE,z.BOOKING_REFUNDED_TYPE,z.ORDER_RECEIPT_TYPE,z.ORDER_REFUNDED_TYPE],a)},filterByType:function(a,b){return _.filter(a,function(a){return a.type===b})},bookingConfirmationNotifications:function(a){return z.filterByType(a,z.BOOKING_CONFIRMATION_TYPE)},bookingFollowUpNotifications:function(a){return z.filterByType(a,z.BOOKING_FOLLOW_UP_TYPE)},bookingRebookedNotifications:function(a){return z.filterByType(a,z.BOOKING_REBOOKED_TYPE)},bookingReminderNotifications:function(a){return z.filterByType(a,
z.BOOKING_REMINDER_TYPE)},invoicePaymentRequestNotifications:function(a){return z.filterByType(a,z.INVOICE_PAYMENT_REQUEST_TYPE)},UNKNOWN_STATUS:"unknown",PROCESSED_STATUS:"processed",DEFERRED_STATUS:"deferred",DELIVERED_STATUS:"delivered",USER_OPENED_STATUS:"open",USER_CLICKED_URL_STATUS:"click",BOUNCE_STATUS:"bounce",DROPPED_STATUS:"dropped",USER_REPORTED_SPAM_STATUS:"spamreport",USER_UNSUBSCRIBED_STATUS:"unsubscribe",isOpened:function(a){return _.contains([z.USER_OPENED_STATUS,z.USER_CLICKED_URL_STATUS,
z.USER_REPORTED_SPAM_STATUS,z.USER_UNSUBSCRIBED_STATUS],a)},isFailed:function(a){return _.contains([z.BOUNCE_STATUS,z.DROPPED_STATUS],a)},subjectForDisputeType:function(a){return interpolate(T("[Response Needed] New Dispute for Booking #%(bookingId)s (%(personName)s)"),{bookingId:a.pk,personName:a.contact.name})}},ua={US_COUNTRY_CODE:"US",INTERNATIONAL_ENABLED_COUNTRIES:q,INTERNATIONAL_DISABLED_COUNTRIES:[["US","USA"]],TEST_NUMBERS:"+15005550001 +15005550002 +15005550003 +15005550004 +15005550006 +15005550009".split(" "),
INTERNATIONAL_ENABLED_NUMBER_REGEX:/^\+?\d{5,15}$/,INTERNATIONAL_DISABLED_NUMBER_REGEX:/^(\+1|1)?\d{10}$/,INTERNATIONAL_ENABLED_NUMBER_MAX_LENGTH:16,INTERNATIONAL_DISABLED_NUMBER_MAX_LENGTH:12,isTestNumber:function(a){a="+"+g.get("phoneNumbers").digits(a);return _.contains(ua.TEST_NUMBERS,a)},isTestNumberAllowed:function(){return window.slipstream&&"production"!=window.slipstream.configuration&&window.slipstream.isTwilioTestAccountEnabled},isEligiblePhoneNumber:function(a,b,c){if(ua.isTestNumberAllowed()&&
ua.isTestNumber(a))return!0;var d=g.get("phoneNumbers");return!d.isPossiblyValid(a)?!1:b?"US"===b?d.parseUsPhoneNumber(a).isUsPhoneNumber:!c?(console.warn("SmsNotification.isEligiblePhoneNumber: company not provided"),!1):c.features.isInternationalSmsEnabled:d.parseUsPhoneNumber(a).isUsPhoneNumber?!0:!c?(console.warn("SmsNotification.isEligiblePhoneNumber: company not provided"),!1):c.features.isInternationalSmsEnabled},groupByStatus:function(a){var b=_.groupBy(a,"status"),c=[];_.forEach("delivered sent pending queued sending rejected undelivered failed invalid".split(" "),
function(a){var d=b[a];d&&d.length&&c.push({status:a,displayStatus:d[0].displayStatus,items:d})});return c}},H={AVAILABILITY_MANIFEST_TYPE:z.AVAILABILITY_MANIFEST_TYPE,BANK_ACCOUNT_CHANGE_TYPE:z.BANK_ACCOUNT_CHANGE_TYPE,BOOKING_CONFIRMATION_TYPE:z.BOOKING_CONFIRMATION_TYPE,BOOKING_CANCELLATION_TYPE:z.BOOKING_CANCELLATION_TYPE,NOTIFICATION_FAILURE_TYPE:z.NOTIFICATION_FAILURE_TYPE,CREW_CHANGE_TYPE:z.CREW_CHANGE_TYPE,CREW_REMINDER_TYPE:z.CREW_REMINDER_TYPE,DAILY_MANIFEST_TYPE:z.DAILY_MANIFEST_TYPE,DISPUTE_TYPE:z.DISPUTE_TYPE,
INVOICE_UPLOAD_STATUS_UPDATE_TYPE:z.INVOICE_UPLOAD_STATUS_UPDATE_TYPE,FAILED_ONLINE_PAYMENTS_TYPE:z.FAILED_ONLINE_PAYMENTS_TYPE,PROCESSOR_VERIFICATION_REQUIRED_TYPE:z.PROCESSOR_VERIFICATION_REQUIRED_TYPE,DIRECT_BOOKING_OPTION:"isDirect",ONLINE_BOOKING_OPTION:"isOnline",AFFILIATE_BOOKING_OPTION:"isAffiliate",REBOOKED_BOOKING_OPTION:"isRebooked",isTypeSupported:function(a,b){return b===H.BANK_ACCOUNT_CHANGE_TYPE||b===H.PROCESSOR_VERIFICATION_REQUIRED_TYPE?a.isAffiliate||a.isCharter:b===H.INVOICE_UPLOAD_STATUS_UPDATE_TYPE?
(a.isAffiliate||a.isCharter)&&a.isInvoicingEnabled:b===H.FAILED_ONLINE_PAYMENTS_TYPE?"eur"===a.processorCurrency:a.isCharter},isAnyTypeSupported:function(a){return _.some(H.TYPES,function(b){return H.isTypeSupported(a,b)})},isUserSubscribed:function(a,b,c){return _.some(a,function(a){return a.user===b&&a.type===c})}};H.TYPES=[H.AVAILABILITY_MANIFEST_TYPE,H.BANK_ACCOUNT_CHANGE_TYPE,H.BOOKING_CANCELLATION_TYPE,H.BOOKING_CONFIRMATION_TYPE,H.NOTIFICATION_FAILURE_TYPE,H.CREW_CHANGE_TYPE,H.CREW_REMINDER_TYPE,
H.DAILY_MANIFEST_TYPE,H.DISPUTE_TYPE,H.INVOICE_UPLOAD_STATUS_UPDATE_TYPE,H.FAILED_ONLINE_PAYMENTS_TYPE,H.PROCESSOR_VERIFICATION_REQUIRED_TYPE];H.ITEM_SUBSCRIPTION_TYPES=[H.AVAILABILITY_MANIFEST_TYPE,H.BOOKING_CONFIRMATION_TYPE,H.BOOKING_CANCELLATION_TYPE,H.NOTIFICATION_FAILURE_TYPE,H.CREW_CHANGE_TYPE,H.CREW_REMINDER_TYPE,H.DISPUTE_TYPE];H.HOURS_BEFORE_SUBSCRIPTION_TYPES=[H.AVAILABILITY_MANIFEST_TYPE,H.CREW_REMINDER_TYPE,H.DAILY_MANIFEST_TYPE];H.HOURS_BEFORE_DEFAULTS={};H.HOURS_BEFORE_DEFAULTS[H.AVAILABILITY_MANIFEST_TYPE]=
24;H.HOURS_BEFORE_DEFAULTS[H.CREW_REMINDER_TYPE]=24;H.HOURS_BEFORE_DEFAULTS[H.DAILY_MANIFEST_TYPE]=-6;H.CREW_AVAILABILITIES_ONLY_TYPES=[H.AVAILABILITY_MANIFEST_TYPE,H.BOOKING_CONFIRMATION_TYPE];H.BOOKING_OPTION_TYPES=[H.BOOKING_CANCELLATION_TYPE,H.BOOKING_CONFIRMATION_TYPE];H.BOOKING_OPTIONS=[H.DIRECT_BOOKING_OPTION,H.ONLINE_BOOKING_OPTION,H.AFFILIATE_BOOKING_OPTION,H.REBOOKED_BOOKING_OPTION];H.BOOKING_OPTIONS_BY_TYPE={};H.BOOKING_OPTIONS_BY_TYPE[H.BOOKING_CANCELLATION_TYPE]=[H.DIRECT_BOOKING_OPTION,
H.ONLINE_BOOKING_OPTION,H.AFFILIATE_BOOKING_OPTION];H.BOOKING_OPTIONS_BY_TYPE[H.BOOKING_CONFIRMATION_TYPE]=[H.DIRECT_BOOKING_OPTION,H.ONLINE_BOOKING_OPTION,H.AFFILIATE_BOOKING_OPTION,H.REBOOKED_BOOKING_OPTION];var Ta={verboseName:T("public headline"),verboseNamePlural:T("public headlines"),CUSTOM:{name:T("Custom"),pk:-1},NONE:{name:T("None"),pk:null},group:function(a){return a.pk&&a.pk!==Ta.CUSTOM.pk?T("Public Headlines"):void 0}},q={CUSTOM:{pk:-1,name:T("Custom"),type:"custom",displayType:T("Other")},
ORDER_CONFIRMATION_TYPE:z.ORDER_CONFIRMATION_TYPE,CANCELLATION_TYPE:z.BOOKING_CANCELLATION_TYPE,CONFIRMATION_TYPE:z.BOOKING_CONFIRMATION_TYPE,FOLLOW_UP_TYPE:z.BOOKING_FOLLOW_UP_TYPE,MESSAGE_TYPE:z.BOOKING_MESSAGE_TYPE,RECEIPT_TYPE:z.BOOKING_RECEIPT_TYPE,REBOOKED_TYPE:z.BOOKING_REBOOKED_TYPE,REFUNDED_TYPE:z.BOOKING_REFUNDED_TYPE,CUSTOM_TYPE:"custom",INVOICE_PAYMENT_REQUEST_TYPE:z.INVOICE_PAYMENT_REQUEST_TYPE,TYPES:[z.BOOKING_CANCELLATION_TYPE,z.BOOKING_CONFIRMATION_TYPE,z.BOOKING_FOLLOW_UP_TYPE,z.BOOKING_MESSAGE_TYPE,
z.BOOKING_RECEIPT_TYPE,z.BOOKING_REBOOKED_TYPE,z.BOOKING_REFUNDED_TYPE,z.INVOICE_PAYMENT_REQUEST_TYPE,"CUSTOM"],BOOKING_TYPES:[z.BOOKING_CANCELLATION_TYPE,z.BOOKING_CONFIRMATION_TYPE,z.BOOKING_FOLLOW_UP_TYPE,z.BOOKING_MESSAGE_TYPE,z.BOOKING_RECEIPT_TYPE,z.BOOKING_REBOOKED_TYPE,z.BOOKING_REFUNDED_TYPE],ORDER_TYPES:[z.BOOKING_CANCELLATION_TYPE,z.BOOKING_CONFIRMATION_TYPE,z.BOOKING_MESSAGE_TYPE,z.BOOKING_RECEIPT_TYPE,z.BOOKING_REFUNDED_TYPE],displayType:z.displayType},hb={OFFLINE_STATUS:"offline",ONLINE_STATUS:"online",
STRIPE_ERRORS:{reader_error:T("Device error."),canceled:T("Payment cancelled."),no_established_connection:T("Device not connected."),no_active_collect_payment_method_attempt:T("Unable to cancel payment."),cancelable_already_completed:T("Unable to cancel payment."),network_error:T("Error connecting to device."),card_declined:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),requires_payment_method:T("Card declined, try a different card (or try again with the same card)."),
requires_confirmation:T("Temporary connectivity problem, please try again."),already_connected:T("Connect to reader failed because the reader is already connected."),cancelable_already_canceled:T("Cancellation failed because the operation has already been cancelled."),discovery_too_many_readers:T("Please try again, or contact FareHarbor Support. (S-READERS)"),failed_fetch_connection_token:T("Could not fetch a connection token."),invalid_reader_version:T("Please update the EMV card reader."),network_timeout:T("Network timeout."),
no_active_read_reusable_card_attempt:T("An error occurred, please try again."),expired_card:T("Could not process payment because the card is cancelled or expired. Please try a different card."),insufficient_funds:T("Could not process payment because the account has insufficient funds. Please call the card issuer or try another card."),lost_card:T("Could not process payment because the card was reported lost or stolen. Please try a different card."),stolen_card:T("Could not process payment because the card was reported lost or stolen. Please try a different card."),
incorrect_pin:cT("PIN is short for Personal Identification Number, used when making card payments","Card declined due to invalid PIN."),call_issuer:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),withdrawal_count_limit_exceeded:T("Could not process payment because the account has insufficient funds. Please call the card issuer or try another card."),payment_intent_is_null:T("Request timed out, please try again.")},ADYEN_ERRORS:{Aborted:T("Payment cancelled."),
Busy:T("Device is currently in use."),Cancel:T("Payment cancelled."),DeviceOut:T("Device unexpectedly disconnected, or battery level is too low."),InvalidCard:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),NotAllowed:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),Refusal:T("Could not process payment because the card was declined. You may need to call the card issuer or try a different card."),
UnreachableHost:T("Network timeout, please try again"),WrongPIN:cT("PIN is short for Personal Identification Number, used when making card payments","Card declined due to invalid PIN.")},CONNECT_READER_ERROR_CODE:"reader_error",READER_IN_USE_ERROR_MESSAGE:"Reader is currently in use.",UNKNOWN_ERROR:T("Unknown error. Please refresh the page and try again."),CANCELLED_ERROR:T("Payment cancelled")},Z={PENDING_STATUS:"pending",DISPUTED_STATUS:"disputed",WON_STATUS:"won",LOST_STATUS:"lost",REFUNDED_STATUS:"refunded",
displayStatus:function(a){return _.capitalize(a)}};Z.OPEN_STATUSES=[Z.PENDING_STATUS,Z.DISPUTED_STATUS];Z.CLOSED_STATUSES=[Z.WON_STATUS,Z.LOST_STATUS,Z.REFUNDED_STATUS];Z.STATUSES=Z.OPEN_STATUSES.concat(Z.CLOSED_STATUSES);var O={CC_TYPE:"balanced-cc",LEGACY_CC_TYPE:"cc",IN_STORE_TYPE:"in-store",AFFILIATE_TYPE:"affiliate",STORED_VALUE_CARD_TYPE:"stored-value-card",PENDING_DISPUTE_STATUS:"pending",DISPUTED_DISPUTE_STATUS:"disputed",WON_DISPUTE_STATUS:"won",LOST_DISPUTE_STATUS:"lost",REFUNDED_DISPUTE_STATUS:"refunded",
INITIATED_PAYMENT_STATUS:"initiated",PENDING_PAYMENT_STATUS:"pending",FAILED_PAYMENT_STATUS:"failed",SUCCEEDED_PAYMENT_STATUS:"succeeded",IDEAL_PROCESSOR_BASED_TYPE:"ideal",SOFORT_PROCESSOR_BASED_TYPE:"sofort",BANCONTACT_PROCESSOR_BASED_TYPE:"bancontact",AFFILIATE_PAYMENT_TYPE:"affiliate",AFFILIATE_PAYMENT_DISPLAY_TEXT:T("Collected by affiliate"),SOFORT_COUNTRY_CHOICES:[["AT",T("Austria")],["BE",T("Belgium")],["DE",T("Germany")],["IT",T("Italy")],["NL",T("Netherlands")],["ES",T("Spain")]],isOpenDisputeStatus:function(a){return _.contains(O.OPEN_DISPUTE_STATUES,
a.disputeStatus)},isClosedDisputeStatus:function(a){return _.contains(O.CLOSED_DISPUTE_STATUSES,a.disputeStatus)},isDisputedAndNonRefundable:function(a){return a.disputeStatus===O.DISPUTED_DISPUTE_STATUS||a.disputeStatus===O.LOST_DISPUTE_STATUS||a.disputeStatus===O.REFUNDED_DISPUTE_STATUS},isPaymentInitiated:function(a){return a.status===O.INITIATED_PAYMENT_STATUS},isPaymentSucceeded:function(a){return a.status===O.SUCCEEDED_PAYMENT_STATUS},isPaymentPending:function(a){return a.status===O.PENDING_PAYMENT_STATUS},
isPaymentFailed:function(a){return a.status===O.FAILED_PAYMENT_STATUS},isEmv:function(a){return a.type===O.CC_TYPE&&a.metadata&&a.metadata.isEmv},isEmvSignatureRequired:function(a){return O.isEmv(a)&&a.metadata.isEmvSignatureRequired},isPartialRefundAllowed:function(a){return!a.receipt.gross?!1:!a.isProcessorBasedType||!a.isDisputed||a.disputeStatus===O.WON_DISPUTE_STATUS||a.disputeStatus===O.PENDING_DISPUTE_STATUS},POSTAL_CODE_VERIFIED_COUNTRIES:["US"],DEMO_CARD_NUMBERS:["4111111111111111","5105105105105100",
"341111111111111","4242424242424242"],isNotCardOnFileProcessorBasedType:function(a){return O.isProcessorBasedType(a)&&!a.isCardOnFile},isProcessorBasedType:function(a){return a.type===O.CC_TYPE||a.type===O.LEGACY_CC_TYPE},isDemoCardNumber:function(a){return _.contains(O.DEMO_CARD_NUMBERS,a)},isPostalCodeRequired:function(a,b){return _.contains(O.POSTAL_CODE_VERIFIED_COUNTRIES,a)?!0:"CA"===a&&b},isPostalCodeVerified:function(a){return _.contains(O.POSTAL_CODE_VERIFIED_COUNTRIES,a)},cardPayments:function(a,
b){var c={};_.forEach(a,function(a){if(!b&&a.type===O.CC_TYPE||b&&a.isProcessorBasedType){var d=a.processorBasedType+"-"+a.processorBasedIdentifier;c[d]||(c[d]=a)}});return _.values(c)},relatedCardPayments:function(a,b){return _.union.apply(null,_.map(a.contact.relatedBookings,function(a){return O.cardPayments(a.payments,b)}))},isGratuityEnabled:function(a){return _.any(_.map(a.bookings?a.bookings:[a.booking],"item"),{isGratuityEnabled:!0})},receiptFooters:function(a){return _.filter(_.map(O.items(a),
"receiptFooter"))},order:function(a){return a.bookings&&a.bookings.length?a.bookings[0].order:null},hasMultipleVisibleContributingBookings:function(a){return!a.bookings?!1:1<a.bookings.length+ +!!a.invisibleBookingCount},items:function(a){return a.booking?[a.booking.item]:F.uniqueItems(a.bookings)},sortByCreatedAt:function(a){return _.sortByOrder(a,function(a){return moment.isMoment(a.createdAt)?a.createdAt.unix():0},!1)},printablePayments:function(a){a=_.map(a,function(a){return a.aggregatedPayment&&
a.aggregatedPayment.isAggregated?a.aggregatedPayment:a});return _.filter(a,function(a){return!a.isDeferred&&a.type!==O.AFFILIATE_TYPE})},taxByType:function(a,b){if(!a.company.features.isTaxTypeBreakdownEnabled)return null;var c,d=b?"initialCosts":"costs";c=_.isArray(a.payments)?_.reduce(a.payments,function(a,b){return _.sumObjectValues(a,b[d].totalCost.taxByType)},{}):a[d].totalCost.taxByType;return ia.LEGACY_TAX_TYPE_PK in c?null:c},holds:function(a){return _.filter(a,function(a){return a.isHold||
a.holdReleasedOn})},nonHoldPayments:function(a){return _.reject(a,function(a){return a.isHold||a.holdReleasedOn})},isActiveHold:function(a){return a.isHold&&a.expiresAt.isAfter(moment())}};O.OPEN_DISPUTE_STATUES=[O.PENDING_DISPUTE_STATUS,O.DISPUTED_DISPUTE_STATUS];O.CLOSED_DISPUTE_STATUSES=[O.WON_DISPUTE_STATUS,O.LOST_DISPUTE_STATUS,O.REFUNDED_DISPUTE_STATUS];var ha={FAILED_TRANSFER_STATUS:"failed",SUCCEEDED_TRANSFER_STATUS:"succeeded",taxByType:function(a){if(!a.payment.company.features.isTaxTypeBreakdownEnabled)return null;
a=a.costs.totalCost.taxByType;return ia.LEGACY_TAX_TYPE_PK in a?null:a}},Q={NO_REPEAT:"none",WEEKLY_REPEAT:"weekly",MONTHLY_REPEAT:"monthly",ALL_DAY_PERIOD:"all-day",TIME_RANGE_PERIOD:"time-range",DAY_RANGE_PERIOD:"day-range",FAILED_STATUS:"failed",SUCCEEDED_STATUS:"succeeded",WEEK_DAYS_KEYS:"sunday monday tuesday wednesday thursday friday saturday".split(" "),WEEK_DAYS:{sunday:T("Sunday"),monday:T("Monday"),tuesday:T("Tuesday"),wednesday:T("Wednesday"),thursday:T("Thursday"),friday:T("Friday"),saturday:T("Saturday")},
WEEK_DAYS_SHORT:{sunday:cT("Abbreviation of Sunday","Su"),monday:cT("Abbreviation of Monday","M"),tuesday:cT("Abbreviation of Tuesday","T"),wednesday:cT("Abbreviation of Wednesday","W"),thursday:cT("Abbreviation of Thursday","Th"),friday:cT("Abbreviation of Friday","F"),saturday:cT("Abbreviation of Saturday","S")},weekDays:function(a){var b=_.clone(Q.WEEK_DAYS_KEYS);a.features.isSundayBased||b.push(b.shift());return b},weekDayShort:function(a){return Q.WEEK_DAYS_SHORT[a]},weekDaysDefaultModel:function(){var a=
{};_.forEach(Q.WEEK_DAYS_KEYS,function(b){a[b]=!0});return a},defaultRule:function(){var a={period:Q.TIME_RANGE_PERIOD,repeat:Q.NO_REPEAT,hours:"",time:"",startOn:null,endOn:null};_.extend(a,Q.weekDaysDefaultModel());return a}},W={ADJUSTMENT_TAG:"adjustment",FUND_BOOKING_FEE_PROCESSING_FEE_TAG:"fund-booking-fee",FUND_PROCESSING_FEE_TAG:"fund-processing-fee",OTHER_TAG:"other",PAYMENT_BOOKING_FEE_TAG:"payment-booking-fee",PAYMENT_BOOKING_FEE_PROCESSING_FEE_TAG:"payment-booking-fee-processing-fee",PAYMENT_GROSS_TAG:"payment-gross",
PAYMENT_PROCESSING_FEE_TAG:"payment-processing-fee",PAYOUT_TAG:"payout",REFUND_GROSS_TAG:"refund-gross",REFUND_BOOKING_FEE_TAG:"refund-booking-fee",REFUND_BOOKING_FEE_PROCESSING_FEE_TAG:"refund-booking-fee-processing-fee",REFUND_PROCESSING_FEE_TAG:"refund-processing-fee",TRANSFER_TAG:"transfer",UPLOAD_TAG:"upload",UNKNOWN_TAG:"",displayTag:function(a){return a===W.UNKNOWN_TAG?"Unknown":_.capitalize(a.split("-").join(" "))}};W.TAGS=[W.ADJUSTMENT_TAG,W.FUND_BOOKING_FEE_PROCESSING_FEE_TAG,W.FUND_PROCESSING_FEE_TAG,
W.OTHER_TAG,W.PAYMENT_BOOKING_FEE_TAG,W.PAYMENT_BOOKING_FEE_PROCESSING_FEE_TAG,W.PAYMENT_GROSS_TAG,W.PAYMENT_PROCESSING_FEE_TAG,W.PAYOUT_TAG,W.REFUND_GROSS_TAG,W.REFUND_BOOKING_FEE_TAG,W.REFUND_BOOKING_FEE_PROCESSING_FEE_TAG,W.REFUND_PROCESSING_FEE_TAG,W.TRANSFER_TAG,W.UPLOAD_TAG,W.UNKNOWN_TAG];var pa=function(a,b,c){if(!b)return!1;var d=g.get("db").slipstream(c);if(!d[a])return!1;a=d[a];return!_.isArray(a)?(console.warn("isCountryApplicable: invalid value",a,c),!1):_.contains(a,b)},d={getCurrencyChoices:d},
La={VALID_VALIDITY:"valid",INVALID_VALIDITY:"invalid",DATE_RANGE_FOR_AVAILABILITY_TYPE:"range-for-booking",DATE_RANGE_FOR_BOOKING_TYPE:"range-for-availability",displayDayPattern:function(a){if(!_.contains([La.DATE_RANGE_FOR_AVAILABILITY_TYPE,La.DATE_RANGE_FOR_BOOKING_TYPE],a.type))return"";a=a.dayPattern||[];return!a.length||a.length===Q.WEEK_DAYS_KEYS.length?"":_.map(a,function(a){return Q.WEEK_DAYS_SHORT[a]}).join(", ")}},ba={FLAT_FEE_RULE_TYPE:"flat",MAXIMUM_FEE_RULE_TYPE:"maximum",calculateFeeableForFee:function(a,
b){return _.roundHalfToEven(a/b)},calculateFeeableForRule:function(a,b,c){if(a.feeType!==s.PERCENTAGE_FEE_TYPE||!a.percentageFeeRate)return 0;a=a.percentageFeeRate;if(c.type===ba.FLAT_FEE_RULE_TYPE)return ba.calculateFeeableForFee(c.amount,a);if(c.type===ba.MAXIMUM_FEE_RULE_TYPE){var d=_.roundHalfToEven(b*a);c=c.amount;return d>c?ba.calculateFeeableForFee(c,a):b}console.warn("StoredValueCard.calculateFeeableForRule: invalid rule type",c.type);return 0},calculateFeeable:function(a,b){if(!a.features.isStoredValueCardBookingFeesEnabled)return 0;
var c=g.get("db").slipstream("storedValueCardFeeableRules");if(_.isUndefined(c))return console.warn("StoredValueCard.calculateFeeable: rules are not defined"),0;var d=a.primaryLocation,c=c[_.get(d,"country")];if(!c)return 0;if(c.isUnrestricted)return b;d=_.get(d,"province");if(_.contains(c.unrestrictedProvinces,d))return b;d=c.provinceRules[d];return!d?0:ba.calculateFeeableForRule(a,b,d)},NUMBER_REGEX:/^[a-zA-Z0-9\-_\#\%$]+$/,isNumberValid:function(a){return ba.NUMBER_REGEX.test(a)}},ra={INVOICE_TYPE:"invoice",
CREDIT_NOTE_TYPE:"credit note",AU_B2C_10_FLAVOR:"AU B2C 10",NZ_15_FLAVOR:"NZ 15",CA_5_FLAVOR:"CA 5",CA_13_FLAVOR:"CA 13",CA_15_FLAVOR:"CA 15",NL_21_FLAVOR:"NL 21",EU_0_FLAVOR:"EU 0",OTHER_0_FLAVOR:"OTHER 0",AUS_TAX_RATE:"10%",NL_TAX_RATE:"21%",NZ_TAX_RATE:"15%",CA_5_TAX_RATE:"5%",CA_13_TAX_RATE:"13%",CA_15_TAX_RATE:"15%",CA_PROVINCES:"AB BC MB NB NL NS NT NU ON PE SK YT".split(" "),statementIdentifier:function(a,b){var c="FHXXX"+("0000000000"+a).slice(-10);return c=b===ra.INVOICE_TYPE?"I"+c:"C"+c}},
la={MIN_QR_CODE_SIZE:1,MAX_QR_CODE_SIZE:1.3,STANDARD:{name:"Standard",settings:{isCompanyInformationIncluded:!0,isRotated:!1,len:5.5,height:2,marginTop:0.125,marginRight:0.125,marginBottom:0.125,marginLeft:0.125,hasLeadingStub:!0,leadingStubLength:1,leadingStubMarginTop:0.125,leadingStubMarginBottom:0.125,hasTrailingStub:!1,trailingStubLength:1,trailingStubMarginTop:0.125,trailingStubMarginBottom:0.125,hasCustomFields:!1,hasStubCustomFields:!1}},BLANK:{name:"",settings:{isCompanyInformationIncluded:!0,
isRotated:!1,len:5.5,height:2,marginTop:0.125,marginRight:0.125,marginBottom:0.125,marginLeft:0.125,hasLeadingStub:!0,leadingStubLength:1,leadingStubMarginTop:0.125,leadingStubMarginBottom:0.125,hasTrailingStub:!1,trailingStubLength:1,trailingStubMarginTop:0.125,trailingStubMarginBottom:0.125,hasCustomFields:!1,hasStubCustomFields:!1}},mainLeft:function(a){var b=a.settings.marginLeft;a.settings.hasTrailingStub&&(b+=a.settings.trailingStubLength);return b},mainRight:function(a){var b=a.settings.marginRight;
a.settings.hasLeadingStub&&(b+=a.settings.leadingStubLength);return b},qrCodeSize:function(a){a=a.settings.height-a.settings.marginTop-a.settings.marginBottom;a<la.MIN_QR_CODE_SIZE&&(a=la.MIN_QR_CODE_SIZE);a>la.MAX_QR_CODE_SIZE&&(a=la.MAX_QR_CODE_SIZE);return a},BOCA_PRINT_FORMAT:"boca",RECEIPT_PRINT_FORMAT:"receipt"},wa={ADMIN_ONLY_TYPE:"admin",ADMIN_ONLY_TYPES:"admin admin-charge-disputed admin-dispute-closed duplicated-x-companies duplicated-x-companies-single generated-report ran-report rejected-sms updated-sms-notification-status card-error processor-webhook-error transferred-payment was-transferred-payment webhook-request-failed webhook-request-succeeded".split(" "),
CHANGED_TYPES:["changed","changed-company-admin-notes","changed-booking-note","changed-customer-checkin-status"],isAdminOnly:function(a){return _.contains(wa.ADMIN_ONLY_TYPES,a.type)},isChangedType:function(a){return _.contains(wa.CHANGED_TYPES,a)},objectUrl:function(a){var b;a.object&&(b="created"===a.type&&a.object&&a.object.cls===N.Company.cls&&a.context&&a.context.instance?a.context.instance.$url():a.object.cls===N.Item.cls&&"created-availabilities"===a.type?N.Item.calendarUrl(a.object):a.object.$url());
b||(b=a.company.$url());return b},_changesByFieldName:{},changesByFieldName:function(a){var b=wa._changesByFieldName[a.uri];if(b)return b;b={};_.forEach(a.context.changes,function(a){b[k.camelKey(a.field)]=a});return wa._changesByFieldName[a.uri]=b}},L={NO_CUSTOM_TAX:"no",ONLY_TAXED_CUSTOM_TAX:"only-taxed",ALL_CUSTOM_TAX:"all",ALWAYS_CUSTOM_TAX:"always",INHERIT_TAX_INCLUSION:"inherit",INCLUDED_TAX_INCLUSION:"included",NOT_INCLUDED_TAX_INCLUSION:"not-included",INHERIT_PRICE_TYPE:"inherit",CHANGE_PRICE_TYPE:"change",
INHERIT_SHEET_RATE_TYPE:"inherit",CHANGE_SHEET_RATE_TYPE:"change",OFFSET_MODIFIER_KIND:"offset",PERCENTAGE_MODIFIER_KIND:"percentage",ADJUST_MODIFIER_TYPE:"adjust",SET_MODIFIER_TYPE:"set",NONE_MODIFIER_TYPE:"none",INHERIT_IS_TAXABLE:"",INHERIT_IS_TAXABLE_LABEL:T("Inherit"),ON_IS_TAXABLE:!0,ON_IS_TAXABLE_LABEL:T("On"),OFF_IS_TAXABLE:!1,OFF_IS_TAXABLE_LABEL:T("Off"),displayTaxInclusion:function(a){var b={};b[L.INHERIT_TAX_INCLUSION]=T("Inherit");b[L.INCLUDED_TAX_INCLUSION]=T("Tax included");b[L.NOT_INCLUDED_TAX_INCLUSION]=
T("Tax not included");return b[a]},displayCustomTax:function(a){var b={};b[L.NO_CUSTOM_TAX]=T("Standard tax");b[L.ONLY_TAXED_CUSTOM_TAX]=T("Custom tax");b[L.ALL_CUSTOM_TAX]=T("Custom tax (include untaxed)");b[L.ALWAYS_CUSTOM_TAX]=T("Custom tax (include untaxed, even on untaxed sheets)");return b[a]||b[L.NO_CUSTOM_TAX]},isInheritTaxability:function(a){return a.isTaxable!==L.OFF_IS_TAXABLE&&a.isTaxable!==L.ON_IS_TAXABLE&&!_.any(a.taxTypes,_.isBoolean)},isCustomTaxAllowed:function(a,b){return b.features.isCustomTaxEnabled&&
!b.features.isAggregateTaxEnabled&&a.modifierType!==L.NONE_MODIFIER_TYPE},isTaxInclusionAllowed:function(a,b){return b.features.isTaxInclusionEnabled&&a.modifierType!==L.NONE_MODIFIER_TYPE&&a.customTax===L.NO_CUSTOM_TAX&&a.modifierKind!==L.PERCENTAGE_MODIFIER_KIND},displayTaxable:function(a){return a===L.ON_IS_TAXABLE?L.ON_IS_TAXABLE_LABEL:a===L.OFF_IS_TAXABLE?L.OFF_IS_TAXABLE_LABEL:L.INHERIT_IS_TAXABLE_LABEL},isAggregateTaxableObject:function(a){return _.contains([u.cls,K.cls,s.cls],a.cls)},isTaxTypesAllowed:function(a,
b,c){return a.isTaxable===L.OFF_IS_TAXABLE||a.isTaxable===L.INHERIT_IS_TAXABLE&&b.cls!==K.cls?!1:!c.company.features.isAggregateTaxEnabled||L.isAggregateTaxableObject(b)},showOffset:function(a,b){return a.price.customTax!==L.NO_CUSTOM_TAX||a.price.modifierType===L.NONE_MODIFIER_TYPE?!1:b&&_.isNumber(b.offset)?!0:a.price.modifierKind===L.OFFSET_MODIFIER_KIND&&(!!a.price.offset||a.price.modifierType===L.SET_MODIFIER_TYPE)},showRate:function(a,b){return a.price.customTax!==L.NO_CUSTOM_TAX||a.price.modifierType===
L.NONE_MODIFIER_TYPE?!1:b&&_.isNumber(b.rate)?!0:a.price.modifierKind===L.PERCENTAGE_MODIFIER_KIND&&(!!a.price.rate||a.price.modifierType===L.SET_MODIFIER_TYPE)},effectiveOffset:function(a,b){if(a.price.modifierType===L.NONE_MODIFIER_TYPE)return 0;b=_.isUndefined(b)?1:b;return _.roundHalfToEven(a.price.offset*a.sheetRate.sheetRate*b)},effectiveRate:function(a,b){if(a.price.modifierType===L.NONE_MODIFIER_TYPE)return 0;b=_.isUndefined(b)?1:b;return a.price.rate*b},modifierKindChoices:function(a){var b,
c=g.get("db").slipstream("currencies");if(c){var d=_.resolveCurrency(a);if(c=c[d])b=c.symbol}b||(console.warn("modifierKindChoices: unable to determine currency symbol",a),b="$");return[[L.PERCENTAGE_MODIFIER_KIND,"%"],[L.OFFSET_MODIFIER_KIND,b]]},isTaxIncluded:function(a){return a.price.taxInclusion===N.PriceLine.INCLUDED_TAX_INCLUSION&&a.taxes.taxability!==N.PriceSheet.NONE_TAXABILITY&&a.price.customTax===N.PriceLine.NO_CUSTOM_TAX&&a.price.modifierKind!==N.PriceLine.PERCENTAGE_MODIFIER_KIND},isCompanyBaseLine:function(a,
b){return b.isBase&&a.cls===s.cls},effectiveTaxTypes:function(a){return _.unique(_.append(_.keys(a.taxes.ratesByType),_.keys(a.taxes.offsetsByType)))},adjustedPriceFromModel:function(a,b,c){b&&(b+="-");var d=b+ea.ADJUSTED_PRICE_KEY_PREFIX;b=a[d+(c?"invoiceRate":"rate")];a=a[d+(c?"invoiceOffset":"offset")];return!_.isNumber(b)&&!_.isNumber(a)?null:{rate:da.sheetRateFromModel(b),offset:a,modifierKind:_.isNumber(b)?L.PERCENTAGE_MODIFIER_KIND:L.OFFSET_MODIFIER_KIND}},extendModelWithAdjustedPrice:function(a,
b,c){b&&_.forEach(["offset","rate","invoiceOffset","invoiceRate"],function(d){var e=b[d];if(_.isNumber(e)){if("rate"===d||"invoiceRate"===d)e=da.sheetRateToModel(e);a[(c?c+"-":"")+ea.ADJUSTED_PRICE_KEY_PREFIX+d]=e}})},adjustPrice:function(a,b){if(!b||!_.isNumber(b.rate)&&!_.isNumber(b.offset))return a;var c=_.clone(a);c.price=_.clone(a.price);c.price.rate=b.rate;c.price.offset=b.offset;c.price.modifierKind=b.modifierKind;return c}};L.IS_TAXABLE_CHOICES=[{label:L.INHERIT_IS_TAXABLE_LABEL,value:L.INHERIT_IS_TAXABLE},
{label:L.ON_IS_TAXABLE_LABEL,value:L.ON_IS_TAXABLE},{label:L.OFF_IS_TAXABLE_LABEL,value:L.OFF_IS_TAXABLE}];L.isTaxableChoices=function(a,b){return L.isCompanyBaseLine(a,b)?_.slice(L.IS_TAXABLE_CHOICES,1):L.IS_TAXABLE_CHOICES};var ma=_.property("isOnline"),Xa=_.property("isBase"),kb=_.property("isTotalBase"),lb=_.property("isInvoiceBase"),Ma=function(a){return!a.isBase&&!a.isTotalBase&&!a.isInvoiceBase},da={NONE_TAXABILITY:"none",PRO_RATE_TAXABILITY:"pro-rate",FULL_TAXABILITY:"full",OFFSET_MODIFIER_KIND:"offset",
PERCENTAGE_MODIFIER_KIND:"percentage",ADJUST_MODIFIER_TYPE:"adjust",SET_MODIFIER_TYPE:"set",baseSheet:function(a){return _.find(a,Xa)},nonBaseSheets:function(a){return _.filter(a,Ma)},sheetRateToModel:function(a){return _.roundHalfToEven(100*a,7)},sheetRateFromModel:function(a){return!_.isNumber(a)?a:a/100},isInvoiceSheet:function(a){return a.cls===N.InvoiceSheet.cls},taxable:function(a){if(a.price.modifierType===L.NONE_MODIFIER_TYPE)return 0;var b=a.taxes.taxability;if(b===da.NONE_TAXABILITY)return 0;
if(b===da.PRO_RATE_TAXABILITY)return L.effectiveOffset(a);if(b===da.FULL_TAXABILITY)return a.price.offset;console.warn("invalid taxability",b);return 0},isNonBase:Ma,dropdownLabel:function(a){var b=a.displayName;a.cls.endsWith("Schedule")&&(b+=" "+T("(schedule)"));a.isArchived&&(b+=" "+T("(archived)"));return b},displayName:function(a){return a.displayName+(a.isArchived?" "+T("(archived)"):"")}};L.NONE_PRICING={visibility:{isVisible:!0,isHiddenWhenBooking:!1,isHiddenOnReceipts:!1,isRequired:!1},price:{modifierType:L.NONE_MODIFIER_TYPE,
customTax:L.NO_CUSTOM_TAX},taxes:{taxability:da.PRO_RATE_TAXABILITY},sheetRate:{sheetRate:1}};var Ya=_.extend({baseSheet:da.baseSheet,totalBaseSheet:function(a){return _.find(a,kb)},nonBaseSheets:da.nonBaseSheets,onlineSheets:function(a){return _.filter(a,ma)},displaySheetRate:function(a){return a-1},fromDisplaySheetRate:function(a){return a+1},isOnlineDefault:function(a){return!a||!a.pk?!1:a==a.company.defaultOnlineTotalSheet||a.company.defaultOnlineTotalSchedule&&a==_.last(a.company.defaultOnlineTotalSchedule.entries).sheet}},
da),mb=_.extend({INHERIT_VISIBILITY:"inherit",VISIBLE_VISIBILITY:"visible",HIDDEN_VISIBILITY:"hidden"},L),na=_.extend({AFFILIATE_RELATIONSHIP:"affiliate",CHARTER_RELATIONSHIP:"charter",invoiceBaseSheet:function(a){return _.find(a,lb)},nonBaseSheets:da.nonBaseSheets,displaySheetRate:function(a,b){if(b===na.CHARTER_RELATIONSHIP)return 1-a;if(b===na.AFFILIATE_RELATIONSHIP)return a},fromDisplaySheetRate:function(a,b){if(b===na.CHARTER_RELATIONSHIP)return 1-a;if(b===na.AFFILIATE_RELATIONSHIP)return a},
displayRelationship:function(a){return a===na.CHARTER_RELATIONSHIP?"reseller":a===na.AFFILIATE_RELATIONSHIP?"referral":"none"}},da),nb=_.extend({},L),Za={isOnlineFallback:function(a){return!!_.get(_.last(a.entries).sheet,"isOnline",!1)},verboseName:T("schedule"),verboseNamePlural:T("schedules")},ob={verboseName:T("schedule"),verboseNamePlural:T("schedules")},$a={isFallbackEntry:function(a){return a.rules[0]&&a.rules[0].type===ja.FALLBACK},hasFallbackEntry:function(a){return(a=_.last(a))&&$a.isFallbackEntry(a)}},
ja={groupRules:function(a,b){var c={};_.forEach(ja.RULE_TYPES,function(a){c[a]=[]});_.forEach(a,function(a){c[a.type].push(a)});b&&this.sortDayOfWeekType(c,b);return c},sortDayOfWeekType:function(a,b){var c=Q.weekDays(b);_.forEach(a,function(b,d){_.contains(ja.DAY_OF_WEEK_TYPES,d)&&(a[d]=_.sortBy(b,function(a){return c.indexOf(a.dayPattern[0])}))})},displayType:function(a){return ja.TYPE_CHOICES_MAP[a.type]},isDateType:function(a){return _.contains(ja.DATE_TYPES,a.type)},isDayOfWeekType:function(a){return _.contains(ja.DAY_OF_WEEK_TYPES,
a.type)},isHourType:function(a){return _.contains(ja.HOUR_TYPES,a.type)},combinedDayPattern:function(a){var b=_.flatten(_.pluck(a,"dayPattern")),c=[];_.forEach(Q.WEEK_DAYS_KEYS,function(a){_.contains(b,a)&&c.push(Q.weekDayShort(a))});return c}},ea={ADJUSTED_PRICE_KEY_PREFIX:"adjustedPrice-",aggregationKey:function(a){return a.customFieldInstance.customField.type===N.CustomField.TRANSPORTATION_TYPE?a.transportationOption&&!a.transportationOption.isSelfTransportation?a.transportationOption.value:T("Self transportation"):
a.value?a.value.toString():""},displayValue:function(a){return a.customFieldInstance.customField.type===N.CustomField.COUNT_TYPE&&!a.value?"":a.displayValue},aggregationDisplayValue:function(a){return _.contains([N.CustomField.TRANSPORTATION_TYPE,N.CustomField.COUNT_TYPE],a.customFieldInstance.customField.type)?"":a.displayValue},aggregationCount:function(a){return a.customFieldInstance.customField.type===N.CustomField.TRANSPORTATION_TYPE?a.transportationOption&&!a.transportationOption.isSelfTransportation?
a.booking.customerCount:0:a.customFieldInstance.customField.type===N.CustomField.COUNT_TYPE?a.value:a.value?1:0},annotate:function(a,b,d){var e=c("time"),f={},h=[],g=[],k=function(a,b){g.push(a);var c=ea.aggregationKey(a),e=ea.aggregationCount(a),k=N.CustomField.isAggregatable(a.customFieldInstance.customField),l=a.customer?a.customer.pk:a.pk;b||!k||d?(k=ea.displayValue(a),""!==k&&h.push({customFieldValue:a,key:c,count:e,displayValue:k,transportationOption:a.transportationOption||null,isAggregated:!1,
sortableIndex:l})):(l=f[c]||{customFieldValue:a,key:c,count:0,displayValue:ea.aggregationDisplayValue(a),transportationOption:null,isAggregated:!0,sortableIndex:l},e&&(l.count+=e,f[c]=l))};_.forEach(b.customers,function(b){_.forEach(b.customFieldValues,function(b){b.customFieldInstance.customField===a&&k(b,!1)})});_.forEach(b.customFieldValues,function(c){c.customFieldInstance.customField===a&&k(c,b.cls===F.cls)});var l=_.append(_.values(f),h),l=_.sortBy(l,"sortableIndex");_.forEach(l,function(a){var b=
"",b=a.customFieldValue,c=b.transportationOption;if(c){var d=b.booking.availability.startAt.clone();d.subtract(c.minutesBeforeStart,"minutes");b=interpolate(T("%(time)s at %(name)s"),{time:e(d),name:b.displayValue})}else b=a.isAggregated&&a.count?a.displayValue?a.count.toString()+" "+a.displayValue:a.count.toString():a.displayValue;a.renderedValue=b});return{annotatedCustomFieldValues:l,customFieldValues:g}},isCustomerLevelWherewolfCustomField:function(a){return a.customFieldInstance.customField.type===
C.WHEREWOLF_TYPE&&a.cls===sa.cls}},ia={LEGACY_TAX_TYPE_PK:-1,RATE_TYPE:"rate",OFFSET_TYPE:"offset",displayName:function(a){return interpolate(T("%(name)s (%(rate)s)"),{name:c("name")(a),rate:ia.displayRate(a)})},displayRate:function(a){if(a.type===ia.RATE_TYPE)return c("percentage")(a.rate,"hideplus");if(a.type===ia.OFFSET_TYPE)return c("amount")(a.offset,a.company)}},va={},sa={hasWaiverType:function(a){return _.any(a,function(a){return N.CustomField.isWaiverType(a.customFieldInstance.customField)})}},
pb=function(){var a={GOOGLE_ANALYTICS_TYPE:"google-analytics",FACEBOOK_TYPE:"facebook",ADROLL_TYPE:"adroll",OPTIMIZELY_TYPE:"optimizely",CUSTOM_CODE_TYPE:"custom-code",IDENTIFIERS_BY_TYPE:{},IDENTIFIER_LABELS:{googleAnalyticsUa:"UA Code",facebookPixel:"Pixel ID",facebookAccessToken:"Access Token",facebookEventSourceURL:"Facebook Event Source URL",adrollAdvertiser:"Advertiser ID",adrollPixel:"Pixel ID",optimizelyAccount:"Account ID",optimizelyProject:"Project ID",optimizelyEventKey:"Goal Event",optimizelyGoals:"Goal ID(s)",
customCode:"Code",customIdentifiers:"Identifiers"},needsCrossDomainField:function(b){return _.includes([a.GOOGLE_ANALYTICS_TYPE,a.FACEBOOK_TYPE,a.ADROLL_TYPE,a.OPTIMIZELY_TYPE],b)},displayIdentifier:function(b){return a.IDENTIFIER_LABELS[b]}},b=a.IDENTIFIERS_BY_TYPE;b[a.GOOGLE_ANALYTICS_TYPE]=["googleAnalyticsUa"];b[a.FACEBOOK_TYPE]=["facebookPixel","facebookAccessToken","facebookEventSourceURL"];b[a.ADROLL_TYPE]=["adrollAdvertiser","adrollPixel"];b[a.OPTIMIZELY_TYPE]=["optimizelyAccount","optimizelyProject",
"optimizelyEventKey","optimizelyGoals"];b[a.CUSTOM_CODE_TYPE]=["customCode","customIdentifiers"];return a}(),ab=function(a,b){if(!a)return console.warn("supported language: invalid empty language code"),"";var c=a.split("-")[0];return(c=ka.DISPLAY_LANGUAGES[a]||ka.DISPLAY_LANGUAGES[c])?c[b]:""},ka={isRecognizedLanguage:function(a){return _.contains(ka.LANGUAGE_CODES_SORTED,a)},rootLanguage:function(a){return a.split("-")[0]},display:function(a){return ab(a,"name")},displayLocal:function(a){return ab(a,
"nameLocal")},shareRootLanguage:function(a,b){return a&&b&&ka.rootLanguage(a)===ka.rootLanguage(b)},SCROLL_TO_LANGUAGE_PARAM:"highlight-language"},qa={BEFORE_MIDNIGHT_CUTOFF_KIND:"before-midnight",BEFORE_START_CUTOFF_KIND:"before-start",RESTRICTION_FIELDS:"minimumInitialPartySize minimumSubsequentPartySize maximumInitialPartySize maximumSubsequentPartySize isBookableEverByPhone soldOutText cutoffUnreachedKind cutoffUnreachedHours isCutoffUnreachedCallToBook cutoffReachedKind cutoffReachedHours isCutoffReachedCallToBook autoOpenHours autoOpenKind".split(" "),
DEFAULT_AUTO_OPEN_HOURS:720,cutoffStart:function(a,b,c){if(a===qa.BEFORE_START_CUTOFF_KIND)return c.clone().subtract(b,"hours");if(a===qa.BEFORE_MIDNIGHT_CUTOFF_KIND)return c.clone().startOf("day").subtract(b,"hours");console.error("BookingRestriction.cutoffStart: invalid kind "+a)}},N={Order:X,Contact:R,Booking:F,Customer:S,LineItem:{},ItemGroup:{},Availability:u,Company:s,User:{OWNER_TYPE:"owner",ADMIN_TYPE:"admin",EMPLOYEE_TYPE:"employee",ONLINE_TYPE:"online",ICS_RESELLER_KEY_NAME:"ICS Calendar",
ACTIVE_PASSWORD_STATUS:"active",EXPIRED_PASSWORD_STATUS:"expired",INVALIDATED_PASSWORD_STATUS:"invalidated",TEMPORARY_PASSWORD_STATUS:"temporary",showNag:function(a,b,c){if(!a)return console.error("User.showNag: No user."),!1;a=a.nags[b];return!a||!c&&a.isDismissed?!1:!0},hasAnyNags:function(a){return!_.all(a.nags,"isDismissed")},getActive:function(a){return _.filter(a,"isInactive",!1)},sortActiveFirst:function(a){return _.sortBy(a,function(a){return[a.isInactive,a.name.toLowerCase()]})},displayName:function(a){return a.isInactive?
a.name+" "+T("(deactivated)"):a.name}},TagGroup:{},Tag:{},TagInstance:{},Item:K,FlowNode:x,CustomFieldInstanceGroup:{dropdownLabel:function(a,b){var c=a.name;a===b&&!a.item&&(c+=" "+T("(shared)"));a.isArchived&&(c+=" "+T("(archived)"));return c}},CustomFieldInstanceCondition:v,CustomFieldInstance:J,CustomerType:{includeArchivedAndHiddenOnRequirement:function(a,b){if(!b)return a;var c=_.pluck(b.customerTypeRequirements,"customerType");return _.union(_.reject(a,"isHidden"),c)},suffix:function(a){return a.isHidden?
T("(deleted)"):a.isArchived?T("(archived)"):""}},CustomerPrototype:{includeArchivedAndHiddenOnRequirement:function(a,b){if(!b)return a;var c=_.pluck(b.customerPrototypeRequirements,"customerPrototype");return _.union(_.reject(a,"isHidden"),c)},name:function(a){return a.displayName},customerTypeSuffix:function(a){var b=a.customerType;if(b.isHidden)return T("(deleted)");var c=a.isExclusive?T("exclusive"):"",d=b.isArchived?T("archived"):"",e="";a.name&&(e=b.shortName||b.singular);(a=_.compact([e,c,d]).join(", "))&&
(a="("+a+")");return a},group:function(a){return a.customerType.isArchived?T("Archived"):a.isHidden?T("Deleted"):T("Active")}},CustomerTypeRate:E,CheckinStatus:M,Image:{CAROUSEL_GALLERY:"carousel"},CustomField:C,ExtendedOption:{},TransportationOption:{},ConnectedCampaign:{},GeneratingCampaign:{},CannedMessage:q,AvailabilityHeadline:Ta,Notification:z,SmsNotification:ua,ReviewExpressNotification:{},Subscription:H,Payment:O,Dispute:Z,InStorePaymentType:{isUsable:function(a,b){var c=b.isCharter&&a.isVisibleWhenCollectedByCharter;
return b.isAffiliate&&a.isVisibleWhenCollectedByAffiliate||c},isVisibleWhenCollectedByCharter:function(a){return _.filter(a,"isVisibleWhenCollectedByCharter")},isVisibleWhenCollectedByAffiliate:function(a){return _.filter(a,"isVisibleWhenCollectedByAffiliate")}},EmvDevice:hb,Refund:ha,Receipt:{ALL_PAYMENT_RECEIPTS:"all",printedAt:function(){return moment()}},Rule:Q,Payout:{SUCCEEDED_STATUS:"succeeded",PAID_STATUS:"paid",PENDING_STATUS:"pending",FAILED_STATUS:"failed",PROCESSED_STATUS:"processed"},
Fund:{},Transfer:{},Upload:{SUCCEEDED_STATUS:"succeeded",PENDING_STATUS:"pending",FAILED_STATUS:"failed"},Transaction:W,Account:{BANK_TYPE:"bank",DEPOSIT_TYPE:"deposit",ESCROW_TYPE:"escrow"},Adjustment:d,Campaign:{},CampaignValidityRule:La,Code:{},StoredValueType:{},StoredValueCard:ba,StoredValueAdjustment:{},PaymentProcessingDocument:ra,TicketLayout:la,CustomCalendar:{},CustomManifest:{},CustomReport:{QUERY_PARAM:"saved",QUERY_PARAM_KEY:"pk"},SuggestedReport:{QUERY_PARAM:"suggested",QUERY_PARAM_KEY:"slug",
DEFAULT_SLUG:"default"},Activity:wa,Block:{},Agent:V,Desk:U,Affiliation:fa,CrewMember:{},Role:{},Hotel:{},Lodging:{RELATED_FEATURE_FLAG:"isTransportationEnabled"},PreferredPickup:{},Pickup:{RELATED_FEATURE_FLAG:"isTransportationEnabled"},Route:{RELATED_FEATURE_FLAG:"isTransportationEnabled"},Stop:{},Run:{},Report:D,Invoice:{PAID_STATUS:"paid",PENDING_STATUS:"pending",UNPAID_STATUS:"unpaid",OVERDUE_STATUS:"overdue",isInvoicedToCharter:function(a){return 0<a}},InvoiceEntry:{},Location:{RELATED_FEATURE_FLAG:"isLocationsEnabled"},
SupportedLanguage:ka,Translation:{displayNameForInstance:function(a){return a.name||a.displayName||a.title||a.unicode},fieldDisplayValue:function(a,b,c){a=_.camelCase(a.fieldName);return c?b[a][c]:b[a]},modelNameForUrl:function(a){return _.kebabCase(a)},modelNameFromUrl:function(a){return _.startCase(a).replace(/ /g,"")},fieldNameForUrl:function(a){return _.kebabCase(a)},fieldNameFromUrl:function(a){return _.snakeCase(a)}},Waiver:{RELATED_FEATURE_FLAG:"isSmartwaiverEnabled"},ConnectedWaiver:{},WaiverInstance:{isSignedWherewolfWaiver:function(a){return _.isEqual(a.waiverType,
"wherewolf")}},Group:{AFFILIATE_TYPE:"affiliate",COMPANY_TYPE:"company",PARTNER_TYPE:"partner"},GroupOverride:{companyLevelOverrides:function(a){return _.filter(a,function(a){return null===a.relatedUser})}},PriceSheet:da,PriceLine:L,TotalSheet:Ya,TotalLine:mb,InvoiceSheet:na,InvoiceLine:nb,TotalSchedule:Za,InvoiceSchedule:ob,ScheduleEntry:$a,TotalScheduleEntry:{},InvoiceScheduleEntry:{},ScheduleEntryRule:ja,TotalScheduleEntryRule:{},InvoiceScheduleEntryRule:{},TaxType:ia,BankAccount:{INDIVIDUAL_ACCOUNT_HOLDER_TYPE:"individual",
COMPANY_ACCOUNT_HOLDER_TYPE:"company",ROUTING_NUMBER_REGEX_BY_COUNTRY:{AU:/^[\d]{6}$/,CA:/^0?[\d]{5}-?[\d]{3}$/,GB:/^[\d]{2}-?[\d]{2}-?[\d]{2}$/,NZ:/^[\d]{6}$/,US:/^[\d]{9}$/},isIbanRequired:function(a,b){return pa(a,b,"processorIbanBankAccountCountries")},isRoutingNumberRequired:function(a,b){return!pa(a,b,"processorIgnoreRoutingNumberCountries")}},Ledger:{RELATED_FEATURE_FLAG:"isLedgersEnabled"},Card:{},CardAffiliation:{},CustomFieldValue:ea,BookingCustomFieldValue:va,CustomerCustomFieldValue:sa,
Resource:h,RequirementGroup:m,Requirement:G,CustomerPrototypeRequirement:{},CustomerTypeRequirement:{},ResourceRequirement:w,ResourceUse:B,ResourceOverride:{},SeatMap:n,SeatGroup:P,Seat:p,SeatAssignment:I,SeatZone:t,Calendar:b,ResellerCompany:{},ResellerCompanyMapping:{},ResellerItem:{RelatedLocationType:{RELATED_NO_ADMISSION:"RELATION_TYPE_RELATED_NO_ADMISSION",ADMISSION_TICKET:"RELATION_TYPE_ADMISSION_TICKET",SUPPLEMENTARY_ADDON:"RELATION_TYPE_SUPPLEMENTARY_ADDON"}},ResellerItemMapping:{},ResellerCustomerType:{},
ResellerCustomerTypeMapping:{},ResellerOption:{},ResellerOptionMapping:{},ResellerKey:{SEND_BOOKINGS_SCHEMA:"send_bookings",SEND_BOOKINGS_WITH_PAYMENTS_SCHEMA:"send_booking_with_payments"},ResellerApp:{},ResellerAppRequest:{PENDING_STATUS:"pending",CONNECTED_STATUS:"connected"},ResellerAppCompany:{},AnalyticsService:pb,CancellationPolicy:{},CancellationRule:{ALWAYS_TYPE:"always",HOURS_BEFORE_AVAILABILITY_START_TYPE:"hours-before-start",HOURS_BEFORE_AVAILABILITY_MIDNIGHT_TYPE:"hours-before-midnight",
HOURS_BEFORE_PSEUDO_TYPE:"hours-before"},BookingRestriction:qa},Na=_.keys(N);_.forEach(Na,function(a){N[a].cls=a});N.models=_.sortBy(_.values(N),"cls");N.inject=function(a){_.forEach(Na,function(b){a[b]=N[b]})};return N}]);m.run(["$filter","$rootScope","auth","db","emv","models","navigation","processors","urls",function(c,g,k,f,l,e,a,q,h){e.inject(g);g.nullModel={};g=f.slipstream("models.verboseNames");_.forEach(g,function(a,b){_.defaults(e[b],a)});e.Company._isFeeable=function(a){return!k.currentUser.isAuthenticated?
!0:!k.permissions.canBookWithNoFee(a)};e.Company._minimumBookingFee=function(a,b){return b?q.get(b).minimumBookingFee(a):a.minimumFee};e.Company._tieredFeeRate=function(a,b){var c=_.find(_.reversed(a.tieredFeeSchedule),function(a){return b>=a.cutoff});if(!c)throw Error("Company._tieredFeeRate: invalid tiered fee schedule");return c.rate};e.Company._minimumFee=function(a,b,c,d){return a<d?!a&&c?0:!a&&b?0:d:a};e.Company.bookingFee=function(a,b,c,d,f){if(!e.Company._isFeeable(a)||"no-fee"===a.feeType)return 0;
if("flat-fee"===a.feeType)return a.flatFee;var h;if("percentage-fee"===a.feeType)h=a.percentageFeeRate;else if("tiered-fee"===a.feeType)h=e.Company._tieredFeeRate(a,b);else throw Error("Company.bookingFee: invalid fee type "+a.feeType);b=_.roundHalfToEven(b*h);a=e.Company._minimumBookingFee(a,f);return b=e.Company._minimumFee(b,d,c,a)};e.Company.taxDisplayRate=function(a){return a.features.includedTaxRate?c("percentage")(a.features.includedTaxRate,!0):""};e.Rule.WEEK_DAYS_DISPLAY=_.map(e.Rule.WEEK_DAYS_KEYS,
function(a){return e.Rule.WEEK_DAYS[a]});e.Availability.manifestUrl=function(b){return a.compose(h.populate(h.dashboard.manifest.availabilities,{shortname:b.company.shortname,date:b.startAt?b.startAt.format("YYYY-MM-DD"):void 0}),{items:b.item.pk,availabilities:b.pk})};e.Run.manifestUrl=function(b){return a.compose(h.populate(h.dashboard.manifest.runs,{shortname:b.route.company.shortname,date:b.startAt?b.startAt.format("YYYY-MM-DD"):void 0}),{routes:b.route.pk})};e.Item.manifestUrl=function(b,c){return a.compose(h.populate(h.dashboard.manifest.availabilities,
{shortname:b.company.shortname,date:c}),{items:b.pk})};e.Resource.manifestUrl=function(b,c){return a.compose(h.populate(h.dashboard.manifest.resources,{shortname:b.company.shortname,date:c}),{resources:b.pk})};e.Booking.processorTypes=function(a){a=a||[];return _.filter(_.sortBy(_.uniq(_.pluck(a,"processorType"))))};e.Booking.statementText=function(a,b){var c=e.Booking.processorTypes(b);return _.map(c,function(b){b=q.get(b);return'"'+b.STATEMENT_TEXT_PREFIX+b.statementText(a)+'"'}).join(" or ")};
e.Booking.pendingStatementText=function(a){a=e.Booking.processorTypes([a]);return _.map(a,function(a){return'"'+q.get(a).PENDING_STATEMENT_TEXT+'"'}).join(" or ")};e.Payment.isDefaultProcessorBasedType=function(a){return a.type===e.Payment.CC_TYPE&&a.processorType===q.DEFAULT_PROCESSOR_TYPE};e.Payment.isLegacyProcessorBasedType=function(a){return e.Payment.isProcessorBasedType(a)&&_.contains(q.LEGACY_PROCESSOR_TYPES,a.processorType)};e.Payment.minimumChargeAmounts=function(a,b){var c=f.slipstream("processorMinimumChargeAmounts");
return _.get(c[b],a,c[b][q.DEFAULT_CURRENCY])};e.Payment.emvDetails=function(a){if(!e.Payment.isEmv(a))return[];var b=_.toTrueKeys("Date;Time;Amount;Description;Name;Address;Zip;City;Country;Contact;Additional Information;Account".split(";")),c=_.filter(a.metadata.emvDetails,function(a){return!b[a.key]});return q.get(a.processorType).filterEmvDetails(c)};g=function(a){return f.slipstream("processorIdealBankTypeChoices")[a]||[]};e.Payment.STRIPE_IDEAL_BANK_TYPE_CHOICES=g(q.STRIPE_PROCESSOR_TYPE);e.Payment.ADYEN_IDEAL_BANK_TYPE_CHOICES=
g(q.ADYEN_PROCESSOR_TYPE);var d=e.Report;d.MODELS={};d.MODELS[e.StoredValueCard.cls]={name:T("Gift Cards"),singular:T("Gift Card"),slug:"stored-value-cards",model:e.StoredValueCard,submodels:[]};d.MODELS[e.PaymentProcessingDocument.cls]={name:T("Payment Processing Documents"),singular:T("Payment Processing Document"),slug:"payment-processing-documents",model:e.PaymentProcessingDocument,submodels:[]};d.MODELS[e.Booking.cls]={name:T("Bookings"),singular:T("Booking"),slug:"bookings",model:e.Booking,
submodels:[]};d.MODELS[e.Customer.cls]={name:T("Customers"),singular:T("Customer"),slug:"customers",model:e.Customer,submodels:[e.Booking]};d.MODELS[e.LineItem.cls]={name:T("Expenses and Discounts"),singular:T("Expense and discount"),slug:"expenses-and-discounts",model:e.LineItem,submodels:[e.Booking]};d.MODELS[e.CustomFieldValue.cls]={name:T("Custom Field Answers"),singular:T("Custom field answer"),slug:"custom-field-answers",model:e.CustomFieldValue,submodels:[e.Customer,e.Booking]};d.MODELS[e.Payment.cls]=
{name:T("Sales"),singular:T("Sales"),slug:"payments-and-refunds",model:e.Payment,submodels:[e.Booking]};d.MODELS[e.ResourceUse.cls]={name:T("Resource Uses"),singular:T("Resource Use"),slug:"resource-uses",model:e.ResourceUse,submodels:[e.Customer,e.Booking]};d.ORDERED_MODELS=[e.Payment,e.Booking,e.Customer,e.CustomFieldValue,e.ResourceUse,e.LineItem,e.StoredValueCard,e.PaymentProcessingDocument];d.UNSOUND_AGGREGATES={Payment:[e.Booking],Booking:[],Customer:[e.Booking],CustomFieldValue:[e.Booking,
e.Customer],LineItem:[e.Booking],ResourceUse:[e.Booking,e.Customer]};d.advancedUrl=function(a,b){return h.populate(h.dashboard.reports.advanced.index,{shortname:a.shortname,modelSlug:d.MODELS[b].slug})};d.SWITCH_QUERY_PARAM_KEY="switch";d.advancedSwitchUrl=function(b,c){var e={};e[d.SWITCH_QUERY_PARAM_KEY]=!0;return a.compose(d.advancedUrl(b,c),e)};d.VALID_COLUMNS=f.slipstream("reports.validColumns");d.VALID_GROUPS=f.slipstream("reports.validGroups");d.VALID_FILTERS=f.slipstream("reports.validFilters");
d.PROHIBITED_GROUPS=f.slipstream("reports.prohibitedGroups");d.PROHIBITED_HIGHER_GROUPS=f.slipstream("reports.prohibitedHigherGroups");d.ALWAYS_UNSOUND_GROUPINGS=f.slipstream("reports.alwaysUnsoundGroupings");d.ALLOWED_DATE_TYPES=f.slipstream("reports.allowedDateTypes");d.DEFAULT_DATE_TYPES=f.slipstream("reports.defaultDateTypes");_.extend(d,f.slipstream("reports.allColumns"));_.extend(d,f.slipstream("reports.allGroups"));_.extend(d,f.slipstream("reports.allFilters"));_.extend(d,f.slipstream("reports.allDateTypes"));
_.extend(d,f.slipstream("reports.allDateRanges"));d.MODELS_BY_GROUP={};_.forEach(d.VALID_GROUPS,function(a,b){_.forEach(a,function(a){d.MODELS_BY_GROUP[a]=d.MODELS_BY_GROUP[a]||[];d.MODELS_BY_GROUP[a].push(e[b])})});e.ResourceOverride.collapseSeatOverrides=function(a){var b={};_.forEach(_.filter(a,"seat"),function(c){var d=c.startAt.format()+"-"+c.endAt.format()+"-"+c.resource.pk;b[d]=b[d]||[];b[d].push(c);_.ref.remove(a,c)});_.forEach(b,function(b){a.push({startAt:b[0].startAt,endAt:b[0].endAt,resource:b[0].resource,
seatCount:b.length})});return a};var b=e.ScheduleEntryRule;b.TYPE_CHOICES=f.slipstream("scheduleEntryRule.typeChoices");b.TYPE_CHOICES_MAP=_.reduce(b.TYPE_CHOICES,function(a,b){a[b[0]]=b[1];return a},{});b.typeChoicesForCompany=function(a){return!a.features.isDynamicPricingEnabled?_.filter(b.TYPE_CHOICES,function(a){return!_.contains(b.HOUR_TYPES,a[0])}):b.TYPE_CHOICES};b.FALLBACK="fallback";b.DATE_BASED_ON_BOOKING="booking";b.DATE_BASED_ON_AVAILABILITY="availability";b.DAY_OF_WEEK_BASED_ON_BOOKING=
"dow-booking";b.DAY_OF_WEEK_BASED_ON_AVAILABILITY="dow-availability";b.HOURS_BEFORE_AVAILABILITY_START="hours-bf-ava-start";b.HOURS_BEFORE_AVAILABILITY_MIDNIGHT="hours-bf-ava-mn";b.RULE_TYPES=[b.FALLBACK,b.DATE_BASED_ON_BOOKING,b.DATE_BASED_ON_AVAILABILITY,b.DAY_OF_WEEK_BASED_ON_BOOKING,b.DAY_OF_WEEK_BASED_ON_AVAILABILITY,b.HOURS_BEFORE_AVAILABILITY_START,b.HOURS_BEFORE_AVAILABILITY_MIDNIGHT];b.DATE_TYPES=[b.DATE_BASED_ON_BOOKING,b.DATE_BASED_ON_AVAILABILITY];b.DAY_OF_WEEK_TYPES=[b.DAY_OF_WEEK_BASED_ON_BOOKING,
b.DAY_OF_WEEK_BASED_ON_AVAILABILITY];b.HOUR_TYPES=[b.HOURS_BEFORE_AVAILABILITY_START,b.HOURS_BEFORE_AVAILABILITY_MIDNIGHT];e.ResourceUse.OPTIONS=f.slipstream("resourceUse.options");e.ResourceUse.OPTIONS_VALUES_KEYS_MAP=_.reduce(e.ResourceUse.OPTIONS,function(a,b){a[b.value]=b.key;return a},{});e.ResourceUse.OPTIONS_KEYS_DISPLAY_TEXT_MAP=_.reduce(e.ResourceUse.OPTIONS,function(a,b){a[b.key]=b.displayText;return a},{});e.ResourceUse.getUseSettings=function(a){var b;a.cls===e.ResourceRequirement.cls?
b=[String(a.isSkipCreation),String(a.isIgnoreResourceOveruse)].join("-"):a.cls===e.Resource.cls?b=[String(a.isSkipResourceUseCreation),String(a.isIgnoreOveruse)].join("-"):console.error("invalid object passed to ResourceUse.getUseSettings");return e.ResourceUse.OPTIONS_VALUES_KEYS_MAP[b]};e.ResourceUse.getDisplayText=function(a){a=e.ResourceUse.getUseSettings(a);return e.ResourceUse.OPTIONS_KEYS_DISPLAY_TEXT_MAP[a]};e.ResourceUse.resourceUseSummaries=function(a,b){b=b||[];return _.reduce(function(a){return _.reduce(a,
function(a,b){var c=b.resourceRequirement.resource;a[c.pk]=a[c.pk]||[];a[c.pk].push(b);return a},{})}(a),function(a,c,d){a[d]=a[d]||{};a[d].totalUseCount=parseFloat(_.sum(c,"useCount").toFixed(2));a[d].totalSeatCount=_.filter(c,"seat").length;a[d].resourcePk=d;a[d].resourceName=c[0].resourceRequirement.resource.name;a[d].isResourceArchived=c[0].resourceRequirement.resource.isArchived;a[d].isOverused=-1<_.map(b,"pk").indexOf(parseInt(d));a[d].url=h.populate(h.dashboard.resources.resource.uses.day,
{shortname:(c[0].resourceRequirement.company||c[0].company).shortname,resourcePk:d,date:_.min(_.pluck(c,"startAt")).format("YYYY-MM-DD")});return a},{})};e.CustomReport.url=function(b){var c=d.advancedUrl(b.company,b.options.modelName),f={};f[e.CustomReport.QUERY_PARAM]=b[e.CustomReport.QUERY_PARAM_KEY];return a.compose(c,f)};e.SuggestedReport.url=function(b,c){var f=d.advancedUrl(c,b.options.modelName),h={};h[e.SuggestedReport.QUERY_PARAM]=b.slug;return a.compose(f,h)};e.Item.frontendUrl=function(a,
b){return b&&!a.isRetail?h.populate(h.company.item.month,{shortname:a.company.shortname,itemPk:a.pk,year:b.format("YYYY"),month:b.format("MM")}):a.$url(h.company.item.index)};e.Item.calendarUrl=function(a){return a.$url(h.dashboard.items.item.calendar)};e.FlowNode.frontendUrl=function(a,b){var c="";return c=a.externalUrl?a.externalUrl:a.item?e.Item.frontendUrl(a.item,b):a.$url(h.company.flowNode.index)};e.FlowNode.suggestedItemUrl=function(b,c,d){c=b.item&&b.item.externalUrl&&!b.externalUrl?b.item.externalUrl:
e.FlowNode.frontendUrl(b,c);var f={};b.type!==e.FlowNode.PAGE_TYPE&&(f[e.FlowNode.FLOW_QUERY]=b.parent.pk);f[e.FlowNode.IS_FROM_CART_QUERY]=d;return a.compose(c,f,!0)};_.extend(e.CampaignValidityRule,f.slipstream("campaignValidityRules.allTypes"));if(l.isDebugging){e.Payment.isEmv=function(a){return a.type===e.Payment.CC_TYPE};e.Payment.isEmvSignatureRequired=function(a){return 0===a.pk%2};var m=e.Payment.emvDetails;e.Payment.emvDetails=function(a){a.metadata||(a.metadata={});a.metadata.emvDetails=
l.debugDetails;return m(a)}}e.SupportedLanguage.DISPLAY_LANGUAGES=f.slipstream("displayLanguages");e.SupportedLanguage.LANGUAGE_CODES_SORTED=f.slipstream("languageCodesSorted");e.Translation.translationOverlayUrl=function(b,c,d,f,g){c={shortname:d,objectType:c.cls,objectId:c.pk,objectField:e.Translation.fieldNameForUrl(b)};b="";g?(c.subfield=e.Translation.fieldNameForUrl(g),b=h.populate(h.dashboard.translationsOverlay.forSubfield,c)):b=h.populate(h.dashboard.translationsOverlay.forField,c);g={};g[e.SupportedLanguage.SCROLL_TO_LANGUAGE_PARAM]=
f;return a.compose(b,g)};e.Seat.editUrl=function(a,b){return h.populate(h.dashboard.settings.seating.seatMap.layout.seats,{shortname:b.company.shortname,seatMapPk:b.pk,seatPks:_.isString(a)?a:_.pluck(a,"pk").join(",")})};e.Seat.duplicateUrl=function(a,b){return h.populate(h.dashboard.settings.seating.seatMap.layout.duplicate,{shortname:b.company.shortname,seatMapPk:b.pk,seatPks:_.isString(a)?a:_.pluck(a,"pk").join(",")})};e.Seat.createUrl=function(a,b,c){return h.populate(h.dashboard.settings.seating.seatMap.layout.new,
{shortname:c.company.shortname,seatMapPk:c.seatMap.pk,seatGroupPk:c.pk,xCoord:a,yCoord:b})}}])})();
(function(){var m=angular.module("lib.processors",["auth.services","db.services","lib.services","navigation.services"]),c={UNSUPPORTED:T("Unsupported processor. Please refresh the page and try again. If you continue to have trouble please contact support@fareharbor.com."),SCRIPT:T("Could not contact processor. Please refresh the page and try again."),TIMEOUT:T("Connection error. Please check your internet connection and try again."),WAIT:T("Please wait a few moments and try again."),TRY_AGAIN:T("Please try again."),
REFRESH:T("Please refresh the page and try again."),UNKNOWN:T("Unknown error. Please refresh the page and try again."),GENERIC_BANK_ACCOUNT:T("Could not update bank account. Please make sure all details have been entered correctly and try again."),REFRESH_BANK_ACCOUNT:T("Could not update bank account. Please refresh the page and try again."),TRY_AGAIN_BANK_ACCOUNT:T("Could not update bank account. Please try again."),GENERIC_CARD:T("Could not process payment. Please refresh the page and try again ensuring all card details have been entered correctly. If you continue to have trouble please contact support@fareharbor.com."),
REFRESH_CARD:T("Could not process payment. Please refresh the page and try again."),BAD_CARD:T("Could not process payment. Please make sure all card details have been entered correctly. If you are still unsuccessful you may need to call the card issuer or try a different card."),INVALID_ROUTING_NUMBER:T("Invalid routing number."),INVALID_CARD_NUMBER:T("Invalid card number. Please check that you have entered your card number correctly and try again."),BAD_CARD_NUMBER:T("Incorrect card number. Please check that you have entered your card number correctly and try again."),
INVALID_DEMO_CARD_NUMBER:T("Only demo card numbers can be used while demo mode is enabled."),INVALID_EXPIRATION:T("Invalid card expiration date. Please check that you've selected the correct expiration date for your card and try again."),BAD_EXPIRATION:T("Expired card. Please enter a valid card."),INVALID_SECURITY_CODE:T("Invalid CVC (card security code). Please check that you've entered your card's security code correctly and try again."),BAD_SECURITY_CODE:T("Incorrect CVC (card security code). Please check that you've entered your card's security code correctly and try again."),
INVALID_COUNTRY_CODE:T("Invalid country. Plesae check that your billing country is correct and try again."),INVALID_POSTAL_CODE:T("Invalid postal (zip) code. Please check that your billing postal code is correct and try again."),BAD_POSTAL_CODE:T("Incorrect postal (zip) code. Please check that your billing postal code is correct and try again.")},g={pending:T("Verification Pending"),failed:T("Verification Failed"),submitted:T("Information submitted. Awaiting reply.")};m.factory("processors",["$injector",
"auth","convert","db",function(k,f,l,e){var a={INDIVIDUAL_ENTITY_TYPE:"individual",COMPANY_ENTITY_TYPE:"company",DEFAULT_PROCESSOR_TYPE:"stripe",DEFAULT_CURRENCY:"usd",ADYEN_PROCESSOR_TYPE:"adyen",STRIPE_PROCESSOR_TYPE:"stripe",BALANCED_PROCESSOR_TYPE:"balanced",PAYPAL_PROCESSOR_TYPE:"paypal",PROCESSOR_TYPES:["stripe","paypal"],LEGACY_PROCESSOR_TYPES:["balanced"],ACCOUNT_CREATION_REQUIREMENTS:e.slipstream("accountCreationRequirements"),ACCOUNT_CREATION_REQUIREMENT_TO_FORM_FIELD:e.slipstream("processorAccountCreationFormField",
{doNotConvert:!0}),SUPPORTED_BANK_ACCOUNT_COUNTRIES:e.slipstream("processorSupportedBankAccountCountries"),BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES:e.slipstream("processorBankAccountVerificationEnabledCountries"),BANK_ACCOUNT_ADDITIONAL_REQUIRED_FORM_FIELDS:e.slipstream("processorBankAccountAdditionalRequiredFields"),SUPPORTED_CURRENCIES:e.slipstream("processorSupportedCurrencies"),PROCESSOR_CHOICES:e.slipstream("processorChoices"),COUNTRY_CHOICES:e.slipstream("countryChoices"),UNVERIFIED_VERIFICATION_STATUS:"unverified",
SUBMITTED_VERIFICATION_STATUS:"submitted",PENDING_VERIFICATION_STATUS:"pending",VERIFIED_VERIFICATION_STATUS:"verified",FAILED_VERIFICATION_STATUS:"failed",TO_BE_REVERIFIED_VERIFICATION_STATUS:"to_be_reverified",ERRORS:c,ONBOARDING_MESSAGES:g,SECRET_FIELD:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",secretField:function(c){return Array(Math.max((c||"").length,a.SECRET_FIELD.length)+1).join(a.SECRET_FIELD[0])},cardType:function(a){if(!a)return"";a=a.toString().trim();var c={};c["2"]=c["51"]=
c["52"]=c["53"]=c["54"]=c["55"]="mastercard";c["34"]=c["37"]="american express";c["62"]=c["81"]="unionpay";c["4"]="visa";c["6"]="discover";c["35"]="jcb";c["30"]=c["36"]=c["38"]="diners club";return c[a.substring(0,2)]||c[a.substring(0,1)]||"unknown"},cardTypeAbbreviation:function(a){return{visa:"visa",mastercard:"mc","american express":"amex",discover:"discover","diners club":"diners",jcb:"jcb",unknown:"unknown",unionpay:"cup"}[a]||""},cardLast4:function(a){return a.substr(a.length-4)},accountCreationRequirements:function(c,
e,d,b){if(a.ACCOUNT_CREATION_REQUIREMENTS){var f=[c,d].join("."),f=_.get(a.ACCOUNT_CREATION_REQUIREMENTS,f);b&&(f=f.filter(function(a){return"legal_entity.business_name"!==a}));if(f)return f}console.error("processors: account creation requirements not identified for "+c+" "+e+" "+d)},requiredAccountCreationFields:function(c,e){try{if(!e)throw Error("missing account creation requirements");if(!a.ACCOUNT_CREATION_REQUIREMENT_TO_FORM_FIELD)throw Error("missing account creation requirements");var d=a.ACCOUNT_CREATION_REQUIREMENT_TO_FORM_FIELD[c];
if(!d)throw Error("missing account creation mapping for processor type");var b={};_.each(e,function(a){(a=d[a])&&(b[l.camelKey(a)]=!0)});if(_.isEmpty(b))throw Error("no required fields");return b}catch(f){console.warn("processors: account creation fields not identified for "+c+": "+f.message)}},bankAccountAdditionalRequiredFields:function(c,e){if(a.BANK_ACCOUNT_ADDITIONAL_REQUIRED_FORM_FIELDS){var d=[c,e].join(".");return _.get(a.BANK_ACCOUNT_ADDITIONAL_REQUIRED_FORM_FIELDS,d,{})}console.error("processors: bank account additional required form fields not identified for "+
c+" "+e)},supportedBankAccountCountries:function(c,e,d){if(a.SUPPORTED_BANK_ACCOUNT_COUNTRIES){var b=[c,e,d].join(".");if(b=_.get(a.SUPPORTED_BANK_ACCOUNT_COUNTRIES,b))return b}console.error("processors: supported bank account countries not identified for "+c+" "+e+" "+d)},verificationEnabledBankAccountCountries:function(c,e){if(a.BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES){var d=[c,e].join(".");if(d=_.get(a.BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES,d))return d}console.error("processors: unable to identify verification enabled bank account countries for "+
c+" "+e)},isVerificationEnabledForBankAccountCountry:function(c,e,d){var b=a.verificationEnabledBankAccountCountries(c,e);if(b)return _.contains(b,d);console.error("processors: unable to identify whether bank account verification is enabled for "+c+" "+e+" "+d)},isBankAccountVerificationEnabled:function(c,e,d){var b=a.verificationEnabledBankAccountCountries(c,e);if(b){if(!b.length)return!1;var f=a.supportedBankAccountCountries(c,e,d);if(f)return!!_.intersection(f,b).length}console.error("processors: unable to identify whether bank account verification is enabled for "+
c+" "+e+" "+d)},supportedCurrencies:function(c,e){var d;if(a.SUPPORTED_CURRENCIES)if(null!==c){var b=[c,e].join(".");if(d=_.get(a.SUPPORTED_CURRENCIES,b))return d}else return d={},_.forOwn(a.SUPPORTED_CURRENCIES,function(a){_.transform(a[e],function(a,b){a[b]=!0},d)}),_.keys(d);console.error("processors: unable to determine supported currencies for "+c+" "+e)},INFO:"info",ERROR:"error",log:function(c,e,d,b){e=e||{};d=d||{};b=b||a.INFO;b=_.get(console,b,console.info);_.isFunction(b)&&b("processors: "+
c,e,d)},get:function(a){return k.get(a||"stripe")},isProcessorEnabled:function(a,c){return _.contains(a.enabledProcessorTypes,c)},_isProcessor:function(a,c,d){a="is"+_.capitalize(d)+"Processor"+_.capitalize(a);return _.get(c,a)},isProcessorBankAccountConnected:function(c,e){return a._isProcessor("bankAccountConnected",c,e)},isProcessorConnected:function(c,e){return a._isProcessor("connected",c,e)},isProcessorTosAccepted:function(c,e){return a._isProcessor("tosAccepted",c,e)},processorVerificationStatus:function(a,
c){return _.get(a,c+"ProcessorVerificationStatus")},processorVerificationStatusDetails:function(a,c){return _.get(a,c+"ProcessorVerificationStatusDetails")},isProcessorVerificationFailed:function(c,e){return a.processorVerificationStatus(c,e)===a.FAILED_VERIFICATION_STATUS},isProcessorVerificationPending:function(c,e){return a.processorVerificationStatus(c,e)===a.PENDING_VERIFICATION_STATUS},isProcessorVerificationSubmitted:function(c,e){var d=a.processorVerificationStatus(c,e);return _.contains([a.SUBMITTED_VERIFICATION_STATUS,
a.PENDING_VERIFICATION_STATUS],d)},isProcessorVerified:function(c,e){var d=a.processorVerificationStatus(c,e);return a.VERIFIED_VERIFICATION_STATUS===d},isProcessorPaymentSetupComplete:function(c,e){return a._isProcessor("paymentSetupComplete",c,e)},processorIdentifier:function(a,c){return _.get(a,c+"ProcessorIdentifier")},isProcessorDefaultBankAccountReadyForUpload:function(c,e){return a._isProcessor("defaultBankAccountReadyForUpload",c,e)},isProcessorDefaultBankAccountReadyForPayout:function(c,
e){return a._isProcessor("defaultBankAccountReadyForPayout",c,e)},isProcessorDefaultBankAccountVerificationEnabled:function(c,e){return a._isProcessor("defaultBankAccountVerificationEnabled",c,e)},isProcessorAccountInformationSubmitted:function(c,e){return a._isProcessor("accountInformationSubmitted",c,e)},processorAdditionalAccountSetupStatus:function(a,c){return _.get(a,c+"ProcessorAdditionalAccountSetupStatus")},isProcessorAdditionalAccountSetupInitiated:function(c,e){return a.processorAdditionalAccountSetupStatus(c,
e)!==a.UNVERIFIED_VERIFICATION_STATUS},isProcessorAdditionalAccountSetupCompleted:function(c,e){return a.processorAdditionalAccountSetupStatus(c,e)===a.VERIFIED_VERIFICATION_STATUS},isProcessorAdditionalAccountSetupFailed:function(c,e){return a.processorAdditionalAccountSetupStatus(c,e)===a.FAILED_VERIFICATION_STATUS},processorEmvLocationStatus:function(a,c){return a[c+"ProcessorEmvLocationStatus"]},isProcessorEmvLocationRequested:function(c,e){return a.processorEmvLocationStatus(c,e)!==a.UNVERIFIED_VERIFICATION_STATUS},
isProcessorEmvLocationFailed:function(c,e){return a.processorEmvLocationStatus(c,e)===a.FAILED_VERIFICATION_STATUS},isProcessorEmvLocationCompleted:function(c,e){return a.processorEmvLocationStatus(c,e)===a.VERIFIED_VERIFICATION_STATUS},isPaymentSetupCompleteForAllEnabledProcessors:function(c){return _.all(c.enabledProcessorTypes,function(e){return a.isProcessorPaymentSetupComplete(c,e)})},applicableProcessorTypes:function(c,e,d){var b=[];a.SUPPORTED_CURRENCIES&&_.forOwn(a.SUPPORTED_CURRENCIES,function(a,
d){_.contains(a[c],e)&&b.push(d)});return _.union(b,d)},getProcessorChoices:function(c){return _.filter(a.PROCESSOR_CHOICES,function(a){return _.contains(c,a[0])})},getCountryChoices:function(c){return _.get(a.COUNTRY_CHOICES,c,[])},isCapabilityEnabledForAnyEnabledProcessor:function(c,e){return _.any(c.enabledProcessorTypes,function(c){var b=a.get(c),b=_.get(b,e,null);return null===b?(console.error("processors.isCapabilityEnabledForAnyEnabledProcessor: service is missing capability flag:",c,e),!1):
b})},processorTypesForCapability:function(c){return _.filter(a.PROCESSOR_TYPES,function(e){var d=a.get(e),d=_.get(d,c,null);return null===d?(console.error("processors.isCapabilityEnabledForAnyEnabledProcessor: service is missing capability flag:",e,c),!1):d})},isAddingEmvDevicePossibleForSelectedProcessor:function(c,e){return(a.get(e).isAddingEmvDevicePossible||_.always)(c)},processorReverificationDate:function(a){return _.get(a,a.defaultProcessorType+"ProcessorReverificationDeadline")}};return a}]);
m.factory("stripe",["$injector","$q","$rootScope","db","models","processors","Stripe",function(k,f,l,e,a,m,h){var d={invalid_number:m.ERRORS.INVALID_CARD_NUMBER,incorrect_number:m.ERRORS.BAD_CARD_NUMBER,invalid_expiry_month:m.ERRORS.INVALID_EXPIRATION,invalid_expiry_year:m.ERRORS.INVALID_EXPIRATION,expired_card:m.ERRORS.BAD_EXPIRATION,invalid_cvc:m.ERRORS.INVALID_SECURITY_CODE,incorrect_cvc:m.ERRORS.BAD_SECURITY_CODE,incorrect_zip:m.ERRORS.BAD_POSTAL_CODE,card_declined:m.ERRORS.BAD_CARD,processing_error:m.ERRORS.TRY_AGAIN,
rate_limit:m.ERRORS.WAIT},b=[{regex:/^Expired API Key provided/i,message:m.ERRORS.REFRESH}],A=e.slipstream("stripeLivePublishableKey"),s=e.slipstream("stripeTestPublishableKey"),r=function(a,b,c){var e=f.defer();h.setPublishableKey(A);a={currency:a.processorCurrency,country:b.processorCountry,account_number:b.accountNumber,account_holder_name:b.accountHolderName,account_holder_type:b.accountHolderType};b.routingNumber&&(a.routing_number=b.routingNumber);h.bankAccount.createToken(a,function(a,b){l.$safeApply(function(){if(b.error){m.log("Stripe client-side error ("+
(b.status||"unknown error")+")",_.extend({stripeResponse:b},c));var a=b.error.message+".";b.error.code&&(a=d[b.error.code]||a);return e.reject([a])}return e.resolve({processorType:"stripe",stripeBankAccountToken:b.id})})});return e.promise},y=function(a,c,e,g,r){var p=f.defer();r=r||!1;if(!h)return m.log("Stripe: unable to load stripe.js"),p.reject([m.ERRORS.SCRIPT]),p.promise;var t=function(a){var c;a.error.code?c=d[a.error.code]:a.error.message&&_.forEach(b,function(b){if(a.error.message.match(b.regex))return c=
b.message,!1});c||(c=m.ERRORS.GENERIC_CARD);var e="card_error"===a.error.type?m.INFO:m.ERROR,f="Stripe client-side "+(a.status||"")+" error",f=f+(" ("+(a.error.type||"unknown error")+")");a.error.message&&(f+=" - "+a.error.message);m.log(f,_.extend({stripeResponse:a,error:c},g),{type:a.error.type},e);return p.reject([c])};h.setPublishableKey(e?s:A);var y={number:c.number,exp_month:c.expirationMonth,exp_year:c.expirationYear};c.cvc&&(y.cvc=c.cvc);y.name=c.name||"";y.address_zip=c.postalCode||"";y.address_country=
c.countryCode||"";c=k.get("auth");a.isStripePerformanceModeSupported&&!r&&!c.currentUser.isAuthenticated?h(e?s:A,{apiVersion:"2020-08-27; api_performance_mode_beta=v1"}).createPaymentMethod({type:"card",card:{number:y.number,exp_month:y.exp_month,exp_year:y.exp_year,cvc:y.cvc},billing_details:{name:y.name}}).then(function(a){l.$safeApply(function(){return!a?p.reject([m.ERRORS.TIMEOUT]):a.error?t(a):!a.paymentMethod?p.reject([m.ERRORS.UNKNOWN]):p.resolve({processorType:"stripe",stripeToken:null,stripePaymentIntentId:null,
stripePaymentMethodId:a.paymentMethod.id,stripeIsRetryingPayment:r})})}):h.card.createToken(y,function(a,b){l.$safeApply(function(){return!b?p.reject([m.ERRORS.TIMEOUT]):b.error?t(b):p.resolve({processorType:"stripe",stripeToken:b.id,stripePaymentIntentId:null,stripePaymentMethodId:null,stripeIsRetryingPayment:r})})});return p.promise},G=function(a,b,c){b=h(b?s:A);return(c?b.handleCardSetup:b.handleCardAction)(a)};return{ERRORS:c,ONBOARDING_MESSAGES:g,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/",
DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/refunding-a-disputed-charge/",NAME:"Stripe",PROCESSOR_TYPE:"stripe",PENDING_STATEMENT_TEXT:"STRIPE",STATEMENT_TEXT_PREFIX:"FH* ",STATEMENT_TEXT_REGEX:/^[a-zA-Z0-9\.\(\)\{\}\[\]&!\$;\-%_\?:\#@\~=\^\+| ]+$/,tokenizeBankAccount:function(a,b,c){if(!h){var d=f.defer();m.log("Stripe: unable to load stripe.js");d.reject([m.ERRORS.SCRIPT]);return d.promise}d=r(a,b,c);a=r(a,b,c);return f.all([d,a]).then(function(a){return{processorType:"stripe",
stripeAccountBankAccountToken:a[0].stripeBankAccountToken,stripeCustomerBankAccountToken:a[1].stripeBankAccountToken}},function(a){return f.reject(_.unique(_.append(a)))})},tokenizeCard:y,tokenizedCard:function(a){return{processorType:"stripe",stripeToken:a}},testToken:function(a,b){var c={number:"4242424242424242",expirationMonth:1,expirationYear:moment().year()+1,cvc:"123"};b=_.extend(b,{testing:!0});return y(a,c,a.isDemoModeEnabled,b,!1).then(function(a){a=a.stripeToken;console.info("stripe: test token",
a);return a})},chargedCard:function(a){var b={processorType:"stripe",stripePaymentIntentId:a.processorId};_.extend(b,a);return b},completeClientAction:function(a,b,c,d,e){var g=f.defer();G(b,d,c).then(function(a){if(a.error)g.reject(T("Authorization failed"));else{var b={processorType:"stripe",stripeToken:null,stripePaymentMethodId:null};c?b.stripeSetupIntentId=a.setupIntent.id:b.stripePaymentIntentId=a.paymentIntent.id;g.resolve(b)}},function(){g.reject(T("Authorization failed"))});return g.promise},
isAdjustmentValid:function(a,b){return a.isProcessable&&"from-company"===a.direction?!b.isAdmin:!0},minimumBookingFee:function(a){return a.minimumFee},minimumChargeAmount:function(b){return a.Payment.minimumChargeAmounts(b,"stripe")},isAutomaticCreationOfAccountsEnabled:!0,isBankAccountsEnabled:!0,isRefundReserveEnabled:!0,isBankAccountCreationEnabled:_.constant(!0),isBankAccountTokenizationNeeded:!0,isBankAccountVerificationDoneViaDeposits:!0,isBookingFeeProratedForRefunds:!1,isCardsEnabled:!0,isCardOnFileEnabled:!0,
isConnectedAfterOnboarding:!1,isCreditCardsEnabled:!0,isDeferredChargesEnabled:!0,isDemoCardNumberCheckSupported:!0,isDisputesEnabled:!0,isEmvEnabled:!0,isFileChargesEnabled:!0,isHoldsEnabled:!0,isSofortEnabled:!0,isIdealEnabled:!0,isBancontactEnabled:!0,isPaypalEnabled:!1,isPayoutsEnabled:!0,isTosEnabled:!0,isTransactionsEnabled:!0,isAccountIdentifierVisibleToCompanyUsersWithPermission:!1,isAdditionalAccountSetupRequired:!1,statementText:function(a){return a.features.stripeStatementText||a.statementText},
filterEmvDetails:function(a){var b=_.toTrueKeys(["File Name","Preferred Name"]);return _.filter(a,function(a){return b[a.key]})}}}]);m.factory("balanced",["$rootScope","$timeout","$q","processors",function(k,f,l,e){k=function(){var a=l.defer();a.reject([e.ERRORS.UNSUPPORTED]);return a.promise};return{ERRORS:c,ONBOARDING_MESSAGES:g,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/",DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/refunding-a-disputed-charge/",
NAME:"Balanced",PROCESSOR_TYPE:"balanced",PENDING_STATEMENT_TEXT:"BALANCED",STATEMENT_TEXT_PREFIX:"BAL*",STATEMENT_TEXT_REGEX:/^.*$/,tokenizeBankAccount:k,tokenizeCard:k,isAutomaticCreationOfAccountsEnabled:!1,isBankAccountsEnabled:!1,isRefundReserveEnabled:!1,isBankAccountCreationEnabled:_.constant(!0),isBankAccountTokenizationNeeded:!1,isBankAccountVerificationDoneViaDeposits:!1,isCardsEnabled:!1,isCardOnFileEnabled:!1,isConnectedAfterOnboarding:!1,isCreditCardsEnabled:!1,isDemoCardNumberCheckSupported:!0,
isDisputesEnabled:!1,isSofortEnabled:!1,isIdealEnabled:!1,isBancontactEnabled:!1,isPaypalEnabled:!1,isPayoutsEnabled:!0,isTosEnabled:!1,isTransactionsEnabled:!0,isAccountIdentifierVisibleToCompanyUsersWithPermission:!1,isAdditionalAccountSetupRequired:!1,statementText:function(a){return a.statementText},filterEmvDetails:function(a){return a}}}]);m.factory("cardflight",function(){return{isTestToken:function(c){return/^test_/.test(c)}}});m.factory("Stripe",function(){return window.Stripe||null});m.factory("stripeEmv",
_.optional(["$q","$filter","$rootScope","$window","auth","db","events","flash","models","?native",function(c,f,g,e,a,m,h,d,b,A){if(!e.StripeTerminal||!e.StripeTerminal.PaymentStatus)return null;var s=f("amount"),r={};r[e.StripeTerminal.PaymentStatus.READY]=T("Waiting...");r[e.StripeTerminal.PaymentStatus.NOT_READY]=cT("Status shown when a card reader is not ready to accept payment","Not ready...");r[e.StripeTerminal.PaymentStatus.PROCESSING]=T("Charging card...");r[e.StripeTerminal.PaymentStatus.WAITING_FOR_INPUT]=
T("Waiting for card...");r.DISCONNECTED=T("Not connected.");r.UNKNOWN=T("Not connected.");r.NATIVE=T("Waiting...");var y=e.slipstream&&"production"!==e.slipstream.configuration&&e.slipstream.isStripeEmvSimulatorEnabled,G={cls:"EmvDevice",name:"EMV Simulator",pk:-1},w=function(a){return function(){return new e.Promise(function(b,c){m.emvDevice.authenticate({shortname:a.shortname},null,null,{}).$promise.then(function(a){b(a.data.connectionToken)},function(a){console.error("stripeEmv: failed to retrieve connection token",
a);c(Error("failed to retrieve activation token from Stripe."))})})}},B=function(){g.$safeApply()},n=function(){g.$safeApply(function(){d.error(T("Reader has been disconnected unexpectedly."))})},P=function(){g.$safeApply()},I,p=A&&A.isNative,t=!1,K=A.EMV_TYPES.BLUETOOTH_EMV,x,E;p&&(h.on(g,"fareharbor.native.emv.createConnection",function(){E?(console.info("stripeEmv: native: requesting connection token",E.shortname),m.emvDevice.authenticate({shortname:E.shortname},null,null,{}).$promise.then(function(a){console.info("stripeEmv: native: created connection token");
A.broadcast("fareharbor.native.emv.connectionCreated",{token:a.data.connectionToken,location:E.stripeEmvLocationId,processor_id:E.stripeProcessorIdentifier})},function(a){console.error("stripeEmv: native: failed to connect",a.data);A.broadcast("fareharbor.native.emv.connectionCreated",{token:"",location:"",processor_id:""})})):(console.error("stripeEmv: native: no current company"),A.broadcast("fareharbor.native.emv.connectionCreated",{token:"",location:"",processor_id:""}))}),h.on(g,"fareharbor.native.emv.connected",
function(a,b){console.info("stripeEmv: native: connected");t=!0;x=null;b=b||{};K=b.reader||A.EMV_TYPES.BLUETOOTH_EMV}),h.on(g,"fareharbor.native.emv.disconnected",function(){console.info("stripeEmv: native: disconnected");t=!1}),h.on(g,"fareharbor.native.emv.completed",function(a,c){console.info("stripeEmv: native: completed",c);x?(c.stripePaymentIntentId?x.resolve({processorId:c.stripePaymentIntentId}):x.reject(b.EmvDevice.STRIPE_ERRORS[c.code||b.EmvDevice.UNKNOWN_ERROR]||b.EmvDevice.STRIPE_ERRORS[b.EmvDevice.UNKNOWN_ERROR]),
x=null):console.error("stripeEmv: attempting to complete EMV without a current deferred",c)}));var J={isSimulatorEnabled:y,STORAGE_KEY:"stripeEmvDevicePk",providerType:"stripe",selectDevice:function(a){if(t||!a||!a.reader)return c.reject();I||J.connect(a.emvDevice.company);return I.connectReader(a.reader,{fail_if_in_use:!0}).then(function(d){if(d.error)return d.error.code!==b.EmvDevice.CONNECT_READER_ERROR_CODE&&console.error("stripeEmv: failed to connect",d),c.reject(d.error);a.status=b.EmvDevice.ONLINE_STATUS;
return c.when(a)})},discoverEmvDevices:function(a,d){if(t)return c.when([]);I||J.connect(a);var e={};y&&(e.simulated=!0);return I.discoverReaders(e).then(function(e){if(e.error)return console.warn("stripeEmv: failed to discover",e.error),c.reject(e.error);console.log("stripeEmv: successfully discovered readers",e.discoveredReaders);var f;y?(G.company=a,f=[{emvDevice:G,status:b.EmvDevice.ONLINE_STATUS,reader:e.discoveredReaders[0]}]):f=_.map(d,function(a){var c=_.find(e.discoveredReaders,{id:a.identifier});
return{emvDevice:a,status:c&&c.status===b.EmvDevice.ONLINE_STATUS?b.EmvDevice.ONLINE_STATUS:b.EmvDevice.OFFLINE_STATUS,reader:c}});return c.when(f)},function(a){console.warn("stripeEmv: failed reader discovery",a);return c.reject()})},connect:function(c){a.permissions.canList(b.EmvDevice,c)&&(p&&(E=c,A.isEmvConnected(c)?(t=!0,K=A.readerType,console.info("stripeEmv: native: the native application is already connected. EMV device serial number: ",A.serialNumber)):(console.info("stripeEmv: native: requesting the native application connect"),
A.broadcast("fareharbor.native.emv.connect"))),I=e.StripeTerminal.create({onFetchConnectionToken:w(c),onCheckoutStatusChanged:B,onUnexpectedReaderDisconnect:n,onConnectionStatusChange:P}))},disconnect:function(){p&&(A.disconnectEmv(),E=null,t=!1);I&&(I.disconnectReader(),I=null)},isConnected:function(){return t?!0:I&&"connected"===I.getConnectionStatus()},isNFC:function(){return K===A.EMV_TYPES.NFC},charge:function(a,d,f,h,n,p){var r=p.emvAsyncSuccessCallback||_.ignore;if(t){var V=c.defer();if(x)return console.warn("stripeEmv: native: already charging natively"),
V.reject(b.EmvDevice.STRIPE_ERRORS[b.EmvDevice.UNKNOWN_ERROR]),V.promise;console.info("stripeEmv: native: creating interaction token");m.emvDevice.createInteractionToken({shortname:a.shortname},{description:d.unicode,bookingGrosses:h}).$promise.then(function(a){console.info("stripeEmv: native: created interaction token");A.broadcast("fareharbor.native.emv.begin",{clientSecret:a.primaryData,amount:f,formattedAmount:s(f,E.processorCurrency)})},function(a){console.error("stripeEmv: native: failed to create interaction token",
a.primaryData);V.reject(b.EmvDevice.STRIPE_ERRORS[b.EmvDevice.UNKNOWN_ERROR])});x=V;return V.promise}if(!I)return c.reject(b.EmvDevice.STRIPE_ERRORS[b.EmvDevice.UNKNOWN_ERROR]);y&&I.setSimulatorConfiguration({testCardNumber:"4242424242424242",testPaymentMethod:"visa"});var w=e.slipstream.isStripeAsyncEmvEnabled;return I.setReaderDisplay({type:"cart",cart:{line_items:[{description:d.unicode,amount:f,quantity:1}],tax:0,total:f,currency:a.processorCurrency}}).then(function(){g.$apply();return m.emvDevice.createInteractionToken({shortname:a.shortname},
{description:d.unicode,bookingGrosses:h}).$promise}).then(function(a){g.$apply();return I.collectPaymentMethod(a.primaryData)}).then(function(a){g.$apply();if(a.error)return c.reject(a.error);if(null===a.paymentIntent)return c.reject({code:"payment_intent_is_null"});if(w){var b=c.defer();r({processorId:a.paymentIntent.id}).then(function(){return b.resolve(a.paymentIntent)});return b.promise}return c.when(a.paymentIntent)}).then(function(a){g.$apply();return I.processPayment(a)}).then(function(a){g.$apply();
return a.error?c.reject(a.error):c.when({processorId:a.paymentIntent.id,isEmvAsyncSuccessCallbackCalled:w})}).catch(function(a){g.$apply();var d=b.EmvDevice.UNKNOWN_ERROR;a.decline_code&&b.EmvDevice.STRIPE_ERRORS[a.decline_code]?d=b.EmvDevice.STRIPE_ERRORS[a.decline_code]:a.code&&(d=b.EmvDevice.STRIPE_ERRORS[a.code]||d);a.data&&a.data.createEmvInteractionTokenForm&&(d=a.data.createEmvInteractionTokenForm.all[0]);console.error("stripeEmv: unhandled error",a,d);return c.reject(d)})},cancel:function(){t?
A.broadcast("fareharbor.native.emv.cancel"):I&&I.cancelCollectPaymentMethod()},information:function(){return t?r[x?"NATIVE":e.StripeTerminal.PaymentStatus.READY]:I?r[I.getPaymentStatus()]||r.UNKNOWN:r.DISCONNECTED},lastDecline:function(){return null}};return J}]));m.factory("adyenEmv",["$q","db","models",function(c,f,g){var e={providerType:"adyen",STORAGE_KEY:"adyenEmvDevicePk",currentDevice:null,currentTransactionId:null,connect:_.noop,disconnect:function(){e.currentDevice=null},isConnected:function(){return!_.isNull(e.currentDevice)},
charge:function(a,f,g,d,b){return c.when({emvDeviceId:e.currentDevice.identifier})},information:_.noop,cancel:function(){var a=e.currentDevice,c=a.identifier,g=e.currentTransactionId;_.isNull(g)?console.warn("adyenEmv: no EMV transaction is in progress"):(console.log("adyenEmv: attempting to cancel EMV transaction for device",c," transactionId",g),f.emvDevice.cancelCharge({shortname:a.company.shortname},{emvDeviceId:c,tokenId:g}).$promise.then(function(){e.currentTransactionId=null}))},lastDecline:_.noop,
discoverEmvDevices:function(a,e){return f.emvDevice.checkConnections({shortname:a.shortname},null,null,null).$promise.then(function(a){var d=_.map(e,function(b){return{emvDevice:b,status:a.primaryData[b.identifier]?g.EmvDevice.ONLINE_STATUS:g.EmvDevice.OFFLINE_STATUS}});return c.when(d)})},selectDevice:function(a){if(!a)return c.reject("no discovered emv device");var m=a.emvDevice;return f.emvDevice.checkConnection({shortname:m.company.shortname,emvDevicePk:m.pk},null,null,null).$promise.then(function(f){f=
f.primaryData[m.identifier]?g.EmvDevice.ONLINE_STATUS:g.EmvDevice.OFFLINE_STATUS;a.status=f;return f===g.EmvDevice.ONLINE_STATUS?(e.currentDevice=m,c.when(a)):c.reject("emv device is offline")})},isSimulatorEnabled:!1};return e}]);m.factory("loginProviders",[function(){return{NAMES_BY_TYPE:{google:"Google",marriott:"Marriott",amazon:"Amazon",auth0:"Auth0"}}}]);m.factory("emv",["$q","$rootScope","auth","db","events","models","stripeEmv","adyenEmv","storage","native",function(c,f,g,e,a,m,h,d,b,A){var s=
null,r=null,y=_.map(e.slipstream("emvProviderChoices"),"0"),G={};G.adyen=d;G.stripe=h;var w=_.filter([h,d]),B=_.filter(w,function(a){return _.find(y,function(b){return a&&a.providerType===b})}),n=function(a){return _.find(B,function(b){if(b.providerType===a)return b})},P=function(){if(!r||!s)return"";var a=r.STORAGE_KEY+":"+s.shortname;r.isSimulatorEnabled&&(a="simulator:"+a);return a},I={ADYEN_PROVIDER:d,STRIPE_PROVIDER:h,SUPPORTED_PROVIDERS:B,currentDevice:null,setProvider:function(a){r=n(a.features.emvProvider)},
getDefaultProviderForProcessorType:function(a){return G[a]},disconnect:function(){if(r)return r.disconnect()},isConnectedToDevice:function(a){return I.isConnected()&&a===I.currentDevice},isConnected:function(){if(r)return r.isConnected()},isNFC:function(){return!r||!r.isNFC?!1:r.isNFC()},storeDeviceSelection:function(a){r&&s&&b.set(P(),a.pk)},selectDevice:function(a){if(!r||!a)return c.reject();I.currentDevice!==a.emvDevice&&I.disconnect();return r.selectDevice(a).then(function(a){I.currentDevice=
a.emvDevice;I.storeDeviceSelection(I.currentDevice)})},previouslySelectedDevicePk:function(){if(r&&s)return b.get(P())},connect:function(a){a&&a.features.isEmvEnabled&&(r=n(a.features.emvProvider))&&r.connect(a)},charge:function(a,b,d,e,f,g){return!r?c.reject():r.charge(a,b,d,e,f,g)},discoverEmvDevices:function(a){if(!g.permissions.canList(m.EmvDevice,a)||!a||!a.features.isEmvEnabled)return c.when([]);var b=e.emvDevices({shortname:a.shortname},null,null,null,{flashError:!1}),d=function(a){return _.map(a,
function(a){return{emvDevice:a,status:m.EmvDevice.OFFLINE_STATUS}})};I.isConnected()||(A.isEmvConnected(a)||I.disconnect(),I.connect(a));return b.$promise.then(function(){return!r?c.when(d(b)):!b.length&&!r.isSimulatorEnabled?(console.log("emv: no emv devices registered yet"),c.when([])):r.discoverEmvDevices(a,b).then(function(a){return c.when(a)}).catch(function(a){console.warn("emv: failed to discover emv devices",a);return c.when(d(b))})})},information:function(){return!r?"":r.information()},lastDecline:function(){return!r?
null:I.isDebugging?I.debugDecline:r.isConnected()?r.lastDecline():null},cancel:function(){if(r)return r.cancel()}};a.on(f,"auth.logout",function(){r&&r.disconnect()});a.on(f,"navigation.company.updated",function(a,b){var c=b.company;if(!s||c)if(!c||!(s===c&&r&&r.isConnected()))s=c,r&&r.disconnect(),c.features.isEmvEnabled&&(r=n(c.features.emvProvider))&&g.currentUser.isAuthenticated&&I.discoverEmvDevices(c).then(function(a){a=_.filter(a,function(a){return"online"===a.status});var b,c=I.previouslySelectedDevicePk();
c&&(b=_.find(a,function(a){return a.emvDevice.pk===c})||_.first(a));I.selectDevice(b).catch(function(){console.warn("emv: unable to connect to device.")})}).catch(function(){console.warn("emv: unable to connect to device: EMV provider not loaded.")})});I.isDebugging=!1;I.debugDecline={customerReceipt:[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"}],merchantReceipt:[{key:"Date",
value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"}]};I.debugDetails=[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"},{key:"Name",value:"Adeventure Extremer"},{key:"Address",value:"12:32pm"},{key:"Zip",value:"12321"},{key:"City",value:"Aina Haina"},
{key:"Country",value:"USA"},{key:"Contact",value:"4155551212"},{key:"Transaction",value:"ch_1BLzcrL4FOCDmmKvrGbjEG2t"},{key:"Authorization",value:"123212321"},{key:"Scheme",value:"super sweet VISA"},{key:"Account",value:"**** **** **** 4242"},{key:"AID",value:"A0000000031010"},{key:"Entry Mode",value:"Chip"},{key:"Verification",value:"Signature"}];return I}]);m.factory("paypal",["db","models",function(k,f){var l=k.slipstream("paypalLiveClientId"),e=k.slipstream("paypalLivePlatformFeesPayeeMerchantId");
return{ERRORS:_.extend({},c,{"country-mismatch":T("PayPal account country invalid."),"onboard-incomplete":T("PayPal onboard not completed."),"permissions-mismatch":T("PayPal permissions not granted."),"email-unconfirmed":T("Please confirm your email address in order to receive payments."),"payments-unreceivable":T("You currently cannot receive payments due to a restriction on your PayPal account.")}),ONBOARDING_MESSAGES:g,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/paypal/",
DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/paypal",NAME:"PayPal",PROCESSOR_TYPE:"paypal",PENDING_STATEMENT_TEXT:"PAYPAL * ",STATEMENT_TEXT_PREFIX:"PAYPAL * ",STATEMENT_TEXT_REGEX:/^[a-zA-Z0-9\.\-\* ]+$/,LIVE_CLIENT_ID:l,LIVE_PLATFORM_FEES_PAYEE_MERCHANT_ID:e,isAutomaticCreationOfAccountsEnabled:!1,isBankAccountsEnabled:!1,isRefundReserveEnabled:!1,isBankAccountCreationEnabled:_.constant(!0),isBankAccountTokenizationNeeded:!1,isBankAccountVerificationDoneViaDeposits:!1,isBookingFeeProratedForRefunds:!0,
isCardsEnabled:!1,isCardOnFileEnabled:!1,isConnectedAfterOnboarding:!0,isCreditCardsEnabled:!1,isDeferredChargesEnabled:!1,isDemoCardNumberCheckSupported:!1,isDisputesEnabled:!0,isEmvEnabled:!1,isFileChargesEnabled:!1,isHoldsEnabled:!1,isSofortEnabled:!1,isIdealEnabled:!1,isBancontactEnabled:!1,isPaypalEnabled:!0,isPayoutsEnabled:!1,isTosEnabled:!1,isTransactionsEnabled:!1,minimumBookingFee:function(a){return 0},minimumChargeAmount:function(a){return f.Payment.minimumChargeAmounts(a,"paypal")},isAccountIdentifierVisibleToCompanyUsersWithPermission:!0,
isAdditionalAccountSetupRequired:!1,statementText:function(a){return a.features.paypalStatementText||a.statementText.slice(0,14)},filterEmvDetails:function(a){return a}}}]);m.directive("ngPaypalCheckout",["$document","$filter","$window","db","navigation","paypal","processors",function(c,f,g,e,a,m,h){var d={},b=function(a){return(a/100).toFixed(2)},A="credit bancontact blik eps giropay ideal mercadopago mybank p24 sepa sofort venmo".split(" "),s=function(a){var b=["credit"];if(a.defaultProcessorType!==
m.PROCESSOR_TYPE){var c=h.get(a.defaultProcessorType),d={isBancontactEnabled:"isBancontactPaymentsEnabled",isCreditCardsEnabled:null,isIdealEnabled:"isIdealPaymentsEnabled",isSofortEnabled:"isSofortPaymentsEnabled"};_.forEach({isBancontactEnabled:"bancontact",isCreditCardsEnabled:"card",isIdealEnabled:"ideal",isSofortEnabled:"sofort"},function(e,f){var g=_.get(c,f,null);null===g&&console.error("ngPaypalCheckout.fundingSourcesToDisable: service is missing capability flag:",c.PROCESSOR_TYPE,f);var h,
l=d[f];h=l?_.get(a.features,l,null):!0;null===h&&console.error("ngPaypalCheckout.fundingSourcesToDisable: feature is missing for commpany:",a,l);g&&h&&b.push(e)})}b=_.unique(b.concat(A));return!b.length?null:b.join()};return{restrict:"A",templateUrl:"ng-paypal-checkout",controllerAs:"paypalCtrl",controller:["$scope",function(f){var g=this;g.status="loading";var l=f.paymentCtrl.company;if(l.paypalMerchantId){var A=null;f.bookForm?(A=f.bookForm,f.submit=f.bookCtrl.submit):f.orderForm?(A=f.orderForm,
f.submit=f.cartCtrl.submit):f.paymentsForm&&(A=f.paymentsForm);var B=h.get("paypal").statementText(l),n=function(){p.Buttons({createOrder:function(a,c){return c.order.create({intent:"CAPTURE",purchase_units:[{amount:{currency_code:l.processorCurrency.toUpperCase(),value:b(f.paymentCtrl.amount()),breakdown:{item_total:{currency_code:l.processorCurrency.toUpperCase(),value:b(f.paymentCtrl.amount())}}},payee:{merchant_id:l.paypalMerchantId},payment_instruction:{disbursement_mode:"INSTANT",platform_fees:[{amount:{currency_code:l.processorCurrency.toUpperCase(),
value:b(f.paymentCtrl.bookingFee())},payee:{merchant_id:m.LIVE_PLATFORM_FEES_PAYEE_MERCHANT_ID}}]},soft_descriptor:B}],application_context:{brand_name:l.name,payment_method:{payee_preferred:"IMMEDIATE_PAYMENT_REQUIRED"},shipping_preference:"NO_SHIPPING"}})},onApprove:function(a){f.$apply(function(){f.paymentCtrl.processorType(m.PROCESSOR_TYPE);f.paymentCtrl.paypalOrderId(a.orderID);f.submit(A)})},onCancel:function(){f.$apply(function(){console.info("PayPal checkout cancelled")})},onError:function(a){f.$apply(function(){console.error("PayPal checkout error",
a);f.paymentCtrl.addErrorMessage(A,h.ERRORS.UNKNOWN)})}}).render("#ng-paypal-checkout-button");g.status="success"},P=function(){g.status="error"},I="PayPal-"+l.shortname,p=d[I];if(p)n();else{var t={"client-id":m.LIVE_CLIENT_ID,"merchant-id":l.paypalMerchantId,currency:l.processorCurrency.toUpperCase(),"integration-date":"2020-03-10",debug:e.slipstream("isDebug")?"true":"false"},K=s(l);K&&(t["disable-funding"]=K);t=a.compose("https://www.paypal.com/sdk/js",t);K=document.createElement("script");K.setAttribute("data-namespace",
I);K.src=t;K.onload=function(){f.$apply(function(){p=d[I]=window[I];n()})};K.onerror=P;c[0].body.appendChild(K)}}else g.status="error"}]}}]);m.factory("adyen",["$q","models","processors",function(k,f,l){var e=_.extend({},g,{failed:T("More information required")});return{ERRORS:c,ONBOARDING_MESSAGES:e,HELP_DOC_URL:"https://fareharbor.com/help/getting-started/setup/payment-setup-checklist/",DISPUTE_LEARN_MORE_URL:"https://fareharbor.com/help/payments/disputes/refunding-a-disputed-charge/",NAME:"Adyen",
PROCESSOR_TYPE:"adyen",PENDING_STATEMENT_TEXT:"ADYEN",STATEMENT_TEXT_PREFIX:"",STATEMENT_TEXT_REGEX:/^[a-zA-Z0-9 ]+$/,isAddingEmvDevicePossible:function(a){return l.isProcessorPaymentSetupComplete(a,"adyen")},isAdjustmentValid:function(a,c){return a.isProcessable&&"from-company"===a.direction?!c.isAdmin:!0},isAutomaticCreationOfAccountsEnabled:!1,isBankAccountsEnabled:!0,isRefundReserveEnabled:!0,isBankAccountCreationEnabled:function(a){return l.isProcessorVerified(a,"adyen")},isBankAccountTokenizationNeeded:!1,
isBankAccountVerificationDoneViaDeposits:!1,isBookingFeeProratedForRefunds:!1,isCardsEnabled:!1,isCardOnFileEnabled:!0,isCreditCardsEnabled:!0,isConnectedAfterOnboarding:!1,isDeferredChargesEnabled:!0,isDemoCardNumberCheckSupported:!1,isDisputesEnabled:!0,isEmvEnabled:!0,isFileChargesEnabled:!0,isHoldsEnabled:!0,isSofortEnabled:!1,isIdealEnabled:!0,isBancontactEnabled:!0,isPaypalEnabled:!1,isPayoutsEnabled:!0,isTosEnabled:!0,isTransactionsEnabled:!0,isAccountIdentifierVisibleToCompanyUsersWithPermission:!1,
isAdditionalAccountSetupRequired:!0,minimumBookingFee:function(a){return a.minimumFee},minimumChargeAmount:function(a){return f.Payment.minimumChargeAmounts(a,"adyen")},tokenizeCard:function(){var a=k.defer();a.resolve({processorType:"adyen"});return a.promise},chargedCard:function(a){var c={processorType:"adyen",adyenEmvDeviceId:a.emvDeviceId};_.extend(c,a);return c},statementText:function(a){return a.features.adyenStatementText||a.statementText},filterEmvDetails:function(a){return a},handleRedirect:function(a){(new AdyenCheckout).createFromAction(a).mount("#adyen-redirect-component-container")},
updateCompanyFieldForBankAccountVerification:function(a,c){a.isAdyenProcessorDefaultBankAccountReadyForPayout=c.isVerified}}}]);m.directive("ngAdyenCheckout",["db",function(c){var f=c.slipstream("adyenCheckoutLiveOriginKey"),g=c.slipstream("adyenCheckoutTestOriginKey"),e=c.slipstream("targetLanguage"),a=c.slipstream("configuration");c={"en-us":"en-US","en-au":"en-US","en-ca":"en-US","en-gb":"en-US","zh-cn":"zh-CN",da:"da-DK",nl:"nl-NL",fi:"fi-FI",fr:"fr-FR","fr-ca":"fr-FR",de:"de-DE",it:"it-IT",ja:"ja-JP",
ko:"ko-KR",no:"no-NO",pl:"pl-PL",pt:"pt-BR",ru:"ru-RU",es:"es-ES",sv:"sv-SE"};var m={"creditCard.numberField.placeholder":"","creditCard.cvcField.placeholder":"","creditCard.expiryDateField.placeholder":""},h={};_.forEach("en-US zh-CN da-DK nl-NL fi-FI fr-FR de-DE it-IT ja-JP ko-KR no-NO pl-PL pt-BR ru-RU es-ES sv-SE".split(" "),function(a){h[a]=m});var d=c[e]?c[e]:"en-US";return{restrict:"A",controller:["$scope",function(b){b.adyenCheckoutClasses={encryptedCardNumber:{focus:!1,valid:!1,touched:!1,
brand:"card"},encryptedExpiryDate:{focus:!1,valid:!1,touched:!1},encryptedSecurityCode:{focus:!1,valid:!1,touched:!1}};var c={brands:"mc visa discover amex jcb diners cup".split(" "),locale:d,translations:h,environment:"production"===a&&!b.paymentCtrl.company.isDemoModeEnabled?"live":"test",originKey:!b.paymentCtrl.company.isDemoModeEnabled?f:g,onChange:function(a){var c="",d="";if(b.paymentCtrl.isAdyenCheckoutDataValid=a.isValid)c=_.stringifyJSON(a.data.paymentMethod),d=_.stringifyJSON(a.data.browserInfo),
b.paymentCtrl.cardCvc(a.data.paymentMethod.encryptedSecurityCode),b.paymentCtrl.cardNumber(a.data.paymentMethod.encryptedCardNumber);b.paymentCtrl.adyenPaymentMethod(c);b.paymentCtrl.adyenBrowserInfo(d);b.$apply()},onFocus:function(a){b.adyenCheckoutClasses[a.fieldType].focus=a.focus;b.$apply()},onBrand:function(a){b.adyenCheckoutClasses.encryptedCardNumber.brand=a.brand;b.adyenCheckoutClasses.encryptedCardNumber.touched=!0;b.$apply()},onFieldValid:function(a){b.adyenCheckoutClasses[a.fieldType].valid=
a.valid;b.adyenCheckoutClasses[a.fieldType].touched=!0;b.$apply()}},e={fontWeight:"normal",padding:"0 12px"};window.matchMedia("(min-width: 680px)").matches&&(e={fontSize:"13px",fontWeight:"normal",padding:"0 12px"});(new AdyenCheckout(c)).create("securedfields",{hasHolderName:!0,holderNameRequired:!0,autoFocus:!1,styles:{base:e,placeholder:{fontWeight:"normal",color:"#768593"}}}).mount("#adyen-checkout-component-container")}]}}]);m.run(["$rootScope","emv","loginProviders","processors",function(c,
f,g,e){c.emv=f;c.loginProviders=g;c.processors=e}])})();angular.module("auth",["auth.controllers","auth.directives","auth.services"]);
(function(){var m=angular.module("auth.controllers",["lib","navigation"]);m.controller("auth.LoginProviderErrorCtrl",["$scope","navigation",function(c,g){var k=g.get("status")||"",f=g.get("message")||T("Unable to log in via single sign-on.");g.clear("status",!0);g.clear("message",!0);c.errorMessage="";"error"===k&&(c.errorMessage=f)}]);m.controller("auth.LoginCtrl",["$scope","navigation","urls",function(c,g,k){var f=g.get("shortname")||"";c.credentials={shortname:f};c.isSessionExpired=g.get("isSessionExpired")||
!1;g.clear("isSessionExpired",!0);var l=g.get("next");c.submit=function(e){c.credentials.shortname&&(e=k.populate(k.company.login,{shortname:c.credentials.shortname.replace(/\s+/g,"").toLowerCase()}),l&&(e=g.compose(e,{next:l})),g.navigate(e))}}]);m.controller("auth.CompanyLoginCtrl",["$scope","auth","db","navigation","urls",function(c,g,k,f,l){var e=f.currentCompany?f.currentCompany.shortname:"",a=f.get("username")||"";f.clear("username",!0);c.isSessionExpired=f.get("isSessionExpired")||!1;f.clear("isSessionExpired",
!0);c.credentials={shortname:e,username:a,password:""};c.isForceReloadingAfterSuccess=!1;var m=f.get("next"),a="yes"===f.get("require");!a&&g.currentUser.isAuthenticated&&e===g.currentUser.company.shortname?(f.redirect(m||g.currentUser.company.$url(l.dashboard.index),"replace"),c.isForceReloadingAfterSuccess=!0):(c.differentCompanyLoginUrl=l.root.login,m&&(e={next:m},a&&(e.require="yes"),c.differentCompanyLoginUrl=f.compose(c.differentCompanyLoginUrl,e)),c.submit=function(a){g.login(c.credentials,
a).then(function(){var a=m||g.currentUser.company.$url(l.dashboard.index);c.isForceReloadingAfterSuccess=(k.slipstream("targetLanguage")||"")!==c.company.language;f.navigate(a,null,c.isForceReloadingAfterSuccess)},function(a){a.data.passwordChangeToken?(a=f.compose(l.root.forgot.resetPassword,{token:a.data.passwordChangeToken,shortname:c.credentials.shortname,username:c.credentials.username,isPasswordChangeRequired:!0}),f.navigate(a)):c.credentials.password=""})},c.providerLogin=function(){c.isForceReloadingAfterSuccess=
!0;var a=f.currentCompany.$url(l.api.providerLogin);m&&(a=f.compose(a,{next:m}));f.navigate(a,"extend",!0)},c.LOGIN_PROVIDER_OPTION="login-provider",c.FAREHARBOR_OPTION="fareharbor",c.isShowingLoginOptions=f.currentCompany.features.isLoginProviderEnabled&&!f.currentCompany.features.isLoginProviderRequired,c.currentLoginOption=c.isShowingLoginOptions?"":!f.currentCompany.features.isLoginProviderEnabled?c.FAREHARBOR_OPTION:c.LOGIN_PROVIDER_OPTION,c.selectLoginOption=function(a){c.currentLoginOption=
a||""})}]);m.controller("auth.ForgotPasswordCtrl",["$scope","db","flash","navigation","urls",function(c,g,k,f,l){var e=f.get("shortname")||"";f.clear("shortname",!0);var a=f.get("username")||"";f.clear("username",!0);c.alreadyHasCompany=!!e;c.credentials={shortname:e,username:a};c.submit=function(a){g.forgot.password({},c.credentials,a).$promise.then(function(){k.success(T("An email has been sent to the address associated with this account."));f.navigate(l.root.login)})}}]);m.controller("auth.ResetPasswordCtrl",
["$scope","auth","clientOptions","db","flash","navigation","urls",function(c,g,k,f,l,e,a){var m=e.get("shortname")||"";e.clear("shortname",!0);var h=e.get("username")||"";e.clear("username",!0);var d=e.get("token")||"";e.clear("token",!0);var b;k.preview&&(b={},b.preview=k.preview);c.isPasswordChangeRequired=!!e.get("isPasswordChangeRequired");e.clear("isPasswordChangeRequired",!0);c.company=f.company({shortname:m},null,null,b);!m||!h||!d?(l.error(T("Bad password reset link")),e.navigate(a.root.login)):
(c.credentials={token:d,username:h,shortname:m,password:""},c.submit=function(b){f.forgot.password.reset({shortname:m},c.credentials,b).$promise.then(function(){l.success(T("Your password has been changed."));g.login(c.credentials,b).then(function(){var b=e.get("next")||g.currentUser.company.$url(a.dashboard.index),d=(f.slipstream("targetLanguage")||"")!==c.company.language;e.navigate(b,null,d)},function(){c.credentials.password=""})})})}]);m.controller("auth.ForgotCredentialsCtrl",["$scope","db",
"flash","navigation","urls",function(c,g,k,f,l){c.credentials={email:""};c.submit=function(e){var a=c.credentials.email;g.forgot.credentials({},c.credentials,e).$promise.then(function(){k.success(T("We emailed you at")+" <b>"+a+"</b>.");f.navigate(l.root.login)})}}])})();
(function(){angular.module("auth.directives",[]).config(["$compileProvider","d",function(m,c){var g=function(f,g){if(!g.parse||!g.permission)throw Error("auth: "+f+": invalid directive definition");return m.directive(f,c.conditionalDirective({name:f,watch:["$injector","$parse","auth",function(e,a,k){var h=c.safeInvoke(e,g.permission),d=c.safeInvoke(e,g.parse);return function(b,c,e){var g=d(e),l=e.ngCanOnlyWhen?a(e.ngCanOnlyWhen):_.always,k=e.ngCanAlsoWhen?a(e.ngCanAlsoWhen):_.never,m=!e.ngCanOnce||
b.$eval(e.ngCanOnce),q,n=!0;return function(){try{if(k(b))return!0;if(!l(b))return!1;var a;m&&!n?a=q:(a=q=h(g(b)),n=!1);return a}catch(c){throw console.error("auth: "+f+": error checking permission for arguments: "+e[f]),c;}}}}],once:function(c,a,f){return!f.ngCanOnlyWhen&&!f.ngCanAlsoWhen&&(!f.ngCanOnce||c.$eval(f.ngCanOnce))},operator:function(c,a,f){return function(a){f.ngThen&&(c[f.ngThen]=a);return a}}}))},k=function(c,l){return g(c,{parse:["$parse",function(e){return function(a){return e(a[c])}}],
permission:["auth",function(c){return function(a){return c.permissions.can(l.permission,a)}}]})};k("ngCanView",{permission:"view"});k("ngCanUpdate",{permission:"update"});k("ngCanRemove",{permission:"remove"});k("ngCanAdminView",{permission:"adminView"});k("ngCanAdminUpdate",{permission:"adminUpdate"});k("ngCanViewAmounts",{permission:"viewAmounts"});k("ngCanViewDashboardSection",{permission:"viewDashboardSection"});k("ngCanViewAdminSection",{permission:"viewAdminSection"});k("ngCanViewManifestSection",
{permission:"viewManifestSection"});k("ngCanViewInvoiceAmounts",{permission:"viewInvoiceAmounts"});k=function(c,l){return g(c,{parse:["$parse",function(e){return function(a){a=a[c].match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s*$/);if(!a)throw Error("auth: "+c+": expected expression of the form '_type_ on _object_'");var g=a[1],h=e(a[2]);return function(a){return{cls:g,owner:h(a)}}}}],permission:["auth",function(c){return function(a){return c.permissions.can(l.permission,a.cls,a.owner)}}]})};k("ngCanCreate",
{permission:"create"});k("ngCanList",{permission:"list"});k("ngCanClear",{permission:"update"});k("ngCanAdminCreate",{permission:"adminCreate"});k("ngCanAdminList",{permission:"adminList"});g("ngCan",{parse:["$parse",function(c){return function(g){var e=g.ngCan.match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s*$/);g=g.ngCan.match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s+with\s+([\s\S]+)\s*$/);if(!e&&!g)throw Error("auth: ng-can: expected expression of the form '_type_ on _object_' or '_type_ on _model_ with _object_'");
var a=e[1],k=_.never,h=_.never;g?(k=c(g[2]),h=c(g[3])):h=c(e[2]);return function(c){return{permission:a,object:h(c),cls:k(c)}}}}],permission:["auth",function(c){return function(g){return!g.cls?c.permissions.can(g.permission,g.object):c.permissions.can(g.permission,g.cls,g.object)}}]});g("ngCanAny",{parse:["$parse",function(c){return function(g){var e=c(g.ngCanAny),a,k;g.ngCanAnyWith?(a=c(g.ngCanAnyOn),k=c(g.ngCanAnyWith)):(a=_.never,k=c(g.ngCanAnyOn));return function(c){return{permissions:e(c),object:k(c),
cls:a(c)}}}}],permission:["auth",function(c){return function(g){return!g.cls?_.any(g.permissions,function(e){return c.permissions.can(e,g.object)}):_.any(g.permissions,function(e){return c.permissions.can(e,g.cls,g.object)})}}]})}])})();
(function(){var m=angular.module("auth.services",["db.services","lib.services","urls.services"]);m.factory("auth",["$browser","$http","$injector","$q","$rootScope","$timeout","convert","db","events","models","sessionStorage","storage","urls",function(c,g,k,f,l,e,a,m,h,d,b,A,s){var r=["canUpdateOnlyFutureBookings","canViewOnlyCrewedAvailabilities"],y=["canView","canList"],G=m.slipstream("isReadonlyEnabled"),w={isAuthenticated:!1};c={};var B=function(a){var b=F.currentUser;return(a=a||b.company)&&b.isAuthenticated&&
b.company&&b.company===a},n=function(){var a=F.currentUser;return a.isAuthenticated&&a.company&&a.company.isAdmin},P=function(a){return a.affiliation&&a.affiliation.affiliateCompany===F.currentUser.company},I=function(a,b){var c=a.conditions.maxCompanyTier;if(_.isNumber(c)){var d=b.features?b.features.tier:null;if(_.isNumber(d)&&d>c)return!1}return!0},p={},t={},K=function(a,b){if(F.currentUser.isAuthenticated){var c=b.uri,d=t[c];if(!_.isUndefined(d))return d;d=x(a,b);return t[c]=d}};a=function(){t=
{}};h.on(l,"auth.login",a);h.on(l,"auth.logout",a);h.on(l,"auth.clearEffectiveGroupCache",a);var x=function(a,b){var c,d;if(F.currentUser.company===b)c=F.currentUser.group;else if(F.currentUser.company.isAdmin)(c=F.currentUser.adminGroup)&&!I(c,b)&&(c=null);else if(F.currentUser.company.isAffiliate){var e=_.findWhere(F.currentUser.company.partners,{company:b});F.currentUser.partnerGroup&&(e&&e.affiliateGroup)&&(d={groupPermissions:_.omit(e.affiliateGroup.groupPermissions,function(a,b){return!(a&&
_.get(F.currentUser.partnerGroup.groupPermissions,b,!1))})},_.forEach(r,function(a){if(e.affiliateGroup.groupPermissions[a]||F.currentUser.partnerGroup.groupPermissions[a])d.groupPermissions[a]=!0}))}if(!c){var f=_.findWhere(F.currentUser.relatedGroupOverrides,{company:b});f||(f=_.findWhere(F.currentUser.company.relatedGroupOverrides,{company:b,relatedUser:null}));f&&(c=f.group||F.currentUser.group)}if(c=c||d)return c;console.warn("auth: user with no effective group",F.currentUser,a,b)},E=function(a){if(!a)throw console.error("auth: invalid permission",
this,a,this.cls),Error("auth: invalid permission");a="can"+_.capitalize(a);if(u.call(this,a)){var b=p[this.cls][a];return!b?(console.error("auth: invalid permission configuration",this,a,p,b),!1):R.call(this,b)}return!1},J=function(a){var b,c,e;if(2===arguments.length)c=(b=arguments[1])?b.cls:"",e=d.Company.forObject(b);else if(3===arguments.length){b=null;if((c=arguments[1])&&!_.isString(c))c=c.cls;e=arguments[2]}else console.error("auth: invalid arguments when checking permission",arguments);if(_.isUndefined(b))throw console.error("auth: invalid object when checking permission",
a,b),Error("auth: invalid object when checking permission "+a);if(!c)throw console.error("auth: invalid class when checking permission",a,c,e),Error("auth: invalid class when checking permission "+a);if(!e)throw console.error("auth: invalid owner when checking permission",a,c,e),Error("auth: invalid owner when checking permission "+a);var f=d.Company.forObject(e);if(!f)throw console.error("auth: invalid company when checking permission",a,c,e,b),Error("auth: invalid company when checking permission "+
a);var g=K(b,f);b={company:f,instance:b,owner:e,cls:c,group:g,permissions:g?g.groupPermissions:{},can:E};f!==e&&(b[_.uncapitalize(e.cls)]=e);(c=p[c].init)&&c.call(b);return E.call(b,a)};l=function(a){return function(){var b=_.toArray(arguments);b.unshift(a);return J.apply(this,b)}};c.canView=l("view");c.canUpdate=l("update");c.canRemove=l("remove");c.canAdminView=l("adminView");c.canAdminUpdate=l("adminUpdate");c.canCreate=l("create");c.canList=l("list");c.canAdminCreate=l("adminCreate");c.canAdminList=
l("adminList");c.can=J;var v=function(a,b,c){b=b||!1;c=_.isUndefined(c)?b:c;a=_.capitalize(a);var d="canView"+a,e="canEdit"+a,f="canEditPrivateProperties"+a;a="canViewPrivateProperties"+a;return{canView:function(){return b?!0:this.permissions[d]},canList:function(){return c?!0:this.permissions[d]},canCreate:e,canUpdate:e,canRemove:e,canClear:e,canAdminUpdate:f,canAdminCreate:f,canAdminView:a,canAdminList:a}},M=function(a,b){if(!this||!this.permissions)throw console.error("auth: this context needed to check canUpdatePastBooking",
this),Error("auth: this context needed");a=a||this.booking;if(!a)throw console.error("auth: booking reference needed to check canUpdatePastBooking",this),Error("auth: booking reference needed");return b&&a.availability.company.features.isLimitedPastBookingUpdatesEnabled||!this.permissions.canUpdateOnlyFutureBookings||!d.Availability.isInPast(a.availability)};l=function(a,b){b=b||{};var c=b.field||"booking";a=_.capitalize(a);var d=b.permissionOverrides||{},e=_.isUndefined(b.checkPastBooking)?!0:b.checkPastBooking,
f=b.isLimitedPastBookingUpdate||!1,g=d.canView||"canView"+a,h=d.canList||"canView"+a,k=d.canCreate||"canEdit"+a,l=d.canUpdate||"canEdit"+a,n=d.canRemove||"canEdit"+a;return _.extend(v(a,b.canAlwaysView,b.canAlwaysList),{init:function(){this.instance&&(this.booking=_.getDotted(this.instance,c))},canView:function(){return!this.group?!0:!J("view",this.booking)?!1:this.permissions[g]},canList:function(){return!this.group?!0:!J("view",this.booking)?!1:this.permissions[h]},canCreate:function(){return!J("update",
this.booking)||this.booking&&e&&!M.call(this,this.booking,f)?!1:this.permissions[k]},canUpdate:function(){return!J("update",this.booking)||e&&!M.call(this,this.booking,f)?!1:this.permissions[l]},canRemove:function(){return!J("update",this.booking)||e&&!M.call(this,this.booking,f)?!1:this.permissions[n]}})};var R=function(a){if(_.isFunction(a))return a.apply(this);if(_.isString(a))return this.permissions[a]||!1},u=function(a){return G&&!_.find(y,function(b){return 0===a.indexOf(b)})?!1:!0};a=function(a,
b){return function(){a=_.isArray(a)?a:[a];var c=!0,d=_.clone(this);d.cls=d.company.cls;if(!u.call(this,b))return!1;_.forEach(a,function(a){if(!d.can(a)||!u.call(this,a))return c=!1});return c&&R.call(this,b)}};p[d.Company.cls]=v("company",!0);p[d.Company.cls].canCreate=function(){return!n()?!1:this.permissions.canEditCompanies};p[d.Company.cls].canRemove=function(){return this.instance===F.currentUser.company?!1:this.can("create")};p[d.Company.cls].canUpdateCompanyWebsite="canEditCompany";p[d.Company.cls].canUpdateCompanyPayments=
a("viewAmounts","canEditAccounting");p[d.Company.cls].canEditAccounting=a("viewAmounts","canEditAccounting");p[d.Company.cls].canEditTransportation="canEditTransportation";p[d.Company.cls].canDuplicateAcrossCompanies=function(){return F.currentUser.company.isAdmin&&this.permissions.canEditTransportation};p[d.Company.cls].canViewAmounts=function(){return!this.group&&!F.currentUser.isAuthenticated?!0:this.permissions.canViewAmounts};p[d.Company.cls].canViewInvoiceAmounts="canViewInvoiceAmounts";p[d.Company.cls].canViewPricing=
a("viewAmounts","canViewSheets");p[d.Company.cls].canUpdatePricing=a("viewAmounts","canEditPricing");p[d.Company.cls].canViewAdminSection=function(){return!F.currentUser.isAuthenticated?!1:F.currentUser.company.isAdmin&&this.permissions.canViewAdminSection};p[d.Company.cls].canViewDashboardSection="canViewDashboardSection";p[d.Company.cls].canViewItemsSection="canViewItemsSection";p[d.Company.cls].canViewSettingsSection="canViewSettingsSection";p[d.Company.cls].canViewBookingsSection="canViewBookingsSection";
p[d.Company.cls].canViewManifestSection="canViewManifestSection";p[d.Company.cls].canSkipContactName=function(){return n()||this.permissions.canSkipContactName};p[d.Company.cls].canViewReports="canViewReports";p[d.Company.cls].canViewNetworkSettings="canViewNetworkSettings";p[d.Company.cls].canCancel=function(){return this.permissions.canCancelBookings};p[d.Company.cls].canCancelEligible=function(){return this.permissions.canCancelEligibleBookings};p[d.Company.cls].canAdminUpdatePaymentSettings=function(){return n()&&
this.can("update")&&this.permissions.canEditPrivatePropertiesCompanyPayments};p[d.Company.cls].canEditSheets="canEditSheets";p[d.TagGroup.cls]=v("tags",!0);var X=function(){return!n()||!this.company.isAdmin?!1:this.permissions.canEditTags};p[d.TagGroup.cls].canCreate=X;p[d.TagGroup.cls].canUpdate=X;p[d.TagGroup.cls].canRemove=X;p[d.Tag.cls]=p[d.TagGroup.cls];p[d.TagInstance.cls]=v("tagInstances",!0);X=function(){return!n()||!J("update",this.owner)?!1:this.permissions.canEditTagInstances};p[d.TagInstance.cls].canCreate=
X;p[d.TagInstance.cls].canUpdate=X;p[d.TagInstance.cls].canRemove=X;p[d.CustomManifest.cls]=v("customManifests");p[d.CustomCalendar.cls]=v("customCalendars");p[d.CustomReport.cls]=v("customReports");p[d.Role.cls]=v("roles");p[d.CrewMember.cls]=v("crewMembers");p[d.CrewMember.cls].canCreateSelfAssignable="canEditCrewMembersSelfAssignable";p[d.CrewMember.cls].canUpdate=function(){return this.permissions.canEditCrewMembers?!0:this.instance.user===F.currentUser?this.permissions.canEditCrewMembersSelfAssignable:
!1};p[d.CrewMember.cls].canRemove=function(){return this.permissions.canEditCrewMembers?!0:this.instance.user===F.currentUser?this.permissions.canEditCrewMembersSelfAssignable:!1};p[d.CrewMember.cls].canCreate=function(){return this.permissions.canEditCrewMembers};p[d.Group.cls]=v("groups");p[d.GroupOverride.cls]=v("groups");p[d.User.cls]=v("users",!0);p[d.User.cls].canUpdate=function(){return this.instance===F.currentUser?!0:this.permissions.canEditUsers};p[d.User.cls].canRemove=function(){return this.instance===
F.currentUser?!1:this.permissions.canEditUsers};p[d.Agent.cls]=v("agents",!0);p[d.Agent.cls].canCreate=function(){return this.permissions.canEditAgents?!0:!this.affiliation?!1:B(this.affiliation.affiliateCompany)?J("create",d.Agent,this.affiliation.affiliateCompany):!1};p[d.Desk.cls]=v("desks",!0);p[d.Desk.cls].canCreate=function(){if(this.permissions.canEditDesks)return!0;if(!this.affiliation)return!1;if(B(this.affiliation.affiliateCompany))return J("create",d.Desk,this.affiliation.affiliateCompany)};
p[d.Affiliation.cls]=v("network");p[d.Affiliation.cls].canView=function(){return this.permissions.canViewNetwork?!0:!this.instance?!1:J("view",d.Affiliation,this.instance.affiliateCompany)};p[d.Affiliation.cls].canRemove=function(){return this.permissions.canEditNetwork?!0:!this.instance?!1:J("remove",d.Affiliation,this.instance.affiliateCompany)};p[d.AvailabilityHeadline.cls]=v("items",!0);p[d.AvailabilityHeadline.cls].canListAssociatedItems="canListAssociatedItems";p[d.CannedMessage.cls]=v("cannedMessages");
p[d.CannedMessage.cls].canListAssociatedItems="canListAssociatedItems";p[d.Item.cls]=v("items",!0);p[d.Item.cls].canView=function(){return!this.instance.isPrivate||this.permissions.canViewItems};p[d.Item.cls].canViewPrivate="canViewPrivateItems";p[d.Item.cls].canUpdateLedger=function(){return this.can("update")&&this.permissions.canViewAccounting&&this.permissions.canEditAccounting};p[d.Item.cls].canUpdateCheckinStatuses=function(){return this.permissions.canEditCheckinStatuses};p[d.FlowNode.cls]=
v("flowNodes",!0);p[d.Image.cls]=v("images",!0);p[d.CustomField.cls]=v("customFields",!0);p[d.CustomField.cls].canListAssociatedItems="canListAssociatedItems";p[d.CustomField.cls].canViewPrivate="canViewPrivateCustomFields";p[d.ExtendedOption.cls]=v("customFields",!0);p[d.TransportationOption.cls]=v("customFields",!0);p[d.ConnectedCampaign.cls]=v("customFields",!0,!1);p[d.ConnectedWaiver.cls]=v("customFields",!0,!1);p[d.GeneratingCampaign.cls]=v("customFields",!0);p[d.CustomFieldInstance.cls]=v("customFields",
!0);p[d.CustomFieldInstanceCondition.cls]=v("customFields",!0);p[d.CustomFieldInstanceGroup.cls]=v("customFields",!0);p[d.CustomFieldInstanceGroup.cls].canListAssociatedItems="canListAssociatedItems";p[d.Availability.cls]=v("availabilities",!0);p[d.Availability.cls].canCreate=function(){return this.permissions.canViewOnlyCrewedAvailabilities?!1:this.permissions.canCreateAvailabilities};p[d.Availability.cls].canBookClosed="canBookClosedAvailabilities";p[d.Availability.cls].canOverbook="canOverbookAvailabilities";
p[d.Availability.cls].canBookCancelled="canBookCancelledAvailabilities";p[d.Availability.cls].canBookUnbookable=function(){return B(this.company)||this.permissions.canBookClosedAvailabilities||this.permissions.canOverbookAvailabilities};p[d.Availability.cls].canSelectExclusiveSeatGroup=function(){return B(this.company)||n()};p[d.Availability.cls].canUpdateMultiple=function(){return this.permissions.canViewOnlyCrewedAvailabilities?!1:this.permissions.canEditMultipleAvailabilities};p[d.Availability.cls].canViewCapacities=
"canViewAvailabilityCapacities";p[d.Availability.cls].canReportOn="canViewAvailabilities";p[d.Availability.cls].canViewOnlyCrewed="canViewOnlyCrewedAvailabilities";p[d.Availability.cls].canUpdateLedger=function(){return this.can("update")&&this.permissions.canViewAccounting&&this.permissions.canEditAccounting};p[d.CustomerType.cls]=v("customerTypes",!0);p[d.CustomerType.cls].canListAssociatedItems="canListAssociatedItems";p[d.CheckinStatus.cls]=v("checkinStatuses");p[d.Campaign.cls]=v("campaigns",
!0);p[d.Code.cls]=v("codes");p[d.CampaignValidityRule.cls]=v("campaigns",!0);p[d.StoredValueType.cls]=v("storedValueCards");p[d.StoredValueCard.cls]=v("storedValueCards",!0,!1);p[d.StoredValueCard.cls].canReportOn=function(){return this.permissions.canViewStoredValueCards};p[d.StoredValueCard.cls].canIssue=function(){return this.permissions.canIssueStoredValueCards};p[d.StoredValueAdjustment.cls]=v("storedValueCards",!0);p[d.PaymentProcessingDocument.cls]=v("paymentProcessingDocuments");p[d.PaymentProcessingDocument.cls].canReportOn=
function(){return this.permissions.canViewAdvancedReport};p[d.Fund.cls]=function(a){a="canView"+_.capitalize(a);return{canView:a,canList:a,canCreate:_.never,canUpdate:_.never,canRemove:_.never}}("accounting");p[d.Fund.cls].canView=p[d.Fund.cls].canList=function(){return!n()?!1:this.permissions.canViewAccounting};p[d.Transaction.cls]=p[d.Fund.cls];p[d.Contact.cls]=v("contacts",!0);p[d.InStorePaymentType.cls]=v("inStorePaymentTypes");p[d.EmvDevice.cls]=v("emvDevices");p[d.EmvDevice.cls].canView=p[d.EmvDevice.cls].canList=
function(){return this.permissions.canCreateCreditCardPayments};p[d.EmvDevice.cls].canCreate=p[d.EmvDevice.cls].canRemove=p[d.EmvDevice.cls].canUpdate=function(){return this.permissions.canEditAccounting};p[d.Ledger.cls]=v("accounting");p[d.Ledger.cls].canCreate=function(){return this.permissions.canViewAccounting&&this.permissions.canEditAccounting};p[d.Ledger.cls].canRemove=function(){return this.permissions.canViewAccounting&&this.permissions.canEditAccounting};p[d.Ledger.cls].canUpdate=function(){return this.permissions.canViewAccounting&&
this.permissions.canEditAccounting};p[d.BankAccount.cls]=v("bankAccounts");p[d.BankAccount.cls].canCreate=function(){return this.permissions.canEditAccounting};p[d.BankAccount.cls].canRemove=function(){return this.permissions.canEditAccounting};p[d.BankAccount.cls].canUpdate=function(){return this.permissions.canEditAccounting};p[d.Card.cls]=v("cards",!0);p[d.Card.cls].canCreate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};p[d.Card.cls].canRemove=function(){return this.permissions.canViewCards&&
this.permissions.canEditAccounting};p[d.Card.cls].canUpdate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};p[d.CardAffiliation.cls]=v("cards",!0);p[d.CardAffiliation.cls].canCreate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};p[d.CardAffiliation.cls].canRemove=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};p[d.CardAffiliation.cls].canUpdate=function(){return this.permissions.canViewCards&&
this.permissions.canEditAccounting};p[d.Account.cls]=v("accounting");p[d.Payout.cls]=v("accounting");p[d.Payout.cls].canRetry=function(){return n()&&this.can("adminUpdate")};p[d.Transfer.cls]=v("accounting");p[d.Adjustment.cls]=v("accounting");p[d.Adjustment.cls].canCreate=function(){return!n()?!1:this.permissions.canEditAccounting};p[d.Adjustment.cls].canUpdate=_.never;p[d.Adjustment.cls].canRemove=_.never;p[d.Invoice.cls]=v("invoices");p[d.InvoiceEntry.cls]=v("invoices");p[d.Upload.cls]=v("accounting");
p[d.Upload.cls].canCreateDirectType=function(){return!this.permissions.canEditAccounting?!1:this.permissions.canCreateDirectUploads};p[d.Hotel.cls]=v("hotels",!0);p[d.Hotel.cls].canCreate=function(){return!n()?!1:this.permissions.canEditHotels};p[d.Hotel.cls].canUpdate=p[d.Hotel.cls].canCreate;p[d.Hotel.cls].canRemove=p[d.Hotel.cls].canCreate;p[d.Lodging.cls]=v("transportation",!0);p[d.Pickup.cls]=v("transportation",!0);p[d.PreferredPickup.cls]=v("transportation",!0);p[d.Route.cls]=v("transportation",
!0);p[d.Route.cls].canListAssociatedItems="canListAssociatedItems";p[d.Run.cls]=v("transportation",!0);p[d.Stop.cls]=v("transportation",!0);p[d.Activity.cls]=v("activities");p[d.Activity.cls].canCreate="canEditActivities";p[d.Activity.cls].canView=function(){return d.Activity.isAdminOnly(this.instance)?n():!0};p[d.Activity.cls].canToggleAdminOnlyStatus=function(){return!n()||this.instance.object&&this.instance.object.cls===d.Activity.cls||d.Activity.isAdminOnly(this.instance)&&!this.instance.context.adminOnlyOriginalType?
!1:this.can("update")};p[d.Activity.cls].canCreateNoteOnActivity=function(){return!n()||this.instance.object&&this.instance.object.cls===d.Activity.cls?!1:this.can("create")};p[d.Activity.cls].canList=function(){return this.permissions.canViewActivities||this.permissions.canViewActivitiesSelf};p[d.Activity.cls].canListFeed=function(){return this.permissions.canViewActivitiesFeed};p[d.Waiver.cls]=v("waivers",!0);p[d.WaiverInstance.cls]=l("waiverInstances");p[d.CustomerPrototype.cls]=v("customFields",
!0);p[d.CustomerPrototype.cls].canCreate=function(){return!J("updatePricing",this.company)?!1:this.permissions.canEditCustomFields};p[d.CustomerTypeRate.cls]=v("availabilities",!0);p[d.Block.cls]=v("blocks");p[d.TotalSchedule.cls]=v("sheets");p[d.InvoiceSchedule.cls]=v("sheets");p[d.TotalScheduleEntry.cls]=v("sheets");p[d.InvoiceScheduleEntry.cls]=v("sheets");p[d.TotalScheduleEntryRule.cls]=v("sheets");p[d.InvoiceScheduleEntryRule.cls]=v("sheets");p[d.TotalSheet.cls]=v("sheets");p[d.TotalSheet.cls].canView=
_.always;p[d.TotalSheet.cls].canReportOn=function(){return this.can("list")};p[d.InvoiceSheet.cls]=v("sheets");p[d.InvoiceSheet.cls].canView=_.always;p[d.InvoiceSheet.cls].canReportOn=function(){return this.can("list")};p[d.TotalLine.cls]=v("sheets");p[d.TotalLine.cls].canView=_.always;p[d.TotalLine.cls].canCreate="canEditPricing";p[d.TotalLine.cls].canUpdate="canEditPricing";p[d.TotalLine.cls].canRemove="canEditPricing";p[d.InvoiceLine.cls]=v("sheets");p[d.InvoiceLine.cls].canView=_.always;p[d.InvoiceLine.cls].canCreate=
"canEditPricing";p[d.InvoiceLine.cls].canUpdate="canEditPricing";p[d.InvoiceLine.cls].canRemove="canEditPricing";p[d.TaxType.cls]=v("accounting");p[d.Subscription.cls]=v("users");p[d.Notification.cls]=l("notifications",{checkPastBooking:!1});p[d.Notification.cls].canCreate=_.super(p[d.Notification.cls].canCreate,function(){return!this.booking?this.permissions.canEditNotifications:this.super()});p[d.Notification.cls].canCreateDisputeType=function(){return!n()?!1:this.can("create",this.booking)};p[d.SmsNotification.cls]=
l("smsNotifications",{checkPastBooking:!1});p[d.SmsNotification.cls].canCreate=function(){return this.company.isSmsEnabled&&this.permissions.canEditSmsNotifications&&(this.booking?J("update",this.booking):!0)};p[d.ReviewExpressNotification.cls]=l("reviewExpress",{checkPastBooking:!1});p[d.Order.cls]=v("orders");p[d.Booking.cls]=v("bookings");p[d.Booking.cls].canSkipPayment="canSkipPayment";p[d.Booking.cls].canBookHiddenFields="canBookHiddenFields";p[d.Booking.cls].canViewAffiliateBookings="canViewAffiliateBookings";
p[d.Booking.cls].canOverrideTransportation="canOverrideTransportation";p[d.Booking.cls].canUpdateOnlyFutureBookings="canUpdateOnlyFutureBookings";p[d.Booking.cls].canCreate=function(){return!this.group&&!F.currentUser.isAuthenticated?!0:this.permissions.canCreateBookings};p[d.Booking.cls].canUpdate=function(){return this.permissions.canEditBookings?!0:P(this.instance)};p[d.Booking.cls].canUpdateExplicitTotal=function(){return!this.permissions.canViewAmounts||this.instance&&!this.can("update")||this.instance&&
!M.call(this,this.instance)?!1:this.permissions.canEditBookingExplicitTotals};p[d.Booking.cls].canUpdateExplicitInvoicePrice=function(){return!this.permissions.canViewInvoiceAmounts||this.instance&&!this.can("update")||this.instance&&!M.call(this,this.instance)?!1:this.permissions.canEditBookingExplicitInvoicePrices};p[d.Booking.cls].canViewBookingNote="canViewBookingNotes";p[d.Booking.cls].canUpdateBookingNote=function(){return!this.can("viewBookingNote")||this.instance&&!M.call(this,this.instance)?
!1:this.permissions.canEditBookingNotes};p[d.Booking.cls].canUpdateBookingAffiliations=function(){return!this.can("update")||!M.call(this,this.instance)?!1:this.permissions.canEditBookingAffiliations};p[d.Booking.cls].canUpdateBookingAffiliationInfo=function(){return!this.can("update")||!M.call(this,this.instance)?!1:this.permissions.canEditBookingAffiliationInfo};p[d.Booking.cls].canView=function(){return!this.group||this.permissions.canViewBookings?!0:P(this.instance)};p[d.Booking.cls].canCancel=
function(){return this.can("update")&&this.permissions.canCancelBookings&&M.call(this,this.instance)};p[d.Booking.cls].canCancelEligible=function(){return!this.can("update")||!d.Booking.isEligibleForCancellation(this.instance,F.currentUser)||!M.call(this,this.instance)?!1:this.permissions.canCancelEligibleBookings};p[d.Booking.cls].canRebook=function(){return!this.can("cancel")?!1:this.can("create")};p[d.Booking.cls].canRebookEligible=function(){return!this.can("cancelEligible")||!d.Booking.isEligibleForRebook(this.instance,
F.currentUser)?!1:this.can("create")};p[d.Booking.cls].canEditCustomFieldValues=function(){return this.can("update")&&this.permissions.canEditCustomFieldValues&&M.call(this,this.instance,!0)};p[d.Booking.cls].canPushCustomFieldValues=function(){return this.permissions.canPushCustomFieldValues&&(!this.instance||M.call(this,this.instance,!0))};p[d.Booking.cls].canChangePriceSheets=function(){return!this.permissions.canViewAmounts||this.instance&&!M.call(this,this.instance)?!1:this.permissions.canChangePriceSheets};
p[d.Booking.cls].canReapplyResourceUses=function(){return this.instance&&!M.call(this,this.instance)?!1:this.permissions.canEditResourceUses};p[d.Booking.cls].canSelectResourceRequirements=function(){return this.permissions.canEditResourceUses||B(this.company)||n()};p[d.Booking.cls].canCreateCustomRefunds=function(){return!this.permissions.canViewAmounts||!M.call(this,this.instance,!0)?!1:this.permissions.canCreateCustomRefunds};p[d.Booking.cls].canCreateDeposits=function(){return!F.currentUser.isAuthenticated||
(B(this.company)||n())||this.group&&this.group.pk?!0:!!this.permissions.canCreateDeposits};p[d.Booking.cls].canAdjustCustomFieldValuePrice=function(){return this.instance&&!M.call(this,this.instance)?!1:!!this.permissions.canAdjustCustomFieldValuePrice};p[d.Customer.cls]=l("customers");p[d.Customer.cls].canViewCheckinStatus=function(){return!this.booking?this.permissions.canViewCustomerCheckinStatus:this.can("view")&&this.permissions.canViewCustomerCheckinStatus};p[d.Customer.cls].canUpdateCheckinStatus=
function(){return J("update",this.booking)&&this.permissions.canEditCustomerCheckinStatus&&M.call(this)};p[d.BookingCustomFieldValue.cls]=l("customFieldValues",{isLimitedPastBookingUpdate:!0});p[d.CustomerCustomFieldValue.cls]=l("customFieldValues",{isLimitedPastBookingUpdate:!0});p[d.BookingCustomFieldValue.cls].canUpdate=function(){return this.permissions.canEditCustomFieldValues&&M.call(this,this.booking,!0)};p[d.CustomerCustomFieldValue.cls].canUpdate=function(){return this.permissions.canEditCustomFieldValues&&
M.call(this,this.booking,!0)};p[d.Refund.cls]=l("refunds",{isLimitedPastBookingUpdate:!0});p[d.Refund.cls]=l("refunds",{isLimitedPastBookingUpdate:!0});p[d.Refund.cls].canUpdate=a("viewAmounts",p[d.Refund.cls].canUpdate);p[d.Refund.cls].canCreate=a("viewAmounts",p[d.Refund.cls].canCreate);p[d.Refund.cls].canViewBookingFee=function(){return n()&&this.permissions.canViewAdminSection};p[d.LineItem.cls]=l("lineItems",{isLimitedPastBookingUpdate:!0});p[d.LineItem.cls].canUpdate=a("viewAmounts",p[d.LineItem.cls].canUpdate);
p[d.LineItem.cls].canCreate=a("viewAmounts",p[d.LineItem.cls].canCreate);p[d.LineItem.cls].canRemove=a("viewAmounts",p[d.LineItem.cls].canRemove);p[d.LineItem.cls].canReportOn=function(){return this.permissions.canViewLineItems};p[d.Payment.cls]=l("payments",{isLimitedPastBookingUpdate:!0});p[d.Payment.cls].canCreatePartial=a("viewAmounts","canSkipPayment");p[d.Payment.cls].canCreateWithoutCVC=function(){return n()||this.permissions.canCreateCreditCardPaymentsWithoutCvv};p[d.Payment.cls].canCreateWithoutCardholdersName=
"canSkipCardholderInfo";p[d.Payment.cls].canCreateWithoutPostalCode="canSkipPostalCode";p[d.Payment.cls].canCreateWithoutCountryCode="canSkipPostalCode";p[d.Payment.cls].canCreateCreditCard=a("viewAmounts","canCreateCreditCardPayments");p[d.Payment.cls].canCreateInStore=a("viewAmounts","canCreateInStorePayments");p[d.Payment.cls].canCreateStoredValueCard=a("viewAmounts","canCreateStoredValueCardPayments");p[d.Payment.cls].canCreateDeferred="canCreateDeferredPayments";p[d.Payment.cls].canCreateAffiliate=
function(){return this.permissions.canCreateAffiliatePayments?!0:this.booking?P(this.booking):!1};p[d.Payment.cls].canViewBookingFee=function(){return n()&&this.permissions.canViewAdminSection};p[d.TicketLayout.cls]=v("ticketLayouts",!0);p[d.SupportedLanguage.cls]=v("supportedLanguages");p[d.Translation.cls]=v("translations");p[d.Location.cls]=v("locations");p[d.Location.cls].canView="canEditLocations";p[d.Location.cls].canViewSensitive="canEditLocations";p[d.Location.cls].canList="canEditLocations";
p[d.Report.cls]=v("reports");p[d.Report.cls].canViewAccountsType="canViewAccounting";p[d.Report.cls].canViewEscrowType="canViewAccounting";p[d.Report.cls].canViewFundsType="canViewAccounting";p[d.Report.cls].canViewPayoutsType="canViewAccounting";p[d.Report.cls].canViewTransfersType="canViewAccounting";p[d.Report.cls].canViewInvoicesType="canViewInvoices";p[d.Report.cls].canViewInvoiceableBookingsType="canEditInvoices";p[d.Report.cls].canViewAdvancedType="canViewAdvancedReport";p[d.Report.cls].canViewAgentsSummaryType=
"canViewAgentsSummaryReport";p[d.Report.cls].canViewBookingTypesSummaryType="canViewBookingTypesSummaryReport";p[d.Report.cls].canViewBookingsType="canViewBookingsReport";p[d.Report.cls].canViewCampaignsSummaryType="canViewCampaignsSummaryReport";p[d.Report.cls].canViewContactsType="canViewContactsReport";p[d.Report.cls].canViewCrewSummaryType="canViewCrewSummaryReport";p[d.Report.cls].canViewCustomFieldSummaryType="canViewCustomFieldSummaryReport";p[d.Report.cls].canViewCustomerTypesSummaryType=
"canViewCustomerTypesSummaryReport";p[d.Report.cls].canViewDesksSummaryType="canViewDesksSummaryReport";p[d.Report.cls].canViewItemsSummaryType="canViewItemsSummaryReport";p[d.Report.cls].canViewLineItemsSummaryType="canViewLineItemsSummaryReport";p[d.Report.cls].canViewLodgingsSummaryType="canViewLodgingsSummaryReport";p[d.Report.cls].canViewPaymentsType="canViewPaymentsReport";p[d.Report.cls].canViewDisputesType="canViewDisputesReport";p[d.Report.cls].canViewPickupLocationsSummaryType="canViewPickupLocationsSummaryReport";
p[d.Report.cls].canViewRevenueSummaryType="canViewRevenueSummaryReport";p[d.Report.cls].canViewUsersSummaryType="canViewUsersSummaryReport";p[d.Report.cls].canViewCompaniesType="canViewCompaniesReport";p[d.Report.cls].canViewInProgressReportsType="canViewInProgressReportsReport";p[d.Report.cls].canViewTransactionsType="canViewTransactionsReport";p[d.Report.cls].canViewVolumeType="canViewVolumeReport";p[d.Report.cls].canReport=function(){return!!this.group};m.slipstream("isReadonlyEnabled")&&(p[d.Report.cls].canView=
_.never,p[d.Report.cls].canList=_.never,p[d.Report.cls].canCreate=_.never,p[d.Report.cls].canUpdate=_.never,p[d.Report.cls].canRemove=_.never,p[d.Report.cls].canViewBookingTypesSummaryType=_.never,p[d.Report.cls].canViewAdvancedType=_.never,p[d.Report.cls].canViewPayoutsType=_.never,p[d.Report.cls].canViewItemsSummaryType=_.never,p[d.Report.cls].canViewRevenueSummaryType=_.never,p[d.Report.cls].canReport=_.never);p[d.Resource.cls]=v("resources");p[d.Resource.cls].canListAssociatedItems="canListAssociatedItems";
p[d.Requirement.cls]=v("resources");p[d.RequirementGroup.cls]=v("resources");p[d.RequirementGroup.cls].canListAssociatedItems="canListAssociatedItems";p[d.CustomerPrototypeRequirement.cls]=v("resources");p[d.CustomerTypeRequirement.cls]=v("resources");p[d.ResourceRequirement.cls]=v("resources");p[d.ResourceOverride.cls]=v("resourceUses",!0);p[d.SeatMap.cls]=v("seatMaps",!0);p[d.SeatGroup.cls]=v("seatMaps",!0);p[d.SeatZone.cls]=v("seatMaps",!0);p[d.ResourceUse.cls]=l("resources",{permissionOverrides:{canCreate:"canEditResourceUses",
canUpdate:"canEditResourceUses",canRemove:"canEditResourceUses"}});p[d.ResourceUse.cls].canReapplyAcrossBookings=function(){return this.permissions.canEditResourceUses};p[d.ResourceUse.cls].canList=_.super(p[d.ResourceUse.cls].canList,function(){return!this.booking?this.permissions.canViewResources:this.super()});p[d.AnalyticsService.cls]=v("analyticsServices",!0);p[d.CancellationPolicy.cls]=v("cancellationPolicies",!0);p[d.CancellationPolicy.cls].canListAssociatedItems="canListAssociatedItems";p[d.CancellationRule.cls]=
v("cancellationPolicies",!0);p[d.BookingRestriction.cls]=v("bookingRestrictions",!0);p[d.BookingRestriction.cls].canListAssociatedItems="canListAssociatedItems";c.canBookWithNoFee=function(a,b){return F.currentUser.isAuthenticated};l=function(){return!n()?!1:this.permissions.canEditReseller};p[d.ResellerApp.cls]=v("reseller");p[d.ResellerApp.cls].canList=l;p[d.ResellerAppCompany.cls]=v("reseller");p[d.ResellerCompany.cls]=v("reseller");p[d.ResellerCompany.cls].canList=l;p[d.ResellerAppRequest.cls]=
v("accounting");p[d.ResellerAppRequest.cls].canUpdate=l;p[d.ResellerAppRequest.cls].canRemove=l;p[d.ResellerCompanyMapping.cls]=v("reseller");p[d.ResellerCompanyMapping.cls].canCreate=l;p[d.ResellerCompanyMapping.cls].canList=l;p[d.ResellerCompanyMapping.cls].canRemove=l;p[d.ResellerItem.cls]=v("reseller");p[d.ResellerItemMapping.cls]=v("reseller");p[d.ResellerCustomerType.cls]=v("reseller");p[d.ResellerCustomerTypeMapping.cls]=v("reseller");p[d.ResellerOption.cls]=v("reseller");p[d.ResellerOptionMapping.cls]=
v("reseller");p[d.ResellerKey.cls]=v("resellerKeys");p[d.ResellerKey.cls].canCreate=function(){return this.permissions.canEditResellerKeys?!0:B()};p[d.ResellerKey.cls].canCreateForAnyUser=function(){return this.permissions.canEditResellerKeys};p[d.Order.cls].canCancelEligible=function(){return this.permissions.canCancelEligibleBookings&&!this.can("cancel")};(l=m.slipstream("currentUser"))?l.isAuthenticated=!0:l=w;a=function(a){var b=function(){return F.currentUser.isAuthenticated?F.currentUser.username+
"@"+F.currentUser.company.shortname:"anonymous"};return{get:function(c){return a.get(b()+":"+c)},set:function(c,d){return a.set(b()+":"+c,d)},del:function(c){return a.del(b()+":"+c)},clear:function(){if(a.key&&a.length)for(var c=b(),d,e,f=0;f<a.length;f++)e=a.key(f),d=e.split(":",1)[0],d===c&&a.del(e);else a.clear()}}};var F={CACHED_ENDPOINTS:["/api/v1/version/"],ALLOWED_STATUSES:[400,403],permissions:c,storage:a(A),sessionStorage:a(b),currentUser:l,isSessionExpirationInProgress:!1,isLogoutInProgress:!1,
isCompanyUser:function(a,b){b=b||F.currentUser;return!a||!b?!1:b.company===a},isAuthenticatedForAdminCompany:n,relatedCompanies:function(){return!F.currentUser.isAuthenticated?[]:_.sortBy(_.unique(_.append(_.pluck(d.GroupOverride.companyLevelOverrides(F.currentUser.company.relatedGroupOverrides),"company"),_.pluck(F.currentUser.relatedGroupOverrides,"company"))),"name")},login:function(a,b){var c=m.login({},a,b);return c.$promise.then(function(){F.currentUser=c;F.currentUser.isAuthenticated=!0;h.broadcast("auth.login")})},
logout:function(a){F.storage.clear();F.sessionStorage.clear();F.currentUser=w;a=a?f.defer().promise:g.post(s.api.logout);h.broadcast("auth.logout");return a},expireSession:function(a){var b=k.get("navigation"),c;c=(c=F.currentUser.company)?c.$url(s.company.login):s.index;c=b.compose(c,{isSessionExpired:!0});b.navigate(c);F.isSessionExpirationInProgress=!0;e(function(){F.logout(a);F.isSessionExpirationInProgress=!1})},checkSession:function(a,b,c,d){if((200>d||300<=d)&&!_.contains(F.ALLOWED_STATUSES,
d)||_.contains(F.CACHED_ENDPOINTS,c))return a;b=b("X-fh-active");c=!1;F.currentUser.isAuthenticated&&b&&(c=parseInt(b,10)!==F.currentUser.pk);(F.currentUser.isAuthenticated&&!b||c)&&F.expireSession(c);return a},effectiveGroup:K};return window.$$auth=F}]);m.run(["$rootScope","$window","auth",function(c,g,k){c.auth=k;g.$$auth=k}])})();angular.module("cache",["cache.services"]);
(function(){var m=angular.module("cache.services",["lib.services","urls.services"]);m.factory("cache",["moment","urls",function(c,g){var k=function(a,c){c=c||{};for(var e in a)a.hasOwnProperty(e)&&(c[e]=f(a[e]));return c},f=function(a){if(_.isArray(a)){for(var c=[],e=0,d=a.length;e<d;e++)c.push(f(a[e]));return c}return _.isModelObject(a)?l(a):_.isObject(a)?k(a):a},l=function(a,c){if(_.isUndefined(a)||null===a)return c&&delete e.cache[c],a;if(!_.isObject(a))return a;var f=a.uri;c=c||f;var d=e.cache[c];
f&&(c&&c!==f&&!_.isUndefined(d))&&(console.log("cache: overlapping uris",f,c),delete e.cache[c]);d=_.isUndefined(d)?{}:d;f&&(e.cache[f]=d,d.$url||(d.$url=g.populateForObject));f=k(a,d);f.$fresh=!1;return f},e={cache:{},read:function(a,c){if(_.isUndefined(a))throw Error("cache.read: invalid key");c&&(a="["+a+"]");var f=e.cache[a];_.isUndefined(f)&&(f=c?[]:{},f.uri=a,f.$fresh=!0,e.cache[a]=f);return f},update:l,clear:function(){e.cache={}},fresh:function(a){return!!a.$fresh},populate:f,reference:function(a){if(a.cls&&
a.uri)return{cls:a.cls,pk:a.pk,uri:a.uri}}};return window.$$cache=e}]);m.run(["$rootScope","cache","events",function(c,g,k){k.on(c,"auth.logout",function(){g.clear()})}])})();
(function(){var m=angular.module("cart",["cache","db","navigation"]);m.factory("cart",["$q","$rootScope","$timeout","cache","clientOptions","db","events","flows","models","navigation","require","persistentStorage","urls","xmessage",function(c,g,k,f,l,e,a,m,h,d,b,A,s,r){var y=function(a){return{company:a,entries:[],isNoTax:!1,isCardRequired:!0,totals:{price:0,tax:0,taxByType:{},total:0}}},G=function(){E.status="success";a.broadcast("cart.loaded")},w=function(a){a.totals.price=_.sum(a.entries,"totals.price");
a.totals.tax=_.sum(a.entries,"totals.tax");a.totals.bookingFee=_.sum(a.entries,"totals.bookingFee");var b=_.pluck(a.entries,"totals.taxByType");_.all(b)?a.totals.taxByType=_.reduce(b,_.sumObjectValues)||{}:a.totals.taxByType=void 0;a.isNoTax=_.all(a.entries,"availability.item.isNoTax");a.totals.isAnyBookingFeeOnly=_.any(a.entries,"availability.item.settings.isBookingFeeOnly");a.isCardRequired=_.any(a.entries,"isCardRequired")},B={},n=function(a,c,d,e,f,g){b.assert(!!c,"cart: expected availability");
b.assert(!!d,"cart: expected breakdown");b.defined(e,"price","cart: expected total price");b.defined(e,"tax","cart: expected total tax");b.defined(e,"bookingFee","cart: expected total total");b.defined(e,"deposit","cart: expected total deposit");b.assert(!!f,"cart: expected model");var h=a.company.shortname;B[h]=B[h]||{};var k=B[h][c.uri];k||(k={availability:c},B[h][c.uri]=k,a.entries.push(k));k.customerBreakdown=d;k.totals=e;k.isCardRequired=c.item.isCardRequired;k.model=f;k.newResourceUses=g;w(a)},
P=function(a,b){_.overwriteWithout(a.entries,function(a){return a.availability===b.availability});B[a.company.shortname]&&delete B[a.company.shortname][b.availability.uri];w(a)},I=function(a){_.clear(a.entries);B[a.company.shortname]={};w(a)},p=function(a,b){try{var d=_.map(b.entries,function(a){var b=e.availability(a.availability,null,null,null,{tagAlong:!0});return b.$promise.then(function(){return{availability:b,storedEntry:a}},function(){return null})});return c.all(d).then(function(b){I(a);_.forEach(b,
function(b){if(b){var c=b.availability;b=b.storedEntry;var d=_.choose(b.customerBreakdown,function(a){var b=f.read(a.customerTypeRate.uri);if(b)return{count:a.count,customerTypeRate:b}});n(a,c,d,b.totals,b.model,b.newResourceUses)}});console.info("cart: finished hydrating")})}catch(g){return console.warn("cart: unable to load cart",b,g),c.when(null)}},t=function(a){var b={};b.entries=_.map(a,function(a){var b=_.map(a.customerBreakdown,function(a){return{count:a.count,customerTypeRate:f.reference(a.customerTypeRate)}}),
c=_.map(a.newResourceUses,function(a){return _.extend({},a,{seat:a.seat?f.reference(a.seat):null,startAt:a.startAt.format("YYYY-MM-DDTHH:mm:ss"),endAt:a.endAt.format("YYYY-MM-DDTHH:mm:ss")})});return{availability:s.extract(a.availability),customerBreakdown:b,totals:a.totals,model:a.model,newResourceUses:c}});return b},K=function(a){if(E.company){var b=t(E.entries);b?(console.info("cart: storing",b),b=A.set("cart",b)):b=A.del("cart");a&&(b=b.then(function(){r.broadcast("fareharbor.cart.changed")}));
return b}},x=function(a,b){_.forEach(a.entries,function(a){_.isUndefined(a.totals.feeable)||(a.totals.bookingFee=h.Company.bookingFee(a.availability.company,a.totals.feeable,a.availability.item.isFreeAllowed,a.totals.price,b))});w(a)},E={status:"success",add:function(a,b,c,d,e){n(E,a,b,c,d,e);return K(!0)},remove:function(a){P(E,a);K(!0)},clear:function(){I(E);K(!0)},updateBookingFees:function(a){x(E,a)},search:function(a){return(B[E.company.shortname]||{})[a.uri]||null},keepShoppingUrl:function(a){return m.initialFlowNode?
m.initialUrl():a.$url(s.company.index)},permalinkUrl:function(a){a=s.populate(s.company.cart.permalink,{shortname:a.shortname,cartUuid:l.userIdentifier});return m.extendWithFlow(a)},load:function(){if(E.company&&"loading"!==E.status)return E.status="loading",E.$promise=A.get("cart").then(function(a){if(a)return console.info("cart: hydrating...",a),p(E,a)}).then(G,G),E.$promise},allCompanies:{status:"success",carts:{},load:function(){E.allCompanies.status="loading";E.allCompanies.$promise=A.getForAllCompanies("cart").then(function(a){delete E.allCompanies.$promise;
_.clear(E.allCompanies.carts);B={};var b=[];_.forEach(a,function(a){if(a.cart){var c=a.company.shortname;E.allCompanies.carts[c]=y(a.company);console.info("cart: loading all...",a);b.push(p(E.allCompanies.carts[c],a.cart))}});return c.all(b).then(function(){E.company&&E.allCompanies.carts[E.company.shortname]?_.extend(E,E.allCompanies.carts[E.company.shortname]):_.extend(E,y());E.allCompanies.status="success"},function(){E.allCompanies.status="success"})});return E.allCompanies.$promise}}};_.extend(E,
y(null));var J=function(a){a&&E.company!==a&&(console.info("cart: loading for new company",a),K(),E.company=a,E.load())};J(d.currentCompany);a.on(g,"navigation.company.updated",function(a,b){J(b.company)});a.on(g,"persistentStorage.reIdentifiedUser",function(){d.currentCompany&&(E.company=d.currentCompany,E.load(),console.info("cart: loading for new user"))});return E}]);m.controller("cart.CartCtrl",["$scope","clientOptions","controllers","db","navigation","require",function(c,g,k,f,l,e){g.reflect("userIdentifier")}]);
m.controller("cart.ViewCartCtrl",["$scope","cart",function(c,g){g.load()}]);m.directive("ngCart",["analytics","cart","clientOptions","db","events","flows","lightframe","models","navigation","paymentController","queueToken","tracking","tracking.geo","urls",function(c,g,k,f,l,e,a,m,h,d,b,A,s,r){return{templateUrl:"cart.cart",controller:["$scope","$attrs",function(y,G){f.slipstream("isDebug")&&(window.$$pop=function(a,b){y.$safeApply(function(){var c=a?a.replace(" ","-"):"z",d=_.capitalize(a||"zach");
w.newOrder["contact-name"]=d;w.newOrder["contact-phone"]="4158881212";w.newOrder["contact-email"]=c+"@fareharbor.com";w.newOrder["payments-payment-cardNumber"]="4242424242424242";w.newOrder["payments-payment-cardholdersName"]=d;w.newOrder["payments-payment-cardExpiryMonth"]="12";w.newOrder["payments-payment-cardExpiryYear"]="2023";w.newOrder["payments-payment-cardCvc"]="123";w.newOrder["payments-payment-postalCode"]="12345";w.newOrder["payments-payment-countryCode"]="US";_.extend(w.newOrder,b)})});
var w=this,B={};w.setEntryValidity=function(a,b){var c=a.availability.uri;_.isUndefined(b)?delete B[c]:B[c]=!!b};w.addEntryController=function(a){_.contains(w.entryCtrls,a)||w.entryCtrls.push(a)};w.removeEntryController=function(a){_.contains(w.entryCtrls,a)&&_.ref.remove(w.entryCtrls,a)};w.newOrder=y.newOrder={clientUuid:_.uuid()};w.company=y.$eval(G.ngCart);w.attachControl=function(a,b){w[a]=b;b.cartCtrl=w};w.showCompleteButton=function(a){return!a.$invalid&&!a.$submitting&&0<g.entries.length&&
_.all(B)&&w.paymentCtrl&&w.paymentCtrl.isCurrentOptionValid()&&w.paymentCtrl.isCurrentKindValid()&&!w.paymentCtrl.isAmountTooLow()};w.isEligibleForGiftCardRedemption=function(){return!w.company.features.isOnlineStoredValueCardRedemptionEnabled||!(0<w.cartTotalsCtrl.totals.price+w.cartTotalsCtrl.totals.tax)?!1:!_.any(g.entries,function(a){return m.Item.isDepositRequired(a.availability.item)})};var n=!1;w.isNavigateAwayAllowed=function(a){return n?!0:!a.$pristine?!1:!0};w.getEntryDepositStatus=function(a,
b){return a.model.isDeposit&&m.Booking.isEligibleForDeposit(a.availability.item,a.totals.deposit,b)};var P=function(d,m){m=m||_.ignore;var q=_.extend({},w.newOrder);q.bookingCount=g.entries.length;_.forEach(g.entries,function(a,b){var c="booking"+b.toString()+"-";_.extendWithPrefix(c,q,a.model);q[c+"availability"]=a.availability.pk});console.info("cart: creating order",q);var B={"X-FH-User-Identifier":k.userIdentifier};_.forEach(b.tokens,function(a,b){B["X-QUEUING-TOKEN-"+b]=a.uuid});var x=f.orders.create({shortname:w.company.shortname},
B,q,d);x.$promise.then(function(){if(x.clientAction)w.paymentCtrl.completeClientAction(d,x).then(function(){P(d,m)},function(){A.track(y,"failed-order",{company:w.company.shortname,"company-id":w.company.pk,isLightframe:a.isLightframe(),clientAction:!0});w.paymentCtrl.restoreCard();d.$submitting=!1;m()});else{n=!0;var b=x.$url(r.company.order.index);if(1===x.contributingBookings.length){var f=x.contributingBookings[0];x.isPending?(b=f.$url(r.embeds.book.wait.booking),b=h.extendQuery(b,{status:"initial"})):
b=f.$url(r.company.item.booking)}else x.isPending&&(b=x.$url(r.embeds.book.wait.order),b=h.extendQuery(b,{status:"initial"}));b=e.extendWithFlow(b);x.isPending&&a.isLightframe()?c.storeContext().then(function(){console.log("cart: analytics context sucessfully stored")},function(){console.error("cart: failed to store analytics context")}).finally(function(){b=h.absoluteUrl(b);h.redirect(b)}):h.navigate(b);g.clear();d.$submitting=!0;var f={company:w.company.shortname,"company-id":w.company.pk,total:x.contributingBookingCosts.totalCost.total,
bookingCount:x.bookingCount,isLightframe:a.isLightframe()},k=_.map(x.contributingBookings,"item");_.isArray(k)&&0<k.length&&(f.items=_.unique(_.map(k,"name")),f["item-ids"]=_.unique(_.map(k,"pk")));!1===s.isEU&&(f.order=x.uuid);A.track(y,"completed-order",f);x.isPending?c.trackOrder(x,{trackGAOnly:!0}):c.trackOrder(x);m()}},function(c){A.track(y,"failed-order",{company:w.company.shortname,"company-id":w.company.pk,isLightframe:a.isLightframe()});w.paymentCtrl.restoreCard();d.$submitting=!1;_.isUndefined(c.data.tokens)||
_.forEach(c.data.tokens,function(a){var c=_.find(g.entries,function(b){if(b.availability.item.pk===a.itemPk)return b});c&&(b.replace(c.availability.item,a),l.broadcast("queuing.tokenIssued",a,parseInt(a.itemPk)))});m()})};w.submit=function(a){if(g.entries.length)if(a.$valid){a.$submitting=!0;w.paymentCtrl.saveCard();var b=w.paymentCtrl.isRedirectBasedPaymentOption();w.newOrder.type=b?m.Order.PENDING_TYPE:m.Order.COMPLETED_TYPE;_.forEach(g.entries,function(a){a.model.type=b?m.Booking.PENDING_TYPE:
m.Booking.COMPLETED_TYPE;var c=w.redeemStoredValueCardsCtrl.storedValueCardsAppliedByEntry[a.availability.uri]||0,d=_.sum([a.totals.price,a.totals.tax]);a.model.isDeposit=w.getEntryDepositStatus(a,d-c)});var c=w.paymentCtrl.option();if(c===w.paymentCtrl.CHARGE_OPTION||c===w.paymentCtrl.DEFER_OPTION)w.tokenizingCard=!0;y.$asyncApply(function(b){w.paymentCtrl.createToken(a,function(){w.tokenizingCard=!1;P(a,b)},function(){w.tokenizingCard=!1;a.$submitting=!1;b()})})}else console.error("cart: attempting to submit invalid order form");
else console.error("cart: attempting to submit empty order form")};d(y,{modelKey:"newOrder",fieldPrefix:"payments-payment",company:w.company,gross:function(){return!w.cartTotalsCtrl?0:w.cartTotalsCtrl.totals.isAnyBookingFeeOnly?w.cartTotalsCtrl.totals.bookingFeeOnlyGross:w.cartTotalsCtrl.totals.preBookingFeeTotal},deposit:function(){return!w.cartTotalsCtrl?0:w.cartTotalsCtrl.totals.totalDeposits},isDepositEligible:function(){return!w.cartTotalsCtrl?0:_.any(g.entries,"model.isDeposit")&&0<w.cartTotalsCtrl.totals.totalDeposits},
bookingFee:function(){return!w.cartTotalsCtrl?0:w.cartTotalsCtrl.totals.bookingFee},invoicePrice:0,isAnonymous:!0,isAffiliate:!1,isCompany:!1,isCardRequired:!!g.isCardRequired});w.attachControl("paymentCtrl",y.paymentCtrl)}],controllerAs:"cartCtrl"}}]);m.directive("ngCartEntry",["cart","db","navigation","urls",function(c,g,k,f){return{restrict:"A",require:"^ngCart",templateUrl:"cart.entry",controller:["$scope","$attrs",function(l,e){var a=this;a.status="loading";a.cartCtrl=l.cartCtrl;a.entry=l.$eval(e.ngCartEntry);
a.total=_.sum([a.entry.totals.price,a.entry.totals.tax]);a.isDeposit=function(){return a.cartCtrl.getEntryDepositStatus(a.entry,a.total-(l.cartCtrl.redeemStoredValueCardsCtrl.storedValueCardsAppliedByEntry[a.entry.availability.uri]||0))};a.change=function(){var c=a.entry.availability.$url(f.company.item.book);k.navigate(c)};a.remove=function(d,b){delete d["booking"+b+"-all"];c.remove(a.entry)};var m={};_.forEach(a.entry.customerBreakdown,function(a){m[a.customerTypeRate.pk]=a.count});var h=g.availability.liveCapacity({shortname:a.entry.availability.item.company.shortname,
itemPk:a.entry.availability.item.pk,availabilityPk:a.entry.availability.pk},null,null,{customerTypeRateCounts:_.stringifyJSON(m),totalSheet:a.entry.model.totalSheet});h.$promise.then(function(){a.cartCtrl.setEntryValidity(a.entry,h.isBookable);a.status=a.entry.availability.isBookable&&h.isBookable?"success":"error";a.isPossiblyBookable=a.entry.availability.isBookable},function(){a.cartCtrl.setEntryValidity(a.entry,!0);a.status="success"});l.$on("$destroy",function(){a.cartCtrl.setEntryValidity(a.entry)})}],
controllerAs:"cartEntryCtrl"}}]);m.directive("ngCartTotals",["cart","models","redeemStoredValueCardsController",function(c,g,k){return{restrict:"A",require:"^ngCart",templateUrl:"cart.totals",controller:["$scope",function(f){var l=this;f.cartCtrl.attachControl("cartTotalsCtrl",l);l.cartCtrl=f.cartCtrl;l.totals=_.extend({},c.totals);var e={};l.currentPrice=function(){return l.totals.price};l.currentTax=function(){return l.totals.tax};var a=function(a){return a.availability.uri},m=function(a){return a.totals.price+
a.totals.tax},h=function(b){b=a(b);return e[b]||0},d=function(b){_.clear(e);var d=f.redeemStoredValueCardsCtrl.storedValueCards;if(!d.length)return b;_.forEach(d,function(b){b=f.redeemStoredValueCardsCtrl.applied(b);b=_.prorate(b,c.entries,m,a);_.merge(e,b,_.add)});var k=0;_.forEach(c.entries,function(a){k+=g.Booking.adjustBookingFee(a.totals.bookingFee,a.totals.price,a.totals.tax,h(a))});return k},b=function(){_.extend(l.totals,c.totals);l.totals.bookingFee=d(l.totals.bookingFee);l.totals.preBookingFeeTotal=
l.totals.price+l.totals.tax-f.redeemStoredValueCardsCtrl.totalApplied();l.totals.total=l.totals.preBookingFeeTotal+l.totals.bookingFee;l.totals.totalDeposits=_.sum(c.entries,function(a){var b=m(a)-h(a);a.totals.deposit=g.Booking.effectiveDeposit(a.availability.item,b);return l.cartCtrl.getEntryDepositStatus(a,b)?a.totals.deposit:0});l.totals.amountDue=_.sum(c.entries,function(a){return l.cartCtrl.getEntryDepositStatus(a,m(a)-h(a))?a.totals.deposit:a.availability.item.settings.isBookingFeeOnly?0:a.totals.price+
a.totals.tax-h(a)})+l.totals.bookingFee;l.totals.bookingFeeOnlyGross=_.sum(c.entries,function(a){return a.availability.item.settings.isBookingFeeOnly?0:a.totals.price+a.totals.tax})};f.$watchCollection("cart.entries",function(){b()});k(f,{company:l.cartCtrl.company,modelKey:"newOrder",price:l.currentPrice,tax:l.currentTax,toggleName:"applyStoredValueCard",storedValueCardsAppliedByEntry:e});f.cartCtrl.attachControl("redeemStoredValueCardsCtrl",f.redeemStoredValueCardsCtrl);f.$watch("redeemStoredValueCardsCtrl.storedValueCards.length",
function(a){b()});f.$watch(function(){var a=f.cartCtrl.paymentCtrl?f.cartCtrl.paymentCtrl.processor():null;return null===a?null:a.PROCESSOR_TYPE},function(a){c.updateBookingFees(a);b()})}],controllerAs:"cartTotalsCtrl"}}]);m.directive("ngCartComplete",["cart",function(c){return{restrict:"A",require:"^ngCart",templateUrl:"cart.complete",controller:["$scope",function(c){}],controllerAs:"cartCompleteCtrl"}}]);m.directive("ngCartAdd",["cart","navigation","urls",function(c,g,k){return{restrict:"A",require:"^ngBook",
templateUrl:"cart.add",controller:["$scope",function(f){var k=this;k.isAdding=!1;k.isAvailabilityInCart=!!c.search(f.bookCtrl.availability);k.add=function(){k.isAdding=!0;var e={feeable:f.bookCtrl.bookTotalsCtrl.totals.feeable,price:f.bookCtrl.bookTotalsCtrl.totals.price,tax:f.bookCtrl.bookTotalsCtrl.totals.tax,taxByType:f.bookCtrl.bookTotalsCtrl.totals.taxByType,bookingFee:f.bookCtrl.bookTotalsCtrl.totals.bookingFee,deposit:f.bookCtrl.bookTotalsCtrl.totals.deposit};f.bookCtrl.reflectASN();f.bookCtrl.isAlreadyBooked=
!0;c.add(f.bookCtrl.availability,f.bookCtrl.bookCountsCtrl.customerBreakdown(),e,f.bookCtrl.newBooking,_.get(f.bookCtrl,"bookCountsCtrl.liveCapacity.resourceUses")).then(function(){g.navigate(c.permalinkUrl(f.bookCtrl.item.company))},function(){f.bookCtrl.restoreASN();k.isAdding=!1})}}],controllerAs:"cartAddCtrl"}}]);m.directive("ngCartSubmit",[function(){return{restrict:"A",require:"^ngCart",templateUrl:"cart.submit"}}]);m.run(["$rootScope","cart",function(c,g){c.cart=g;window.$$cart=g}])})();
angular.module("db",["db.services"]);
(function(){var m=0;angular.module("db.services",["cache.services","lib.services"]).factory("db",["$http","$injector","$rootScope","$q","$window","cache","convert","flash","ratelimit","require","urls",function(c,g,k,f,l,e,a,q,h,d,b){var A=!1;angular.element(l).on("beforeunload",function(){A=!0});var s={},r=_.debounce(function(){A||q.warn("<b>"+T("Could not reach FareHarbor.")+"</b> "+T("Please check your internet connection."))},2E3,!0),y=function(a){_.isUndefined(a)&&(a="<b>"+T("That didn't work.")+
"</b> "+T("Please try again."));a&&q.error(a)},G=_.debounce(function(a){q.error("<b>"+interpolate(T("Too many %(errorType)s."),{errorType:a})+"</b> "+T("Please wait a few minutes and try again. If you continue to receive this message please contact")+' <a href="mailto:support@fareharbor.com" target="_blank">support@fareharbor.com</a>.')},2E3,!0),w=_.debounce(function(){q.error("<b>"+T("FareHarbor will be right back.")+"</b> "+T("Please wait a few minutes and try again."))},2E3,!0),B=function(a,b,
c){return c?_.map(a,function(a){return e.update(a)}):e.update(a,b)},n=function(k){var n={},l={isDelete404Success:!0},p=k.formName||k.key+"Form";return function(S,u,v,x,A,D){var t=_.extend({},l,k,A),V=!1!==t.flashError,C=!1!==t.flash500Error,z,E;if(_.isString(S))z=S;else{var F={};_.extend(F,t.defaultParams||{},S);z=b.populate(t.url,F)}E=z;if(_.isUndefined(z))return console.warn("db: invalid endpoint",t.url,F),u=t.isArray?[]:{},u.$promise=f.reject(null),u.$promise.cancel=_.ignore,u;x&&(z+="?"+Vb(a.clientRequest(x)),
x=null);t.ignoreQueryParamsInCacheUri||(E=z);var H=m+=1;console.log("db: endpoint",z,H);if((S=n[z])&&!t.ignoreInFlight){if(t.tagAlong)return console.log("db: tagging along",z,H),S.value;"GET"===t.method&&"GET"===S.method&&(console.log("db: already in flight, cancelling",z,H),S.timeout.promise.cancelled=!0,S.timeout.resolve())}var U;U=t.ignoreCache?t.isArray?[]:{}:e.read(E,t.isArray);if(t.eagerCache&&!U.$fresh)return U;var fa=function(a){a.data&&t.sideKeys&&_.forEach(t.sideKeys,function(b){var c=a.data[b];
c&&(a[b]=B(c,null,_.isArray(c)))})},J=_.identity;t.key&&(J=t.isArray?function(a){console.log("db: success",z,H);if(U.$requestId!==H)return console.log("db: out of order",z,U.$requestId,H),a;var b=_.isFunction(t.key)?t.key(a):t.key;_.overwrite(U,B(a.data[b],null,!0));U.$fresh=!1;a.data?(a.primaryData=a.data[b]=U,fa(a)):a.primaryData=null;v&&I(v,p)(a,U);return a}:function(a){console.log("db: success",z,H);if(U.$requestId!==H)return console.warn("db: out of order",z,U.$requestId,H),a;var b=_.isFunction(t.key)?
t.key(a):t.key,c=a.data[b],c=t.ignoreCache?B(c):B(c,E);a.data?(a.primaryData=a.data[b]=c,fa(a)):a.primaryData=null;v&&I(v,p)(a,c);return a});var K;v&&(K=P(v,p));var L=function(a){console.log("db: error",z,H,a);var b=a.status;if(500===b)return C&&q.error("<b>"+T("Whoops, an internal error has occurred.")+"</b> "+T("FareHarbor has been notified. Please wait a few minutes and try again.")),f.reject(a);if(503===b)return w(),f.reject(a);if(403===b)return V&&(b='href="'+g.get("navigation").loginRedirectUrl(!0)+
'"',q.error("<b>"+T("Not allowed.")+"</b> "+interpolate(T("Please <a %(href)s>log in</a> as a different user or request permission from your administrator."),{href:b}))),f.reject(a);if(420===b)return G("connections"),f.reject(a);if(429===b)return G("requests"),f.reject(a);if(324===b)return r(),f.reject(a);if(0===b||-1===b){if(a.config.timeout&&a.config.timeout.cancelled)return s;r();return f.reject(a)}if(400===b)return K?K(a,b):V&&y(a.data.errorMessage||t.errorMessage),f.reject(a);if(404===b){if(t.isDelete404Success&&
"DELETE"===t.method)return console.log("db: treating 404 as success",z,H),J(a)}else y(a.data.errorMessage||t.errorMessage),console.error("db: unknown error",a,b);return f.reject(a)},M=function(a){return function(b){b=a(b);console.log("db: complete",z,H);t.ignoreInFlight||(n[z]=null);v&&(v.$submitting=!1);U.$requestId===H&&(delete U.$requestId,delete U.$promise);return b}};v&&(v.$submitting=!0);S=f.defer();var O={method:t.method,url:z,data:u||{},timeout:S.promise,headers:D,transformResponse:function(a,
b){a=_.isArray(a)?a:[a];return a.concat(b)}(c.defaults.transformResponse,function(a,b,c){return g.get("auth").checkSession(a,b,z,c)})};u=function(){return c(O).then(M(J),M(L))};t.isRatelimited&&(u=h(u));var N=u();d.assert(!N.success&&!N.error,"db: disallow $http promise interface");t.ignoreInFlight||(n[z]={timeout:S,value:U,requestId:H,method:t.method,uri:z});U.$requestId=H;U.$promise=N;U.$promise.timeout=S;U.$promise.cancel=function(){N.timeout?t.tagAlong?console.warn("db: attempting to cancel a tag-along to request",
z,H):(N.timeout.promise.cancelled=!0,N.timeout.resolve(),t.ignoreInFlight||(n[z]=null),console.log("db: cancelled",z,H)):console.warn("db: cancellation failed",z,H)};return U}},P=function(a,b){return function(c){var d=c.data[b];_.forEach(d,function(b,c){a[c]||(a[c]={$error:{}});var d=a[c];b&&b.length?d.$error.$server=b:d.$error={}});a.$errorCallbacks&&_.forEach(a.$errorCallbacks,function(a){a(d)})}},I=function(a,b){return function(b,c){_.forEach(a,function(a,b){a&&a.$error&&delete a.$error.$server});
a.$successCallbacks&&_.forEach(a.$successCallbacks,function(a){a(c)})}},p=function(a,c){c||(c=a+"s");var d=n({method:"GET",url:b.api[c],isArray:!0,key:c});d.create=n({method:"POST",url:b.api[c],key:a});return d},t=function(a){var c=n({method:"GET",url:b.api[a],key:a});c.update=n({method:"PUT",url:b.api[a],key:a});c.remove=n({method:"DELETE",url:b.api[a],formName:"disableForm"});return c},K=function(a){return function(b,c,d,e,f,g){return n({method:a.method||null,url:a.url||null,key:a.key||null,formName:a.formName||
null,flash500Error:a.flash500Error})(b,d,e,f,g,c)}},x=function(a,b,c){var d={};d[b]=_.isUndefined(c)?"yes":c;return function(b,c,e,f,g){f=_.extend({},d,f);return a(b,c,e,f,g)}},E=function(a){return x(a,"pickable")},J=n({method:"POST",url:b.api.login,key:"user",formName:"loginForm"}),v={};v.password=n({method:"POST",url:b.api.forgotPassword,formName:"forgotPasswordForm"});v.password.reset=n({method:"POST",url:b.api.resetPassword,formName:"resetPasswordForm"});v.credentials=n({method:"POST",url:b.api.forgotCredentials,
formName:"forgotCredentialsForm"});var M=n({method:"GET",url:b.api.reportTest,key:"report"}),R=n({method:"GET",url:b.api.companies,isArray:!0,key:"companies"});R.pickable=E(R);R.jump=x(R,"jump");R.full=x(R,"full");R.create=n({method:"POST",url:b.api.companies,key:"company"});R.admin=n({method:"GET",url:b.api.company,key:"company",defaultParams:{shortname:"admin"}});R.report=n({method:"GET",url:b.api.reportCompanies,key:"report"});var u=n({method:"GET",url:b.api.company,key:"company"});u.update=n({method:"PUT",
url:b.api.company,key:"company"});u.remove=n({method:"DELETE",url:b.api.company,formName:"disableForm"});u.styles={};u.styles.update=n({method:"PUT",url:b.api.companyStyles,key:"styles",formName:"companyStylesForm"});u.adminNotes={};u.adminNotes.update=n({method:"PUT",url:b.api.companyAdminNotes,key:"adminNotes",formName:"companyAdminNotesForm"});u.accounts=n({method:"GET",url:b.api.companyAccounts,isArray:!0,key:"accounts"});u.accounts.report=n({method:"GET",url:b.api.reportAccounts,key:"report"});
u.nags={};u.nags.update=n({method:"PUT",url:b.api.companyNags,key:"companyNags",formName:"companyNagsForm"});u.companyFeatures={};u.companyFeatures.update=n({method:"PUT",url:b.api.companyFeatures,key:"companyFeatures",formName:"companyFeaturesForm"});u.refundReserve={};u.refundReserve.update=n({method:"PUT",url:b.api.refundReserve,key:"companyFeatures",formName:"refundReserveForm"});u.itemColorsFeature={};u.itemColorsFeature.update=n({method:"PUT",url:b.api.companyItemColorsFeature,key:"companyItemColorsFeature",
formName:"companyItemColorsFeatureForm"});u.contactInformation={};u.contactInformation.update=n({method:"PUT",url:b.api.companyContactInformation,key:"contactInformation",formName:"companyContactInformationForm"});u.processorAccount={};u.processorAccount.create=n({method:"POST",url:b.api.processorAccount,key:"processorAccount"});u.tosAcceptance={};u.tosAcceptance.update=n({method:"PUT",url:b.api.companyTosAcceptance,key:"tosAcceptance",formName:"companyTosAcceptanceForm"});u.processorOnboard={};u.processorOnboard.update=
n({method:"PUT",url:b.api.processorOnboard,key:"processorOnboard",formName:"processorOnboardForm"});u.processorCompleteAccountSetup={};u.processorCompleteAccountSetup.update=n({method:"PUT",url:b.api.processorCompleteAccountSetup,key:"processorCompleteAccountSetup",formName:"processorCompleteAccountSetupForm"});u.escrowReport=n({method:"GET",url:b.api.reportEscrow,key:"report"});u.profile={};u.profile.update=n({method:"PUT",url:b.api.companyProfile,key:"profile",formName:"companyProfileForm"});u.payments=
{};u.payments.update=n({method:"PUT",url:b.api.companyPayments,key:"payments",formName:"companyPaymentsForm"});u.manifestSettings={};u.manifestSettings.update=n({method:"PUT",url:b.api.companyManifestSettings,key:"manifestSettings",formName:"manifestSettingsForm"});u.images=n({method:"GET",url:b.api.companyImages,key:"images",isArray:!0});u.images.create=n({method:"POST",url:b.api.companyImages,key:"image"});u.image={};u.image.update=n({method:"PUT",url:b.api.companyImage,key:"image"});u.image.remove=
n({method:"DELETE",url:b.api.companyImage});u.activities={};u.activities.all=n({method:"GET",url:b.api.allActivities,isArray:!0,key:"activities"});u.activities.system=n({method:"GET",url:b.api.systemActivities,isArray:!0,key:"activities"});u.activities.admin=x(u.activities.system,"admin");u.calendar=n({method:"GET",url:b.api.companyCalendar,key:"calendar"});u.summaryReport={};u.summaryReport.items=n({method:"GET",url:b.api.reportItemsSummary,key:"report"});u.summaryReport.users=n({method:"GET",url:b.api.reportUsersSummary,
key:"report"});u.summaryReport.bookingTypes=n({method:"GET",url:b.api.reportBookingTypesSummary,key:"report"});u.summaryReport.customerTypes=n({method:"GET",url:b.api.reportCustomerTypesSummary,key:"report"});u.summaryReport.customField=n({method:"GET",url:b.api.reportCustomFieldSummary,key:"report"});u.summaryReport.lodgings=n({method:"GET",url:b.api.reportLodgingsSummary,key:"report"});u.summaryReport.pickups=n({method:"GET",url:b.api.reportPickupsSummary,key:"report"});u.summaryReport.crew=n({method:"GET",
url:b.api.reportCrewSummary,key:"report"});u.summaryReport.agents=n({method:"GET",url:b.api.reportAgentsSummary,key:"report"});u.summaryReport.desks=n({method:"GET",url:b.api.reportDesksSummary,key:"report"});u.summaryReport.campaigns=n({method:"GET",url:b.api.reportCampaignsSummary,key:"report"});u.summaryReport.revenue=n({method:"GET",url:b.api.reportRevenueSummary,key:"report"});u.advancedReport=n({method:"POST",url:b.api.reportAdvanced,key:"report"});u.seatZones=n({method:"GET",isArray:!0,url:b.api.companySeatZones,
key:"seatZones"});var X=p("group"),F=t("group");F.duplicate=n({method:"POST",url:b.api.duplicateGroup,key:"group",formName:"duplicateGroupForm"});F.remove=n({method:"DELETE",url:b.api.group,formName:"disableForm"});var S=p("groupOverride");S.related=n({method:"GET",url:b.api.relatedGroupOverrides,isArray:!0,key:"groupOverrides"});var V=t("groupOverride");V.activities=n({method:"GET",url:b.api.groupOverrideActivities,isArray:!0,key:"activities"});var U=p("bankAccount"),fa=t("bankAccount");fa.remove=
n({method:"DELETE",url:b.api.bankAccount,key:"bankAccount",formName:"disableForm"});fa.verify=n({method:"PUT",url:b.api.verifyBankAccount,key:"verifiedBankAccount",formName:"verifyBankAccountForm"});var D=p("card"),C=t("card");C.remove=n({method:"DELETE",url:b.api.card,key:"disableForm"});var Ka=n({method:"GET",url:b.api.cardAffiliations,isArray:!0,key:"cardAffiliations"});Ka.create=n({method:"POST",url:b.api.cardAffiliations,isArray:!0,key:"cardAffiliations",form:"cardAffiliationsForm"});var Sa=
p("customManifest"),z=t("customManifest"),ua=p("customCalendar"),H=t("customCalendar"),Ta=p("customReport"),hb=t("customReport"),Z=n({method:"GET",url:b.api.users,isArray:!0,key:"users"});Z.pickable=E(Z);Z.all=n({method:"GET",url:b.api.allUsers,isArray:!0,key:"users"});Z.related=n({method:"GET",url:b.api.relatedUsers,isArray:!0,key:"users"});Z.create=n({method:"POST",url:b.api.users,key:"user",formName:"createUserForm"});var O=n({method:"GET",url:b.api.user,key:"user"});O.update=n({method:"PUT",url:b.api.user,
key:"user",formName:"updateUserForm"});O.remove=n({method:"DELETE",url:b.api.user});O.activities=n({method:"GET",url:b.api.userActivities,isArray:!0,key:"activities"});O.subscriptions=n({method:"GET",url:b.api.userSubscriptions,isArray:!0,key:"subscriptions"});O.itemSubscriptions=n({method:"GET",url:b.api.userItemSubscriptions,isArray:!0,key:"subscriptions"});O.itemSubscriptions.update=n({method:"POST",url:b.api.userItemSubscriptions,isArray:!0,key:"subscriptions"});O.overview=n({method:"GET",url:b.api.userOverview,
key:"overview"});O.nags={};O.nags.update=n({method:"PUT",url:b.api.userNags,key:"userNags",formName:"userNagsForm"});var ha=p("item");ha.pickable=E(ha);ha.public=x(ha,"public");ha.all=n({method:"GET",url:b.api.allItems,isArray:!0,key:"items"});ha.calendar=n({method:"GET",url:b.api.itemsCalendar,key:"calendar"});var Q=t("item");Q.pricingOverview=n({method:"GET",url:b.api.itemPricingOverview,key:"pricingOverview"});Q.color=n({method:"PUT",url:b.api.itemColor,key:"color",formName:"updateItemColorForm"});
Q.calendar=n({method:"GET",url:b.api.itemCalendar,key:"calendar"});Q.duplicate=n({method:"POST",url:b.api.duplicateItem,key:"item"});Q.subscriptions=n({method:"GET",url:b.api.itemSubscriptions,isArray:!0,key:"subscriptions"});Q.images=n({method:"GET",url:b.api.itemImages,key:"images",isArray:!0});Q.images.create=n({method:"POST",url:b.api.itemImages,key:"image"});Q.image={};Q.image.update=n({method:"PUT",url:b.api.itemImage,key:"image"});Q.image.remove=n({method:"DELETE",url:b.api.itemImage});Q.reviewExpressSettings=
{};Q.reviewExpressSettings.update=n({method:"PUT",url:b.api.reviewExpressSettings,key:"reviewExpressSettings",form:"reviewExpressSettingsForm"});Q.picthriveSettings={};Q.picthriveSettings.update=n({method:"PUT",url:b.api.picthriveSettings,key:"picthriveSettings",formName:"picthriveSettingsForm"});Q.ratings=n({method:"GET",url:b.api.itemRatings,key:"ratings"});Q.flowPages=n({method:"GET",isArray:!0,url:b.api.itemFlowPages,key:"flowNodes"});Q.flowPages.full=x(Q.flowPages,"full");Q.futureAvailabilityCount=
n({method:"GET",url:b.api.futureAvailabilityCount,key:"futureAvailabilityCount"});Q.isQueued=n({method:"GET",url:b.api.isItemQueued,key:"queuedStatus"});Q.hasFutureAvailsUsingCompanyLevelCfig=n({method:"GET",url:b.api.itemHasFutureAvailsUsingCompanyLevelCfig,key:"hasFutureAvails"});var W=t("flowNode"),pa=function(){return g.get("flows").wrapEndpoint(W).apply(null,arguments)};pa.update=W.update;pa.remove=W.remove;var La=n({method:"GET",url:b.api.defaultFlowPage,key:"defaultFlowPage"});pa.withDescendants=
x(n({method:"GET",url:b.api.flowNode,key:"flowNode",ignoreQueryParamsInCacheUri:!0}),"descendants");pa.duplicate=n({method:"POST",url:b.api.duplicateFlowNode,key:"flowNode"});var ba=p("flowNode");ba.multi=n({method:"POST",url:b.api.flowNodes,isArray:!0,key:"flowNodes",formName:"flowNodeForm"});ba.root=x(ba,"root");ba.root.create=x(ba.create,"root");ba.pages=x(ba,"pages");var ra=n({method:"GET",url:b.api.affiliates,isArray:!0,key:"affiliations"});ra.all=n({method:"GET",url:b.api.allAffiliates,isArray:!0,
key:"affiliations"});ra.pickable=E(ra);ra.create=n({method:"POST",url:b.api.affiliates,key:"affiliation",formName:"createAffiliationForm"});var la=n({method:"GET",url:b.api.affiliate,key:"affiliation"});la.update=n({method:"PUT",url:b.api.affiliate,key:"affiliation",formName:"updateAffiliationForm"});la.remove=n({method:"DELETE",url:b.api.affiliate,formName:"disableForm"});var wa=n({method:"GET",url:b.api.affiliateCards,key:"cards",isArray:!0,flashError:!1}),L=n({method:"GET",url:b.api.affiliateCardAffiliations,
key:"cardAffiliations",isArray:!0,flashError:!1}),ma=n({method:"GET",url:b.api.partners,isArray:!0,key:"affiliations"});ma.all=x(ma,"all");ma.pickable=E(ma);ma.minimal=x(ma,"minimal");var Xa=n({method:"GET",url:b.api.partner,key:"partner"});Xa.remove=n({method:"DELETE",url:b.api.partner,formName:"disableForm"});var kb=n({method:"GET",url:b.api.partnerCards,key:"cards",isArray:!0,flashError:!1}),lb=n({method:"GET",url:b.api.partnerCardAffiliations,key:"cardAffiliations",isArray:!0,flashError:!1}),
Ma=p("agent");Ma.all=n({method:"GET",url:b.api.allAgents,isArray:!0,key:"agents"});var da=t("agent"),Ya=p("desk");Ya.all=n({method:"GET",url:b.api.allDesks,isArray:!0,key:"desks"});var mb=t("desk"),na=p("hotel"),nb=t("hotel"),Za=p("lodging");Za.duplicate=n({method:"POST",url:b.api.duplicateLodgingsAcrossCompanies,formName:"duplicateLodgingsAcrossCompaniesForm",key:"lodgings",isArray:!0});var ob=t("lodging"),$a=p("preferredPickup"),ja=t("preferredPickup"),ea=p("pickup");ea.duplicate=n({method:"POST",
url:b.api.duplicatePickupsAcrossCompanies,formName:"duplicatePickupsAcrossCompaniesForm",key:"pickups",isArray:!0});var ia=t("pickup"),va=p("route");va.pickable=E(va);va.duplicate=n({method:"POST",url:b.api.duplicateRoutesAcrossCompanies,formName:"duplicateRoutesAcrossCompaniesForm",key:"routes",isArray:!0});var sa=n({method:"GET",url:b.api.route,key:"route",ignoreQueryParamsInCacheUri:!0});sa.update=n({method:"PUT",url:b.api.route,key:"route"});sa.remove=n({method:"DELETE",url:b.api.route,formName:"disableForm"});
sa.items=n({method:"GET",url:b.api.routeItems,isArray:!0,key:"items"});sa.duplicate=n({method:"POST",url:b.api.duplicateRoute,key:"route",formName:"duplicateRouteForm"});var pb=p("stop"),ab=t("stop"),ka={};ka.searchByDate=n({method:"GET",url:b.api.searchRunsByDate,isArray:!0,key:"runs"});ka.manifest=n({method:"GET",url:b.api.runsManifest,isArray:!0,key:"runs"});var qa=n({method:"GET",url:b.api.campaigns,isArray:!0,key:"campaigns"});qa.create=n({method:"POST",url:b.api.campaigns,key:"campaign"});var N=
n({method:"GET",url:b.api.campaign,key:"campaign"});N.update=n({method:"PUT",url:b.api.campaign,key:"campaign"});N.remove=n({method:"DELETE",url:b.api.campaign,formName:"disableForm"});N.customFields=n({method:"GET",url:b.api.campaignCustomFields,isArray:!0,key:"customFields"});var Na=n({method:"GET",url:b.api.campaignValidityRules,isArray:!0,key:"campaignValidityRules"});Na.create=n({method:"POST",url:b.api.campaignValidityRules,key:"campaignValidityRule",formName:"createCampaignValidityRuleForm"});
var Ea=n({method:"GET",url:b.api.campaignValidityRule,key:"campaignValidityRule"});Ea.remove=n({method:"DELETE",url:b.api.campaignValidityRule,formName:"disableForm"});var Ua=n({method:"GET",url:b.api.codes,isArray:!0,key:"codes"});Ua.create=n({method:"POST",url:b.api.codes,key:"codes",isArray:!0,formName:"createCodesForm"});Ua.byTag={};Ua.byTag.clear=n({method:"DELETE",url:b.api.codesByTag});var ib=n({method:"GET",url:b.api.code,key:"code"});ib.update=n({method:"PUT",url:b.api.code,key:"code",formName:"updateCodeForm"});
ib.remove=n({method:"DELETE",url:b.api.code});var Tc=p("storedValueType"),Uc=t("storedValueType"),Va=n({method:"GET",url:b.api.storedValueCards,isArray:!0,key:"storedValueCards"});Va.create=n({method:"POST",url:b.api.storedValueCards,key:"storedValueCards",isArray:!0,formName:"createStoredValueCardsForm"});Va.issue=n({method:"POST",url:b.api.issueStoredValueCard,key:"storedValueCard",formName:"issueStoredValueCardForm"});Va.search=n({method:"GET",url:b.api.searchStoredValueCardsByNumber,key:"searchResult"});
var Wa=t("storedValueCard");Wa.payments=n({method:"GET",url:b.api.storedValueCardPayments,isArray:!0,key:"payments"});Wa.notifications={};Wa.notifications.create=n({method:"POST",url:b.api.storedValueCardNotifications,isArray:!0,key:"notifications",formName:"storedValueCardNotificationForm"});var Vc=p("storedValueAdjustment"),jb=t("storedValueAdjustment");delete jb.update;delete jb.remove;var Wc=p("document"),Xc=n({method:"GET",url:b.api.paymentProcessingDocument,isArray:!0,key:"pk"}),Yc=p("resellerCompany",
"resellerCompanies"),Zc=t("resellerCompany"),$c=p("resellerCompanyMapping"),ad=t("resellerCompanyMapping"),bd=p("resellerItem"),cd=t("resellerItem"),dd=p("resellerItemMapping"),ed=t("resellerItemMapping"),fd=p("resellerCustomerType"),gd=t("resellerCustomerType"),hd=p("resellerCustomerTypeMapping"),id=t("resellerCustomerTypeMapping"),jd=p("resellerOption"),kd=t("resellerOption"),ld=p("resellerOptionMapping"),md=t("resellerOptionMapping"),nd=n({method:"GET",url:b.api.resellerUnmappedItems,isArray:!0,
key:"items"}),od=n({method:"GET",url:b.api.resellerUnmappedCustomerPrototypes,isArray:!0,key:"customerPrototypes"}),pd=p("resellerKey"),qd=t("resellerKey"),rd=p("resellerApp"),sd=t("resellerApp"),qb=p("resellerAppRequest"),td=t("resellerAppRequest");qb.refresh=x(qb,"refresh");var ud=p("resellerAppCompany","resellerAppCompanies"),vd=t("resellerAppCompany"),Oa=n({method:"GET",url:b.api.customFields,isArray:!0,key:"customFields"});Oa.includeArchived=x(Oa,"include-archived");Oa.all=n({method:"GET",url:b.api.allCustomFields,
isArray:!0,key:"customFields"});Oa.create=n({method:"POST",url:b.api.customFields,key:"customField",formName:"createCustomFieldForm"});var xa=n({method:"GET",url:b.api.customField,key:"customField"});xa.items=n({method:"GET",url:b.api.customFieldItems,key:"items",isArray:!0});xa.companyCustomFieldInstanceGroups=n({method:"GET",url:b.api.customFieldCompanyCustomFieldGroups,key:"customFieldInstanceGroups",isArray:!0});xa.duplicate=n({method:"POST",url:b.api.duplicateCustomField,key:"customField",formName:"duplicateCustomFieldForm"});
xa.prevalidate=n({method:"POST",url:b.api.prevalidateCustomField,key:"prevalidity",formName:"prevalidateCustomFieldForm",flashError:!1});xa.update=n({method:"PUT",url:b.api.customField,key:"customField",formName:"updateCustomFieldForm"});xa.remove=n({method:"DELETE",url:b.api.customField,formName:"disableForm"});var Wb={};Wb.create=n({method:"POST",url:b.api.transportationOptions,key:"transportationOption"});var rb={};rb.update=n({method:"PUT",url:b.api.transportationOption,key:"transportationOption"});
rb.remove=n({method:"DELETE",url:b.api.transportationOption});var Xb={};Xb.create=n({method:"POST",url:b.api.extendedOptions,key:"extendedOption",formName:"createExtendedOptionForm"});var sb={};sb.update=n({method:"PUT",url:b.api.extendedOption,key:"extendedOption",formName:"updateExtendedOptionForm"});sb.remove=n({method:"DELETE",url:b.api.extendedOption,key:"extendedOption",formName:"disableForm"});var Yb={};Yb.create=n({method:"POST",url:b.api.connectedCampaigns,key:"connectedCampaign",formName:"createConnectedCampaignForm"});
var Zb={};Zb.remove=n({method:"DELETE",url:b.api.connectedCampaign});var $b={};$b.create=n({method:"POST",url:b.api.generatingCampaigns,key:"generatingCampaign",formName:"generatingCampaignForm"});var tb={};tb.update=n({method:"PUT",url:b.api.generatingCampaign,key:"generatingCampaign",formName:"generatingCampaignForm"});tb.remove=n({method:"DELETE",url:b.api.generatingCampaign});var Fa=n({method:"GET",url:b.api.itemCustomFieldInstanceGroups,isArray:!0,key:"customFieldInstanceGroups"});Fa.includeArchived=
x(Fa,"include-archived");Fa.create=n({method:"POST",url:b.api.itemCustomFieldInstanceGroups,key:"customFieldInstanceGroup"});var Ga=n({method:"GET",url:b.api.companyCustomFieldInstanceGroups,isArray:!0,key:"customFieldInstanceGroups"});Ga.includeArchived=x(Ga,"include-archived");Ga.create=n({method:"POST",url:b.api.companyCustomFieldInstanceGroups,key:"customFieldInstanceGroup"});var Pa=t("customFieldInstanceGroup");Pa.multi=n({method:"POST",url:b.api.customFieldInstanceGroupsMulti,isArray:!0,key:"customFieldInstanceGroups",
formName:"customFieldInstanceGroupsForm"});Pa.remove=n({method:"DELETE",url:b.api.customFieldInstanceGroup,key:"customFieldInstanceGroup",formName:"disableForm"});Pa.duplicate=n({method:"POST",url:b.api.duplicateCustomFieldInstanceGroup,key:"customFieldInstanceGroup",formName:"duplicateForm"});Pa.items=n({method:"GET",url:b.api.customFieldInstanceGroupItems,isArray:!0,key:"items"});var wd=t("customFieldInstance"),ub=p("customFieldInstance");ub.multi=n({method:"POST",url:b.api.customFieldInstancesMulti,
isArray:!0,key:"customFieldInstances",formName:"customFieldInstancesForm"});ub.forPushedCustomFieldValues=n({method:"GET",url:b.api.customFieldInstancesForPushedCustomFieldValues,key:"customFieldInstances",isArray:!0});var xd=t("customFieldInstanceCondition"),yd=p("customFieldInstanceCondition"),zd=t("supportedLanguage"),Ad=p("supportedLanguage"),Bd=n({method:"GET",url:b.api.translations,key:"translations"}),vb=n({method:"GET",url:b.api.translationsForModel,key:"translationsForModel",isArray:!0});
vb.includeArchived=x(vb,"include-archived");var ac=n({method:"GET",url:b.api.translationsForField,key:"translationsAndSourceField"});ac.update=n({method:"POST",url:b.api.translationsForField,key:"updatedTranslations",formName:"translationsForFieldForm",isArray:!0});var Cd=n({method:"GET",url:b.api.understoodLanguages,key:"understoodLanguages"}),bc=n({method:"GET",url:b.api.translationsForSubfield,key:"translationsAndSourceField"});bc.update=n({method:"POST",url:b.api.translationsForSubfield,key:"updatedTranslations",
formName:"translationsForFieldForm",isArray:!0});var cc=n({method:"GET",url:b.api.roles,isArray:!0,key:"roles"});cc.create=n({method:"POST",url:b.api.roles,key:"role"});var wb=n({method:"GET",url:b.api.role,key:"role"});wb.update=n({method:"PUT",url:b.api.role,key:"role"});wb.remove=n({method:"DELETE",url:b.api.role});var dc=n({method:"GET",url:b.api.crewMembers,isArray:!0,key:"crewMembers"});dc.create=n({method:"POST",url:b.api.crewMembers,key:"crewMember"});var xb=n({method:"GET",url:b.api.crewMember,
key:"crewMember"});xb.update=n({method:"PUT",url:b.api.crewMember,key:"crewMember"});xb.remove=n({method:"DELETE",url:b.api.crewMember,key:"crewMember"});var ec=t("customerType");ec.items=n({method:"GET",url:b.api.customerTypeItems,key:"items",isArray:!0});var bb=p("customerType");bb.includeArchived=x(bb,"include-archived");bb.all=n({method:"GET",url:b.api.allCustomerTypes,isArray:!0,key:"customerTypes"});var fc=t("customerPrototype");fc.duplicate=n({method:"POST",url:b.api.duplicateCustomerPrototype,
key:"customerPrototype",formName:"duplicateForm"});var yb=p("customerPrototype");yb.all=n({method:"GET",url:b.api.allCustomerPrototypes,isArray:!0,key:"customerPrototypes"});yb.multi=n({method:"POST",url:b.api.customerPrototypesMulti,isArray:!0,key:"customerPrototypes",formName:"customerPrototypesForm"});var gc=t("checkinStatus","checkinStatuses"),Dd=p("checkinStatus","checkinStatuses");gc.updateBookings=n({method:"PUT",url:b.api.checkinStatusForBookings,key:"bookings",isArray:!0,formName:"updateCheckinStatusForBookingsForm"});
var Ed=p("cannedMessage"),zb=t("cannedMessage");zb.items=n({method:"GET",url:b.api.cannedMessageItems,key:"items",isArray:!0});zb.availabilityHeadlines=n({method:"GET",url:b.api.cannedMessageAvailabilityHeadlines,key:"availabilityHeadlines",isArray:!0});var Fd=p("availabilityHeadline"),hc=t("availabilityHeadline");hc.items=n({method:"GET",url:b.api.availabilityHeadlineItems,key:"items",isArray:!0});var ca={};ca.next=n({method:"GET",url:b.api.nextAvailability,key:"availability"});ca.update=n({method:"POST",
url:b.api.updateAvailabilities,formName:"updateAvailabilitiesForm",key:"updateAvailabilities"});ca.updateByItem=n({method:"POST",url:b.api.updateItemAvailabilities,formName:"updateAvailabilitiesForm",key:"updateAvailabilities"});ca.byDate=n({method:"GET",url:b.api.availabilitiesByDate,isArray:!0,key:"availabilities"});ca.byTag={};ca.byTag.clear=n({method:"DELETE",url:b.api.availabilitiesByTag,formName:"disableForm"});ca.futureCount=n({method:"GET",url:b.api.futureAvailabilityCount,key:"futureAvailabilityCount"});
ca.searchByDate=n({method:"GET",url:b.api.searchAvailabilitiesByDate,isArray:!0,key:"availabilities",sideKeys:["nextBookableStartAt"]});ca.searchAllByDate=n({method:"GET",url:b.api.searchAllAvailabilitiesByDate,isArray:!0,key:"availabilities",sideKeys:["nextBookableStartAt"]});ca.searchByPk=n({method:"GET",url:b.api.searchAvailabilitiesByPk,isArray:!0,key:"availabilities"});ca.manifest=n({method:"GET",url:b.api.availabilitiesManifest,isArray:!0,key:"availabilities",sideKeys:["bookings","bookingCounts",
"crewMembers","sonarAvailabilities"]});ca.manifestSelectable=n({method:"GET",url:b.api.manifestSelectableAvailabilities,isArray:!0,key:"availabilities"});ca.searchByUpcoming=n({method:"GET",url:b.api.searchAvailabilitiesByUpcoming,isArray:!0,key:"availabilities"});ca.rule=n({method:"POST",url:b.api.rule,key:"createdAvailabilities",formName:"ruleForm"});ca.withResourceRequirements=n({method:"GET",url:b.api.availabilitiesWithResourceRequirements,key:"availabilities",isArray:!0});var aa=n({method:"GET",
url:b.api.availability,key:"availability"});aa.update=n({method:"PUT",url:b.api.availability,key:"availability",formName:"updateAvailabilityForm"});aa.status={};aa.status.update=n({method:"PUT",url:b.api.availabilityStatus,key:"availabilityStatus",formName:"updateAvailabilityStatusForm"});aa.book=K({method:"POST",url:b.api.book,key:"booking",formName:"bookForm"});aa.liveCapacity=n({method:"GET",url:b.api.availabilityLiveCapacity,key:"liveCapacity",formName:"liveCapacityForm"});aa.resourceUses=n({method:"GET",
url:b.api.availabilityResourceUses,key:"resourceUses",isArray:!0});aa.remove=n({method:"DELETE",url:b.api.availability,formName:"disableForm"});aa.notifications=n({method:"POST",url:b.api.notifications,formName:"notificationsForm"});aa.notificationOptions={};aa.notificationOptions.update=n({method:"PUT",url:b.api.availabilityNotificationOptions,key:"notificationOptions",formName:"updateAvailabilityNotificationOptionsForm"});aa.note={};aa.note=n({method:"PUT",url:b.api.availabilityNote,key:"note",
formName:"updateAvailabilityNoteForm"});aa.smsNotifications={};aa.smsNotifications.create=n({method:"POST",url:b.api.smsNotifications,formName:"smsNotificationsForm"});aa.checkinStatuses=n({method:"GET",url:b.api.availabilityCheckinStatuses,isArray:!0,key:"bookings"});aa.seatRequirements=n({method:"GET",url:b.api.seatRequirements,isArray:!0,key:"requirements"});var ic={};ic.create=n({method:"POST",url:b.api.customerTypeRates,key:"customerTypeRate"});var Ab={};Ab.remove=n({method:"DELETE",url:b.api.customerTypeRate,
formName:"disableForm"});Ab.update=n({method:"PUT",url:b.api.customerTypeRate,key:"customerTypeRate"});var Gd=p("block"),Hd=t("block"),cb={};cb.availability=n({method:"GET",url:b.api.subjectsAvailability,key:"subjects"});cb.booking=n({method:"GET",url:b.api.subjectsBooking,key:"subjects"});cb.order=n({method:"GET",url:b.api.subjectsOrder,key:"subjects"});var Bb=t("contact");Bb.bookings={};Bb.bookings.update=n({method:"PUT",url:b.api.contactBookings,key:"modified"});var jc={};jc.report=n({method:"GET",
url:b.api.reportContacts,key:"report"});var Id=n({method:"GET",url:b.api.contactPayments,isArray:!0,key:"payments"}),Qa=n({method:"GET",url:b.api.order,key:"order",sideKeys:["customersWithSeatAssignments"]}),Jd=n({method:"GET",url:b.api.order,key:"order",ignoreQueryParamsInCacheUri:!0});Qa.wait=x(Jd,"wait");Qa.notification=n({method:"POST",url:b.api.orderNotification,formName:"orderNotificationForm"});Qa.cancel=n({method:"POST",url:b.api.orderCancellation,key:"order",formName:"cancelOrderBookingsForm"});
Qa.customersWithSeatAssignments=n({method:"GET",url:b.api.orderCustomersWithSeatAssignments,key:"customersWithSeatAssignments"});var kc={};kc.create=K({method:"POST",url:b.api.orders,key:"order",formName:"orderForm"});var Cb=n({method:"GET",url:b.api.orderPayments,isArray:!0,key:"payments"});Cb.create=n({method:"POST",url:b.api.orderPayments,key:"payments"});Cb.refund=n({method:"POST",url:b.api.orderRefunds,isArray:!0,key:"payments"});var ta=n({method:"GET",url:b.api.bookings,isArray:!0,key:"bookings"});
ta.byContact=n({method:"GET",url:b.api.bookingsByContact,isArray:!0,key:"bookings"});ta.searchByQuery=n({method:"GET",url:b.api.searchBookingsByQuery,isArray:!0,key:"bookings"});ta.searchByNew=n({method:"GET",url:b.api.searchBookingsByNew,isArray:!0,key:"bookings"});ta.report=n({method:"GET",url:b.api.reportBookings,key:"report"});ta.invoiceableReport=n({method:"GET",url:b.api.reportInvoiceableBookings,key:"report"});ta.manifest=n({method:"GET",url:b.api.bookingsManifest,isArray:!0,key:"bookings"});
ta.searchByUuid=n({method:"GET",url:b.api.searchBookingsByUuid,isArray:!0,key:"bookings"});var Y=n({method:"GET",url:b.api.booking,key:"booking",sideKeys:["customersWithSeatAssignments"]});Y.customersWithSeatAssignments=n({method:"GET",url:b.api.bookingCustomersWithSeatAssignments,key:"customersWithSeatAssignments"});var Kd=n({method:"GET",url:b.api.booking,key:"booking",ignoreQueryParamsInCacheUri:!0});Y.wait=x(Kd,"wait");Y.byPk=n({method:"GET",url:b.api.bookingByPk,key:"booking",ignoreCache:!0});
Y.reprice=n({method:"PUT",url:b.api.repriceBooking,key:"repricing",formName:"repriceBookingForm"});Y.notification=n({method:"POST",url:b.api.notification,formName:"notificationForm"});Y.smsNotification=n({method:"POST",url:b.api.smsNotification,formName:"smsNotificationForm"});Y.cancel=n({method:"DELETE",url:b.api.booking,key:"booking",formName:"cancelBookingForm"});Y.note={};Y.note.update=n({method:"PUT",url:b.api.bookingNote,key:"note",formName:"updateBookingNoteForm"});Y.explicitGross={};Y.explicitGross.update=
n({method:"PUT",url:b.api.bookingExplicitGross,key:"explicitGross",formName:"updateBookingExplicitGrossForm"});Y.explicitInvoicePrice={};Y.explicitInvoicePrice.update=n({method:"PUT",url:b.api.bookingExplicitInvoicePrice,key:"explicitInvoicePrice",formName:"updateBookingExplicitInvoicePriceForm"});Y.notificationOptions={};Y.notificationOptions.update=n({method:"PUT",url:b.api.bookingNotificationOptions,key:"notificationOptions",formName:"updateBookingNotificationOptionsForm"});Y.affiliation={};Y.affiliation.update=
n({method:"PUT",url:b.api.affiliation,key:"affiliation"});Y.checkinStatus={};Y.checkinStatus.update=n({method:"PUT",url:b.api.bookingCheckinStatus,key:"bookingCheckinStatus",formName:"updateBookingCheckinStatusForm"});Y.effectiveCancellationRule=n({method:"GET",url:b.api.bookingEffectiveCancellationRule,key:"cancellationRule"});var lc={checkinStatus:{}};lc.checkinStatus.update=n({method:"PUT",url:b.api.customerCheckinStatus,key:"customerCheckinStatus",formName:"updateCustomerCheckinStatusForm"});
var Db={};Db.find=n({method:"GET",url:b.api.searchCustomersByEncodedPk,key:"booking"});Db.withSeats=n({method:"GET",url:b.api.customersWithSeats,isArray:!0,key:"customers"});var Eb={};Eb.update=n({method:"PUT",url:b.api.bookingCustomFieldValue,key:"customFieldValue"});Eb.remove=n({method:"DELETE",url:b.api.bookingCustomFieldValue});var Fb={};Fb.update=n({method:"PUT",url:b.api.customerCustomFieldValue,key:"customFieldValue"});Fb.remove=n({method:"DELETE",url:b.api.customerCustomFieldValue});var Ld=
n({method:"POST",url:b.api.pushCustomFieldValues,key:"customFieldValues",isArray:!0,sideKeys:["booking"],formName:"pushCustomFieldValuesForm"}),oa=p("report");oa.recent=n({method:"GET",url:b.api.recentReports,key:"reports",isArray:!0});oa.inProgress=n({method:"GET",url:b.api.inProgressReports,key:"reports",isArray:!0});oa.volumeOverview=n({method:"GET",url:b.api.volumeOverviewReport,key:"volume"});oa.dailyVolumeOverview=n({method:"GET",url:b.api.dailyVolumeOverviewReport,key:"dailyVolume"});oa.paymentOverview=
n({method:"GET",url:b.api.paymentOverviewReport,key:"paymentOverview"});oa.itemsSummaryOverview=n({method:"GET",url:b.api.itemsSummaryOverviewReport,key:"itemsSummary"});oa.nextPayoutOverview=n({method:"GET",url:b.api.nextPayoutOverviewReport,key:"nextPayouts",isArray:!0});oa.report=n({method:"GET",url:b.api.reportReports,key:"report"});var ya=t("report");ya.rerun=ya.update;delete ya.update;ya.cancel=n({method:"DELETE",url:b.api.report,formName:"disableForm",key:"report"});delete ya.remove;ya.objects=
n({method:"POST",url:b.api.reportObjects,key:"objects",isArray:!1});var Gb=p("invoice");Gb.report=n({method:"GET",url:b.api.reportInvoices,key:"report"});Gb.partnerInvoice=n({method:"GET",url:b.api.partnerInvoice,key:"invoice"});var Ha=t("invoice");Ha.uploads=n({method:"GET",url:b.api.invoiceUploads,isArray:!0,key:"uploads"});Ha.uploads.create=n({method:"POST",url:b.api.invoiceUploads,key:"upload"});Ha.notifications={};Ha.notifications.create=n({method:"POST",url:b.api.invoiceNotifications,isArray:!0,
key:"notifications",formName:"invoiceNotificationForm"});Ha.uuid=n({method:"GET",url:b.api.uuidInvoice,key:"invoice"});var Hb={};Hb.create=n({method:"POST",url:b.api.lineItems,key:"lineItem"});Hb.report=n({method:"GET",url:b.api.reportLineItems,key:"report"});var Ib=n({method:"GET",url:b.api.lineItem,key:"lineItem"});Ib.remove=n({method:"DELETE",url:b.api.lineItem});Ib.update=n({method:"PUT",url:b.api.lineItem,key:"lineItem"});var Md=p("tagGroup"),Nd=t("tagGroup"),mc={};mc.create=n({method:"POST",
url:b.api.tags,key:"tag"});var Jb={};Jb.update=n({method:"PUT",url:b.api.tag,key:"tag"});Jb.remove=n({method:"DELETE",url:b.api.tag,formName:"disableForm"});var nc=n({method:"GET",url:b.api.objectTags,key:"objectTags",isArray:!0});nc.update=n({method:"PUT",url:b.api.objectTags,key:"objectTags",isArray:!0});var Ia=n({method:"GET",url:b.api.payments,isArray:!0,key:"payments"});Ia.related=n({method:"GET",url:b.api.relatedPayments,isArray:!0,key:"payments"});Ia.create=n({method:"POST",url:b.api.payments,
key:"payment"});Ia.refund=n({method:"POST",url:b.api.refunds,isArray:!0,key:"payments"});Ia.report=n({method:"GET",url:b.api.reportPayments,key:"report"});Ia.volumeReport=n({method:"GET",url:b.api.reportVolume,key:"report"});var oc={};oc.create=n({method:"POST",url:b.api.installmentPayment,key:"installmentPayment"});var pc={};pc.create=n({method:"POST",url:b.api.orderInstallmentPayment,key:"orderInstallmentPayment"});var qc=n({method:"GET",url:b.api.authorizationHolds,isArray:!0,key:"authorizationHolds"});
qc.update=n({method:"PUT",url:b.api.authorizationHolds,isArray:!0,key:"authorizationHolds"});var rc=n({method:"GET",url:b.api.paymentFees,isArray:!0,key:"payments"});rc.update=n({method:"POST",url:b.api.paymentFees,key:"payments"});var sc=p("inStorePaymentType"),Od=n({method:"POST",url:b.api.emvLocation,key:"emvLocation",formName:"emv_location_form"});sc.all=n({method:"GET",url:b.api.allInStorePaymentTypes,isArray:!0,key:"inStorePaymentTypes"});var tc=p("ledger");tc.all=n({method:"GET",url:b.api.allLedgers,
isArray:!0,key:"ledgers"});var Pd=t("ledger"),Qd=t("inStorePaymentType"),Rd=p("emvDevice"),za=t("emvDevice");za.authenticate=n({method:"POST",url:b.api.retrieveConnectionToken,key:"activation",formName:"retrieve_connection_token_form",flashError:!1,ignoreCache:!0,ignoreInFlight:!0});za.createInteractionToken=n({method:"POST",url:b.api.createInteractionToken,key:"tokenId",formName:"emv_device_create_payment_intent_form",flashError:!1});za.checkConnections=n({method:"GET",url:b.api.checkEmvDeviceConnections,
key:"connectedDevices",flashError:!1});za.checkConnection=n({method:"GET",url:b.api.checkEmvDeviceConnection,key:"connectedDevices"});za.checkPaymentStatus=n({method:"POST",url:b.api.checkEmvPaymentStatus,key:"result",flashError:!1,flash500Error:!1});za.cancelCharge=n({method:"POST",url:b.api.cancelEmvCharge});var uc={custom:{}};uc.custom.create=n({method:"POST",url:b.api.customRefunds,key:"refund",formName:"customRefundForm"});var vc={};vc.report=n({method:"GET",url:b.api.reportDisputes,key:"report"});
var wc=n({method:"GET",url:b.api.payouts,isArray:!0,key:"payouts"});wc.report=n({method:"GET",url:b.api.reportPayouts,key:"report"});var xc=n({method:"GET",url:b.api.payout,key:"payout"});xc.retry=n({method:"PUT",url:b.api.payoutRetry,key:"payoutRetry"});var yc=n({method:"GET",url:b.api.transfers,isArray:!0,key:"transfers"});yc.create=n({method:"POST",url:b.api.transfers,key:"transfer"});var Sd=n({method:"GET",url:b.api.transfer,key:"transfer"}),zc={};zc.create=n({method:"POST",url:b.api.oneTimeTransfer,
formName:"transferAndUploadDelegateForm",key:"oneTimeTransfer"});var Td=n({method:"GET",url:b.api.upcomingRefundReserveAmounts,key:"upcomingRefundReserveAmounts"}),Ac=n({method:"GET",url:b.api.uploads,isArray:!0,key:"uploads"});Ac.create=n({method:"POST",url:b.api.uploads,key:"upload"});var Ud=n({method:"GET",url:b.api.upload,key:"upload"}),Bc=n({method:"GET",url:b.api.funds,isArray:!0,key:"funds"});Bc.report=n({method:"GET",url:b.api.reportFunds,key:"report"});var Vd=n({method:"GET",url:b.api.fund,
key:"fund"}),Cc=n({method:"GET",url:b.api.adjustments,isArray:!0,key:"adjustments"});Cc.create=n({method:"POST",url:b.api.adjustments,key:"adjustment"});var Wd=n({method:"GET",url:b.api.adjustment,key:"adjustment"}),Dc={};Dc.report=n({method:"GET",url:b.api.reportTransactions,key:"report"});var Kb=n({method:"GET",url:b.api.activities,isArray:!0,key:"activities"});Kb.notes={};Kb.notes.create=n({method:"POST",url:b.api.notes,key:"activity",formName:"noteForm"});var Ec=n({method:"GET",url:b.api.activity,
key:"activity"});Ec.update=n({method:"PUT",url:b.api.activity,key:"activity"});var Xd=n({method:"PUT",url:b.api.reorder,key:"reorder"}),Fc=n({method:"GET",url:b.api.waivers,isArray:!0,key:"waivers"});Fc.create=n({method:"POST",url:b.api.waivers,key:"waiver"});var Lb=n({method:"GET",url:b.api.waiver,key:"waiver"});Lb.update=n({method:"PUT",url:b.api.waiver,key:"waiver"});Lb.remove=n({method:"DELETE",url:b.api.waiver,formName:"disableForm"});var Gc={};Gc.create=n({method:"POST",url:b.api.connectedWaivers,
key:"connectedWaiver",formName:"createConnectedWaiverForm"});var Hc={};Hc.remove=n({method:"DELETE",url:b.api.connectedWaiver});var Ic={};Ic.remove=n({method:"DELETE",url:b.api.waiverInstance,key:"waiverInstance"});var Ra=p("totalSchedule");Ra.online=x(Ra,"online");Ra.includeArchived=x(Ra,"include-archived");var Mb=t("totalSchedule"),Yd=p("totalScheduleEntry","totalScheduleEntries"),Zd=t("totalScheduleEntry"),$d=p("totalScheduleEntryRule"),ae=t("totalScheduleEntryRule"),Nb=p("invoiceSchedule");Nb.includeArchived=
x(Nb,"include-archived");var Ob=t("invoiceSchedule"),be=p("invoiceScheduleEntry","invoiceScheduleEntries"),ce=t("invoiceScheduleEntry"),de=p("invoiceScheduleEntryRule"),ee=t("invoiceScheduleEntryRule");Mb.duplicate=n({method:"POST",url:b.api.duplicateTotalSchedule,key:"totalSchedule",formName:"duplicateTotalScheduleForm"});Mb.affiliations=n({method:"GET",isArray:!0,url:b.api.totalScheduleAffiliations,key:"affiliations"});Ob.duplicate=n({method:"POST",url:b.api.duplicateInvoiceSchedule,key:"invoiceSchedule",
formName:"duplicateInvoiceScheduleForm"});Ob.affiliations=n({method:"GET",isArray:!0,url:b.api.invoiceScheduleAffiliations,key:"affiliations"});var fe=n({method:"GET",url:b.api.effectiveSheets,key:"effectiveSheets"}),ge=n({method:"GET",url:b.api.affiliationEffectiveSheets,key:"effectiveSheets"}),he=n({method:"GET",url:b.api.rebookingEffectiveSheets,key:"effectiveSheets"}),ie=n({method:"GET",url:b.api.totalScheduleEffectiveSheet,key:"effectiveSheets"}),je=n({method:"GET",url:b.api.invoiceScheduleEffectiveSheet,
key:"effectiveSheets"}),ga=p("totalSheet");ga.all=x(ga,"all");ga.includeArchived=x(ga,"include-archived");ga.nonBase=x(ga,"nonBase");ga.online=x(ga,"online");ga.bases=x(ga,"bases");var Aa=t("totalSheet");Aa.duplicate=n({method:"POST",url:b.api.duplicateTotalSheet,key:"totalSheet",formName:"duplicateSheetForm"});Aa.pricing=n({method:"GET",url:b.api.totalPricing,key:"effectivePricings",isArray:!0});Aa.pricing.update=n({method:"PUT",url:b.api.totalPricing,key:"effectivePricings",isArray:!0,formName:"priceLineForm"});
Aa.pricing.stack=n({method:"GET",url:b.api.totalStack,key:"lines",isArray:!0});Aa.schedules=n({method:"GET",isArray:!0,url:b.api.totalSheetSchedules,key:"totalSchedules"});Aa.affiliations=n({method:"GET",isArray:!0,url:b.api.totalSheetAffiliations,key:"affiliations"});var Ba=p("invoiceSheet");Ba.all=x(Ba,"all");Ba.includeArchived=x(Ba,"include-archived");Ba.nonBase=x(Ba,"nonBase");var Ca=t("invoiceSheet");Ca.duplicate=n({method:"POST",url:b.api.duplicateInvoiceSheet,key:"invoiceSheet",formName:"duplicateSheetForm"});
Ca.pricing=n({method:"GET",url:b.api.invoicePricing,key:"effectivePricings",isArray:!0});Ca.pricing.update=n({method:"PUT",url:b.api.invoicePricing,key:"effectivePricings",isArray:!0,formName:"priceLineForm"});Ca.pricing.stack=n({method:"GET",url:b.api.invoiceStack,key:"lines",isArray:!0});Ca.schedules=n({method:"GET",isArray:!0,url:b.api.invoiceSheetSchedules,key:"invoiceSchedules"});Ca.affiliations=n({method:"GET",isArray:!0,url:b.api.invoiceSheetAffiliations,key:"affiliations"});var Pb={};Pb.channels=
n({method:"GET",url:b.pusher.channels,key:"channels",isArray:!0});Pb.members=n({method:"POST",url:b.pusher.members,key:"channels",isArray:!0});var Qb=p("taxType");Qb.all=x(Qb,"all");var ke=t("taxType"),Jc=t("location");Jc.items=n({method:"GET",url:b.api.locationItems,key:"items",isArray:!0});var Kc=p("location");Kc.createPrimary=n({method:"POST",url:b.api.primaryLocation,key:"location"});var db=p("resource");db.includeArchived=x(db,"include-archived");db.manifest=n({method:"GET",url:b.api.resourcesManifest,
key:"resources",isArray:!0});var eb=t("resource");eb.items=n({method:"GET",url:b.api.resourceItems,key:"items",isArray:!0});eb.requirementGroups=n({method:"GET",url:b.api.resourceRequirementGroups,key:"requirementGroups",isArray:!0});eb.availabilities=n({method:"GET",url:b.api.resourceAvailabilities,key:"availabilities",isArray:!0});var Ja={};Ja.byDate=n({method:"GET",url:b.api.resourceUsesByDate,key:"resourceUses",isArray:!0});Ja.calendar=n({method:"GET",url:b.api.resourceUsesCalendar,key:"calendar"});
Ja.unassignSeats=n({method:"PUT",url:b.api.resourceUsesUnassignSeats,isArray:!0,key:"resourceUses",formName:"unassignSeatsForm"});Ja.reapplyResourceUses=n({method:"POST",url:b.api.reapplyResourceUses,isArray:!0,key:"resourceUses",sideKeys:["unsatisfiableResources","bookings"],formName:"reapplyResourceUsesForm"});Ja.reapplyResourceUsesPoll=n({method:"GET",url:b.api.reapplyResourceUses,key:"taskState",sideKeys:["bookings","resourceUses","unsatisfiableResources"]});var Rb=n({method:"GET",url:b.api.itemRequirementGroups,
isArray:!0,key:"requirementGroups"});Rb.create=n({method:"POST",url:b.api.itemRequirementGroups,key:"requirementGroup"});var Lc=p("requirementGroup"),Sb=t("requirementGroup");Sb.duplicate=n({method:"POST",url:b.api.duplicateRequirementGroup,key:"requirementGroup",formName:"duplicateRequirementGroupForm"});Sb.items=n({method:"GET",url:b.api.requirementGroupItems,isArray:!0,key:"items"});var le=p("requirement"),me=t("requirement"),ne=p("resourceRequirement"),Mc=t("resourceRequirement");Mc.update=n({method:"PUT",
url:b.api.resourceRequirement,key:"resourceRequirement",sideKeys:["newResourceRequirement"]});var Nc=t("resourceUse");Nc.update=n({method:"PUT",url:b.api.resourceUse,key:"resourceUse",sideKeys:["customer"],formName:"resourceUseForm",flashError:!1});var fb=n({method:"GET",url:b.api.resourceOverride,key:"resourceOverride"});fb.update=n({method:"PUT",url:b.api.resourceOverride,key:"resourceOverride",formName:"resourceOverrideForm"});fb.remove=n({method:"DELETE",url:b.api.resourceOverride,formName:"disableForm"});
fb.rule=n({method:"POST",url:b.api.resourceOverrideRule,isArray:!0,key:"resourceOverrides",formName:"resourceOverrideRuleForm"});var gb={byTag:{}};gb.byTag.clear=n({method:"DELETE",url:b.api.resourceOverridesByTag,formName:"disableForm"});gb.byDate=n({method:"GET",url:b.api.resourceOverridesByDate,key:"resourceOverrides",isArray:!0});gb.forSeat=n({method:"POST",url:b.api.seatResourceOverrides,key:"resourceOverrides",isArray:!0,formName:"seatResourceOverridesForm"});var oe=p("seatMap"),Da=t("seatMap");
Da.duplicate=n({method:"POST",url:b.api.duplicateSeatMap,key:"seatMap",formName:"duplicateSeatMapForm"});Da.update=n({method:"PUT",url:b.api.seatMap,key:"seatMap"});Da.full=x(n({method:"GET",url:b.api.seatMap,key:"seatMap",sideKeys:["seatZones","seatGroups"],ignoreQueryParamsInCacheUri:!0}),"full");Da.resourceUsesBySeat=n({method:"GET",url:b.api.seatMapResourceUsesBySeat,key:"resourceUsesBySeat",ignoreCache:!0});Da.resourceOverridesBySeat=n({method:"GET",url:b.api.seatMapResourceOverridesBySeat,key:"resourceOverridesBySeat",
sideKeys:["resourceOverrides"],ignoreCache:!0});Da.resources=n({method:"GET",url:b.api.seatMapResources,key:"resources",isArray:!0});var pe=p("seatGroup"),qe=t("seatGroup"),re=p("seatZone"),se=t("seatZone"),te=p("ticketLayout"),ue=t("ticketLayout"),ve=p("analyticsService"),we=t("analyticsService"),xe=p("cancellationPolicy","cancellationPolicies"),Tb=t("cancellationPolicy"),ye=p("cancellationRule"),ze=t("cancellationRule");Tb.affiliations=n({method:"GET",isArray:!0,url:b.api.cancellationPolicyAffiliations,
key:"affiliations"});Tb.items=n({method:"GET",isArray:!0,url:b.api.cancellationPolicyItems,key:"items"});var Ae=p("bookingRestriction"),Oc=t("bookingRestriction");Oc.items=n({method:"GET",isArray:!0,url:b.api.bookingRestrictionItems,key:"items"});var Pc=n({method:"GET",isArray:!0,url:b.api.persistentStore,key:"persistentStores"});Pc.remove=n({method:"DELETE",url:b.api.persistentStore});var Qc=n({method:"GET",url:b.api.persistentStoreForCompany,key:"persistentStore"});Qc.remove=n({method:"DELETE",
url:b.api.persistentStoreForCompany});var Ub=n({method:"GET",url:b.api.persistentStoreItem,key:"value"});Ub.update=n({method:"PUT",url:b.api.persistentStoreItem,key:"value",formName:"persistentStoreForm"});Ub.remove=n({method:"DELETE",url:b.api.persistentStoreItem});var Be=n({method:"GET",url:b.api.taskResult,key:"taskResult"}),Ce=K({method:"POST",url:b.api.token,key:"tokens",flash500Error:!1}),De=n({method:"GET",formName:"noForm",key:function(a){return _.keys(a.data)[0]}}),Ee=n({method:"GET",url:b.api.view,
key:"view"}),Fe=n({method:"GET",url:b.api.version,key:"version"}),Rc=function(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%2F/gi,"/").replace(/%20/g,b?"%20":"+")},Sc=function(a,b){b=_.isBoolean(b)?b?"yes":"no":b;return Rc(a,!0)+"="+Rc(b,!0)},Vb=function(a){var b=[];_.forEach(a,function(a,c){_.isArray(a)?_.forEach(a,function(a){b.push(Sc(c,a))}):b.push(Sc(c,a))});return b.join("&")};return{CANCELLED:s,toKeyValue:Vb,login:J,
forgot:v,companies:R,company:u,users:Z,user:O,groups:X,group:F,groupOverrides:S,groupOverride:V,contacts:jc,contact:Bb,contactPayments:Id,customManifests:Sa,customManifest:z,customCalendars:ua,customCalendar:H,customReports:Ta,customReport:hb,items:ha,item:Q,flowNodes:ba,flowNode:pa,defaultFlowPage:function(){return g.get("flows").wrapEndpoint(La,!0).apply(null,arguments)},activities:Kb,activity:Ec,affiliates:ra,affiliate:la,affiliateCards:wa,affiliateCardAffiliations:L,partners:ma,partner:Xa,partnerCards:kb,
partnerCardAffiliations:lb,agents:Ma,agent:da,desks:Ya,desk:mb,cannedMessages:Ed,cannedMessage:zb,availabilityHeadlines:Fd,availabilityHeadline:hc,customerPrototypes:yb,customerPrototype:fc,customerTypes:bb,customerType:ec,checkinStatuses:Dd,checkinStatus:gc,customFields:Oa,customField:xa,transportationOptions:Wb,transportationOption:rb,extendedOptions:Xb,extendedOption:sb,connectedCampaigns:Yb,connectedCampaign:Zb,generatingCampaigns:$b,generatingCampaign:tb,customFieldInstances:ub,customFieldInstance:wd,
customFieldInstanceConditions:yd,customFieldInstanceCondition:xd,customFieldInstanceGroup:Pa,companyCustomFieldInstanceGroups:Ga,combinedCustomFieldInstanceGroups:function(a,b){var c={shortname:a.company.shortname,itemPk:a.pk},d={shortname:a.company.shortname},e=b?Fa.includeArchived(c):Fa(c),g=a.company.features.isCompanyLevelCustomFieldInstanceGroupsEnabled?b?Ga.includeArchived(d):Ga(d):[],h=[];h.$promise=f.all([e.$promise,g.$promise]).then(function(){_.ref.append(h,e,g)});return h},itemCustomFieldInstanceGroups:Fa,
pushCustomFieldValues:Ld,customerCustomFieldValue:Fb,bookingCustomFieldValue:Eb,availabilities:ca,availability:aa,customerTypeRates:ic,customerTypeRate:Ab,subjects:cb,blocks:Gd,block:Hd,orders:kc,order:Qa,orderPayments:Cb,bookings:ta,booking:Y,customer:lc,customers:Db,lineItems:Hb,lineItem:Ib,payments:Ia,installmentPayment:oc,orderInstallmentPayment:pc,disputes:vc,refunds:uc,authorizationHolds:qc,paymentFees:rc,inStorePaymentTypes:sc,inStorePaymentType:Qd,emvLocation:Od,emvDevices:Rd,emvDevice:za,
bankAccounts:U,bankAccount:fa,cards:D,card:C,cardAffiliations:Ka,supportedLanguages:Ad,supportedLanguage:zd,translations:Bd,translationsForModel:vb,translationsForField:ac,understoodLanguages:Cd,translationsForSubfield:bc,reports:oa,report:ya,campaigns:qa,campaign:N,campaignValidityRules:Na,campaignValidityRule:Ea,codes:Ua,code:ib,storedValueTypes:Tc,storedValueType:Uc,storedValueCards:Va,storedValueCard:Wa,storedValueAdjustments:Vc,storedValueAdjustment:jb,resellerCompanies:Yc,resellerCompany:Zc,
resellerCompanyMappings:$c,resellerCompanyMapping:ad,resellerItems:bd,resellerItem:cd,resellerItemMappings:dd,resellerItemMapping:ed,resellerCustomerTypes:fd,resellerCustomerType:gd,resellerCustomerTypeMappings:hd,resellerCustomerTypeMapping:id,resellerOptions:jd,resellerOption:kd,resellerOptionMappings:ld,resellerOptionMapping:md,resellerUnmappedItems:nd,resellerUnmappedCustomerPrototypes:od,resellerKeys:pd,resellerKey:qd,resellerApps:rd,resellerApp:sd,resellerAppRequest:td,resellerAppRequests:qb,
resellerAppCompany:vd,resellerAppCompanies:ud,reorder:Xd,refresh:function(a,b){d.assert(a,"db.refresh: expected uri");return De(a,null,null,null,b)},slipstream:function(b,c){c=c||{};if(window.slipstream&&window.slipstream[b]){var d=window.slipstream[b],e=c.doNotConvert||!1;return _.isObject(d)?(d=e?d:a.serverResponse(d),B(d,null,_.isArray(d))):d}},ledgers:tc,ledger:Pd,payouts:wc,payout:xc,transfers:yc,transfer:Sd,uploads:Ac,upload:Ud,oneTimeTransfer:zc,upcomingRefundReserveAmounts:Td,adjustments:Cc,
adjustment:Wd,transactions:Dc,funds:Bc,fund:Vd,roles:cc,role:wb,crewMembers:dc,crewMember:xb,hotels:na,hotel:nb,lodgings:Za,lodging:ob,pickups:ea,pickup:ia,routes:va,route:sa,stops:pb,stop:ab,runs:ka,preferredPickups:$a,preferredPickup:ja,testReport:M,invoices:Gb,invoice:Ha,totalSchedules:Ra,totalSchedule:Mb,totalScheduleEntries:Yd,totalScheduleEntry:Zd,totalScheduleEntryRules:$d,totalScheduleEntryRule:ae,invoiceScheduleEntryRules:de,invoiceScheduleEntryRule:ee,invoiceSchedules:Nb,invoiceSchedule:Ob,
invoiceScheduleEntries:be,invoiceScheduleEntry:ce,effectiveSheets:fe,affiliationEffectiveSheets:ge,rebookingEffectiveSheets:he,totalScheduleEffectiveSheet:ie,invoiceScheduleEffectiveSheet:je,totalSheets:ga,totalSheet:Aa,invoiceSheets:Ba,invoiceSheet:Ca,taxTypes:Qb,taxType:ke,paymentProcessingDocuments:Wc,paymentProcessingDocument:Xc,locations:Kc,location:Jc,waivers:Fc,waiver:Lb,connectedWaivers:Gc,connectedWaiver:Hc,waiverInstance:Ic,resources:db,resource:eb,resourceUses:Ja,requirementGroups:function(a){var b=
Rb(a),c=Lc(a);return f.all([b.$promise,c.$promise]).then(function(){return b.concat(c)})},requirementGroup:Sb,companyRequirementGroups:Lc,itemRequirementGroups:Rb,requirements:le,requirement:me,resourceRequirements:ne,resourceRequirement:Mc,resourceUse:Nc,resourceOverride:fb,resourceOverrides:gb,seatMaps:oe,seatMap:Da,seatGroups:pe,seatGroup:qe,seatZones:re,seatZone:se,ticketLayouts:te,ticketLayout:ue,analyticsServices:ve,analyticsService:we,cancellationPolicies:xe,cancellationPolicy:Tb,cancellationRules:ye,
cancellationRule:ze,bookingRestrictions:Ae,bookingRestriction:Oc,persistentStore:Pc,persistentStoreForCompany:Qc,persistentStoreItem:Ub,tagGroups:Md,tagGroup:Nd,tags:mc,tag:Jb,objectTags:nc,taskResult:Be,tokens:Ce,version:Fe,serverResponse:B,formErrorHandler:P,errorStatus:function(a){return 0===a&&!A?"disconnect":404===a?"not-found":403===a?"forbidden":"error"},pusher:Pb,searchEndpoint:function(a,b,c){c=c||{};return function(d){return a(b,null,null,_.defaults({q:d},c))}},view:Ee}}])})();
angular.module("clientOptions",["clientOptions.services"]);
(function(){var m=angular.module("clientOptions.services",["db","lib","navigation"]);m.factory("clientOptions",["$rootScope","$sniffer","auth","db","events","models","navigation","storage","urls",function(c,g,k,f,l,e,a,m,h){h=/^(?:https?:\/\/)?(?:[a-z0-9\-_]+\.[a-z0-9\-_]+)+.*/i;var d=[{query:"u",key:"userIdentifier",reflect:!m.isPersistent(),reflectExternal:function(){return k.currentUser.isAuthenticated?!1:!0}},{query:"asn",key:"asnAffiliateCompany",reflect:!0},{query:"asn-ref",key:"asnVoucherNumber",
reflect:!0},{query:"sheet",key:"defaultTotalSheetPk",reflect:!0,type:"int"},{query:"sheet-uuid",key:"defaultTotalSheetUuid",reflect:!0},{query:"schedule",key:"defaultTotalSchedulePk",reflect:!0,type:"int"},{query:"schedule-uuid",key:"defaultTotalScheduleUuid",reflect:!0},{query:"full-items",key:"isFullItemsEnabled",reflect:!0,type:"yes-no",isAuthenticatedAllowed:!0},{query:"kiosk",key:"isKioskModeEnabled",isSlipstream:!0,type:"yes-no"},{query:"ref",key:"onlineBookingReference",reflect:!0,isAuthenticatedAllowed:!0},
{query:"referrer",key:"referrerUrl",pattern:h},{query:"back",key:"backUrl",pattern:h,reflect:!0,decode:!0},{query:"is-back-company-url",key:"isBackCompanyUrl",type:"yes-no"},{query:"preview",key:"preview"},{query:"site-tags",key:"trackingSiteTags",onlyIfDefined:!0,decode:!0},{query:"page-tags",key:"trackingPageTags",onlyIfDefined:!0,decode:!0},{query:"button-tags",key:"trackingButtonTags",onlyIfDefined:!0,decode:!0},{query:"from-ssl",key:"trackingIsFromSsl",type:"yes-no",onlyIfDefined:!0},{query:"from-embed",
key:"trackingFromEmbed",onlyIfDefined:!0},{query:e.FlowNode.FLOW_QUERY,key:"flowNode",reflect:!0,isUpdatedOnLocationChange:!0,isAuthenticatedAllowed:!0},{query:e.FlowNode.IS_FROM_CART_QUERY,key:"isFromCart",reflect:!0,type:"yes-no",isUpdatedOnLocationChange:!0},{query:"bookable-only",key:"isBookableOnly",type:"yes-no"},{query:"branding",key:"isCompanyBrandingEnabled",reflect:!0,type:"yes-no"},{query:"gclid",key:"gclid"}],b=_.filter(d,"isUpdatedOnLocationChange"),A=function(a){a=a||_.always;var b=
{};_.forEach(d,function(c){if(a(c)&&c.key){var d=G[c.key];_.isUndefined(d)||("yes-no"===c.type?d&&(b[c.query]="yes"):"int"===c.type?_.isFinite(d)&&(b[c.query]=d):d&&(b[c.query]=d))}});return b},s=function(){return A(function(a){return!!a.reflect})},r=function(){var a=A(function(a){return _.isFunction(a.reflectExternal)?a.reflectExternal():!!a.reflectExternal});return _.mapKeys(a,function(a,b){return"fh-"+b})};c.$on("$locationChangeSuccess",function(){_.forEach(b,w);var c=s();_.forEach(c,function(b,
c){a.set(c,b,!0)})});l.on(c,"navigation.company.updated",function(){a.currentCompany&&(G.asnCharterCompany?G.asnCharterCompany!==a.currentCompany.shortname&&(G.asnCharterCompany="",G.asnAffiliateCompany="",G.asnVoucherNumber=""):G.asnCharterCompany=a.currentCompany.shortname)});c=f.slipstream("domain");var y=f.slipstream("protocol")+"://"+c,G={reflect:function(b){var c=_.find(d,"key",b).query;a.set(c,G[b],!0)},extendUrl:function(b){return a.compose(b,A(),!0)},reflectUrl:function(b){var c;if("/"===
b.charAt(0)||0===b.indexOf(y))c=s();else if(0===b.indexOf("http"))c=r();else return b;return a.compose(b,c,!0)},reflectUrlsInHrefs:function(a){a.on("mousedown","a",function(){var a=$(this);a.attr("href",G.reflectUrl(a.attr("href")))})}},w=function(b){var c=a.get(b.query)||"";!c&&b.isSlipstream&&(c=f.slipstream(b.query)||"");k.currentUser.isAuthenticated&&!b.isAuthenticatedAllowed&&(c="");b.pattern&&!b.pattern.test(c)&&(c="");if(!b.onlyIfDefined||c)"int"===b.type?(c=parseInt(c,10),c=isNaN(c)?null:
c):"yes-no"===b.type&&(c="yes"===c),g.history&&!b.isUpdatedOnLocationChange&&a.clear(b.query,!0),b.decode&&(c=decodeURIComponent(c)),b.key&&(G[b.key]=c)};_.forEach(d,w);k.currentUser.isAuthenticated||(G.asnAffiliateCompany=G.asnAffiliateCompany||f.slipstream("asnAffiliateCompany")||"");G.asnAffiliateCompany||(G.asnAffiliateCompany="",G.asnVoucherNumber="");return G}]);m.run(["$rootScope","clientOptions",function(c,g){c.clientOptions=g}])})();
(function(){angular.module("flash",["flash.services"]);angular.module("flash.services",[]).factory("flash",[function(){return{debug:_.ignore,info:_.ignore,warn:_.ignore,error:_.ignore,success:_.ignore}}])})();angular.module("lightframe",["lightframe.services"]);
(function(){var m=angular.module("lightframe.services",[]);m.factory("lightframe",["$browser","$sniffer","$window","clientOptions","navigation","xmessage",function(c,g,k,f,l,e){c="";var a=!1,m=!1,h=null,d={};g=function(a){try{a=decodeURIComponent(a),d=JSON.parse(a)||{},h=d.parentUrl||null}catch(b){}};/^fareharbor-embed:/.test(k.name)?(g(window.name.substr(17)),c=d.embedId||"",a=d.isLightframed||!1):/^fareharbor-lightframe/.test(k.name)&&(g(window.name.substr(22)),m=!0);var b={embedId:c,isLightframe:function(){return k.top!==
k&&m},isEmbed:function(){return k.top!==k&&b.embedId},isLightframed:function(){return b.isEmbed()&&a},parentUrl:function(){return h},broadcast:function(a,c){c=_.extend({embedId:b.embedId},c);e.broadcast(a,c)},updateHeight:function(a){b.isEmbed()&&a&&b.broadcast("fareharbor.height",{height:a})},open:function(a){a=f.extendUrl(a);b.isEmbed()?b.broadcast("fareharbor.open",{url:a}):k.top.location.href=k.location.protocol+"//"+k.location.hostname+(k.location.port?":"+k.location.port:"")+a},close:function(){b.broadcast("fareharbor.close")},
ready:function(){b.broadcast("fareharbor.ready")},isDirectAccess:function(){return k.top===k},listenForTouch:function(){var a=function(){b.broadcast("fareharbor.touchDetected")};window.addEventListener("touchstart",function r(){a();window.removeEventListener("touchstart",r)},!1);window.addEventListener("pointerdown",function y(b){"touch"==b.pointerType&&(a(),window.removeEventListener("pointerdown",y))},!1)}};return b}]);m.run(["$rootScope","lightframe",function(c,g){c.lightframe=g;c.isLightframe=
g.isLightframe();g.ready();g.listenForTouch()}])})();(function(){angular.module("tracking",[]).factory("analytics",[function(){return{trackView:_.ignore}}])})();angular.module("urls",["urls.services"]);
(function(){var m=angular.module("urls.services",["lib.services"]);m.factory("urls",["models","require",function(c,g){var k={},f=function(a,c,e){var d,b,f;for(f in c)if(c.hasOwnProperty(f)){var g=c[f];f&&void 0!==g&&(b=":"+f+"(?:\\([^\\)/]+\\))?",(d=k[b])||(d=k[b]=RegExp(b)),a=a.replace(d,g))}if(e||-1===a.indexOf(":"))return a},l={Company:function(a){return{shortname:a.shortname,canonical:{company:"company.index",dashboard:"dashboard.index"}}},Hotel:function(a){return{shortname:a.company.shortname,
hotelPk:a.pk,canonical:{dashboard:"dashboard.settings.hotels.hotel"}}},Lodging:function(a){return{shortname:a.company.shortname,lodgingPk:a.pk,canonical:{dashboard:"dashboard.settings.lodgings.lodging"}}},PreferredPickup:function(a){return{shortname:a.company.shortname,lodgingPk:a.lodging.pk,preferredPickupPk:a.pk,canonical:{dashboard:"dashboard.settings.lodgings.lodging"}}},Route:function(a){return{shortname:a.company.shortname,routePk:a.pk,canonical:{dashboard:"dashboard.settings.routes.route"}}},
Run:function(a){return{shortname:a.route.company.shortname,routePk:a.route.pk,runPk:a.pk,canonical:{dashboard:"dashboard.settings.routes.route"}}},Stop:function(a){return{shortname:a.company.shortname,routePk:a.route.pk,stopPk:a.pk,canonical:{dashboard:"dashboard.settings.routes.route"}}},Pickup:function(a){return{shortname:a.company.shortname,pickupPk:a.pk,canonical:{dashboard:"dashboard.settings.pickups.pickup"}}},User:function(a){return{username:a.username,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.index"}}},
CustomManifest:function(a){return{customManifestPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.index"}}},CustomCalendar:function(a){return{customCalendarPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.index"}}},CustomReport:function(a){return{customReportPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.index"}}},Image:function(a){return{imagePk:a.pk,itemPk:a.item?a.item.pk:void 0,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.index"}}},
Resource:function(a){return{resourcePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.resources.resource.index"}}},ResourceOverride:function(a){return{resourceOverridePk:a.pk,resourcePk:a.resource.pk,shortname:a.resource.company.shortname,canonical:{dashboard:"dashboard.resources.resource.uses.index"}}},SeatMap:function(a){return{seatMapPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.layout.index"}}},SeatGroup:function(a){return{seatGroupPk:a.pk,
seatMapPk:a.seatMap.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.layout.seatGroup"}}},SeatZone:function(a){return{seatZonePk:a.pk,seatMapPk:a.seatMap.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.seatZones.seatZone"}}},Seat:function(a){return{seatPks:a.pk,seatMapPk:a.seatMap.pk,shortname:a.seatMap.company.shortname,canonical:{dashboard:"dashboard.settings.seating.seatMap.layout.seats"}}},TagGroup:function(a){return{tagGroupPk:a.pk,
shortname:a.company.shortname}},Tag:function(a){return{tagPk:a.pk,tagGroupPk:a.tagGroup.pk,shortname:a.tagGroup.company.shortname}},Item:function(a){return{itemPk:a.pk,shortname:a.company.shortname,canonical:{company:"company.item.index",dashboard:"dashboard.items.item.index"}}},FlowNode:function(a){return{flowNodePk:a.pk,shortname:a.company.shortname,canonical:{company:"company.flowNode.index",dashboard:"dashboard.settings.flows.flowNode.index"}}},CustomerPrototype:function(a){return{customerPrototypePk:a.pk,
itemPk:a.item.pk,shortname:a.item.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.customerTypes"}}},Availability:function(a){return{availabilityPk:a.pk,itemPk:a.item.pk,shortname:a.item.company.shortname,date:a.startAt?a.startAt.format("YYYY-MM-DD"):void 0,canonical:{company:"company.item.availability",dashboard:"dashboard.overlay.availability.index"}}},Block:function(a){return{blockPk:a.pk,availabilityPk:a.availability.pk,itemPk:a.availability.item.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.overlay.availability.index"}}},Contact:function(a){return{contactPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.index"}}},Order:function(a){return{contactPk:a.contact.pk,orderUuid:a.uuid,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.order",company:"company.order.index"}}},Booking:function(a){return{bookingUuid:a.uuid,itemPk:a.item.pk,contactPk:a.contact.pk,shortname:a.company.shortname,affiliateShortname:a.affiliation?
a.affiliation.affiliateCompany.shortname:void 0,canonical:{company:"company.item.booking",dashboard:"dashboard.overlay.contact.booking"}}},Campaign:function(a){return{campaignPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.index"}}},CampaignValidityRule:function(a){return{campaignValidityRulePk:a.pk,campaignPk:a.campaign.pk,shortname:a.campaign.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.settings"}}},Code:function(a){return{codePk:a.pk,
campaignPk:a.campaign.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.code"}}},StoredValueType:function(a){return{storedValueTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueType"}}},StoredValueCard:function(a){return{storedValueCardPk:a.pk,storedValueCardNumber:a.number,shortname:a.storedValueType.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueCard.index"}}},StoredValueAdjustment:function(a){return{storedValueAdjustmentPk:a.pk,
storedValueCardPk:a.storedValueCard.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueCard.storedValueAdjustment"}}},PaymentProcessingDocument:function(a){return{paymentProcessingDocumentPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.document.index"}}},Customer:function(a){return{customerPk:a.pk,bookingUuid:a.booking.uuid,shortname:a.company.shortname,contactPk:_.get(a,"booking.contact.pk"),canonical:{dashboard:"dashboard.overlay.contact.booking"}}},
CheckinStatus:function(a){return{checkinStatusPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.checkinStatuses"}}},CustomerType:function(a){return{customerTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customerTypes.customerType"}}},CustomerTypeRate:function(a){return{customerTypeRatePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.availability.prices"}}},CannedMessage:function(a){return{cannedMessagePk:a.pk,
shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.cannedMessages.cannedMessage"}}},AvailabilityHeadline:function(a){return{availabilityHeadlinePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.availabilityHeadlines.availabilityHeadline"}}},InStorePaymentType:function(a){return{inStorePaymentTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.inStorePaymentTypes"}}},TaxType:function(a){return{taxTypePk:a.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.settings.payments.taxTypes.taxType"}}},Ledger:function(a){return{ledgerPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.ledgers.ledger"}}},EmvDevice:function(a){return{inStorePaymentTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.emvDevices"}}},BankAccount:function(a){return{bankAccountPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.bankAccounts"}}},
Card:function(a){return{cardPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.cards.card.index"}}},CardAffiliation:function(a){return{cardAffiliationPk:a.pk,cardPk:a.card.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.cards.card.index"}}},Payment:function(a){return{paymentPk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},
Refund:function(a){return{refundPk:a.pk,paymentPk:a.payment.pk,contactPk:a.payment.booking.contact.pk,bookingUuid:a.payment.booking.uuid,itemPk:a.payment.booking.item.pk,shortname:a.payment.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},LegacyTransfer:function(a){return{transferPk:a.pk,shortname:a.company.shortname}},LegacyTransaction:function(a){return{transactionPk:a.pk}},Account:function(a){return{accountPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.transactions.index"}}},
Payout:function(a){return{payoutPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.payouts.payout"}}},Transfer:function(a){return{transferPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.accounts.transfer"}}},Upload:function(a){return{uploadPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.accounts.upload"}}},Adjustment:function(a){return{adjustmentPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.transactions.adjustment"}}},
Transaction:function(a){return{transactionPk:a.pk,shortname:c.Company.ADMIN_SHORTNAME,canonical:{dashboard:"dashboard.reports.transactions.index"}}},LineItem:function(a){return{lineItemPk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Agent:function(a){return{agentPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.agents.agent"}}},Desk:function(a){return{deskPk:a.pk,
shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.desks.desk"}}},Role:function(a){return{rolePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.index"}}},CrewMember:function(a){return{crewMemberPk:a.pk,availabilityPk:a.availability.pk,itemPk:a.availability.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.availability.index"}}},CustomField:function(a){return{customFieldPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},
TransportationOption:function(a){return{transportationOptionPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ExtendedOption:function(a){return{extendedOptionPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ConnectedCampaign:function(a){return{connectedCampaignPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ConnectedWaiver:function(a){return{connectedWaiverPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},GeneratingCampaign:function(a){return{generatingCampaignPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},CustomFieldInstance:function(a){return{customFieldInstancePk:a.pk,
itemPk:a.item?a.item.pk:"",shortname:a.company.shortname,customFieldInstanceGroupPk:a.customFieldInstanceGroup?a.customFieldInstanceGroup.pk:"",canonical:{dashboard:a.item?"dashboard.items.item.prices.index":"dashboard.settings.customFieldInstanceGroups.customFieldInstanceGroup"}}},CustomFieldInstanceCondition:function(a){return{customFieldInstanceConditionPk:a.pk,customFieldInstancePk:a.customFieldInstance.pk,shortname:a.customFieldInstance.company.shortname,customFieldInstanceGroupPk:a.customFieldInstanceGroup?
a.customFieldInstanceGroup.pk:"",canonical:{dashboard:a.customFieldInstance.item?"dashboard.items.item.prices.index":"dashboard.settings.customFieldInstanceGroups.customFieldInstanceGroup"}}},CustomFieldInstanceGroup:function(a){return{customFieldInstanceGroupPk:a.pk,itemPk:a.item?a.item.pk:null,shortname:a.company.shortname,canonical:{dashboard:a.item?"dashboard.items.item.prices.fieldGroups":"dashboard.settings.customFieldInstanceGroups.customFieldInstanceGroup"}}},RequirementGroup:function(a){return{requirementGroupPk:a.pk,
shortname:a.company.shortname,itemPk:a.isItemLevel?a.item.pk:null,canonical:{dashboard:a.isItemLevel?"dashboard.items.item.prices.resources":"dashboard.settings.requirementGroups.requirementGroup"}}},Requirement:function(a){return{requirementPk:a.pk,requirementGroupPk:a.requirementGroup.pk,itemPk:a.requirementGroup.isItemLevel?a.requirementGroup.item.pk:null,shortname:a.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},CustomerPrototypeRequirement:function(a){return{customerPrototypeRequirementPk:a.pk,
requirementPk:a.requirement.pk,requirementGroupPk:a.requirement.requirementGroup.pk,itemPk:a.requirement.requirementGroup.isItemLevel?a.requirement.requirementGroup.item.pk:null,shortname:a.requirement.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},ResourceRequirement:function(a){return{resourceRequirementPk:a.pk,requirementPk:a.requirement.pk,requirementGroupPk:a.requirement.requirementGroup.pk,itemPk:a.requirement.requirementGroup.isItemLevel?
a.requirement.requirementGroup.item.pk:null,shortname:a.requirement.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},CustomerCustomFieldValue:function(a){return{customerCustomFieldValuePk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},BookingCustomFieldValue:function(a){return{bookingCustomFieldValuePk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,
shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Group:function(a){return{groupPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.group"}}},GroupOverride:function(a){return{groupOverridePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.groupOverride"}}},ResourceUse:function(a){return{resourceUsePk:a.pk,customerPk:a.customer?a.customer.pk:void 0,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,
shortname:a.booking.contact.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Affiliation:function(a){return{affiliationPk:a.pk,shortname:a.company.shortname,affiliateShortname:a.affiliateCompany.shortname,canonical:{dashboard:"dashboard.settings.network.affiliates.affiliate.index"}}},Activity:function(a){return{activityPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.activity.index"}}},Notification:function(a){return{notificationPk:a.pk,shortname:a.company.shortname,
contactPk:a.booking?a.booking.contact.pk:void 0,bookingUuid:a.booking?a.booking.uuid:void 0,availabilityPk:a.availability?a.availability.pk:void 0,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},SmsNotification:function(a){return{smsNotificationPk:a.pk,shortname:a.company.shortname,contactPk:a.booking?a.booking.contact.pk:void 0,bookingUuid:a.booking?a.booking.uuid:void 0,availabilityPk:a.availability?a.availability.pk:void 0,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},
Subscription:function(a){return{subscriptionPk:a.pk,username:a.user.username,shortname:a.user.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.settings"}}},Invoice:function(a){return{invoicePk:a.pk,invoiceUuid:a.uuid,shortname:a.company.shortname,affiliateShortname:a.affiliation?a.affiliation.affiliateCompany.shortname:void 0,canonical:{dashboard:"dashboard.reports.invoices.invoice.index"}}},InvoiceEntry:function(a){return{invoiceEntryPk:a.pk,invoiceUuid:a.invoice.uuid,
invoicePk:a.invoice.pk,shortname:a.invoice.company.shortname,canonical:{dashboard:"dashboard.reports.invoices.invoice.index"}}},Report:function(a){return{reportPk:a.pk,shortname:a.company.shortname,modelSlug:a.type===c.Report.ADVANCED_TYPE?c.Report.MODELS[a.options.modelName].slug:void 0,canonical:{dashboard:"dashboard.reports.advanced.permalink"}}},Waiver:function(a){return{waiverPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.waivers.waiver.index"}}},WaiverInstance:function(a){return{waiverPk:a.waiver.pk,
waiverInstancePk:a.pk,bookingUuid:a.booking.uuid,contactPk:a.booking.contact.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},TotalSchedule:function(a){return{shortname:a.company.shortname,totalSchedulePk:a.pk,totalScheduleUuid:a.uuid,canonical:{dashboard:"dashboard.settings.pricing.totalSchedules.index"}}},TotalScheduleEntry:function(a){return{shortname:a.company.shortname,totalSchedulePk:a.schedule.pk,totalScheduleEntryPk:a.pk,canonical:{dashboard:"dashboard.settings.pricing.totalSchedules.entry.index"}}},
TotalScheduleEntryRule:function(a){return{shortname:a.company.shortname,totalSchedulePk:a.entry.schedule.pk,totalScheduleEntryPk:a.entry.pk,totalScheduleEntryRulePk:a.pk,canonical:{dashboard:"dashboard.settings.pricing.totalSchedules.entry.index"}}},InvoiceSchedule:function(a){return{shortname:a.company.shortname,invoiceSchedulePk:a.pk,canonical:{dashboard:"dashboard.settings.pricing.invoiceSchedules.index"}}},InvoiceScheduleEntry:function(a){return{shortname:a.company.shortname,invoiceSchedulePk:a.schedule.pk,
invoiceScheduleEntryPk:a.pk,canonical:{dashboard:"dashboard.settings.pricing.invoiceSchedules.entry.index"}}},InvoiceScheduleEntryRule:function(a){return{shortname:a.company.shortname,invoiceSchedulePk:a.entry.schedule.pk,invoiceScheduleEntryPk:a.entry.pk,invoiceScheduleEntryRulePk:a.pk,canonical:{dashboard:"dashboard.settings.pricing.invoiceSchedules.entry.index"}}},TotalSheet:function(a){return{totalSheetPk:a.pk,totalSheetUuid:a.uuid,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.totalSheet"}}},
TotalLine:function(a){return{totalSheetPk:a.sheet.pk,totalSheetUuid:a.sheet.uuid,shortname:a.sheet.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.totalSheet"}}},InvoiceSheet:function(a){return{invoiceSheetPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.invoiceSheet"}}},InvoiceLine:function(a){return{invoiceSheetPk:a.sheet.pk,shortname:a.sheet.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.invoiceSheet"}}},SupportedLanguage:function(a){return{languagePk:a.pk,
shortname:a.company.shortname,modelName:c.Translation.modelNameForUrl(a.modelName),canonical:{dashboard:"dashboard.settings.translations.language.translations.index"}}},Translation:function(a){return{translationPk:a.pk,languagePk:a.supportedLanguage.pk,shortname:a.supportedLanguage.company.shortname,canonical:{dashboard:"dashboard.settings.translations.language.translations.index"}}},Location:function(a){return{locationPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.locations.location"}}},
ResellerCompany:function(a){return{resellerCompanyPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.company.index"}}},ResellerCompanyMapping:function(a){return{resellerCompanyMappingPk:a.pk,resellerCompanyPk:a.resellerCompany.pk,shortname:a.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.company.index"}}},ResellerItem:function(a){return{resellerItemPk:a.pk,resellerCompanyPk:a.resellerCompany.pk,shortname:a.resellerCompany.company.shortname,
canonical:{dashboard:"dashboard.settings.reseller.item.index"}}},ResellerItemMapping:function(a){return{resellerItemMappingPk:a.pk,resellerItemPk:a.resellerItem.pk,resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.item.index"}}},ResellerCustomerType:function(a){return{resellerCustomerTypePk:a.pk,resellerItemPk:a.resellerItem.pk,resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,
canonical:{dashboard:"dashboard.settings.reseller.customerType.index"}}},ResellerCustomerTypeMapping:function(a){return{resellerCustomerTypeMappingPk:a.pk,resellerCustomerTypePk:a.resellerCustomerType.pk,resellerItemPk:a.resellerCustomerType.resellerItem.pk,resellerCompanyPk:a.resellerCustomerType.resellerItem.resellerCompany.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.customerType.index"}}},ResellerOption:function(a){return{resellerOptionPk:a.pk,resellerItemPk:a.resellerItem.pk,
resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.option.index"}}},ResellerOptionMapping:function(a){return{resellerOptionMappingPk:a.pk,resellerOptionPk:a.resellerOption.pk,resellerItemPk:a.resellerOption.resellerItem.pk,resellerCompanyPk:a.resellerOption.resellerItem.resellerCompany.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.option.index"}}},ResellerKey:function(a){return{resellerKeyPk:a.pk,
username:a.user.username,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.apiKeys.apiKey"}}},ResellerApp:function(a){return{resellerAppPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.apps.app.index"}}},ResellerAppRequest:function(a){return{resellerAppRequestPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.connect"}}},ResellerAppCompany:function(a){return{resellerAppCompanyPk:a.pk,resellerAppPk:a.resellerApp.pk,
shortname:a.resellerApp.company.shortname}},AnalyticsService:function(a){return{analyticsServicePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.analyticsServices.analyticsService"}}},CancellationPolicy:function(a){return{cancellationPolicyPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.cancellationPolicy.index"}}},CancellationRule:function(a){return{cancellationPolicyPk:a.cancellationPolicy.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.cancellationPolicy.index"}}},
BookingRestriction:function(a){return{bookingRestrictionPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.bookingRestrictions.bookingRestriction"}}},TicketLayout:function(a){return{ticketLayoutPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.ticketLayouts.ticketLayout.index"}}}},e={populate:f,populateForObject:function(a){a=a||"";var c;if(this.$urls){if(c=this.$urls[a])return c}else this.$urls={},this.$params=e.extract(this);if(a)c=f(a,this.$params);
else{if(!this.$params.canonical)return"";c=this.$params.canonical.dashboard||this.$params.canonical.company;if(!c)return"";c=f(_.getDotted(e,c),this.$params)}return this.$urls[a]=c},extract:function(a){g.assert(a,"urls: unable to extract from object",a);g.defined(l,a.cls,"urls: unable to extract cls",a);try{return l[a.cls](a)}catch(c){return console.warn("urls: unable to extract",a,c),{}}},calendarUrls:function(a){return{index:a,month:a+":year/:month/",day:a+":year/:month/:day/",agenda:a+":year/:month/:day/",
grid:a+":year/:month/:day/",timeline:a+":year/:month/:day/"}},dayUrlForCompany:function(a,g){return f(a.features.isDayViewEnabled?e.dashboard.bookings.day.date:e.dashboard.bookings.timeline.date+"?timeline-type="+c.Company.AVAILABILITY_TIMELINE,{shortname:a.shortname,date:g.format("YYYY-MM-DD")})},legacyManifest:"/:shortname/manifest/",company:{index:"/:shortname/",login:"/:shortname/login/",about:"/:shortname/about/",faq:"/:shortname/faq/",policies:"/:shortname/policies/",items:{index:"/:shortname/items/",
calendar:"/:shortname/items/calendar/",date:{index:"/:shortname/items/date/",date:"/:shortname/items/date/:date/"}},item:{index:"/:shortname/items/:itemPk(pk)/",calendar:"/:shortname/items/:itemPk(pk)/calendar/",month:"/:shortname/items/:itemPk(pk)/calendar/:year/:month/",date:"/:shortname/items/:itemPk(pk)/date/:date/",availability:"/:shortname/items/:itemPk(pk)/availability/:availabilityPk/",book:"/:shortname/items/:itemPk(pk)/availability/:availabilityPk/book/",booking:"/:shortname/items/:itemPk(pk)/booking/:bookingUuid/"},
storedValueCard:{index:"/:shortname/gift-cards/:storedValueCardNumber/"},cart:{index:"/:shortname/cart/",permalink:"/:shortname/cart/?u=:cartUuid"},order:{index:"/:shortname/orders/:orderUuid/"},invoice:{index:"/:shortname/invoices/:invoiceUuid/"},flowNode:{index:"/:shortname/items/?flow=:flowNodePk",calendar:"/:shortname/items/calendar/?flow=:flowNodePk",date:{index:"/:shortname/items/date/?flow=:flowNodePk",date:"/:shortname/items/date/:date/?flow=:flowNodePk"}}},dashboard:{index:"/:shortname/dashboard/",
overlay:{index:"/:shortname/dashboard/@overlay=/",item:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/",date:"/:shortname/dashboard/@overlay=/items/:itemPk/date/:date/"},availability:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/",bookings:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/bookings/",cancelled:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/bookings/cancelled/"},message:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/message/",
settings:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/settings/",prices:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/prices/",integrations:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/integrations/"},contact:{index:"/:shortname/dashboard/@overlay=/contacts/:contactPk/",booking:"/:shortname/dashboard/@overlay=/contacts/:contactPk/bookings/:bookingUuid/",order:"/:shortname/dashboard/@overlay=/contacts/:contactPk/orders/:orderUuid/"},
deprecatedBooking:{index:"/:shortname/dashboard/@overlay=/bookings/:bookingUuid/"},activity:{index:"/:shortname/dashboard/@overlay=/activities/:activityPk/"},translation:{index:"/:shortname/dashboard/@overlayTop=/translations/:objectType/:objectId/:objectField/"},document:{index:"/:shortname/dashboard/@overlay=/documents/:paymentProcessingDocumentPk"},close:"/:shortname/dashboard/@overlay"},translationsOverlay:{index:"/:shortname/dashboard/@translations-overlay=/",forSubfield:"/:shortname/dashboard/@translations-overlay=/for-field/:objectType/:objectId/:objectField/:subfield/",
forField:"/:shortname/dashboard/@translations-overlay=/for-field/:objectType/:objectId/:objectField/",close:"/:shortname/dashboard/@translations-overlay"},admin:{index:"/:shortname/dashboard/admin/"},manifest:{index:"/:shortname/dashboard/manifest/",date:"/:shortname/dashboard/manifest/date/:date/",bookings:"/:shortname/dashboard/manifest/date/:date/bookings/",availabilities:"/:shortname/dashboard/manifest/date/:date/availabilities/",items:"/:shortname/dashboard/manifest/date/:date/items/",runs:"/:shortname/dashboard/manifest/date/:date/runs/",
resources:"/:shortname/dashboard/manifest/date/:date/resources/"},bookings:{index:"/:shortname/dashboard/bookings/",calendar:"/:shortname/dashboard/bookings/calendar/",day:{index:"/:shortname/dashboard/bookings/day/",date:"/:shortname/dashboard/bookings/day/:date/"},grid:{index:"/:shortname/dashboard/bookings/grid/",date:"/:shortname/dashboard/bookings/grid/:date/"},timeline:{index:"/:shortname/dashboard/bookings/timeline/",date:"/:shortname/dashboard/bookings/timeline/:date/"},agenda:{index:"/:shortname/dashboard/bookings/agenda/",
date:"/:shortname/dashboard/bookings/agenda/:date/"},booking:{deprecatedPermalink:"/:shortname/dashboard/bookings/:bookingUuid/view/",deprecatedAffiliatePermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/:bookingUuid/"},contact:{index:"/:shortname/dashboard/bookings/contacts/:contactPk/",order:"/:shortname/dashboard/bookings/contacts/:contactPk/orders/:orderUuid/view/",booking:"/:shortname/dashboard/bookings/contacts/:contactPk/bookings/:bookingUuid/view/",affiliateContactPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/",
affiliateBookingPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/bookings/:bookingUuid/",affiliateOrderPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/orders/:orderUuid/"}},reports:{index:"/:shortname/dashboard/reports/",type:"/:shortname/dashboard/reports/:type/",invoices:{index:"/:shortname/dashboard/reports/invoices/",create:{index:"/:shortname/dashboard/reports/invoices/create/",permalink:"/:shortname/dashboard/reports/invoices/create/report/:reportPk/"},
permalink:"/:shortname/dashboard/reports/invoices/report/:reportPk/",invoice:{index:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/",multi:"/:shortname/dashboard/reports/invoices/invoices/:invoicePks(pks)/",notification:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/notification/",upload:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/upload/"},partnerInvoice:{index:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/",notification:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/notification/",
upload:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/upload/"}},test:{index:"/:shortname/dashboard/reports/test/",permalink:"/:shortname/dashboard/reports/test/report/:reportPk/"},reports:{index:"/:shortname/dashboard/reports/reports/"},accounts:{index:"/:shortname/dashboard/reports/accounts/",permalink:"/:shortname/dashboard/reports/accounts/report/:reportPk/",transfer:"/:shortname/dashboard/reports/accounts/transfer/:transferPk/",upload:"/:shortname/dashboard/reports/accounts/upload/:uploadPk/"},
customersRedirect:{index:"/:shortname/dashboard/reports/customers/"},contacts:{index:"/:shortname/dashboard/reports/contacts/",permalink:"/:shortname/dashboard/reports/contacts/report/:reportPk/"},bookings:{index:"/:shortname/dashboard/reports/bookings/",permalink:"/:shortname/dashboard/reports/bookings/report/:reportPk/"},companies:{index:"/:shortname/dashboard/reports/companies/",permalink:"/:shortname/dashboard/reports/companies/report/:reportPk/"},payments:{index:"/:shortname/dashboard/reports/payments/",
permalink:"/:shortname/dashboard/reports/payments/report/:reportPk/"},disputes:{index:"/:shortname/dashboard/reports/disputes/",permalink:"/:shortname/dashboard/reports/disputes/report/:reportPk/"},lineItems:{index:"/:shortname/dashboard/reports/line-items/",permalink:"/:shortname/dashboard/reports/line-items/report/:reportPk/"},payouts:{index:"/:shortname/dashboard/reports/payouts/",permalink:"/:shortname/dashboard/reports/payouts/report/:reportPk/",payout:"/:shortname/dashboard/reports/payouts/payout/:payoutPk/"},
escrow:{index:"/:shortname/dashboard/reports/future-payouts/",permalink:"/:shortname/dashboard/reports/future-payouts/report/:reportPk/"},volume:{index:"/:shortname/dashboard/reports/volume/",permalink:"/:shortname/dashboard/reports/volume/report/:reportPk/"},transactions:{index:"/:shortname/dashboard/reports/transactions/",permalink:"/:shortname/dashboard/reports/transactions/report/:reportPk/",adjustment:"/:shortname/dashboard/reports/transactions/:adjustmentPk/"},bookingTypesSummary:{index:"/:shortname/dashboard/reports/booking-types-summary/",
permalink:"/:shortname/dashboard/reports/booking-types-summary/report/:reportPk/"},crewSummary:{index:"/:shortname/dashboard/reports/crew-summary/",permalink:"/:shortname/dashboard/reports/crew-summary/report/:reportPk/"},customerTypesSummary:{index:"/:shortname/dashboard/reports/customer-types-summary/",permalink:"/:shortname/dashboard/reports/customer-types-summary/report/:reportPk/"},customFieldSummary:{index:"/:shortname/dashboard/reports/custom-field-summary/",permalink:"/:shortname/dashboard/reports/custom-field-summary/report/:reportPk/"},
itemsSummary:{index:"/:shortname/dashboard/reports/items-summary/",permalink:"/:shortname/dashboard/reports/items-summary/report/:reportPk/"},lodgingsSummary:{index:"/:shortname/dashboard/reports/lodging-summary/",permalink:"/:shortname/dashboard/reports/lodging-summary/report/:reportPk/"},pickupsSummary:{index:"/:shortname/dashboard/reports/pickups-summary/",permalink:"/:shortname/dashboard/reports/pickups-summary/report/:reportPk/"},usersSummary:{index:"/:shortname/dashboard/reports/users-summary/",
permalink:"/:shortname/dashboard/reports/users-summary/report/:reportPk/"},agentsSummary:{index:"/:shortname/dashboard/reports/agents-summary/",permalink:"/:shortname/dashboard/reports/agents-summary/report/:reportPk/"},desksSummary:{index:"/:shortname/dashboard/reports/desks-summary/",permalink:"/:shortname/dashboard/reports/desks-summary/report/:reportPk/"},campaignsSummary:{index:"/:shortname/dashboard/reports/campaigns-summary/",permalink:"/:shortname/dashboard/reports/campaigns-summary/report/:reportPk/"},
revenueSummary:{index:"/:shortname/dashboard/reports/revenue-summary/",permalink:"/:shortname/dashboard/reports/revenue-summary/report/:reportPk/"},advanced:{redirect:"/:shortname/dashboard/reports/advanced/",index:"/:shortname/dashboard/reports/advanced/:modelSlug/",permalink:"/:shortname/dashboard/reports/advanced/:modelSlug/:reportPk/"}},items:{index:"/:shortname/dashboard/items/",grid:"/:shortname/dashboard/items/grid/",list:"/:shortname/dashboard/items/list/",item:{index:"/:shortname/dashboard/items/:itemPk/",
activity:"/:shortname/dashboard/items/:itemPk/activity/",calendar:"/:shortname/dashboard/items/:itemPk/calendar/",prices:{index:"/:shortname/dashboard/items/:itemPk/prices/",customerTypes:"/:shortname/dashboard/items/:itemPk/prices/customer-types/",fieldGroups:"/:shortname/dashboard/items/:itemPk/prices/field-groups/",resources:"/:shortname/dashboard/items/:itemPk/prices/resources/"},embeds:"/:shortname/dashboard/items/:itemPk/embeds/",onlineBooking:"/:shortname/dashboard/items/:itemPk/online-booking/",
suggestedItems:"/:shortname/dashboard/items/:itemPk/suggested-items/",seating:"/:shortname/dashboard/items/:itemPk/seating/",info:{index:"/:shortname/dashboard/items/:itemPk/info/",notes:"/:shortname/dashboard/items/:itemPk/info/notes/",basic:"/:shortname/dashboard/items/:itemPk/info/basic/",photos:"/:shortname/dashboard/items/:itemPk/info/photos/",advanced:"/:shortname/dashboard/items/:itemPk/info/advanced/",tags:"/:shortname/dashboard/items/:itemPk/info/tags/"},listing:{index:"/:shortname/dashboard/items/:itemPk/listing/",
basic:"/:shortname/dashboard/items/:itemPk/listing/basic/",photos:"/:shortname/dashboard/items/:itemPk/listing/photos/",facts:"/:shortname/dashboard/items/:itemPk/listing/facts/"},notifications:{index:"/:shortname/dashboard/items/:itemPk/notifications/",internal:"/:shortname/dashboard/items/:itemPk/notifications/internal/",external:"/:shortname/dashboard/items/:itemPk/notifications/external/"},integrations:{index:"/:shortname/dashboard/items/:itemPk/integrations/",subscribe:"/:shortname/dashboard/items/:itemPk/integrations/subscribe/",
reviewExpress:"/:shortname/dashboard/items/:itemPk/integrations/review-express/",picthrive:"/:shortname/dashboard/items/:itemPk/integrations/picthrive/"}}},resources:{index:"/:shortname/dashboard/resources/",resource:{index:"/:shortname/dashboard/resources/:resourcePk/",settings:"/:shortname/dashboard/resources/:resourcePk/settings/",uses:{index:"/:shortname/dashboard/resources/:resourcePk/uses/",overview:"/:shortname/dashboard/resources/:resourcePk/uses/overview/",day:"/:shortname/dashboard/resources/:resourcePk/uses/date/:date/"}}},
settings:{index:"/:shortname/dashboard/settings/",advanced:"/:shortname/dashboard/settings/advanced/",payments:{index:"/:shortname/dashboard/settings/payments/",cards:{index:"/:shortname/dashboard/settings/payments/cards/",card:{index:"/:shortname/dashboard/settings/payments/cards/:cardPk/",settings:"/:shortname/dashboard/settings/payments/cards/:cardPk/settings/"}},inStorePaymentTypes:"/:shortname/dashboard/settings/payments/payment-types/",taxTypes:{index:"/:shortname/dashboard/settings/payments/tax-types/",
taxType:"/:shortname/dashboard/settings/payments/tax-types/:taxTypePk"},emvDevices:"/:shortname/dashboard/settings/payments/emv-devices/",bankAccounts:"/:shortname/dashboard/settings/payments/bank-accounts/",refundReserve:"/:shortname/dashboard/settings/payments/refund-reserve/",ledgers:{index:"/:shortname/dashboard/settings/payments/ledgers/",ledger:"/:shortname/dashboard/settings/payments/ledgers/:ledgerPk"}},profile:{index:"/:shortname/dashboard/settings/profile/",style:"/:shortname/dashboard/settings/profile/style/",
slideshow:"/:shortname/dashboard/settings/profile/slideshow/",pages:"/:shortname/dashboard/settings/profile/pages/"},info:{index:"/:shortname/dashboard/settings/info/",notesAndPolicies:{index:"/:shortname/dashboard/settings/info/notes/",health:"/:shortname/dashboard/settings/info/notes/health/",hours:"/:shortname/dashboard/settings/info/notes/hours/"},contact:"/:shortname/dashboard/settings/info/contact/",socialMedia:"/:shortname/dashboard/settings/info/social-media/",advanced:"/:shortname/dashboard/settings/info/advanced/",
tags:"/:shortname/dashboard/settings/info/tags/",facts:"/:shortname/dashboard/settings/info/facts/"},cancellationPolicies:"/:shortname/dashboard/settings/cancellation-policies/",cancellationPolicy:{index:"/:shortname/dashboard/settings/cancellation-policies/:cancellationPolicyPk/",settings:"/:shortname/dashboard/settings/cancellation-policies/:cancellationPolicyPk/settings/"},tagGroups:{index:"/:shortname/dashboard/settings/tag-groups/",tagGroup:{index:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/",
settings:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/settings/",tag:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/tags/:tagPk/"}},seating:{index:"/:shortname/dashboard/settings/seat-maps/",seatMap:{index:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/",layout:{index:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/",seatGroup:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/seat-groups/:seatGroupPk/",duplicate:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/seats/:seatPks(pks)/duplicate/",
seats:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/seats/:seatPks(pks)/","new":"/:shortname/dashboard/settings/seat-maps/:seatMapPk/layout/new/:seatGroupPk/:xCoord/:yCoord/"},seatZones:{index:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/seat-zones/",seatZone:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/seat-zones/:seatZonePk/"},settings:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/settings/",activity:"/:shortname/dashboard/settings/seat-maps/:seatMapPk/activity/"}},
permissions:{index:"/:shortname/dashboard/settings/permissions/",groups:"/:shortname/dashboard/settings/permissions/groups/",group:"/:shortname/dashboard/settings/permissions/groups/:groupPk/",groupOverrides:"/:shortname/dashboard/settings/permissions/outside-users/",groupOverride:"/:shortname/dashboard/settings/permissions/outside-users/:groupOverridePk/",users:"/:shortname/dashboard/settings/permissions/users/",user:{index:"/:shortname/dashboard/settings/permissions/users/:username/",settings:"/:shortname/dashboard/settings/permissions/users/:username/settings/",
apiKeys:{index:"/:shortname/dashboard/settings/permissions/users/:username/api-keys/",apiKey:"/:shortname/dashboard/settings/permissions/users/:username/api-keys/:resellerKeyPk/"}}},agents:{index:"/:shortname/dashboard/settings/agents/",agent:"/:shortname/dashboard/settings/agents/:agentPk/"},desks:{index:"/:shortname/dashboard/settings/desks/",desk:"/:shortname/dashboard/settings/desks/:deskPk/"},campaigns:{index:"/:shortname/dashboard/settings/campaigns/",campaign:{index:"/:shortname/dashboard/settings/campaigns/:campaignPk/",
settings:"/:shortname/dashboard/settings/campaigns/:campaignPk/settings/",code:"/:shortname/dashboard/settings/campaigns/:campaignPk/codes/:codePk/"}},checkinStatuses:"/:shortname/dashboard/settings/check-in/",customerTypes:{index:"/:shortname/dashboard/settings/customer-types/",customerType:"/:shortname/dashboard/settings/customer-types/:customerTypePk/"},requirementGroups:{index:"/:shortname/dashboard/settings/requirement-groups/",requirementGroup:"/:shortname/dashboard/settings/requirement-groups/:requirementGroupPk"},
customFields:{index:"/:shortname/dashboard/settings/custom-fields/",table:"/:shortname/dashboard/settings/custom-fields/table/",type:"/:shortname/dashboard/settings/custom-fields/type/:type/",customField:"/:shortname/dashboard/settings/custom-fields/:customFieldPk(pk)/"},customFieldInstanceGroups:{index:"/:shortname/dashboard/settings/custom-field-groups/",customFieldInstanceGroup:"/:shortname/dashboard/settings/custom-field-groups/:customFieldInstanceGroupPk(pk)/"},cannedMessages:{index:"/:shortname/dashboard/settings/canned-messages/",
cannedMessage:"/:shortname/dashboard/settings/canned-messages/:cannedMessagePk/"},availabilityHeadlines:{index:"/:shortname/dashboard/settings/headlines/",availabilityHeadline:"/:shortname/dashboard/settings/headlines/:availabilityHeadlinePk/"},network:{index:"/:shortname/dashboard/settings/network/",affiliates:{index:"/:shortname/dashboard/settings/network/affiliates/",affiliate:{index:"/:shortname/dashboard/settings/network/affiliates/:affiliationPk/",cards:"/:shortname/dashboard/settings/network/affiliates/:affiliationPk/cards/"}},
partners:{index:"/:shortname/dashboard/settings/network/partners/",partner:{index:"/:affiliateShortname/dashboard/settings/network/partners/:affiliationPk/",cards:"/:affiliateShortname/dashboard/settings/network/partners/:affiliationPk/cards/"}}},hotels:{index:"/:shortname/dashboard/settings/hotels/",hotel:"/:shortname/dashboard/settings/hotels/:hotelPk/"},lodgings:{index:"/:shortname/dashboard/settings/lodgings/",lodging:"/:shortname/dashboard/settings/lodgings/:lodgingPk/"},pickups:{index:"/:shortname/dashboard/settings/pickups/",
pickup:"/:shortname/dashboard/settings/pickups/:pickupPk/"},routes:{index:"/:shortname/dashboard/settings/routes/",route:"/:shortname/dashboard/settings/routes/:routePk/"},translations:{index:"/:shortname/dashboard/settings/languages/",language:{index:"/:shortname/dashboard/settings/languages/:languagePk/",settings:"/:shortname/dashboard/settings/languages/:languagePk/settings/",translations:{index:"/:shortname/dashboard/settings/languages/:languagePk/translations/",forModel:"/:shortname/dashboard/settings/languages/:languagePk/translations/:modelName/"}}},
pricing:{index:"/:shortname/dashboard/settings/pricing/",sheets:"/:shortname/dashboard/settings/pricing/sheets/",totalSheet:"/:shortname/dashboard/settings/pricing/total-sheets/:totalSheetPk/",invoiceSheet:"/:shortname/dashboard/settings/pricing/invoice-sheets/:invoiceSheetPk/",schedules:"/:shortname/dashboard/settings/pricing/schedules/",totalSchedules:{index:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/",settings:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/settings/",
entry:{index:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/",settings:"/:shortname/dashboard/settings/pricing/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/settings/"}},invoiceSchedules:{index:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/",settings:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/settings/",entry:{index:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/",
settings:"/:shortname/dashboard/settings/pricing/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/settings/"}},overview:"/:shortname/dashboard/settings/pricing/overview/"},activity:{index:"/:shortname/dashboard/settings/activity/",company:"/:shortname/dashboard/settings/activity/company/"},embeds:"/:shortname/dashboard/settings/embeds/",fhdn:"/:shortname/dashboard/settings/fhdn/",connect:"/:shortname/dashboard/settings/connect/",integrations:{index:"/:shortname/dashboard/settings/integrations/",
subscribe:"/:shortname/dashboard/settings/integrations/subscribe/"},reseller:{index:"/:shortname/dashboard/settings/integrations/channels/",requests:"/:shortname/dashboard/settings/integrations/channels/requests/",company:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/settings/"},item:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/",
settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/settings/"},customerType:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/customer-types/:resellerCustomerTypePk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/customer-types/:resellerCustomerTypePk/settings/"},option:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/options/:resellerOptionPk/",
settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/options/:resellerOptionPk/settings/"},apps:{index:"/:shortname/dashboard/settings/integrations/apps/",app:{index:"/:shortname/dashboard/settings/integrations/apps/:resellerAppPk/",settings:"/:shortname/dashboard/settings/integrations/apps/:resellerAppPk/settings/"}}},waivers:{index:"/:shortname/dashboard/settings/waivers/",waiver:{index:"/:shortname/dashboard/settings/waivers/:waiverPk/"}},locations:{index:"/:shortname/dashboard/settings/locations/",
settings:"/:shortname/dashboard/settings/locations/settings/",location:"/:shortname/dashboard/settings/locations/location/:locationPk/"},storedValue:{index:"/:shortname/dashboard/settings/gift-cards/",storedValueTypes:"/:shortname/dashboard/settings/gift-cards/types/",storedValueType:"/:shortname/dashboard/settings/gift-cards/types/:storedValueTypePk/",storedValueCards:"/:shortname/dashboard/settings/gift-cards/cards/",storedValueCard:{index:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/",
settings:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/settings/",storedValueAdjustment:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/adjustments/:storedValueAdjustmentPk/"}},analyticsServices:{index:"/:shortname/dashboard/settings/analytics/",analyticsService:"/:shortname/dashboard/settings/analytics/:analyticsServicePk/"},flows:{index:"/:shortname/dashboard/settings/flows/",flowNode:{index:"/:shortname/dashboard/settings/flows/:flowNodePk/"}},ticketLayouts:{index:"/:shortname/dashboard/settings/ticket-layouts/",
ticketLayout:{index:"/:shortname/dashboard/settings/ticket-layouts/:ticketLayoutPk/"}},suggestedItems:"/:shortname/dashboard/settings/suggested-items/",bookingRestrictions:{index:"/:shortname/dashboard/settings/booking-restrictions/",bookingRestriction:"/:shortname/dashboard/settings/booking-restrictions/:bookingRestrictionPk/"}}},root:{index:"/",login:"/login/",forgot:{index:"/forgot/",password:"/forgot/password/",resetPassword:"/forgot/password/reset/",credentials:"/forgot/credentials/"},version:"/version/",
help:"/help/",demo:"/demo/",about:"/about/",tour:"/tour/"},email:{bookingNotification:"/email/:type/:shortname/bookings/:bookingUuid/",orderNotification:"/email/:type/:shortname/orders/:orderUuid/",invoicePaymentRequest:"/email/:type/:shortname/invoice/:invoicePk/"},embeds:{calendar:{index:"/embeds/calendar/:shortname/",all:"/embeds/calendar/:shortname/all/",items:"/embeds/calendar/:shortname/items/:itemPks(pks)/"},cart:{index:"/embeds/cart/"},checkin:{index:"/embeds/checkin/",company:{index:"/embeds/checkin/:shortname/",
booking:{index:"/embeds/checkin/:shortname/bookings/:bookingUuid/",customer:"/embeds/checkin/:shortname/bookings/:bookingUuid/customers/:customerPk/"}},qr:"/:encodedCustomerPk"},book:{index:"/embeds/book/:shortname/",storedValueCard:{index:"/embeds/book/:shortname/gift-cards/:storedValueCardNumber/"},items:{index:"/embeds/book/:shortname/items/",calendar:"/embeds/book/:shortname/items/calendar/",date:{index:"/embeds/book/:shortname/items/date/",date:"/embeds/book/:shortname/items/date/:date/"}},item:{index:"/embeds/book/:shortname/items/:itemPk(pk)/",
calendar:"/embeds/book/:shortname/items/:itemPk(pk)/calendar/",month:"/embeds/book/:shortname/items/:itemPk(pk)/calendar/:year/:month/",date:"/embeds/book/:shortname/items/:itemPk(pk)/date/:date/",availability:"/embeds/book/:shortname/items/:itemPk(pk)/availability/:availabilityPk/",book:"/embeds/book/:shortname/items/:itemPk(pk)/availability/:availabilityPk/book/",booking:"/embeds/book/:shortname/items/:itemPk(pk)/booking/:bookingUuid/"},cart:{index:"/embeds/book/:shortname/cart/",flowNode:"/embeds/book/:shortname/cart/?flow=:flowNodePk",
permalink:"/embeds/book/:shortname/cart/?u=:cartUuid"},order:{index:"/embeds/book/:shortname/orders/:orderUuid/"},flowNode:{index:"/embeds/book/:shortname/items/?flow=:flowNodePk",calendar:"/embeds/book/:shortname/items/calendar/?flow=:flowNodePk",date:{index:"/embeds/book/:shortname/items/date/?flow=:flowNodePk",date:"/embeds/book/:shortname/items/date/:date/?flow=:flowNodePk"}},wait:{index:"/embeds/book/:shortname/pending/",order:"/embeds/book/:shortname/pending/orders/:orderUuid/",booking:"/embeds/book/:shortname/pending/bookings/:bookingUuid/"}},
partners:{index:"/embeds/partners/",company:"/embeds/partners/:shortname/"},items:{index:"/embeds/items/:shortname/"},analytics:{booking:"/embeds/a/:shortname/booking/:bookingUuid/"}},pusher:{auth:"/realtime/auth/",channels:"/realtime/:shortname/channels/",members:"/realtime/:shortname/members/"},api:{login:"/api/v1/login/",logout:"/api/v1/logout/",forgotPassword:"/api/v1/forgot/password/",resetPassword:"/api/v1/forgot/password/reset/:shortname/",forgotCredentials:"/api/v1/forgot/credentials/",companies:"/api/v1/companies/",
company:"/api/v1/companies/:shortname/",providerLogin:"/api/v1/companies/:shortname/login/provider/",companyNags:"/api/v1/companies/:shortname/nags/",companyFeatures:"/api/v1/companies/:shortname/features/",refundReserve:"/api/v1/companies/:shortname/refund-reserve/",companyItemColorsFeature:"/api/v1/companies/:shortname/item-colors-feature/",companyProfile:"/api/v1/companies/:shortname/profile/",companyContactInformation:"/api/v1/companies/:shortname/contact-information/",processorAccount:"/api/v1/companies/:shortname/processor-account/",
processorOnboard:"/api/v1/companies/:shortname/tax-information/onboard/",processorCompleteAccountSetup:"/api/v1/companies/:shortname/processor-account/complete-setup/",companyTosAcceptance:"/api/v1/companies/:shortname/tos/",companyAccounts:"/api/v1/companies/:shortname/accounts/",companyStyles:"/api/v1/companies/:shortname/styles/",companyAdminNotes:"/api/v1/companies/:shortname/admin-notes/",companyPayments:"/api/v1/companies/:shortname/payments/",companyManifestSettings:"/api/v1/companies/:shortname/manifest-settings/",
companyCalendar:"/api/v1/companies/:shortname/calendar/:year/:month/",companyImages:"/api/v1/companies/:shortname/images/",companyImage:"/api/v1/companies/:shortname/images/:imagePk/",tagGroups:"/api/v1/companies/:shortname/tag-groups/",tagGroup:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/",tags:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/tags/",tag:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/tags/:tagPk/",objectTags:"/api/v1/companies/:shortname/tags/:objectCls/:objectPk/",
taxTypes:"/api/v1/companies/:shortname/tax-types/",taxType:"/api/v1/companies/:shortname/tax-types/:taxTypePk/",inStorePaymentTypes:"/api/v1/companies/:shortname/in-store-payment-types/",allInStorePaymentTypes:"/api/v1/companies/:shortname/in-store-payment-types/all/",ledgers:"/api/v1/companies/:shortname/ledgers/",allLedgers:"/api/v1/companies/:shortname/ledgers/all/",ledger:"/api/v1/companies/:shortname/ledgers/:ledgerPk/",inStorePaymentType:"/api/v1/companies/:shortname/in-store-payment-types/:inStorePaymentTypePk/",
emvLocation:"/api/v1/companies/:shortname/emv-location/",emvDevices:"/api/v1/companies/:shortname/emv-devices/",emvDevice:"/api/v1/companies/:shortname/emv-devices/:emvDevicePk/",retrieveConnectionToken:"/api/v1/companies/:shortname/emv-devices/connection-token/",createInteractionToken:"/api/v1/companies/:shortname/emv-devices/emv-interaction-token/",checkEmvDeviceConnections:"/api/v1/companies/:shortname/emv-devices/check-connection/",checkEmvDeviceConnection:"/api/v1/companies/:shortname/emv-devices/check-connection/:emvDevicePk/",
checkEmvPaymentStatus:"/api/v1/companies/:shortname/emv-devices/payment-status/",cancelEmvCharge:"/api/v1/companies/:shortname/emv-devices/cancel-charge/",bankAccounts:"/api/v1/companies/:shortname/bank-accounts/",bankAccount:"/api/v1/companies/:shortname/bank-accounts/:bankAccountPk/",cards:"/api/v1/companies/:shortname/cards/",card:"/api/v1/companies/:shortname/cards/:cardPk/",cardAffiliations:"/api/v1/companies/:shortname/cards/:cardPk/card-affiliations/",verifyBankAccount:"/api/v1/companies/:shortname/bank-accounts/:bankAccountPk/verify/",
hotels:"/api/v1/companies/:shortname/hotels/",hotel:"/api/v1/companies/:shortname/hotels/:hotelPk/",lodgings:"/api/v1/companies/:shortname/lodgings/",duplicateLodgingsAcrossCompanies:"/api/v1/companies/:shortname/lodgings/duplicate/",lodging:"/api/v1/companies/:shortname/lodgings/:lodgingPk/",preferredPickups:"/api/v1/companies/:shortname/lodgings/:lodgingPk/preferred-pickups/",preferredPickup:"/api/v1/companies/:shortname/lodgings/:lodgingPk/preferred-pickups/:preferredPickupPk/",pickups:"/api/v1/companies/:shortname/pickups/",
duplicatePickupsAcrossCompanies:"/api/v1/companies/:shortname/pickups/duplicate/",pickup:"/api/v1/companies/:shortname/pickups/:pickupPk/",routes:"/api/v1/companies/:shortname/routes/",duplicateRoutesAcrossCompanies:"/api/v1/companies/:shortname/routes/duplicate/",route:"/api/v1/companies/:shortname/routes/:routePk/",routeItems:"/api/v1/companies/:shortname/routes/:routePk/items/",duplicateRoute:"/api/v1/companies/:shortname/routes/:routePk/duplicate/",stops:"/api/v1/companies/:shortname/routes/:routePk/stops/",
stop:"/api/v1/companies/:shortname/routes/:routePk/stops/:stopPk/",customManifests:"/api/v1/companies/:shortname/custom-manifests/",customManifest:"/api/v1/companies/:shortname/custom-manifests/:customManifestPk/",customCalendars:"/api/v1/companies/:shortname/custom-calendars/",customCalendar:"/api/v1/companies/:shortname/custom-calendars/:customCalendarPk/",customReports:"/api/v1/companies/:shortname/custom-reports/",customReport:"/api/v1/companies/:shortname/custom-reports/:customReportPk/",users:"/api/v1/companies/:shortname/users/",
allUsers:"/api/v1/companies/:shortname/users/all/",relatedUsers:"/api/v1/companies/:shortname/users/related/",user:"/api/v1/companies/:shortname/users/:username/",userNags:"/api/v1/companies/:shortname/users/:username/nags/",userActivities:"/api/v1/companies/:shortname/users/:username/activities/",userSubscriptions:"/api/v1/companies/:shortname/users/:username/subscriptions/",userItemSubscriptions:"/api/v1/companies/:shortname/users/:username/subscriptions/items/:itemPk/",userOverview:"/api/v1/companies/:shortname/users/:username/overview/",
reorder:"/api/v1/companies/:shortname/reorder/:objectCls/:objectPk/",activities:"/api/v1/companies/:shortname/activities/:activityObjectCls/:activityObjectPks/",activity:"/api/v1/companies/:shortname/activities/:activityPk(pk)/",allActivities:"/api/v1/companies/:shortname/activities/all/",systemActivities:"/api/v1/companies/:shortname/activities/system/",notes:"/api/v1/companies/:shortname/activities/:activityObjectCls/:activityObjectPk/notes/",items:"/api/v1/companies/:shortname/items/",allItems:"/api/v1/companies/:shortname/items/all/",
item:"/api/v1/companies/:shortname/items/:itemPk/",itemColor:"/api/v1/companies/:shortname/items/:itemPk/color/",itemPricingOverview:"/api/v1/companies/:shortname/items/:itemPk/pricing-overview/",duplicateItem:"/api/v1/companies/:shortname/items/:itemPk/duplicate/",itemCalendar:"/api/v1/companies/:shortname/items/:itemPk/calendar/:year/:month/",itemSubscriptions:"/api/v1/companies/:shortname/items/:itemPk/subscriptions/",itemImages:"/api/v1/companies/:shortname/items/:itemPk/images/",itemImage:"/api/v1/companies/:shortname/items/:itemPk/images/:imagePk/",
itemRatings:"/api/v1/companies/:shortname/items/:itemPk/ratings/",itemFlowPages:"/api/v1/companies/:shortname/items/:itemPk/flow-nodes/",itemHasFutureAvailsUsingCompanyLevelCfig:"/api/v1/companies/:shortname/items/:itemPk/has-future-avails-using-company-cfig/",itemsCalendar:"/api/v1/companies/:shortname/items/:itemPks(pks)/calendar/:year/:month/",flowNodes:"/api/v1/companies/:shortname/flow-nodes/",flowNode:"/api/v1/companies/:shortname/flow-nodes/:flowNodePk/",defaultFlowPage:"/api/v1/companies/:shortname/flow-nodes/default/",
duplicateFlowNode:"/api/v1/companies/:shortname/flow-nodes/:flowNodePk/duplicate/",cannedMessages:"/api/v1/companies/:shortname/canned-messages/",cannedMessage:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/",cannedMessageItems:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/items/",cannedMessageAvailabilityHeadlines:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/availability-headlines/",availabilityHeadlines:"/api/v1/companies/:shortname/availability-headlines/",
availabilityHeadline:"/api/v1/companies/:shortname/availability-headlines/:availabilityHeadlinePk/",availabilityHeadlineItems:"/api/v1/companies/:shortname/availability-headlines/:availabilityHeadlinePk/items/",allCustomerTypes:"/api/v1/companies/:shortname/customer-types/all/",customerTypes:"/api/v1/companies/:shortname/customer-types/",customerType:"/api/v1/companies/:shortname/customer-types/:customerTypePk/",customerTypeItems:"/api/v1/companies/:shortname/customer-types/:customerTypePk/items/",
customerPrototypes:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/",customerPrototype:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/:customerPrototypePk/",duplicateCustomerPrototype:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/:customerPrototypePk/duplicate/",allCustomerPrototypes:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/all/",customerPrototypesMulti:"/api/v1/companies/:shortname/items/customer-prototypes/multi/",checkinStatuses:"/api/v1/companies/:shortname/checkin-statuses/",
checkinStatus:"/api/v1/companies/:shortname/checkin-statuses/:checkinStatusPk/",checkinStatusForBookings:"/api/v1/companies/:shortname/checkin-statuses/bookings/",roles:"/api/v1/companies/:shortname/roles/",role:"/api/v1/companies/:shortname/roles/:rolePk/",crewMembers:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/crew-members/",crewMember:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/crew-members/:crewMemberPk/",customFields:"/api/v1/companies/:shortname/custom-fields/",
allCustomFields:"/api/v1/companies/:shortname/custom-fields/all/",customField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/",customFieldItems:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/items/",customFieldCompanyCustomFieldGroups:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/company-custom-field-groups/",duplicateCustomField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/duplicate/",prevalidateCustomField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/prevalidate/total-sheets/:totalSheetPk/availabilities/:availabilityPk/",
transportationOptions:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/transportation-options/",transportationOption:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/transportation-options/:transportationOptionPk/",extendedOptions:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/extended-options/",extendedOption:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/extended-options/:extendedOptionPk/",connectedCampaigns:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-campaigns/",
connectedCampaign:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-campaigns/:connectedCampaignPk/",generatingCampaigns:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/generating-campaigns/",generatingCampaign:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/generating-campaigns/:generatingCampaignPk/",campaigns:"/api/v1/companies/:shortname/campaigns/",campaign:"/api/v1/companies/:shortname/campaigns/:campaignPk/",campaignValidityRules:"/api/v1/companies/:shortname/campaigns/:campaignPk/campaign-validity-rules/",
campaignValidityRule:"/api/v1/companies/:shortname/campaigns/:campaignPk/campaign-validity-rules/:campaignValidityRulePk/",campaignCustomFields:"/api/v1/companies/:shortname/campaigns/:campaignPk/custom-fields/",storedValueTypes:"/api/v1/companies/:shortname/stored-value-types/",storedValueType:"/api/v1/companies/:shortname/stored-value-types/:storedValueTypePk/",storedValueCards:"/api/v1/companies/:shortname/stored-value-cards/",issueStoredValueCard:"/api/v1/companies/:shortname/stored-value-cards/issue/",
storedValueCard:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/",storedValueCardPayments:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/payments/",storedValueCardNotifications:"/api/v1/companies/:shortname/stored-value-cards/notifications/?q=:storedValueCardNumber",searchStoredValueCardsByNumber:"/api/v1/companies/:shortname/stored-value-cards/search/",storedValueAdjustments:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/adjustments/",
storedValueAdjustment:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/adjustments/:storedValueAdjustmentPk/",codes:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/",code:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/:codePk/",codesByTag:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/:tag/",allAffiliates:"/api/v1/companies/:shortname/affiliates/all/",affiliates:"/api/v1/companies/:shortname/affiliates/",affiliate:"/api/v1/companies/:shortname/affiliates/:affiliationPk/",
affiliateCards:"api/v1/companies/:shortname/affiliates/:affiliationPk/cards/",affiliateCardAffiliations:"/api/v1/companies/:shortname/affiliates/:affiliationPk/card-affiliations/",partners:"/api/v1/companies/:shortname/partners/",partner:"/api/v1/companies/:affiliateShortname/partners/:affiliationPk/",partnerCards:"/api/v1/companies/:shortname/partners/:affiliationPk/cards/",partnerCardAffiliations:"/api/v1/companies/:shortname/partners/:affiliationPk/card-affiliations/",allAgents:"/api/v1/companies/:shortname/agents/all/",
agents:"/api/v1/companies/:shortname/agents/",agent:"/api/v1/companies/:shortname/agents/:agentPk/",allDesks:"/api/v1/companies/:shortname/desks/all/",desks:"/api/v1/companies/:shortname/desks/",desk:"/api/v1/companies/:shortname/desks/:deskPk/",customFieldInstances:"/api/v1/companies/:shortname/custom-field-instances/",customFieldInstancesMulti:"/api/v1/companies/:shortname/items/custom-field-instances/multi/",customFieldInstance:"/api/v1/companies/:shortname/custom-field-instances/:customFieldInstancePk/",
customFieldInstanceConditions:"/api/v1/companies/:shortname/custom-field-instances/:customFieldInstancePk/conditions/",customFieldInstanceCondition:"/api/v1/companies/:shortname/custom-field-instances/:customFieldInstancePk/conditions/:customFieldInstanceConditionPk/",customFieldInstanceGroup:"/api/v1/companies/:shortname/custom-field-instance-groups/:customFieldInstanceGroupPk/",customFieldInstanceGroupsMulti:"/api/v1/companies/:shortname/items/custom-field-instance-groups/multi/",duplicateCustomFieldInstanceGroup:"/api/v1/companies/:shortname/custom-field-instance-groups/:customFieldInstanceGroupPk/duplicate/",
itemCustomFieldInstanceGroups:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instance-groups/",companyCustomFieldInstanceGroups:"/api/v1/companies/:shortname/custom-field-instance-groups/",customFieldInstanceGroupItems:"/api/v1/companies/:shortname/custom-field-instance-groups/:customFieldInstanceGroupPk/items/",customFieldInstancesForPushedCustomFieldValues:"/api/v1/companies/:shortname/items/:itemPk/source-booking/:sourceBookingPk/pushed-custom-field-instances/",supportedLanguages:"/api/v1/companies/:shortname/supported-languages/",
supportedLanguage:"/api/v1/companies/:shortname/supported-languages/:languagePk/",translationsForModel:"/api/v1/companies/:shortname/supported-languages/:languagePk/translations/:modelName/",translationsForField:"/api/v1/companies/:shortname/translations/:objectType/:objectId/:objectField/",understoodLanguages:"/api/v1/companies/:shortname/understood-languages/",translationsForSubfield:"/api/v1/companies/:shortname/translations/:objectType/:objectId/:objectField/:subfield/",nextAvailability:"/api/v1/companies/:shortname/items/:itemPk/availabilities/next/",
futureAvailabilityCount:"/api/v1/companies/:shortname/:objectType/:objectPk/availabilities/future/count/",availabilitiesByDate:"/api/v1/companies/:shortname/items/:itemPk/availabilities/date/:date/",availabilitiesByResource:"/api/v1/companies/:shortname/items/:itemPk/availabilities/date/:date/resource/:resourcePk/",availabilitiesByTag:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:tag/",availability:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/",availabilityStatus:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/status/",
availabilityLiveCapacity:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/live/",availabilityResourceUses:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/resource-uses/",updateItemAvailabilities:"/api/v1/companies/:shortname/items/:itemPk/availabilities/update/",updateAvailabilities:"/api/v1/companies/:shortname/availabilities/update/",availabilityNote:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/note/",availabilityCheckinStatuses:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/checkin-statuses/",
availabilityNotificationOptions:"/api/v1/companies/:shortname/availabilities/:availabilityPk/notification-options/",sendConfirmations:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/send-confirmations/",notifications:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/notifications/",smsNotifications:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/sms-notifications/",subjectsBooking:"/api/v1/companies/:shortname/subjects/:type/bookings/:bookingUuid/:language/",
subjectsOrder:"/api/v1/companies/:shortname/subjects/:type/orders/:orderUuid/:language/",subjectsAvailability:"/api/v1/companies/:shortname/subjects/:type/availabilities/:availabilityPk/:languages/",customerTypeRates:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/customer-type-rates/",customerTypeRate:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/customer-type-rates/:customerTypeRatePk/",blocks:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/blocks/",
block:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/blocks/:blockPk/",rule:"/api/v1/companies/:shortname/items/:itemPk/availabilities/rule/",orders:"/api/v1/companies/:shortname/orders/",order:"/api/v1/companies/:shortname/orders/:orderUuid/",orderPayments:"/api/v1/companies/:shortname/orders/:orderUuid/payments/",orderNotification:"/api/v1/companies/:shortname/orders/:orderUuid/notification/",orderCancellation:"/api/v1/companies/:shortname/orders/:orderUuid/cancel/",
book:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/book/",bookings:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/bookings/",booking:"/api/v1/companies/:shortname/bookings/:bookingUuid/",bookingByPk:"/api/v1/companies/:shortname/bookings/:bookingPk/",repriceBooking:"/api/v1/companies/:shortname/bookings/:bookingUuid/reprice/",bookingCheckinStatus:"/api/v1/companies/:shortname/bookings/:bookingUuid/checkin-status/",customerCheckinStatus:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers/:customerPk/checkin-status/",
bookingCustomersWithSeatAssignments:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers-with-seat-assignments/",orderCustomersWithSeatAssignments:"/api/v1/companies/:shortname/orders/:orderUuid/customers-with-seat-assignments/",bookingNote:"/api/v1/companies/:shortname/bookings/:bookingUuid/note/",bookingExplicitGross:"/api/v1/companies/:shortname/bookings/:bookingUuid/explicit-gross/",bookingExplicitInvoicePrice:"/api/v1/companies/:shortname/bookings/:bookingUuid/explicit-invoice-price/",
bookingNotificationOptions:"/api/v1/companies/:shortname/bookings/:bookingUuid/notification-options/",bookingEffectiveCancellationRule:"/api/v1/companies/:shortname/bookings/:bookingUuid/effective-cancellation-rule/",searchCustomersByEncodedPk:"/embeds/redirect/checkin/:encodedPk/",contact:"/api/v1/companies/:shortname/contacts/:contactPk/",contactBookings:"/api/v1/companies/:shortname/contacts/:contactPk/bookings/",contactPayments:"/api/v1/companies/:shortname/contacts/:contactPk/payments/",affiliation:"/api/v1/companies/:shortname/bookings/:bookingUuid/affiliation/",
notification:"/api/v1/companies/:shortname/bookings/:bookingUuid/notification/",smsNotification:"/api/v1/companies/:shortname/bookings/:bookingUuid/sms-notifications/",lineItems:"/api/v1/companies/:shortname/bookings/:bookingUuid/line-items/",lineItem:"/api/v1/companies/:shortname/bookings/:bookingUuid/line-items/:lineItemPk/",customerCustomFieldValue:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers/custom-field-values/:customerCustomFieldValuePk/",bookingCustomFieldValue:"/api/v1/companies/:shortname/bookings/:bookingUuid/custom-field-values/:bookingCustomFieldValuePk/",
pushCustomFieldValues:"/api/v1/companies/:shortname/bookings/:bookingUuid/push-custom-field-values/",payments:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/",installmentPayment:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/installment-payment/",orderInstallmentPayment:"/api/v1/companies/:shortname/orders/:orderUuid/payments/order-installment-payment/",relatedPayments:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/related/",authorizationHolds:"/api/v1/companies/:shortname/bookings/:bookingUuid/authorization-holds/",
refunds:"/api/v1/companies/:shortname/bookings/:bookingUuid/refunds/",orderRefunds:"/api/v1/companies/:shortname/orders/:orderUuid/refunds/",customRefunds:"/api/v1/companies/:shortname/bookings/:bookingUuid/refunds/custom/",availabilitiesManifest:"/api/v1/companies/:shortname/manifest/availabilities/date/:date/",bookingsManifest:"/api/v1/companies/:shortname/manifest/bookings/date/:date/",runsManifest:"/api/v1/companies/:shortname/manifest/runs/date/:date/",resourcesManifest:"/api/v1/companies/:shortname/manifest/resources/date/:date/",
manifestSelectableAvailabilities:"/api/v1/companies/:shortname/manifest/selectable-availabilities/date/:date/",searchAllAvailabilitiesByDate:"/api/v1/companies/:shortname/search/availabilities/date/:date/",searchAvailabilitiesByDate:"/api/v1/companies/:shortname/search/items/:itemPks(pks)/availabilities/date/:date/",searchAvailabilitiesByUpcoming:"/api/v1/companies/:shortname/search/availabilities/upcoming/:filter",searchAvailabilitiesByPk:"/api/v1/companies/:shortname/search/availabilities/:availabilityPks/",
searchBookingsByQuery:"/api/v1/companies/:shortname/search/bookings/query/:filter",searchBookingsByNew:"/api/v1/companies/:shortname/search/bookings/new/:filter",searchBookingsByUuid:"/api/v1/companies/:shortname/search/bookings/:bookingUuids/",searchRunsByDate:"/api/v1/companies/:shortname/search/runs/date/:date/",bookingsByContact:"/api/v1/companies/:shortname/search/bookings/contact/:contactPk/",invoices:"/api/v1/companies/:shortname/invoices/",invoice:"/api/v1/companies/:shortname/invoices/:invoicePk/",
uuidInvoice:"/api/v1/companies/:shortname/invoices/uuid/:invoiceUuid/",invoiceNotifications:"/api/v1/companies/:shortname/invoices/:invoicePk/notifications/",invoiceUploads:"/api/v1/companies/:shortname/invoices/:invoicePk/uploads/",partnerInvoice:"/api/v1/companies/:shortname/invoices/partner-invoices/:invoicePk/",groups:"/api/v1/companies/:shortname/groups/",group:"/api/v1/companies/:shortname/groups/:groupPk/",duplicateGroup:"/api/v1/companies/:shortname/groups/:groupPk/duplicate/",groupOverrides:"/api/v1/companies/:shortname/group-overrides/",
groupOverride:"/api/v1/companies/:shortname/group-overrides/:groupOverridePk/",groupOverrideActivities:"/api/v1/companies/:shortname/group-overrides/:groupOverridePk/activities/",relatedGroupOverrides:"/api/v1/companies/:shortname/group-overrides/related/",reports:"/api/v1/companies/:shortname/reports/",recentReports:"/api/v1/companies/:shortname/reports/recent/",inProgressReports:"/api/v1/companies/:shortname/reports/in-progress/",volumeOverviewReport:"/api/v1/companies/:shortname/reports/volume-overview/",
dailyVolumeOverviewReport:"/api/v1/companies/:shortname/reports/daily-volume-overview/",paymentOverviewReport:"/api/v1/companies/:shortname/reports/payment-overview/",itemsSummaryOverviewReport:"/api/v1/companies/:shortname/reports/items-summary-overview/",nextPayoutOverviewReport:"/api/v1/companies/:shortname/reports/next-payout-overview/",report:"/api/v1/companies/:shortname/reports/:reportPk(pk)/",reportObjects:"/api/v1/companies/:shortname/reports/:reportPk(pk)/objects/",reportReports:"/api/v1/companies/:shortname/reports/reports/",
reportContacts:"/api/v1/companies/:shortname/reports/contacts/",reportBookings:"/api/v1/companies/:shortname/reports/bookings/",reportInvoiceableBookings:"/api/v1/companies/:shortname/reports/invoiceable-bookings/",reportTest:"/api/v1/companies/:shortname/reports/test/",reportLineItems:"/api/v1/companies/:shortname/reports/line-items/",reportPayments:"/api/v1/companies/:shortname/reports/payments/",reportDisputes:"/api/v1/companies/:shortname/reports/disputes/",reportPayouts:"/api/v1/companies/:shortname/reports/payouts/",
reportInvoices:"/api/v1/companies/:shortname/reports/invoices/",reportAccounts:"/api/v1/companies/:shortname/reports/accounts/",reportTransactions:"/api/v1/companies/:shortname/reports/transactions/",reportEscrow:"/api/v1/companies/:shortname/reports/escrow/",reportVolume:"/api/v1/companies/:shortname/reports/volume/",reportCompanies:"/api/v1/companies/:shortname/reports/companies/",reportItemsSummary:"/api/v1/companies/:shortname/reports/summary/items/",reportUsersSummary:"/api/v1/companies/:shortname/reports/summary/users/",
reportBookingTypesSummary:"/api/v1/companies/:shortname/reports/summary/booking-types/",reportCustomerTypesSummary:"/api/v1/companies/:shortname/reports/summary/customer-types/",reportCustomFieldSummary:"/api/v1/companies/:shortname/reports/summary/custom-field/",reportLodgingsSummary:"/api/v1/companies/:shortname/reports/summary/lodgings/",reportPickupsSummary:"/api/v1/companies/:shortname/reports/summary/pickups/",reportCrewSummary:"/api/v1/companies/:shortname/reports/summary/crew/",reportAgentsSummary:"/api/v1/companies/:shortname/reports/summary/agents/",
reportDesksSummary:"/api/v1/companies/:shortname/reports/summary/desks/",reportCampaignsSummary:"/api/v1/companies/:shortname/reports/summary/campaigns/",reportRevenueSummary:"/api/v1/companies/:shortname/reports/summary/revenue/",reportAdvanced:"/api/v1/companies/:shortname/reports/advanced/",reviewExpressSettings:"/api/v1/companies/:shortname/items/:itemPk/review-express-settings/",picthriveSettings:"/api/v1/companies/:shortname/items/:itemPk/picthrive-settings/",payouts:"/api/v1/companies/:shortname/payouts/",
payout:"/api/v1/companies/:shortname/payouts/:payoutPk/",payoutRetry:"/api/v1/companies/:shortname/payouts/:payoutPk/retry/",transfers:"/api/v1/companies/:shortname/transfers/",transfer:"/api/v1/companies/:shortname/transfers/:transferPk/",oneTimeTransfer:"/api/v1/companies/:shortname/one-time-transfer/",upcomingRefundReserveAmounts:"/api/v1/companies/:shortname/upcoming-refund-reserve-amounts/",uploads:"/api/v1/companies/:shortname/uploads/",upload:"/api/v1/companies/:shortname/uploads/:uploadPk/",
adjustments:"/api/v1/companies/:shortname/adjustments/",adjustment:"/api/v1/companies/:shortname/adjustments/:adjustmentPk/",waivers:"/api/v1/companies/:shortname/waivers/",waiver:"/api/v1/companies/:shortname/waivers/:waiverPk/",waiverInstance:"/api/v1/companies/:shortname/waiver-instances/:waiverInstancePk/",connectedWaivers:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-waivers/",connectedWaiver:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-waivers/:connectedWaiverPk/",
locations:"/api/v1/companies/:shortname/locations/",location:"/api/v1/companies/:shortname/locations/:locationPk/",locationItems:"/api/v1/companies/:shortname/locations/:locationPk/items/",primaryLocation:"/api/v1/companies/:shortname/locations/primary/",totalSchedules:"/api/v1/companies/:shortname/total-schedules/",totalSchedule:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/",totalScheduleAffiliations:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/affiliations/",
duplicateTotalSchedule:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/duplicate/",totalScheduleEntries:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/",totalScheduleEntry:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/",totalScheduleEntryRules:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/rules/",totalScheduleEntryRule:"/api/v1/companies/:shortname/total-schedules/:totalSchedulePk/entries/:totalScheduleEntryPk/rules/:totalScheduleEntryRulePk/",
invoiceSchedules:"/api/v1/companies/:shortname/invoice-schedules/",invoiceSchedule:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/",invoiceScheduleAffiliations:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/affiliations/",duplicateInvoiceSchedule:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/duplicate/",invoiceScheduleEntries:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/",invoiceScheduleEntry:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/",
invoiceScheduleEntryRules:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/rules/",invoiceScheduleEntryRule:"/api/v1/companies/:shortname/invoice-schedules/:invoiceSchedulePk/entries/:invoiceScheduleEntryPk/rules/:invoiceScheduleEntryRulePk/",effectiveSheets:"/api/v1/companies/:shortname/availabilities/:availabilityPk/effective-sheets/",affiliationEffectiveSheets:"/api/v1/companies/:shortname/availabilities/:availabilityPk/affiliations/:affiliationPk/effective-sheets/",
rebookingEffectiveSheets:"/api/v1/companies/:shortname/availabilities/:availabilityPk/bookings/:bookingUuid/effective-sheets/",totalScheduleEffectiveSheet:"/api/v1/companies/:shortname/availabilities/:availabilityPk/total-schedules/:totalSchedulePk/effective-sheets/",invoiceScheduleEffectiveSheet:"/api/v1/companies/:shortname/availabilities/:availabilityPk/invoice-schedules/:invoiceSchedulePk/effective-sheets/",totalSheets:"/api/v1/companies/:shortname/total-sheets/",totalSheet:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/",
totalSheetSchedules:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/schedules/",totalSheetAffiliations:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/affiliations/",duplicateTotalSheet:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/duplicate/",totalPricing:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/pricing/:objectCls/:objectPk/",totalStack:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/pricing/:objectCls/:objectPk/stack/",invoiceSheets:"/api/v1/companies/:shortname/invoice-sheets/",
invoiceSheet:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/",invoiceSheetSchedules:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/schedules/",invoiceSheetAffiliations:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/affiliations/",duplicateInvoiceSheet:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/duplicate/",invoicePricing:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/pricing/:objectCls/:objectPk/",invoiceStack:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/pricing/:objectCls/:objectPk/stack/",
resources:"/api/v1/companies/:shortname/resources/",resource:"/api/v1/companies/:shortname/resources/:resourcePk/",resourceItems:"/api/v1/companies/:shortname/resources/:resourcePk/items/",resourceRequirementGroups:"/api/v1/companies/:shortname/resources/:resourcePk/requirement-groups/",resourceAvailabilities:"/api/v1/companies/:shortname/resources/:resourcePk/availabilities/date/:date/",resourceUsesByDate:"/api/v1/companies/:shortname/resources/:resourcePk/resource-uses/:date/",resourceUsesCalendar:"/api/v1/companies/:shortname/resources/:resourcePk/resource-uses/calendar/:year/:month/",
resourceUsesUnassignSeats:"/api/v1/companies/:shortname/resource-uses/unassign-seats/",reapplyResourceUses:"/api/v1/companies/:shortname/reapply-resource-uses/",requirementGroups:"/api/v1/companies/:shortname/requirement-groups/",itemRequirementGroups:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/",requirementGroup:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/",duplicateRequirementGroup:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/duplicate/",
requirementGroupItems:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/items/",requirements:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/",requirement:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/:requirementPk/",resourceRequirements:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/:requirementPk/resource-requirements/",resourceRequirement:"/api/v1/companies/:shortname/requirement-groups/:requirementGroupPk/requirements/:requirementPk/resource-requirements/:resourceRequirementPk/",
resourceUse:"/api/v1/companies/:shortname/bookings/:bookingUuid/resource-uses/:resourceUsePk/",resourceOverride:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:resourceOverridePk/",resourceOverrideRule:"/api/v1/companies/:shortname/resources/:resourcePk/resource-override-rule/",resourceOverridesByTag:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:tag/",resourceOverridesByDate:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:date/",
seatResourceOverrides:"/api/v1/companies/:shortname/seat-resource-overrides/",seatMaps:"/api/v1/companies/:shortname/seat-maps/",seatMap:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/",duplicateSeatMap:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/duplicate/",seatMapResourceUsesBySeat:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/resource-uses/:startAt/:endAt/",seatMapResourceOverridesBySeat:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/resource-overrides/:startAt/:endAt/",seatMapResources:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/resources/",
seatGroups:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-groups/",seatGroup:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-groups/:seatGroupPk/",seatZones:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-zones/",companySeatZones:"/api/v1/companies/:shortname/seat-zones/",seatZone:"/api/v1/companies/:shortname/seat-maps/:seatMapPk/seat-zones/:seatZonePk/",availabilitiesWithResourceRequirements:"/api/v1/companies/:shortname/availabilities/:availabilityPks(pks)/resource-requirements/",
seatRequirements:"/api/v1/companies/:shortname/availabilities/:availabilityPk/total-sheets/:totalSheetPk/seat-requirements/",customersWithSeats:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers-with-seats/",resellerCompanies:"/api/v1/companies/:shortname/reseller-companies/",resellerCompany:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/",resellerCompanyMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-company-mappings/",resellerCompanyMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-company-mappings/:resellerCompanyMappingPk/",
resellerItems:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/",resellerItem:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/",resellerItemMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-item-mappings/",resellerItemMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-item-mappings/:resellerItemMappingPk",
resellerCustomerTypes:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/",resellerCustomerType:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/",resellerCustomerTypeMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/reseller-customer-type-mappings/",
resellerCustomerTypeMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/reseller-customer-type-mappings/:resellerCustomerTypeMappingPk/",resellerOptions:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/",resellerOption:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/",
resellerOptionMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/reseller-option-mappings/",resellerOptionMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/reseller-option-mappings/:resellerOptionMappingPk/",resellerUnmappedItems:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/unmapped/items/",
resellerUnmappedCustomerPrototypes:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/unmapped/customer-prototypes/",resellerKeys:"/api/v1/companies/:shortname/users/:username/reseller-keys/",resellerKey:"/api/v1/companies/:shortname/reseller-keys/:resellerKeyPk/",resellerApps:"/api/v1/companies/:shortname/reseller-apps/",resellerApp:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/",resellerAppRequests:"/api/v1/companies/:shortname/reseller-app-requests/",
resellerAppRequest:"/api/v1/companies/:shortname/reseller-app-requests/:resellerAppRequestPk/",resellerAppCompanies:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/reseller-app-companies/",resellerAppCompany:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/reseller-app-companies/:resellerAppCompanyPk",ticketLayouts:"/api/v1/companies/:shortname/ticket-layouts/",ticketLayout:"/api/v1/companies/:shortname/ticket-layouts/:ticketLayoutPk/",analyticsServices:"/api/v1/companies/:shortname/a-services/",
analyticsService:"/api/v1/companies/:shortname/a-services/:analyticsServicePk/",cancellationPolicies:"/api/v1/companies/:shortname/cancellation-policies/",cancellationPolicy:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/",cancellationRules:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/cancellation-rules/",cancellationRule:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/cancellation-rules/:cancellationRulePk/",cancellationPolicyAffiliations:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/affiliations/",
cancellationPolicyItems:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/items/",bookingRestrictions:"/api/v1/companies/:shortname/booking-restrictions/",bookingRestriction:"/api/v1/companies/:shortname/booking-restrictions/:bookingRestrictionPk/",bookingRestrictionItems:"/api/v1/companies/:shortname/booking-restrictions/:bookingRestrictionPk/items/",paymentProcessingDocument:"/api/v1/companies/:shortname/payment-processing/document/:paymentProcessingDocumentPk/",persistentStore:"/api/v1/persistence/:identifier/",
persistentStoreForCompany:"/api/v1/persistence/:identifier/:shortname/",persistentStoreItem:"/api/v1/persistence/:identifier/:shortname/:key/",taskResult:"/api/v1/task-result/:taskId/",version:"/api/v1/version/",token:"/api/v1/queuing/items/:itemPk/refresh/",isItemQueued:"/api/v1/queuing/items/:itemPk/is-queued/",view:"/api/v1/view/:objectType/:objectIdentifier/"}};return e}]);m.run(["$rootScope","urls",function(c,g){c.urls=g}])})();angular.module("native",["native.services"]);
(function(){var m=angular.module("native.services",[]);m.factory("native",["$rootScope","$window","auth","db","events","navigation","urls","models",function(c,g,k,f,l,e,a,m){var h={STRONG_SUCCESS_INDICATION:"fareharbor.native.indicate.strongSuccessIndication",WEAK_SUCCESS_INDICATION:"fareharbor.native.indicate.weakSuccessIndication",STRONG_ERROR_INDICATION:"fareharbor.native.indicate.strongErrorIndication",WEAK_ERROR_INDICATION:"fareharbor.native.indicate.weakErrorIndication"},d={NFC:"nfc",BLUETOOTH_EMV:"bluetooth_emv"},
b=f.slipstream("isNative")||!1,A=f.slipstream("nativeClient")||"",s=f.slipstream("nativeClientVersion")||"",r=f.slipstream("isDebug"),y=f.slipstream("domain"),G=f.slipstream("protocol"),w=function(a,b){b=b||{};a.shortname=b.shortname||null;a.emvConnected=b.emvConnected||!1;a.serialNumber=b.serialNumber||null;a.readerType=b.reader||d.BLUETOOTH_EMV},B={isNative:b,client:A,version:s,EMV_TYPES:d,broadcast:function(a,b,c){c=c||"fareharbor";console.info("native: triggering",a,b,c);g.webkit&&g.webkit.messageHandlers&&
g.webkit.messageHandlers[c]?(b=_.extend({type:a},b),g.webkit.messageHandlers[c].postMessage(b)):g.fhdroid?b?fhdroid.postMessage(a,_.stringifyJSON(b)):fhdroid.postMessage(a):console.warn("native: native client unavailable")},indicate:function(a){a=a||h.WEAK_SUCCESS_INDICATION;B.broadcast("fareharbor.native.indicate",{indication:a})},print:function(a){var b={};if(a){var c=["<!DOCTYPE html>",'<html class="native-print">',"<head>",'<meta name="viewport" content="initial-scale=1.0" />'];_.forEach($('head link[type="text/css"][href^="/"]'),
function(a){a=$(a).attr("href");a=_.startsWith(a,"//")?G+":"+a:G+"://"+y+a;c.push('<link rel="stylesheet" href="'+a+'" type="text/css">')});c.push("</head>");c.push("<body>");c.push(a.outerHTML);c.push("</body>");c.push("</html>");b.html=c.join("\n")}console.info("native: print",b);B.broadcast("fareharbor.native.print",b)},isEmvConnected:function(a){return B.shortname===a.shortname&&B.emvConnected},connectEmv:function(a){w(B,a);console.info("stripeEmv: native: setting up EmvConnection",a)},disconnectEmv:function(){w(B);
B.broadcast("fareharbor.native.emv.disconnect");console.info("stripeEmv: native: requesting the native application disconnect")}};_.extend(B,h);l.on(c,"auth.logout",function(){B.broadcast("fareharbor.native.loggedOut")});k.currentUser.isAuthenticated||B.broadcast("fareharbor.native.logOut");g.FH={nativeEvent:function(a){c.$safeApply(function(){l.broadcast(a.type,a)})}};B.broadcast("fareharbor.native.ready",{sonarKey:f.slipstream("pusherKey")},"fareharborExtended");l.on(c,"fareharbor.native.inApp",
function(a,b){B.isNative=!0;b=b||{};B.client=b.client||B.client||"unknown";B.version=b.version||B.version||"unknown";b.shortname===m.Company.ADMIN_SHORTNAME?B.disconnectEmv():B.connectEmv(b)});l.on(c,"navigation.company.updated",function(a,b){if(b&&b.company){var c=b.company,d=k.effectiveGroup({},c),c=_.pick(c,"shortname name language imageCdnUrl imageEmailCdnUrl features processorCurrency processorCountry timezone timeFormatType isAffiliate isCharter".split(" ")),d=_.pick(d,["pk","groupPermissions"]);
B.broadcast("fareharbor.native.companyChanged",{company:c,group:d},"fareharborExtended")}});f=function(){var a=k.effectiveGroup({},k.currentUser.company);B.broadcast("fareharbor.native.userPermissionsChanged",{group:_.pick(a,["pk","groupPermissions"])},"fareharborExtended")};l.on(c,"dashboard.shared.userPermissionsChanged",f);l.on(c,"dashboard.shared.permissionsGroupChanged",f);l.on(c,"fareharbor.native.booking.open",function(b,c){var d=a.populate(a.dashboard.overlay.contact.booking,{shortname:c.shortname,
contactPk:c.contactPk,bookingUuid:c.bookingUuid});e.navigate(d)});l.on(c,"fareharbor.native.navigate",function(a,b){e.navigate(b.url)});if(r)l.on(c,"fareharbor.native.test",function(a,b){g.confirm("fareharbor.native.test triggered; respond?")&&B.broadcast("fareharbor.native.testSucceeded",{number:42})});return B}]);m.run(["$rootScope","native",function(c,g){c.native=g}])})();angular.module("navigation",["navigation.services","navigation.directives"]);
(function(){var m=angular.module("navigation.directives",["clientOptions.services","lib.services"]);m.directive("ngNavigationActive",["d","navigation",function(c,k){return{restrict:"A",link:function(f,l,e){var a=f.isSet(e.ngNavigationExact)?k.pathEquals:k.pathStartsWith,m,h=function(){var c=m();c?_.isString(c)?l.toggleClass("current",!!a(c)):_.isArray(c)?l.toggleClass("current",_.any(c,function(b){return!b?(console.warn("ng-navigation-active: empty url in list",b,c,e.ngNavigationActive,e.ngHref),
!1):!!a(b)})):console.warn("ng-navigation-active: invalid url",c,e.ngNavigationActive,e.ngHref):(console.warn("ng-navigation-active: no url",c,e.ngNavigationActive,e.ngHref),l.removeClass("current"))};if(e.ngNavigationActive)m=c.watcher(f,e.ngNavigationActive,"",h,!0);else if(e.ngHref)m=c.observer(e,"ngHref","",h);else{console.warn("invalid use of ng-navigation-active");return}k.watch(f,h);h()}}}]);var c=function(c,k){m.directive(c,["$injector","$parse","navigation",function(f,l,e){var a=f.invoke(k);
return{transclude:"element",priority:1E3,terminal:!0,restrict:"A",compile:function(e,f,d){e=c+"When";var b=f[e]?l(f[e]):null;return function(c,e,f){var g=a(c,e,f),h,k,l=function(a){k&&k.$destroy();k=c.$new();k.route={bindings:a};d(k,function(a){h&&h.remove();e.after(a);h=a})};c.$watch(function(){return b&&!b(c)?!1:g()||!1},function(a,b){f.ngThen&&(c[f.ngThen]=!!a);a&&b?l(a):a?l(a):b&&(k&&k.$destroy(),h&&(h.remove(),h=null))},!0)}}}}])};c("ngNavigationSpec",["$parse","navigation",function(c,k){var f=
{prefix:"pathStartsWith",path:"pathEquals"};return function(l,e,a){var m=_.bind(c(a.ngNavigationSpec),null,l),h=function(a){return k[f[a[0]]](a[1])};return function(){var a=m();return _.chooseFirst(a,h)}}}]);c("ngNavigationPrefix",["$parse","navigation",function(c,k){return function(f,l,e){var a=_.bind(c(e.ngNavigationPrefix),null,f),m=function(a){if(!a)throw Error("ng-navigation-prefix: invalid paths: "+e.ngNavigationPrefix);return k.pathStartsWith(a)};return function(){var c=a();if(_.isUndefined(c))throw Error("ng-navigation-prefix: undefined paths: "+
e.ngNavigationPrefix);_.isArray(c)||(c=[c]);if(!c.length)throw Error("ng-navigation-prefix: empty paths: "+e.ngNavigationPrefix);return _.chooseFirst(c,m)}}}]);c("ngNavigationPath",["$parse","navigation",function(c,k){return function(f,l,e){var a=_.bind(c(e.ngNavigationPath),null,f),m=function(a){if(!a)throw Error("ng-navigation-path: invalid paths: "+e.ngNavigationPath);return k.pathEquals(a)};return function(){var c=a();if(_.isUndefined(c))throw Error("ng-navigation-path: undefined paths: "+e.ngNavigationPath);
_.isArray(c)||(c=[c]);if(!c.length)throw Error("ng-navigation-path: empty paths: "+e.ngNavigationPath);return _.chooseFirst(c,m)}}}]);c("ngNavigationSection",["navigation",function(c){var k={root:"inRootSection",company:"inCompanySection",manifest:"inManifestSection",dashboard:"inDashboardSection"};return function(f,l,e){return function(){return c[k[e.ngNavigationSection]]()}}}]);c("ngNavigationInvoiceLogin",["navigation","urls",function(c,k){var f=k.dashboard.reports.invoices.partnerInvoice.index,
l=function(e){var a=c.get("next");return!a?!1:c.parseQuery(a).source===e};return function(e,a,k){return function(){return c.nextPathEquals(f)&&(l("uuid-invoice")||l("email"))}}}]);m.directive("ngConfirmNavigateAway",["$parse","$rootScope","$window","auth","navigation",function(c,k,f,l,e){return{restrict:"A",require:"?form",compile:function(a,k){var h=k.ngConfirmNavigateAwayWhen?c(k.ngConfirmNavigateAwayWhen):null,d=k.ngConfirmNavigateAwayComplete?c(k.ngConfirmNavigateAwayComplete):null;return function(a,
c,g,k){c=e.url;var m=e.stripQuery(c),q=e.parseQuery(c);if(!f.slipstream.isEmbedded||f.slipstream.isBookEmbed){var w=function(){return g.ngConfirmNavigateAway?g.ngConfirmNavigateAway:T("Your changes will be lost.")},B=function(c){if(l.isSessionExpirationInProgress)return!1;if(h)return h(a,{$url:c});c=!_.isUndefined(c)?e.stripPrefix(c):"";var d=e.stripQuery(c);m!==d?c=!0:(c=e.parseQuery(c),c=!_.isEmpty(q)&&!_.isEqual(q,c)?!0:!1);return c&&k.$dirty},n=function(){if(B())return w()};a.$on("$locationChangeStart",
function(c,e){if(B(e)){var g=f.confirm(T("Are you sure you want to leave this page?")+" "+w());g||(l.isLogoutInProgress=!1,c.preventDefault());d&&d(a,{$complete:g})}});var P=angular.element(f);P.on("beforeunload",n);a.$on("$destroy",function(){P.off("beforeunload",n)})}}}}}]);m.config(["$provide",function(c){c.decorator("ngHrefDirective",["$delegate",function(c){c.shift();return c}])}]);m.directive("ngHref",["$browser","$location","$parse","clientOptions","d","navigation",function(c,k,f,l,e,a){return{restrict:"A",
link:function(c,f,d){var b=!1,g=function(){var c=k();b&&(c=a.multiUrl(c));c=l.reflectUrl(c);d.$set("href",c)},k=e.observer(d,"ngHref","",function(d){!b&&a.parseMultiUrl(d)?(b=!0,a.watch(c,g)):g()})}}}]);c=function(c,k){return m.directive(c,["d","navigation","$parse",function(f,l,e){return{restrict:"A",link:function(a,m,h){var d=a.isSet(h[c+"Strict"]),b=c+"When",A=h[b]?e(h[b]):_.noop,s=f.observer(h,c);m.on("click",function(c){var e=$(c.target),f=s();if(f&&k.test(c)&&(!h[b]||A(a)))if(!c.defaultPrevented&&
(!d||m.is(e)))if(!e.is("a")||m.is(e))a.$apply(function(){l.navigate(f)}),k.preventDefault&&c.preventDefault()})}}}])};c("ngNavigate",{test:function(c){return!c.shiftKey&&!c.controlKey&&!c.metaKey&&!c.altKey}});c("ngShiftNavigate",{test:function(c){return c.shiftKey&&!c.controlKey&&!c.metaKey&&!c.altKey}});c("ngControlNavigate",{test:function(c){return!c.shiftKey&&c.ctrlKey&&!c.metaKey&&!c.altKey}});c("ngMetaNavigate",{test:function(c){return!c.shiftKey&&!c.controlKey&&c.metaKey&&!c.altKey}});c("ngAltNavigate",
{test:function(c){return!c.shiftKey&&!c.controlKey&&!c.metaKey&&c.altKey},preventDefault:!0});c("ngShiftOrAltNavigate",{test:function(c){return(c.shiftKey||c.altKey)&&!c.controlKey&&!c.metaKey}});m.directive("ngRedirect",["navigation",function(c){return{restrict:"A",link:function(k,f,l){f=k.$eval(l.ngRedirect);k=k.$eval(l.ngRedirectMode)||"";if(!f)throw Error("ng-redirect: no url: "+l.ngRedirect);c.redirect(f,k)}}}]);m.directive("ngReload",["navigation",function(c){return{restrict:"A",link:function(k,
f,l){c.reload()}}}]);m.directive("ngReloadRoot",["$location","$window","navigation","urls",function(c,k,f,l){return{restrict:"A",link:function(){var e=f.compose(l.root.index,c.search());k.location.replace(e)}}}])})();
(function(){var m=angular.module("navigation.services",["auth.services","db.services","lib.services","urls.services"]);m.factory("navigation",["$rootScope","$browser","$injector","$location","$timeout","$window","auth","db","events","models","urls",function(c,g,k,f,l,e,a,m,h,d,b){m.slipstream("isDebug");var A=m.slipstream("protocol"),s=m.slipstream("domain"),r=g.baseHref();"/"===r[r.length-1]&&(r=r.slice(0,r.length-1));var y=function(a){return!r&&"/embeds/"===a.slice(0,8)||!r&&"/"!==a.slice(0,1)?
!1:a.slice(0,r.length)===r},G=function(a){return!y(a)?r+a:a},w="_top"===$("base").attr("target"),B=function(a,b){var c=e;w&&(c=e.top);b?c.location.replace(a):c.location.assign(a)},n={admin:"admin-section",company:"company-section",dashboard:"dashboard-section",root:"root-section"};n.all=_.values(n).join(" ");var P=function(a,b){b?($("body").removeClass(n.all),$("body").addClass(n[a])):$("body").removeClass(n[a])},I={glob:"([a-zA-Z0-9-_.]+)",slug:"([a-z0-9-_.]+)",path:"([a-z-/]+)",pk:"(-?[0-9]+)",
pks:"((-?[0-9]+)(,-?[0-9]+)*)"},p=function(a,b,c){a=a.replace(/\//g,"\\/");a=a.replace(/:(\w+)(\((\w+)\))?/g,function(a,b,d,e){c.push(b);return d?I[e]:I.glob});return RegExp("^"+a+(b?"$":""))},t={},K=function(a,b){if(!a)throw Error("navigation: matcher not given path");if(!_.isString(a))throw console.error("navigation: matcher not given a string path",a,b),Error("navigation: matcher not given string path");var c=a+(b?"$":""),d=t[c];if(d)return d;var e=[],g,h=u.parseMultiUrl(a);if(h&&h.multiPath){g=
p(h.path,!1,e);var k=[],l=p(h.multiPath,b,k),d=function(){var a=f.search()[h.key];if(_.isUndefined(a))return!1;a=a||"/";"/"!==a[a.length-1]&&(a+="/");var b=u.path;"/"!==b[b.length-1]&&(b+="/");b=_.toArray(g.exec(b));if(!b.length)return!1;a=_.toArray(l.exec(a));if(!a.length)return!1;var c={};_.forEach(_.rest(b),function(a,b){c[e[b]]=a});_.forEach(_.rest(a),function(a,b){c[k[b]]=a});return c}}else g=p(a,b,e),d=function(){var a=u.path;"/"!==a[a.length-1]&&(a+="/");a=_.toArray(g.exec(a));if(!a.length)return!1;
var b={};_.forEach(_.rest(a),function(a,c){b[e[c]]=a});return b};return t[c]=d},x={};d=function(a,b){return function(c,d){var e=a+c;if(!d&&!_.isUndefined(x[e]))return x[e];var f=b(c);return x[e]=f}};var E=function(a,b){return function(){if(!_.isUndefined(x[a]))return x[a];var c=b();return x[a]=c}},J=function(a){try{return decodeURIComponent(a)}catch(b){}},v=function(a){var b={},c,d;_.forEach((a||"").split("&"),function(a){a&&(c=a.replace(/\+/g,"%20").split("="),d=J(c[0]),_.isUndefined(d)||(a=!_.isUndefined(c[1])?
J(c[1]):!0,Object.hasOwnProperty.call(b,d)?_.isArray(b[d])?b[d].push(a):b[d]=[b[d],a]:b[d]=a))});return b},M=function(a){var b=a.replace("%3F","?");return _.contains(b,"?")?b.split("?")[0]:a},R=function(a){return a&&(a=a.replace("%3F","?"),_.contains(a,"?"))?(a=a.split("?")[1],v(a)):{}},u={base:r,url:G(f.url()||"/"),path:G(f.path()||"/"),compose:function(a,b,c){b=_.pick(b,function(b,d){try{return!RegExp("[&\\?]"+d+"="+(c?"":b)).test(a)}catch(e){return!0}});if(b=m.toKeyValue(b)){var d="",e=a.indexOf("#");
-1!==e&&(d=a.slice(e),a=a.slice(0,e));return _.contains(a,"?")?a+"&"+b+d:a+"?"+b+d}return a},parseQuery:R,stripQuery:M,stripPrefix:function(a){return a.replace(/^https?:\/\/[^\/]+/,"")},extendQuery:function(a,b){var c=u.parseQuery(a);_.extend(c,b);a=M(a);return u.compose(a,c)},pathStartsWith:d("pathStartsWith",function(a){return K(a)()}),pathEquals:d("pathEquals",function(a){return K(a,!0)()}),nextPathEquals:d("nextPathEquals",function(a){a=p(a,!0,[]);var b=f.search().next;if(_.isUndefined(b))return!1;
b=M(b);return(a=a.exec(b))&&a.length}),inCompanySection:E("inCompanySection",function(){var a,c=!u.inRootSection()&&!u.inDashboardSection()&&!u.inLegacyManifestSection()&&!!(a=u.pathStartsWith(b.company.index));P("company",c);return a}),inDashboardSection:E("inDashboardSection",function(){var a,c=!u.inRootSection()&&!!(a=u.pathStartsWith(b.dashboard.index));P("dashboard",c);return a}),inLegacyManifestSection:E("inLegacyManifestSection",function(){var a,c=!u.inRootSection()&&!!(a=u.pathStartsWith(b.legacyManifest));
P("dashboard",c);return a}),inRootSection:E("inRootSection",function(){var a=!1;_.forEach(b.root,function(c){a=c===b.root.index?a||u.pathEquals(c):_.isObject(c)?a||u.pathStartsWith(c.index):a||u.pathStartsWith(c)});P("root",a);return a}),reload:function(){l(function(){location.reload()})},redirect:function(a,b,c){if(f.$$replace)l(_.bind(u.redirect,u,a,b,c));else if(a=u.multiUrl(a||"/",b||"extend"),!y(a)||c)B(a,!0);else return a=y(a)?a.slice(r.length):a,f.replace(),f.url(a),a},navigate:function(a,
b,c){a=u.multiUrl(a||"/",b||"replace");if(!y(a)||c)B(a);else return a=y(a)?a.slice(r.length):a,f.url(a),a},forceNavigate:function(a){return c.$apply(function(){return u.navigate(a)})},open:function(a,b,c){c&&(c.stopPropagation(),c.preventDefault());b=_.extend({},{status:1,scrollbars:1,resizable:1},b);b=_.map(b,function(a,b){return b+"="+a}).join(",");e.open(a,"$$window",b)},get:function(a){return f.search()[a]},set:function(a,b,c){c&&f.replace();return f.search(a,b)},clear:function(a,b){b&&f.replace();
return f.search(a,null)},getInt:function(a){a=_.int(this.get(a));if(!isNaN(a))return a},getPk:function(a){a=u.getInt(a);if(!_.isUndefined(a)&&!(0>=a))return a},getPks:function(a){return _.splitPks(this.get(a))},parseMultiUrl:function(a){if(_.isUndefined(a))console.warn("navigation: invalid multi-url",a);else if(!/^(https?|ftp|mailto|tel)/.test(a)){var b=_.split(a,"@",2);if(2===b.length&&(a=b[0],b=b[1])){var b=_.split(b,"=",2),c=b[0],d=b[1]||"",e={},b=_.split(d,"?",2);2===b.length&&(d=b[0],e=v(b[1]));
return{path:a,key:c,multiPath:d,search:e}}}},multiUrl:function(a,b,c){if(!a)throw Error("navigation: bad url to multi");b=b||"replace";var d=u.parseMultiUrl(a),e={};d&&(b="extend",d.multiPath&&(e[d.key]=d.multiPath),_.extend(e,d.search));"extend"===b&&(e=_.extend({},f.search(),e),d&&!d.multiPath&&delete e[d.key]);d&&(a=d.path,c?a=c:u.pathStartsWith(d.path)&&(a=u.path));return u.compose(a,e)},watch:function(a,b,c){var d=function(){a.$safeApply(function(){b(u.path,u.url)})},e=function(a,b){if(_.isObject(c)&&
c.search)if(a===b)d();else{var e=c.search,f=R(a),g=R(b);e&&(f=_.pick(f,e),g=_.pick(g,e));_.isEqual(f,g)||d()}else d()};return"path"===c?a.$watch(function(){var a=u.parseMultiUrl(u.url);return a?a.path:u.path},d):"multiPath"===c?a.$watch(function(){var a=u.parseMultiUrl(u.url);return a?a.key+"="+a.multiPath:""},d):a.$watch(function(){return u.url},e)},currentCompany:null,updateCurrentCompany:function(a,b){var c=k.get("analytics");u.currentCompany=b;c.trackCompany(u.currentCompany);h.broadcast("navigation.company.updated",
{company:u.currentCompany});a.$on("$destroy",function(){u.currentCompany=null;c.trackCompany(null);h.broadcast("navigation.company.updated",{company:u.currentCompany})})},isCurrentCompany:function(a){return u.currentCompany&&_.isUriEqual(u.currentCompany,a)},absoluteUrl:function(a){a=_.isUndefined(a)?u.url:G(a);return A+"://"+s+a},loginRedirectUrl:function(a){var c;c=u.currentCompany?u.currentCompany.$url(b.company.login):b.root.login;var d=u.path,e=_.extend({},f.search());delete e.next;var e=u.compose(d,
e),g={};/\/login\//g.test(d)||(g.next=e,a&&(g.require="yes"));return u.compose(c,g)},startBookingUrl:function(c,d){if(!c)return d.company.$url(b.dashboard.bookings.index);var e=c.availability.startAt,f=c.company,g=moment().startOf("day");0>e.diff(g)&&(e=g);c.affiliation&&c.affiliation.affiliateCompany===a.currentUser.company&&(a.storage.set("currentPartnerSelection",c.company.uri),f=c.affiliation.affiliateCompany);if(u.pathStartsWith(b.dashboard.bookings.day.index))g=b.dashboard.bookings.day.date;
else if(u.pathStartsWith(b.dashboard.bookings.agenda.index))g=b.dashboard.bookings.agenda.date;else if(u.pathStartsWith(b.dashboard.bookings.calendar))g=b.calendarUrls(b.dashboard.bookings.calendar).month;else if(u.pathStartsWith(b.dashboard.bookings.grid.index))g=b.dashboard.bookings.grid.date;else if(u.pathStartsWith(b.dashboard.bookings.timeline.index))g=b.dashboard.bookings.timeline.date;else return u.compose(b.populate(b.dashboard.bookings.index,{shortname:f.shortname}),{date:e.format("YYYY-MM-DD")});
return b.populate(g,{shortname:f.shortname,year:e.format("YYYY"),month:e.format("MM"),date:e.format("YYYY-MM-DD")})}},X=!0;c.$on("$locationChangeStart",function(a){c.$evalAsync(function(){c.$broadcast("$locationChangeComplete",!a.defaultPrevented);a.defaultPrevented&&c.$broadcast("$locationChangeCancelled")})});var F=function(a){if(function(){return!_.some("jacobite lobosondamadeira safarimadeira cruzeiros-da-oura benagilexpress carvoeirocaves alextester dinnertrain pureboats starboardsboats macbike-all boomchicago boatamsterdam schuttevaer berlinonbike".split(" "),
function(b){return a.includes(b)})}())return!1;var c=u.currentCompany?u.currentCompany.shortname:"",d=[b.embeds.calendar.index,b.embeds.items.index,b.embeds.cart.index,b.embeds.checkin.index,b.embeds.partners.index].map(function(a){return a.replace(":shortname/",c)});return _.some(d,function(b){return a.includes(b)})};c.$on("$locationChangeSuccess",function(a,b,c){b=b?u.stripPrefix(b):"/";b=G(b);c=c?u.stripPrefix(c):"/";c=G(c);a=f.path();a=G(a||"/");"/"!==a[a.length-1]?u.redirect(u.compose(a+"/",
f.search())):(x={},u.url=b,u.path=a,(b!==c||X)&&l(function(){console.info("navigation: navigation complete",u.url,b);g.notifyWhenNoOutstandingRequests(function(){u.url===b&&!F(u.path)&&k.get("analytics").trackView(b)})}),X=!1)});e.$$navigation=u;e.$$location=f;return u}]);m.run(["$rootScope","navigation",function(c,g){c.navigation=g}])})();
(function(){var m=angular.module("embeds.cart","lib auth cache cart clientOptions db flash lightframe native navigation tracking urls".split(" "));configure(m);m.controller("embeds.cart.IndexCtrl",["$scope","cart","events","lightframe","navigation","xmessage",function(c,g,k,f,l,e){c.indexCtrl={carts:[],cartEntriesTotal:0};var a,m=function(){c.indexCtrl.cartEntriesTotal=0;c.indexCtrl.carts=_.filter(g.allCompanies.carts,function(a){c.indexCtrl.cartEntriesTotal+=a.entries.length;return!!a.entries.length});
e.broadcast(c.indexCtrl.carts.length?"fareharbor.cart.show":"fareharbor.cart.hide");a=moment()},h=function(){g.allCompanies.load().then(m)};h();e.on(c,"fareharbor.cart.changed",h);e.on(c,"fareharbor.window.focused",_.debounce(h,1E4,{leading:!0,trailing:!1}));setInterval(function(){(!a||12E4<=moment().diff(a))&&h()},12E4);c.indexCtrl.selectedCart=null;c.viewCart=function(a){if(a=a||c.indexCtrl.selectedCart)a=g.permalinkUrl(a.company),a=l.compose(a,{"from-embed":"cart"}),f.open(a),c.indexCtrl.selectedCart=
null};c.hide=function(){e.broadcast("fareharbor.cart.hide")}}])})();
